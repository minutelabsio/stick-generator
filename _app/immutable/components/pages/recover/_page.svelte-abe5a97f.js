import{S as j,i as K,s as B,E as N,F as W,m as k,h as f,n as c,b as x,D as _,C as E,e as Y,g as V,t as C,d as q,f as P,a9 as le,P as ne,k as I,a as A,q as R,l as D,c as L,r as U,aa as z,H as te,I as oe,u as re,K as se,x as H,y as O,z as G,A as M,G as ae}from"../../../chunks/index-5bd3dcd0.js";import{s as ie,l as ce}from"../../../chunks/index-29800c50.js";import{R as v,p as Z,U as ue,l as fe}from"../../../chunks/account-a239d173.js";import{g as he}from"../../../chunks/nav-1ca5ec09.js";function pe(o){let e,t;return{c(){e=N("svg"),t=N("path"),this.h()},l(r){e=W(r,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,xmlns:!0});var n=k(e);t=W(n,"path",{"fill-rule":!0,"clip-rule":!0,d:!0,fill:!0}),k(t).forEach(f),n.forEach(f),this.h()},h(){c(t,"fill-rule","evenodd"),c(t,"clip-rule","evenodd"),c(t,"d","M14.2071 0.292893C14.5976 0.683417 14.5976 1.31658 14.2071 1.70711L6.20711 9.70711C5.81658 10.0976 5.18342 10.0976 4.79289 9.70711L0.792893 5.70711C0.402369 5.31658 0.402369 4.68342 0.792893 4.29289C1.18342 3.90237 1.81658 3.90237 2.20711 4.29289L5.5 7.58579L12.7929 0.292893C13.1834 -0.0976311 13.8166 -0.0976311 14.2071 0.292893Z"),c(t,"fill","currentColor"),c(e,"width","15"),c(e,"height","10"),c(e,"viewBox","0 0 15 10"),c(e,"fill","none"),c(e,"xmlns","http://www.w3.org/2000/svg")},m(r,n){x(r,e,n),_(e,t)},p:E,i:E,o:E,d(r){r&&f(e)}}}class de extends j{constructor(e){super(),K(this,e,null,pe,B,{})}}function me(o){let e,t;return{c(){e=N("svg"),t=N("path"),this.h()},l(r){e=W(r,"svg",{xmlns:!0,width:!0,height:!0,fill:!0});var n=k(e);t=W(n,"path",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),k(t).forEach(f),n.forEach(f),this.h()},h(){c(t,"stroke","currentColor"),c(t,"stroke-linecap","round"),c(t,"stroke-linejoin","round"),c(t,"stroke-width","2"),c(t,"d","m8 1 5 5m0 0-5 5m5-5H1"),c(e,"xmlns","http://www.w3.org/2000/svg"),c(e,"width","14"),c(e,"height","12"),c(e,"fill","none")},m(r,n){x(r,e,n),_(e,t)},p:E,i:E,o:E,d(r){r&&f(e)}}}class _e extends j{constructor(e){super(),K(this,e,null,me,B,{})}}function ge(o){let e,t;return{c(){e=N("svg"),t=N("path"),this.h()},l(r){e=W(r,"svg",{xmlns:!0,width:!0,height:!0,fill:!0});var n=k(e);t=W(n,"path",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),k(t).forEach(f),n.forEach(f),this.h()},h(){c(t,"stroke","currentColor"),c(t,"stroke-linecap","round"),c(t,"stroke-linejoin","round"),c(t,"stroke-width","2"),c(t,"d","M1 13v1a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3v-1m-4-8L9 1m0 0L5 5m4-4v12"),c(e,"xmlns","http://www.w3.org/2000/svg"),c(e,"width","18"),c(e,"height","18"),c(e,"fill","none")},m(r,n){x(r,e,n),_(e,t)},p:E,i:E,o:E,d(r){r&&f(e)}}}class ve extends j{constructor(e){super(),K(this,e,null,ge,B,{})}}function be(o){const e=o.slice(),t=e[2][e[0]].props;return e[5]=t.$$on_click,e[6]=le(t,["$$on_click"]),e}function ke(o){let e,t,r=o[2][o[0]].text+"",n,a,i,d,p,l=o[0]===v.Processing&&J(),s=o[0]===v.Done&&Q(),$=[{class:"btn btn-primary !btn-lg !h-[56px] !min-h-0 w-fit gap-2"},o[6]],y={};for(let u=0;u<$.length;u+=1)y=ne(y,$[u]);return{c(){e=I("button"),l&&l.c(),t=A(),n=R(r),a=A(),s&&s.c(),this.h()},l(u){e=D(u,"BUTTON",{class:!0});var h=k(e);l&&l.l(h),t=L(h),n=U(h,r),a=L(h),s&&s.l(h),h.forEach(f),this.h()},h(){z(e,y)},m(u,h){x(u,e,h),l&&l.m(e,null),_(e,t),_(e,n),_(e,a),s&&s.m(e,null),e.autofocus&&e.focus(),i=!0,d||(p=te(e,"click",function(){oe(o[5])&&o[5].apply(this,arguments)}),d=!0)},p(u,h){o=u,o[0]===v.Processing?l||(l=J(),l.c(),l.m(e,t)):l&&(l.d(1),l=null),(!i||h&5)&&r!==(r=o[2][o[0]].text+"")&&re(n,r),o[0]===v.Done?s?h&1&&P(s,1):(s=Q(),s.c(),P(s,1),s.m(e,null)):s&&(V(),C(s,1,1,()=>{s=null}),q()),z(e,y=se($,[{class:"btn btn-primary !btn-lg !h-[56px] !min-h-0 w-fit gap-2"},h&5&&o[6]]))},i(u){i||(P(s),i=!0)},o(u){C(s),i=!1},d(u){u&&f(e),l&&l.d(),s&&s.d(),d=!1,p()}}}function ye(o){let e,t,r,n,a,i,d,p;return t=new ve({}),{c(){e=I("label"),H(t.$$.fragment),r=R(" Upload your recovery kit"),n=A(),a=I("input"),this.h()},l(l){e=D(l,"LABEL",{for:!0,class:!0});var s=k(e);O(t.$$.fragment,s),r=U(s," Upload your recovery kit"),s.forEach(f),n=L(l),a=D(l,"INPUT",{id:!0,type:!0,accept:!0,class:!0}),this.h()},h(){c(e,"for","upload-recovery-kit"),c(e,"class","btn btn-primary !btn-lg !h-[56px] !min-h-0 w-fit gap-2"),c(a,"id","upload-recovery-kit"),c(a,"type","file"),c(a,"accept",".txt"),c(a,"class","hidden")},m(l,s){x(l,e,s),G(t,e,null),_(e,r),x(l,n,s),x(l,a,s),i=!0,d||(p=te(a,"change",o[4]),d=!0)},p:E,i(l){i||(P(t.$$.fragment,l),i=!0)},o(l){C(t.$$.fragment,l),i=!1},d(l){l&&f(e),M(t),l&&f(n),l&&f(a),d=!1,p()}}}function J(o){let e;return{c(){e=I("span"),this.h()},l(t){e=D(t,"SPAN",{class:!0}),k(e).forEach(f),this.h()},h(){c(e,"class","animate-spin ease-linear rounded-full border-2 border-t-2 border-t-orange-500 border-neutral-900 w-[16px] h-[16px] text-sm")},m(t,r){x(t,e,r)},d(t){t&&f(e)}}}function Q(o){let e,t;return e=new _e({}),{c(){H(e.$$.fragment)},l(r){O(e.$$.fragment,r)},m(r,n){G(e,r,n),t=!0},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){C(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function we(o){let e,t,r,n;const a=[ye,ke],i=[];function d(l,s){return l[0]===v.Ready||l[0]===v.Error?0:1}function p(l,s){return s===1?be(l):l}return e=d(o),t=i[e]=a[e](p(o,e)),{c(){t.c(),r=Y()},l(l){t.l(l),r=Y()},m(l,s){i[e].m(l,s),x(l,r,s),n=!0},p(l,[s]){let $=e;e=d(l),e===$?i[e].p(p(l,e),s):(V(),C(i[$],1,1,()=>{i[$]=null}),q(),t=i[e],t?t.p(p(l,e),s):(t=i[e]=a[e](p(l,e)),t.c()),P(t,1),t.m(r.parentNode,r))},i(l){n||(P(t),n=!0)},o(l){C(t),n=!1},d(l){i[e].d(l),l&&f(r)}}}function $e(o,e,t){let r,{handleFileInput:n}=e,{state:a}=e,i;function d(){i=this.files,t(1,i)}return o.$$set=p=>{"handleFileInput"in p&&t(3,n=p.handleFileInput),"state"in p&&t(0,a=p.state)},o.$$.update=()=>{o.$$.dirty&10&&i&&n(i),o.$$.dirty&1&&t(2,r={[v.Processing]:{text:"Processing recovery kit...",props:{disabled:a===v.Processing,$$on_click:()=>{}}},[v.Done]:{text:"Continue to the app",props:{$$on_click:()=>he("/")}}})},[a,i,r,n,d]}class xe extends j{constructor(e){super(),K(this,e,$e,we,B,{handleFileInput:3,state:0})}}function Ee(o){let e,t;return{c(){e=I("p"),t=R(`If you’ve lost access to all of your connected devices, you can use your
      recovery kit to restore access to your private data.`)},l(r){e=D(r,"P",{});var n=k(e);t=U(n,`If you’ve lost access to all of your connected devices, you can use your
      recovery kit to restore access to your private data.`),n.forEach(f)},m(r,n){x(r,e,n),_(e,t)},p:E,i:E,o:E,d(r){r&&f(e)}}}function Ie(o){let e,t,r,n,a,i,d,p=o[2].username.trimmed+"",l,s,$,y;return t=new de({}),{c(){e=I("h3"),H(t.$$.fragment),r=R(" Account recovered!"),n=A(),a=I("p"),i=R("Welcome back "),d=I("strong"),l=R(p),s=R("."),$=R(`
      We were able to successfully recover all of your private data.`),this.h()},l(u){e=D(u,"H3",{class:!0});var h=k(e);O(t.$$.fragment,h),r=U(h," Account recovered!"),h.forEach(f),n=L(u),a=D(u,"P",{});var S=k(a);i=U(S,"Welcome back "),d=D(S,"STRONG",{});var g=k(d);l=U(g,p),s=U(g,"."),g.forEach(f),$=U(S,`
      We were able to successfully recover all of your private data.`),S.forEach(f),this.h()},h(){c(e,"class","flex items-center gap-2 font-normal text-base text-green-600")},m(u,h){x(u,e,h),G(t,e,null),_(e,r),x(u,n,h),x(u,a,h),_(a,i),_(a,d),_(d,l),_(d,s),_(a,$),y=!0},p(u,h){(!y||h&4)&&p!==(p=u[2].username.trimmed+"")&&re(l,p)},i(u){y||(P(t.$$.fragment,u),y=!0)},o(u){C(t.$$.fragment,u),y=!1},d(u){u&&f(e),M(t),u&&f(n),u&&f(a)}}}function X(o){let e,t;return{c(){e=I("p"),t=R(`We were unable to recover your account. Please double check that you
      uploaded the correct file.`),this.h()},l(r){e=D(r,"P",{class:!0});var n=k(e);t=U(n,`We were unable to recover your account. Please double check that you
      uploaded the correct file.`),n.forEach(f),this.h()},h(){c(e,"class","text-red-600")},m(r,n){x(r,e,n),_(e,t)},d(r){r&&f(e)}}}function ee(o){let e,t="It should be a file named Webnative-RecoveryKit-{yourUsername}.txt",r;return{c(){e=I("p"),r=R(t),this.h()},l(n){e=D(n,"P",{class:!0});var a=k(e);r=U(a,t),a.forEach(f),this.h()},h(){c(e,"class","text-xxs")},m(n,a){x(n,e,a),_(e,r)},d(n){n&&f(e)}}}function De(o){let e,t,r,n,a,i,d,p,l,s,$,y;const u=[Ie,Ee],h=[];function S(m,b){return m[1]===v.Done?0:1}a=S(o),i=h[a]=u[a](o);let g=o[1]===v.Error&&X();s=new xe({props:{handleFileInput:o[0],state:o[1]}});let w=o[1]!==v.Done&&ee();return{c(){e=I("div"),t=I("h1"),r=R("Recover your account"),n=A(),i.c(),d=A(),g&&g.c(),p=A(),l=I("div"),H(s.$$.fragment),$=A(),w&&w.c(),this.h()},l(m){e=D(m,"DIV",{class:!0});var b=k(e);t=D(b,"H1",{class:!0});var F=k(t);r=U(F,"Recover your account"),F.forEach(f),n=L(b),i.l(b),d=L(b),g&&g.l(b),p=L(b),l=D(b,"DIV",{class:!0});var T=k(l);O(s.$$.fragment,T),$=L(T),w&&w.l(T),T.forEach(f),b.forEach(f),this.h()},h(){c(t,"class","text-xl"),c(l,"class","flex flex-col gap-2"),c(e,"class","min-h-[calc(100vh-96px)] flex flex-col items-start justify-center max-w-[590px] m-auto gap-6 pb-5 text-sm")},m(m,b){x(m,e,b),_(e,t),_(t,r),_(e,n),h[a].m(e,null),_(e,d),g&&g.m(e,null),_(e,p),_(e,l),G(s,l,null),_(l,$),w&&w.m(l,null),y=!0},p(m,[b]){let F=a;a=S(m),a===F?h[a].p(m,b):(V(),C(h[F],1,1,()=>{h[F]=null}),q(),i=h[a],i?i.p(m,b):(i=h[a]=u[a](m),i.c()),P(i,1),i.m(e,d)),m[1]===v.Error?g||(g=X(),g.c(),g.m(e,p)):g&&(g.d(1),g=null);const T={};b&2&&(T.state=m[1]),s.$set(T),m[1]!==v.Done?w||(w=ee(),w.c(),w.m(l,null)):w&&(w.d(1),w=null)},i(m){y||(P(i),P(s.$$.fragment,m),y=!0)},o(m){C(i),C(s.$$.fragment,m),y=!1},d(m){m&&f(e),h[a].d(),g&&g.d(),M(s),w&&w.d()}}}function Pe(o,e,t){let r;ae(o,ie,i=>t(2,r=i));let n=r.session?v.Done:v.Ready;return[async i=>{const d=new FileReader;d.onload=async p=>{t(1,n=v.Processing);try{const{authStrategy:l,program:{components:{crypto:s,reference:$,storage:y}}}=r,u=p.target.result.split("username: ")[1].split("key: "),h=ce(u[1].replace(/(\r\n|\n|\r)/gm,""),"base64pad"),S=u[0].replace(/(\r\n|\n|\r)/gm,""),g=await Z(S),w=await r.program.agentDID(),m=`${S.split("#")[0]}#${w}`,b=await Z(m);y.setItem(ue,m);const{success:F}=await r.program.fileSystem.recover({newUsername:b,oldUsername:g,readKey:h});if(!F)throw new Error("Failed to recover file system");await fe(b,m),t(1,n=v.Done)}catch(l){console.error(l),t(1,n=v.Error)}},d.onerror=p=>{console.error(p),t(1,n=v.Error)},d.readAsText(i[0])},n,r]}class Re extends j{constructor(e){super(),K(this,e,Pe,De,B,{handleFileInput:0})}get handleFileInput(){return this.$$.ctx[0]}}function Ue(o){let e,t;return e=new Re({}),{c(){H(e.$$.fragment)},l(r){O(e.$$.fragment,r)},m(r,n){G(e,r,n),t=!0},p:E,i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){C(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}class Le extends j{constructor(e){super(),K(this,e,null,Ue,B,{})}}export{Le as default};
