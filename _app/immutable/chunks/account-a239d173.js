import{s as n,f as u,c as g,d as l,e as w}from"./index-29800c50.js";import{$ as p}from"./index-5bd3dcd0.js";import{g as y}from"./backup-7521c0ec.js";import{A as f}from"./account-settings-a010cf93.js";import{G as c,A as m}from"./gallery-bc559059.js";const d="fullUsername";var h=(s=>(s[s.Ready=0]="Ready",s[s.Processing=1]="Processing",s[s.Error=2]="Error",s[s.Done=3]="Done",s))(h||{});const G=async s=>{const e=await s.keystore.publicExchangeKey(),t=await s.keystore.getAlgorithm();return g(s,e,t)},K=async s=>{const e=s.normalize("NFD"),t=await l(new TextEncoder().encode(e));return w(t,"base32").slice(0,32)},N=async s=>{const{authStrategy:e,program:{components:{storage:t}}}=p(n),{success:r}=await e.register({username:s});if(!r)return r;const a=await e.session();u.set(a.fs),await k(a.fs);const o=await t.getItem(d);return n.update(i=>({...i,username:{full:o,hashed:s,trimmed:o.split("#")[0]},session:a})),r},k=async s=>{await s.mkdir(c[m.PUBLIC]),await s.mkdir(c[m.PRIVATE]),await s.mkdir(f)},P=async(s,e)=>{const{authStrategy:t,program:{components:{storage:r}}}=p(n),a=await t.session();u.set(a.fs);const o=await y(a.fs);await r.setItem(d,e),n.update(i=>({...i,username:{full:e,hashed:s,trimmed:e.split("#")[0]},session:a,backupCreated:o.created}))};export{h as R,d as U,G as c,P as l,K as p,N as r};
