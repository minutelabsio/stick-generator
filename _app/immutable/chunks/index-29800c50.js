var my=Object.defineProperty;var gy=(r,e,t)=>e in r?my(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ss=(r,e,t)=>(gy(r,typeof e!="symbol"?e+"":e,t),t);import{w as writable,_ as __vitePreload}from"./preload-helper-ba922b4b.js";const DEFAULT_THEME_KEY="useDefaultTheme",THEME_KEY="theme",getSystemDefaultTheme=()=>window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",loadTheme=()=>{{const r=localStorage.getItem(DEFAULT_THEME_KEY)!=="undefined"&&JSON.parse(localStorage.getItem(DEFAULT_THEME_KEY)),e=localStorage.getItem(THEME_KEY),t=getSystemDefaultTheme();return r?{selectedTheme:getSystemDefaultTheme(),useDefault:r}:{selectedTheme:e??t??"light",useDefault:r}}},storeTheme=r=>{localStorage.setItem("theme",r)},themeStore=writable(loadTheme()),sessionStore=writable({username:null,session:null,authStrategy:null,program:null,loading:!0,backupCreated:null}),filesystemStore=writable(null),notificationStore=writable([]),accountSettingsStore=writable({avatar:null,loading:!0});function asUint8Array$1(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function allocUnsafe$1(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?asUint8Array$1(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function concat$2(r,e){e||(e=r.reduce((o,s)=>o+s.length,0));const t=allocUnsafe$1(e);let n=0;for(const o of r)t.set(o,n),n+=o.length;return asUint8Array$1(t)}function base$2(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var o=0;o<r.length;o++){var s=r.charAt(o),u=s.charCodeAt(0);if(t[u]!==255)throw new TypeError(s+" is ambiguous");t[u]=o}var f=r.length,l=r.charAt(0),h=Math.log(f)/Math.log(256),p=Math.log(256)/Math.log(f);function m(A){if(A instanceof Uint8Array||(ArrayBuffer.isView(A)?A=new Uint8Array(A.buffer,A.byteOffset,A.byteLength):Array.isArray(A)&&(A=Uint8Array.from(A))),!(A instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(A.length===0)return"";for(var L=0,J=0,ne=0,pe=A.length;ne!==pe&&A[ne]===0;)ne++,L++;for(var de=(pe-ne)*p+1>>>0,H=new Uint8Array(de);ne!==pe;){for(var z=A[ne],ue=0,ce=de-1;(z!==0||ue<J)&&ce!==-1;ce--,ue++)z+=256*H[ce]>>>0,H[ce]=z%f>>>0,z=z/f>>>0;if(z!==0)throw new Error("Non-zero carry");J=ue,ne++}for(var Ee=de-J;Ee!==de&&H[Ee]===0;)Ee++;for(var Be=l.repeat(L);Ee<de;++Ee)Be+=r.charAt(H[Ee]);return Be}function b(A){if(typeof A!="string")throw new TypeError("Expected String");if(A.length===0)return new Uint8Array;var L=0;if(A[L]!==" "){for(var J=0,ne=0;A[L]===l;)J++,L++;for(var pe=(A.length-L)*h+1>>>0,de=new Uint8Array(pe);A[L];){var H=t[A.charCodeAt(L)];if(H===255)return;for(var z=0,ue=pe-1;(H!==0||z<ne)&&ue!==-1;ue--,z++)H+=f*de[ue]>>>0,de[ue]=H%256>>>0,H=H/256>>>0;if(H!==0)throw new Error("Non-zero carry");ne=z,L++}if(A[L]!==" "){for(var ce=pe-ne;ce!==pe&&de[ce]===0;)ce++;for(var Ee=new Uint8Array(J+(pe-ce)),Be=J;ce!==pe;)Ee[Be++]=de[ce++];return Ee}}}function S(A){var L=b(A);if(L)return L;throw new Error(`Non-${e} character`)}return{encode:m,decodeUnsafe:b,decode:S}}var src$2=base$2,_brrp__multiformats_scope_baseX$2=src$2;const coerce$2=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},fromString$8=r=>new TextEncoder().encode(r),toString$8=r=>new TextDecoder().decode(r);let Encoder$2=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Decoder$2=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or$2(this,e)}},ComposedDecoder$2=class{constructor(e){this.decoders=e}or(e){return or$2(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const or$2=(r,e)=>new ComposedDecoder$2({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let Codec$2=class{constructor(e,t,n,o){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=o,this.encoder=new Encoder$2(e,t,n),this.decoder=new Decoder$2(e,t,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const from$4=({name:r,prefix:e,encode:t,decode:n})=>new Codec$2(r,e,t,n),baseX$2=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:o}=_brrp__multiformats_scope_baseX$2(t,e);return from$4({prefix:r,name:e,encode:n,decode:s=>coerce$2(o(s))})},decode$i=(r,e,t,n)=>{const o={};for(let p=0;p<e.length;++p)o[e[p]]=p;let s=r.length;for(;r[s-1]==="=";)--s;const u=new Uint8Array(s*t/8|0);let f=0,l=0,h=0;for(let p=0;p<s;++p){const m=o[r[p]];if(m===void 0)throw new SyntaxError(`Non-${n} character`);l=l<<t|m,f+=t,f>=8&&(f-=8,u[h++]=255&l>>f)}if(f>=t||255&l<<8-f)throw new SyntaxError("Unexpected end of data");return u},encode$g=(r,e,t)=>{const n=e[e.length-1]==="=",o=(1<<t)-1;let s="",u=0,f=0;for(let l=0;l<r.length;++l)for(f=f<<8|r[l],u+=8;u>t;)u-=t,s+=e[o&f>>u];if(u&&(s+=e[o&f<<t-u]),n)for(;s.length*t&7;)s+="=";return s},rfc4648$2=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>from$4({prefix:e,name:r,encode(o){return encode$g(o,n,t)},decode(o){return decode$i(o,n,t,r)}}),identity$4=from$4({prefix:"\0",name:"identity",encode:r=>toString$8(r),decode:r=>fromString$8(r)}),identityBase$2=Object.freeze(Object.defineProperty({__proto__:null,identity:identity$4},Symbol.toStringTag,{value:"Module"})),base2$4=rfc4648$2({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base2$5=Object.freeze(Object.defineProperty({__proto__:null,base2:base2$4},Symbol.toStringTag,{value:"Module"})),base8$4=rfc4648$2({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base8$5=Object.freeze(Object.defineProperty({__proto__:null,base8:base8$4},Symbol.toStringTag,{value:"Module"})),base10$4=baseX$2({prefix:"9",name:"base10",alphabet:"0123456789"}),base10$5=Object.freeze(Object.defineProperty({__proto__:null,base10:base10$4},Symbol.toStringTag,{value:"Module"})),base16$4=rfc4648$2({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper$2=rfc4648$2({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base16$5=Object.freeze(Object.defineProperty({__proto__:null,base16:base16$4,base16upper:base16upper$2},Symbol.toStringTag,{value:"Module"})),base32$4=rfc4648$2({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper$2=rfc4648$2({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad$2=rfc4648$2({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper$2=rfc4648$2({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex$2=rfc4648$2({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper$2=rfc4648$2({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad$2=rfc4648$2({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper$2=rfc4648$2({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z$2=rfc4648$2({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base32$5=Object.freeze(Object.defineProperty({__proto__:null,base32:base32$4,base32hex:base32hex$2,base32hexpad:base32hexpad$2,base32hexpadupper:base32hexpadupper$2,base32hexupper:base32hexupper$2,base32pad:base32pad$2,base32padupper:base32padupper$2,base32upper:base32upper$2,base32z:base32z$2},Symbol.toStringTag,{value:"Module"})),base36$4=baseX$2({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper$2=baseX$2({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base36$5=Object.freeze(Object.defineProperty({__proto__:null,base36:base36$4,base36upper:base36upper$2},Symbol.toStringTag,{value:"Module"})),base58btc$2=baseX$2({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr$2=baseX$2({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base58$2=Object.freeze(Object.defineProperty({__proto__:null,base58btc:base58btc$2,base58flickr:base58flickr$2},Symbol.toStringTag,{value:"Module"})),base64$6=rfc4648$2({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad$2=rfc4648$2({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url$2=rfc4648$2({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad$2=rfc4648$2({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base64$7=Object.freeze(Object.defineProperty({__proto__:null,base64:base64$6,base64pad:base64pad$2,base64url:base64url$2,base64urlpad:base64urlpad$2},Symbol.toStringTag,{value:"Module"})),alphabet$2=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),alphabetBytesToChars$2=alphabet$2.reduce((r,e,t)=>(r[t]=e,r),[]),alphabetCharsToBytes$2=alphabet$2.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function encode$f(r){return r.reduce((e,t)=>(e+=alphabetBytesToChars$2[t],e),"")}function decode$h(r){const e=[];for(const t of r){const n=alphabetCharsToBytes$2[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const base256emoji$4=from$4({prefix:"🚀",name:"base256emoji",encode:encode$f,decode:decode$h}),base256emoji$5=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:base256emoji$4},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const bases$2={...identityBase$2,...base2$5,...base8$5,...base10$5,...base16$5,...base32$5,...base36$5,...base58$2,...base64$7,...base256emoji$5};function createCodec$1(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}const string$1=createCodec$1("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),ascii$1=createCodec$1("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=allocUnsafe$1(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),BASES$1={utf8:string$1,"utf-8":string$1,hex:bases$2.base16,latin1:ascii$1,ascii:ascii$1,binary:ascii$1,...bases$2};function fromString$7(r,e="utf8"){const t=BASES$1[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?asUint8Array$1(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}function toString$7(r,e="utf8"){const t=BASES$1[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function getAugmentedNamespace(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){if(this instanceof n){var o=[null];o.push.apply(o,arguments);var s=Function.bind.apply(e,o);return new s}return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var o=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return r[n]}})}),t}function commonjsRequire(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var localforageExports={},localforage$1={get exports(){return localforageExports},set exports(r){localforageExports=r}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/(function(r,e){(function(t){r.exports=t()})(function(){return function t(n,o,s){function u(h,p){if(!o[h]){if(!n[h]){var m=typeof commonjsRequire=="function"&&commonjsRequire;if(!p&&m)return m(h,!0);if(f)return f(h,!0);var b=new Error("Cannot find module '"+h+"'");throw b.code="MODULE_NOT_FOUND",b}var S=o[h]={exports:{}};n[h][0].call(S.exports,function(A){var L=n[h][1][A];return u(L||A)},S,S.exports,t,n,o,s)}return o[h].exports}for(var f=typeof commonjsRequire=="function"&&commonjsRequire,l=0;l<s.length;l++)u(s[l]);return u}({1:[function(t,n,o){(function(s){var u=s.MutationObserver||s.WebKitMutationObserver,f;if(u){var l=0,h=new u(A),p=s.document.createTextNode("");h.observe(p,{characterData:!0}),f=function(){p.data=l=++l%2}}else if(!s.setImmediate&&typeof s.MessageChannel<"u"){var m=new s.MessageChannel;m.port1.onmessage=A,f=function(){m.port2.postMessage(0)}}else"document"in s&&"onreadystatechange"in s.document.createElement("script")?f=function(){var J=s.document.createElement("script");J.onreadystatechange=function(){A(),J.onreadystatechange=null,J.parentNode.removeChild(J),J=null},s.document.documentElement.appendChild(J)}:f=function(){setTimeout(A,0)};var b,S=[];function A(){b=!0;for(var J,ne,pe=S.length;pe;){for(ne=S,S=[],J=-1;++J<pe;)ne[J]();pe=S.length}b=!1}n.exports=L;function L(J){S.push(J)===1&&!b&&f()}}).call(this,typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(t,n,o){var s=t(1);function u(){}var f={},l=["REJECTED"],h=["FULFILLED"],p=["PENDING"];n.exports=m;function m(z){if(typeof z!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,z!==u&&L(this,z)}m.prototype.catch=function(z){return this.then(null,z)},m.prototype.then=function(z,ue){if(typeof z!="function"&&this.state===h||typeof ue!="function"&&this.state===l)return this;var ce=new this.constructor(u);if(this.state!==p){var Ee=this.state===h?z:ue;S(ce,Ee,this.outcome)}else this.queue.push(new b(ce,z,ue));return ce};function b(z,ue,ce){this.promise=z,typeof ue=="function"&&(this.onFulfilled=ue,this.callFulfilled=this.otherCallFulfilled),typeof ce=="function"&&(this.onRejected=ce,this.callRejected=this.otherCallRejected)}b.prototype.callFulfilled=function(z){f.resolve(this.promise,z)},b.prototype.otherCallFulfilled=function(z){S(this.promise,this.onFulfilled,z)},b.prototype.callRejected=function(z){f.reject(this.promise,z)},b.prototype.otherCallRejected=function(z){S(this.promise,this.onRejected,z)};function S(z,ue,ce){s(function(){var Ee;try{Ee=ue(ce)}catch(Be){return f.reject(z,Be)}Ee===z?f.reject(z,new TypeError("Cannot resolve promise with itself")):f.resolve(z,Ee)})}f.resolve=function(z,ue){var ce=J(A,ue);if(ce.status==="error")return f.reject(z,ce.value);var Ee=ce.value;if(Ee)L(z,Ee);else{z.state=h,z.outcome=ue;for(var Be=-1,ot=z.queue.length;++Be<ot;)z.queue[Be].callFulfilled(ue)}return z},f.reject=function(z,ue){z.state=l,z.outcome=ue;for(var ce=-1,Ee=z.queue.length;++ce<Ee;)z.queue[ce].callRejected(ue);return z};function A(z){var ue=z&&z.then;if(z&&(typeof z=="object"||typeof z=="function")&&typeof ue=="function")return function(){ue.apply(z,arguments)}}function L(z,ue){var ce=!1;function Ee(st){ce||(ce=!0,f.reject(z,st))}function Be(st){ce||(ce=!0,f.resolve(z,st))}function ot(){ue(Be,Ee)}var nt=J(ot);nt.status==="error"&&Ee(nt.value)}function J(z,ue){var ce={};try{ce.value=z(ue),ce.status="success"}catch(Ee){ce.status="error",ce.value=Ee}return ce}m.resolve=ne;function ne(z){return z instanceof this?z:f.resolve(new this(u),z)}m.reject=pe;function pe(z){var ue=new this(u);return f.reject(ue,z)}m.all=de;function de(z){var ue=this;if(Object.prototype.toString.call(z)!=="[object Array]")return this.reject(new TypeError("must be an array"));var ce=z.length,Ee=!1;if(!ce)return this.resolve([]);for(var Be=new Array(ce),ot=0,nt=-1,st=new this(u);++nt<ce;)_t(z[nt],nt);return st;function _t(ht,Lt){ue.resolve(ht).then(At,function(Mt){Ee||(Ee=!0,f.reject(st,Mt))});function At(Mt){Be[Lt]=Mt,++ot===ce&&!Ee&&(Ee=!0,f.resolve(st,Be))}}}m.race=H;function H(z){var ue=this;if(Object.prototype.toString.call(z)!=="[object Array]")return this.reject(new TypeError("must be an array"));var ce=z.length,Ee=!1;if(!ce)return this.resolve([]);for(var Be=-1,ot=new this(u);++Be<ce;)nt(z[Be]);return ot;function nt(st){ue.resolve(st).then(function(_t){Ee||(Ee=!0,f.resolve(ot,_t))},function(_t){Ee||(Ee=!0,f.reject(ot,_t))})}}},{1:1}],3:[function(t,n,o){(function(s){typeof s.Promise!="function"&&(s.Promise=t(2))}).call(this,typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(t,n,o){var s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E};function u(E,P){if(!(E instanceof P))throw new TypeError("Cannot call a class as a function")}function f(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var l=f();function h(){try{if(!l||!l.open)return!1;var E=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),P=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!E||P)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function p(E,P){E=E||[],P=P||{};try{return new Blob(E,P)}catch(j){if(j.name!=="TypeError")throw j;for(var C=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,M=new C,K=0;K<E.length;K+=1)M.append(E[K]);return M.getBlob(P.type)}}typeof Promise>"u"&&t(3);var m=Promise;function b(E,P){P&&E.then(function(C){P(null,C)},function(C){P(C)})}function S(E,P,C){typeof P=="function"&&E.then(P),typeof C=="function"&&E.catch(C)}function A(E){return typeof E!="string"&&(console.warn(E+" used as a key, but it is not a string."),E=String(E)),E}function L(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var J="local-forage-detect-blob-support",ne=void 0,pe={},de=Object.prototype.toString,H="readonly",z="readwrite";function ue(E){for(var P=E.length,C=new ArrayBuffer(P),M=new Uint8Array(C),K=0;K<P;K++)M[K]=E.charCodeAt(K);return C}function ce(E){return new m(function(P){var C=E.transaction(J,z),M=p([""]);C.objectStore(J).put(M,"key"),C.onabort=function(K){K.preventDefault(),K.stopPropagation(),P(!1)},C.oncomplete=function(){var K=navigator.userAgent.match(/Chrome\/(\d+)/),j=navigator.userAgent.match(/Edge\//);P(j||!K||parseInt(K[1],10)>=43)}}).catch(function(){return!1})}function Ee(E){return typeof ne=="boolean"?m.resolve(ne):ce(E).then(function(P){return ne=P,ne})}function Be(E){var P=pe[E.name],C={};C.promise=new m(function(M,K){C.resolve=M,C.reject=K}),P.deferredOperations.push(C),P.dbReady?P.dbReady=P.dbReady.then(function(){return C.promise}):P.dbReady=C.promise}function ot(E){var P=pe[E.name],C=P.deferredOperations.pop();if(C)return C.resolve(),C.promise}function nt(E,P){var C=pe[E.name],M=C.deferredOperations.pop();if(M)return M.reject(P),M.promise}function st(E,P){return new m(function(C,M){if(pe[E.name]=pe[E.name]||xt(),E.db)if(P)Be(E),E.db.close();else return C(E.db);var K=[E.name];P&&K.push(E.version);var j=l.open.apply(l,K);P&&(j.onupgradeneeded=function(ee){var I=j.result;try{I.createObjectStore(E.storeName),ee.oldVersion<=1&&I.createObjectStore(J)}catch(ae){if(ae.name==="ConstraintError")console.warn('The database "'+E.name+'" has been upgraded from version '+ee.oldVersion+" to version "+ee.newVersion+', but the storage "'+E.storeName+'" already exists.');else throw ae}}),j.onerror=function(ee){ee.preventDefault(),M(j.error)},j.onsuccess=function(){var ee=j.result;ee.onversionchange=function(I){I.target.close()},C(ee),ot(E)}})}function _t(E){return st(E,!1)}function ht(E){return st(E,!0)}function Lt(E,P){if(!E.db)return!0;var C=!E.db.objectStoreNames.contains(E.storeName),M=E.version<E.db.version,K=E.version>E.db.version;if(M&&(E.version!==P&&console.warn('The database "'+E.name+`" can't be downgraded from version `+E.db.version+" to version "+E.version+"."),E.version=E.db.version),K||C){if(C){var j=E.db.version+1;j>E.version&&(E.version=j)}return!0}return!1}function At(E){return new m(function(P,C){var M=new FileReader;M.onerror=C,M.onloadend=function(K){var j=btoa(K.target.result||"");P({__local_forage_encoded_blob:!0,data:j,type:E.type})},M.readAsBinaryString(E)})}function Mt(E){var P=ue(atob(E.data));return p([P],{type:E.type})}function Nt(E){return E&&E.__local_forage_encoded_blob}function pr(E){var P=this,C=P._initReady().then(function(){var M=pe[P._dbInfo.name];if(M&&M.dbReady)return M.dbReady});return S(C,E,E),C}function _r(E){Be(E);for(var P=pe[E.name],C=P.forages,M=0;M<C.length;M++){var K=C[M];K._dbInfo.db&&(K._dbInfo.db.close(),K._dbInfo.db=null)}return E.db=null,_t(E).then(function(j){return E.db=j,Lt(E)?ht(E):j}).then(function(j){E.db=P.db=j;for(var ee=0;ee<C.length;ee++)C[ee]._dbInfo.db=j}).catch(function(j){throw nt(E,j),j})}function Me(E,P,C,M){M===void 0&&(M=1);try{var K=E.db.transaction(E.storeName,P);C(null,K)}catch(j){if(M>0&&(!E.db||j.name==="InvalidStateError"||j.name==="NotFoundError"))return m.resolve().then(function(){if(!E.db||j.name==="NotFoundError"&&!E.db.objectStoreNames.contains(E.storeName)&&E.version<=E.db.version)return E.db&&(E.version=E.db.version+1),ht(E)}).then(function(){return _r(E).then(function(){Me(E,P,C,M-1)})}).catch(C);C(j)}}function xt(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function Vt(E){var P=this,C={db:null};if(E)for(var M in E)C[M]=E[M];var K=pe[C.name];K||(K=xt(),pe[C.name]=K),K.forages.push(P),P._initReady||(P._initReady=P.ready,P.ready=pr);var j=[];function ee(){return m.resolve()}for(var I=0;I<K.forages.length;I++){var ae=K.forages[I];ae!==P&&j.push(ae._initReady().catch(ee))}var fe=K.forages.slice(0);return m.all(j).then(function(){return C.db=K.db,_t(C)}).then(function(he){return C.db=he,Lt(C,P._defaultConfig.version)?ht(C):he}).then(function(he){C.db=K.db=he,P._dbInfo=C;for(var be=0;be<fe.length;be++){var ke=fe[be];ke!==P&&(ke._dbInfo.db=C.db,ke._dbInfo.version=C.version)}})}function pt(E,P){var C=this;E=A(E);var M=new m(function(K,j){C.ready().then(function(){Me(C._dbInfo,H,function(ee,I){if(ee)return j(ee);try{var ae=I.objectStore(C._dbInfo.storeName),fe=ae.get(E);fe.onsuccess=function(){var he=fe.result;he===void 0&&(he=null),Nt(he)&&(he=Mt(he)),K(he)},fe.onerror=function(){j(fe.error)}}catch(he){j(he)}})}).catch(j)});return b(M,P),M}function Ze(E,P){var C=this,M=new m(function(K,j){C.ready().then(function(){Me(C._dbInfo,H,function(ee,I){if(ee)return j(ee);try{var ae=I.objectStore(C._dbInfo.storeName),fe=ae.openCursor(),he=1;fe.onsuccess=function(){var be=fe.result;if(be){var ke=be.value;Nt(ke)&&(ke=Mt(ke));var Oe=E(ke,be.key,he++);Oe!==void 0?K(Oe):be.continue()}else K()},fe.onerror=function(){j(fe.error)}}catch(be){j(be)}})}).catch(j)});return b(M,P),M}function Ft(E,P,C){var M=this;E=A(E);var K=new m(function(j,ee){var I;M.ready().then(function(){return I=M._dbInfo,de.call(P)==="[object Blob]"?Ee(I.db).then(function(ae){return ae?P:At(P)}):P}).then(function(ae){Me(M._dbInfo,z,function(fe,he){if(fe)return ee(fe);try{var be=he.objectStore(M._dbInfo.storeName);ae===null&&(ae=void 0);var ke=be.put(ae,E);he.oncomplete=function(){ae===void 0&&(ae=null),j(ae)},he.onabort=he.onerror=function(){var Oe=ke.error?ke.error:ke.transaction.error;ee(Oe)}}catch(Oe){ee(Oe)}})}).catch(ee)});return b(K,C),K}function jr(E,P){var C=this;E=A(E);var M=new m(function(K,j){C.ready().then(function(){Me(C._dbInfo,z,function(ee,I){if(ee)return j(ee);try{var ae=I.objectStore(C._dbInfo.storeName),fe=ae.delete(E);I.oncomplete=function(){K()},I.onerror=function(){j(fe.error)},I.onabort=function(){var he=fe.error?fe.error:fe.transaction.error;j(he)}}catch(he){j(he)}})}).catch(j)});return b(M,P),M}function Yt(E){var P=this,C=new m(function(M,K){P.ready().then(function(){Me(P._dbInfo,z,function(j,ee){if(j)return K(j);try{var I=ee.objectStore(P._dbInfo.storeName),ae=I.clear();ee.oncomplete=function(){M()},ee.onabort=ee.onerror=function(){var fe=ae.error?ae.error:ae.transaction.error;K(fe)}}catch(fe){K(fe)}})}).catch(K)});return b(C,E),C}function kt(E){var P=this,C=new m(function(M,K){P.ready().then(function(){Me(P._dbInfo,H,function(j,ee){if(j)return K(j);try{var I=ee.objectStore(P._dbInfo.storeName),ae=I.count();ae.onsuccess=function(){M(ae.result)},ae.onerror=function(){K(ae.error)}}catch(fe){K(fe)}})}).catch(K)});return b(C,E),C}function wr(E,P){var C=this,M=new m(function(K,j){if(E<0){K(null);return}C.ready().then(function(){Me(C._dbInfo,H,function(ee,I){if(ee)return j(ee);try{var ae=I.objectStore(C._dbInfo.storeName),fe=!1,he=ae.openKeyCursor();he.onsuccess=function(){var be=he.result;if(!be){K(null);return}E===0||fe?K(be.key):(fe=!0,be.advance(E))},he.onerror=function(){j(he.error)}}catch(be){j(be)}})}).catch(j)});return b(M,P),M}function nr(E){var P=this,C=new m(function(M,K){P.ready().then(function(){Me(P._dbInfo,H,function(j,ee){if(j)return K(j);try{var I=ee.objectStore(P._dbInfo.storeName),ae=I.openKeyCursor(),fe=[];ae.onsuccess=function(){var he=ae.result;if(!he){M(fe);return}fe.push(he.key),he.continue()},ae.onerror=function(){K(ae.error)}}catch(he){K(he)}})}).catch(K)});return b(C,E),C}function ar(E,P){P=L.apply(this,arguments);var C=this.config();E=typeof E!="function"&&E||{},E.name||(E.name=E.name||C.name,E.storeName=E.storeName||C.storeName);var M=this,K;if(!E.name)K=m.reject("Invalid arguments");else{var j=E.name===C.name&&M._dbInfo.db,ee=j?m.resolve(M._dbInfo.db):_t(E).then(function(I){var ae=pe[E.name],fe=ae.forages;ae.db=I;for(var he=0;he<fe.length;he++)fe[he]._dbInfo.db=I;return I});E.storeName?K=ee.then(function(I){if(I.objectStoreNames.contains(E.storeName)){var ae=I.version+1;Be(E);var fe=pe[E.name],he=fe.forages;I.close();for(var be=0;be<he.length;be++){var ke=he[be];ke._dbInfo.db=null,ke._dbInfo.version=ae}var Oe=new m(function(Ke,ze){var Ve=l.open(E.name,ae);Ve.onerror=function(dt){var vt=Ve.result;vt.close(),ze(dt)},Ve.onupgradeneeded=function(){var dt=Ve.result;dt.deleteObjectStore(E.storeName)},Ve.onsuccess=function(){var dt=Ve.result;dt.close(),Ke(dt)}});return Oe.then(function(Ke){fe.db=Ke;for(var ze=0;ze<he.length;ze++){var Ve=he[ze];Ve._dbInfo.db=Ke,ot(Ve._dbInfo)}}).catch(function(Ke){throw(nt(E,Ke)||m.resolve()).catch(function(){}),Ke})}}):K=ee.then(function(I){Be(E);var ae=pe[E.name],fe=ae.forages;I.close();for(var he=0;he<fe.length;he++){var be=fe[he];be._dbInfo.db=null}var ke=new m(function(Oe,Ke){var ze=l.deleteDatabase(E.name);ze.onerror=function(){var Ve=ze.result;Ve&&Ve.close(),Ke(ze.error)},ze.onblocked=function(){console.warn('dropInstance blocked for database "'+E.name+'" until all open connections are closed')},ze.onsuccess=function(){var Ve=ze.result;Ve&&Ve.close(),Oe(Ve)}});return ke.then(function(Oe){ae.db=Oe;for(var Ke=0;Ke<fe.length;Ke++){var ze=fe[Ke];ot(ze._dbInfo)}}).catch(function(Oe){throw(nt(E,Oe)||m.resolve()).catch(function(){}),Oe})})}return b(K,P),K}var fr={_driver:"asyncStorage",_initStorage:Vt,_support:h(),iterate:Ze,getItem:pt,setItem:Ft,removeItem:jr,clear:Yt,length:kt,key:wr,keys:nr,dropInstance:ar};function Rt(){return typeof openDatabase=="function"}var qt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Jr="~~local_forage_type~",zt=/^~~local_forage_type~([^~]+)~/,br="__lfsc__:",Jt=br.length,Xt="arbf",Dt="blob",It="si08",Zt="ui08",X="uic8",se="si16",we="si32",x="ur16",g="ui32",w="fl32",O="fl64",U=Jt+Xt.length,W=Object.prototype.toString;function te(E){var P=E.length*.75,C=E.length,M,K=0,j,ee,I,ae;E[E.length-1]==="="&&(P--,E[E.length-2]==="="&&P--);var fe=new ArrayBuffer(P),he=new Uint8Array(fe);for(M=0;M<C;M+=4)j=qt.indexOf(E[M]),ee=qt.indexOf(E[M+1]),I=qt.indexOf(E[M+2]),ae=qt.indexOf(E[M+3]),he[K++]=j<<2|ee>>4,he[K++]=(ee&15)<<4|I>>2,he[K++]=(I&3)<<6|ae&63;return fe}function $e(E){var P=new Uint8Array(E),C="",M;for(M=0;M<P.length;M+=3)C+=qt[P[M]>>2],C+=qt[(P[M]&3)<<4|P[M+1]>>4],C+=qt[(P[M+1]&15)<<2|P[M+2]>>6],C+=qt[P[M+2]&63];return P.length%3===2?C=C.substring(0,C.length-1)+"=":P.length%3===1&&(C=C.substring(0,C.length-2)+"=="),C}function tt(E,P){var C="";if(E&&(C=W.call(E)),E&&(C==="[object ArrayBuffer]"||E.buffer&&W.call(E.buffer)==="[object ArrayBuffer]")){var M,K=br;E instanceof ArrayBuffer?(M=E,K+=Xt):(M=E.buffer,C==="[object Int8Array]"?K+=It:C==="[object Uint8Array]"?K+=Zt:C==="[object Uint8ClampedArray]"?K+=X:C==="[object Int16Array]"?K+=se:C==="[object Uint16Array]"?K+=x:C==="[object Int32Array]"?K+=we:C==="[object Uint32Array]"?K+=g:C==="[object Float32Array]"?K+=w:C==="[object Float64Array]"?K+=O:P(new Error("Failed to get type for BinaryArray"))),P(K+$e(M))}else if(C==="[object Blob]"){var j=new FileReader;j.onload=function(){var ee=Jr+E.type+"~"+$e(this.result);P(br+Dt+ee)},j.readAsArrayBuffer(E)}else try{P(JSON.stringify(E))}catch(ee){console.error("Couldn't convert value into a JSON string: ",E),P(null,ee)}}function ct(E){if(E.substring(0,Jt)!==br)return JSON.parse(E);var P=E.substring(U),C=E.substring(Jt,U),M;if(C===Dt&&zt.test(P)){var K=P.match(zt);M=K[1],P=P.substring(K[0].length)}var j=te(P);switch(C){case Xt:return j;case Dt:return p([j],{type:M});case It:return new Int8Array(j);case Zt:return new Uint8Array(j);case X:return new Uint8ClampedArray(j);case se:return new Int16Array(j);case x:return new Uint16Array(j);case we:return new Int32Array(j);case g:return new Uint32Array(j);case w:return new Float32Array(j);case O:return new Float64Array(j);default:throw new Error("Unkown type: "+C)}}var wt={serialize:tt,deserialize:ct,stringToBuffer:te,bufferToString:$e};function lt(E,P,C,M){E.executeSql("CREATE TABLE IF NOT EXISTS "+P.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],C,M)}function Xr(E){var P=this,C={db:null};if(E)for(var M in E)C[M]=typeof E[M]!="string"?E[M].toString():E[M];var K=new m(function(j,ee){try{C.db=openDatabase(C.name,String(C.version),C.description,C.size)}catch(I){return ee(I)}C.db.transaction(function(I){lt(I,C,function(){P._dbInfo=C,j()},function(ae,fe){ee(fe)})},ee)});return C.serializer=wt,K}function vr(E,P,C,M,K,j){E.executeSql(C,M,K,function(ee,I){I.code===I.SYNTAX_ERR?ee.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[P.storeName],function(ae,fe){fe.rows.length?j(ae,I):lt(ae,P,function(){ae.executeSql(C,M,K,j)},j)},j):j(ee,I)},j)}function wn(E,P){var C=this;E=A(E);var M=new m(function(K,j){C.ready().then(function(){var ee=C._dbInfo;ee.db.transaction(function(I){vr(I,ee,"SELECT * FROM "+ee.storeName+" WHERE key = ? LIMIT 1",[E],function(ae,fe){var he=fe.rows.length?fe.rows.item(0).value:null;he&&(he=ee.serializer.deserialize(he)),K(he)},function(ae,fe){j(fe)})})}).catch(j)});return b(M,P),M}function Dn(E,P){var C=this,M=new m(function(K,j){C.ready().then(function(){var ee=C._dbInfo;ee.db.transaction(function(I){vr(I,ee,"SELECT * FROM "+ee.storeName,[],function(ae,fe){for(var he=fe.rows,be=he.length,ke=0;ke<be;ke++){var Oe=he.item(ke),Ke=Oe.value;if(Ke&&(Ke=ee.serializer.deserialize(Ke)),Ke=E(Ke,Oe.key,ke+1),Ke!==void 0){K(Ke);return}}K()},function(ae,fe){j(fe)})})}).catch(j)});return b(M,P),M}function In(E,P,C,M){var K=this;E=A(E);var j=new m(function(ee,I){K.ready().then(function(){P===void 0&&(P=null);var ae=P,fe=K._dbInfo;fe.serializer.serialize(P,function(he,be){be?I(be):fe.db.transaction(function(ke){vr(ke,fe,"INSERT OR REPLACE INTO "+fe.storeName+" (key, value) VALUES (?, ?)",[E,he],function(){ee(ae)},function(Oe,Ke){I(Ke)})},function(ke){if(ke.code===ke.QUOTA_ERR){if(M>0){ee(In.apply(K,[E,ae,C,M-1]));return}I(ke)}})})}).catch(I)});return b(j,C),j}function Ar(E,P,C){return In.apply(this,[E,P,C,1])}function Kr(E,P){var C=this;E=A(E);var M=new m(function(K,j){C.ready().then(function(){var ee=C._dbInfo;ee.db.transaction(function(I){vr(I,ee,"DELETE FROM "+ee.storeName+" WHERE key = ?",[E],function(){K()},function(ae,fe){j(fe)})})}).catch(j)});return b(M,P),M}function Vr(E){var P=this,C=new m(function(M,K){P.ready().then(function(){var j=P._dbInfo;j.db.transaction(function(ee){vr(ee,j,"DELETE FROM "+j.storeName,[],function(){M()},function(I,ae){K(ae)})})}).catch(K)});return b(C,E),C}function cn(E){var P=this,C=new m(function(M,K){P.ready().then(function(){var j=P._dbInfo;j.db.transaction(function(ee){vr(ee,j,"SELECT COUNT(key) as c FROM "+j.storeName,[],function(I,ae){var fe=ae.rows.item(0).c;M(fe)},function(I,ae){K(ae)})})}).catch(K)});return b(C,E),C}function bn(E,P){var C=this,M=new m(function(K,j){C.ready().then(function(){var ee=C._dbInfo;ee.db.transaction(function(I){vr(I,ee,"SELECT key FROM "+ee.storeName+" WHERE id = ? LIMIT 1",[E+1],function(ae,fe){var he=fe.rows.length?fe.rows.item(0).key:null;K(he)},function(ae,fe){j(fe)})})}).catch(j)});return b(M,P),M}function Pn(E){var P=this,C=new m(function(M,K){P.ready().then(function(){var j=P._dbInfo;j.db.transaction(function(ee){vr(ee,j,"SELECT key FROM "+j.storeName,[],function(I,ae){for(var fe=[],he=0;he<ae.rows.length;he++)fe.push(ae.rows.item(he).key);M(fe)},function(I,ae){K(ae)})})}).catch(K)});return b(C,E),C}function Vn(E){return new m(function(P,C){E.transaction(function(M){M.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(K,j){for(var ee=[],I=0;I<j.rows.length;I++)ee.push(j.rows.item(I).name);P({db:E,storeNames:ee})},function(K,j){C(j)})},function(M){C(M)})})}function er(E,P){P=L.apply(this,arguments);var C=this.config();E=typeof E!="function"&&E||{},E.name||(E.name=E.name||C.name,E.storeName=E.storeName||C.storeName);var M=this,K;return E.name?K=new m(function(j){var ee;E.name===C.name?ee=M._dbInfo.db:ee=openDatabase(E.name,"","",0),E.storeName?j({db:ee,storeNames:[E.storeName]}):j(Vn(ee))}).then(function(j){return new m(function(ee,I){j.db.transaction(function(ae){function fe(Oe){return new m(function(Ke,ze){ae.executeSql("DROP TABLE IF EXISTS "+Oe,[],function(){Ke()},function(Ve,dt){ze(dt)})})}for(var he=[],be=0,ke=j.storeNames.length;be<ke;be++)he.push(fe(j.storeNames[be]));m.all(he).then(function(){ee()}).catch(function(Oe){I(Oe)})},function(ae){I(ae)})})}):K=m.reject("Invalid arguments"),b(K,P),K}var On={_driver:"webSQLStorage",_initStorage:Xr,_support:Rt(),iterate:Dn,getItem:wn,setItem:Ar,removeItem:Kr,clear:Vr,length:cn,key:bn,keys:Pn,dropInstance:er};function v(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function T(E,P){var C=E.name+"/";return E.storeName!==P.storeName&&(C+=E.storeName+"/"),C}function k(){var E="_localforage_support_test";try{return localStorage.setItem(E,!0),localStorage.removeItem(E),!1}catch{return!0}}function y(){return!k()||localStorage.length>0}function B(E){var P=this,C={};if(E)for(var M in E)C[M]=E[M];return C.keyPrefix=T(E,P._defaultConfig),y()?(P._dbInfo=C,C.serializer=wt,m.resolve()):m.reject()}function Q(E){var P=this,C=P.ready().then(function(){for(var M=P._dbInfo.keyPrefix,K=localStorage.length-1;K>=0;K--){var j=localStorage.key(K);j.indexOf(M)===0&&localStorage.removeItem(j)}});return b(C,E),C}function Z(E,P){var C=this;E=A(E);var M=C.ready().then(function(){var K=C._dbInfo,j=localStorage.getItem(K.keyPrefix+E);return j&&(j=K.serializer.deserialize(j)),j});return b(M,P),M}function ye(E,P){var C=this,M=C.ready().then(function(){for(var K=C._dbInfo,j=K.keyPrefix,ee=j.length,I=localStorage.length,ae=1,fe=0;fe<I;fe++){var he=localStorage.key(fe);if(he.indexOf(j)===0){var be=localStorage.getItem(he);if(be&&(be=K.serializer.deserialize(be)),be=E(be,he.substring(ee),ae++),be!==void 0)return be}}});return b(M,P),M}function xe(E,P){var C=this,M=C.ready().then(function(){var K=C._dbInfo,j;try{j=localStorage.key(E)}catch{j=null}return j&&(j=j.substring(K.keyPrefix.length)),j});return b(M,P),M}function Le(E){var P=this,C=P.ready().then(function(){for(var M=P._dbInfo,K=localStorage.length,j=[],ee=0;ee<K;ee++){var I=localStorage.key(ee);I.indexOf(M.keyPrefix)===0&&j.push(I.substring(M.keyPrefix.length))}return j});return b(C,E),C}function Ce(E){var P=this,C=P.keys().then(function(M){return M.length});return b(C,E),C}function yt(E,P){var C=this;E=A(E);var M=C.ready().then(function(){var K=C._dbInfo;localStorage.removeItem(K.keyPrefix+E)});return b(M,P),M}function Ie(E,P,C){var M=this;E=A(E);var K=M.ready().then(function(){P===void 0&&(P=null);var j=P;return new m(function(ee,I){var ae=M._dbInfo;ae.serializer.serialize(P,function(fe,he){if(he)I(he);else try{localStorage.setItem(ae.keyPrefix+E,fe),ee(j)}catch(be){(be.name==="QuotaExceededError"||be.name==="NS_ERROR_DOM_QUOTA_REACHED")&&I(be),I(be)}})})});return b(K,C),K}function Ge(E,P){if(P=L.apply(this,arguments),E=typeof E!="function"&&E||{},!E.name){var C=this.config();E.name=E.name||C.name,E.storeName=E.storeName||C.storeName}var M=this,K;return E.name?K=new m(function(j){E.storeName?j(T(E,M._defaultConfig)):j(E.name+"/")}).then(function(j){for(var ee=localStorage.length-1;ee>=0;ee--){var I=localStorage.key(ee);I.indexOf(j)===0&&localStorage.removeItem(I)}}):K=m.reject("Invalid arguments"),b(K,P),K}var Qe={_driver:"localStorageWrapper",_initStorage:B,_support:v(),iterate:ye,getItem:Z,setItem:Ie,removeItem:yt,clear:Q,length:Ce,key:xe,keys:Le,dropInstance:Ge},et=function(P,C){return P===C||typeof P=="number"&&typeof C=="number"&&isNaN(P)&&isNaN(C)},Ye=function(P,C){for(var M=P.length,K=0;K<M;){if(et(P[K],C))return!0;K++}return!1},We=Array.isArray||function(E){return Object.prototype.toString.call(E)==="[object Array]"},je={},He={},De={INDEXEDDB:fr,WEBSQL:On,LOCALSTORAGE:Qe},Ne=[De.INDEXEDDB._driver,De.WEBSQL._driver,De.LOCALSTORAGE._driver],Se=["dropInstance"],Pe=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Se),Fe={description:"",driver:Ne.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Ae(E,P){E[P]=function(){var C=arguments;return E.ready().then(function(){return E[P].apply(E,C)})}}function re(){for(var E=1;E<arguments.length;E++){var P=arguments[E];if(P)for(var C in P)P.hasOwnProperty(C)&&(We(P[C])?arguments[0][C]=P[C].slice():arguments[0][C]=P[C])}return arguments[0]}var ie=function(){function E(P){u(this,E);for(var C in De)if(De.hasOwnProperty(C)){var M=De[C],K=M._driver;this[C]=K,je[K]||this.defineDriver(M)}this._defaultConfig=re({},Fe),this._config=re({},this._defaultConfig,P),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return E.prototype.config=function(C){if((typeof C>"u"?"undefined":s(C))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var M in C){if(M==="storeName"&&(C[M]=C[M].replace(/\W/g,"_")),M==="version"&&typeof C[M]!="number")return new Error("Database version must be a number.");this._config[M]=C[M]}return"driver"in C&&C.driver?this.setDriver(this._config.driver):!0}else return typeof C=="string"?this._config[C]:this._config},E.prototype.defineDriver=function(C,M,K){var j=new m(function(ee,I){try{var ae=C._driver,fe=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!C._driver){I(fe);return}for(var he=Pe.concat("_initStorage"),be=0,ke=he.length;be<ke;be++){var Oe=he[be],Ke=!Ye(Se,Oe);if((Ke||C[Oe])&&typeof C[Oe]!="function"){I(fe);return}}var ze=function(){for(var vt=function(fi){return function(){var Ji=new Error("Method "+fi+" is not implemented by the current driver"),li=m.reject(Ji);return b(li,arguments[arguments.length-1]),li}},Pt=0,Gt=Se.length;Pt<Gt;Pt++){var Ut=Se[Pt];C[Ut]||(C[Ut]=vt(Ut))}};ze();var Ve=function(vt){je[ae]&&console.info("Redefining LocalForage driver: "+ae),je[ae]=C,He[ae]=vt,ee()};"_support"in C?C._support&&typeof C._support=="function"?C._support().then(Ve,I):Ve(!!C._support):Ve(!0)}catch(dt){I(dt)}});return S(j,M,K),j},E.prototype.driver=function(){return this._driver||null},E.prototype.getDriver=function(C,M,K){var j=je[C]?m.resolve(je[C]):m.reject(new Error("Driver not found."));return S(j,M,K),j},E.prototype.getSerializer=function(C){var M=m.resolve(wt);return S(M,C),M},E.prototype.ready=function(C){var M=this,K=M._driverSet.then(function(){return M._ready===null&&(M._ready=M._initDriver()),M._ready});return S(K,C,C),K},E.prototype.setDriver=function(C,M,K){var j=this;We(C)||(C=[C]);var ee=this._getSupportedDrivers(C);function I(){j._config.driver=j.driver()}function ae(be){return j._extend(be),I(),j._ready=j._initStorage(j._config),j._ready}function fe(be){return function(){var ke=0;function Oe(){for(;ke<be.length;){var Ke=be[ke];return ke++,j._dbInfo=null,j._ready=null,j.getDriver(Ke).then(ae).catch(Oe)}I();var ze=new Error("No available storage method found.");return j._driverSet=m.reject(ze),j._driverSet}return Oe()}}var he=this._driverSet!==null?this._driverSet.catch(function(){return m.resolve()}):m.resolve();return this._driverSet=he.then(function(){var be=ee[0];return j._dbInfo=null,j._ready=null,j.getDriver(be).then(function(ke){j._driver=ke._driver,I(),j._wrapLibraryMethodsWithReady(),j._initDriver=fe(ee)})}).catch(function(){I();var be=new Error("No available storage method found.");return j._driverSet=m.reject(be),j._driverSet}),S(this._driverSet,M,K),this._driverSet},E.prototype.supports=function(C){return!!He[C]},E.prototype._extend=function(C){re(this,C)},E.prototype._getSupportedDrivers=function(C){for(var M=[],K=0,j=C.length;K<j;K++){var ee=C[K];this.supports(ee)&&M.push(ee)}return M},E.prototype._wrapLibraryMethodsWithReady=function(){for(var C=0,M=Pe.length;C<M;C++)Ae(this,Pe[C])},E.prototype.createInstance=function(C){return new E(C)},E}(),_e=new ie;n.exports=_e},{3:3}]},{},[4])(4)})})(localforage$1);const localforage=localforageExports;var RootBranch;(function(r){r.Public="public",r.Pretty="p",r.Private="private",r.PrivateLog="privateLog",r.Shared="shared",r.SharedCounter="sharedCounter",r.Version="version"})(RootBranch||(RootBranch={}));var Kind;(function(r){r.Directory="directory",r.File="file"})(Kind||(Kind={}));function directory(...r){if(r.some(e=>e.includes("/")))throw new Error("Forward slashes `/` are not allowed");return{directory:r}}function file(...r){if(r.some(e=>e.includes("/")))throw new Error("Forward slashes `/` are not allowed");return{file:r}}function root$1(){return{directory:[]}}function appData(r,e){const t=directory(RootBranch.Private,"Apps",r.creator,r.name);return e?combine(t,e):t}function fromPosix(r){const e=r.replace(/^\/+/,"").split("/");return r.endsWith("/")?{directory:e.slice(0,-1)}:r===""?root$1():{file:e}}function toPosix(r,{absolute:e}={absolute:!1}){const t=e?"/":"",n=unwrap$2(r).join("/");return isDirectory(r)?t+n+(n.length?"/":""):t+n}function combine(r,e){return map$2(t=>unwrap$2(r).concat(t),e)}function isDirectory(r){return!!r.directory}function isFile$1(r){return!!r.file}function isPartition(r,e){return unwrap$2(e)[0]===r}function isOnRootBranch(r,e){return unwrap$2(e)[0]===r}function isRootDirectory(r){return r.directory.length===0}function isSamePartition(r,e){return unwrap$2(r)[0]===unwrap$2(e)[0]}function isSameKind(r,e){return isDirectory(r)&&isDirectory(e)?!0:!!(isFile$1(r)&&isFile$1(e))}function kind(r){return isDirectory(r)?Kind.Directory:Kind.File}function map$2(r,e){return isDirectory(e)?{directory:r(e.directory)}:isFile$1(e)?{file:r(e.file)}:e}function parent(r){return isDirectory(r)&&isRootDirectory(r)?null:directory(...unwrap$2(r).slice(0,-1))}function removePartition(r){return map$2(e=>isDirectory(r)||e.length>1?e.slice(1):e,r)}function terminus(r){const e=unwrap$2(r);return e.length<1?null:e[e.length-1]}function unwrap$2(r){if(isDirectory(r))return r.directory;if(isFile$1(r))return r.file;throw new Error("Path is neither a directory or a file")}function withPartition(r,e){return combine(directory(r),e)}function log$8(r){return`[ ${r.join(", ")} ]`}async function bareNameFilter({crypto:r,accountDID:e,path:t}){return`wnfs:${e}:bareNameFilter:${await pathHash(r,t)}`}async function readKey({crypto:r,accountDID:e,path:t}){return`wnfs:${e}:readKey:${await pathHash(r,t)}`}async function pathHash(r,e){return toString$7(await r.hash.sha256(fromString$7("/"+unwrap$2(e).join("/"),"utf8")),"base64pad")}const ROOT_FILESYSTEM_PERMISSIONS={fs:{private:[root$1()],public:[root$1()]}};function appId(r){return`${r.creator}/${r.name}`}function permissionPaths(r){var t,n,o,s;let e=[];return r.app&&e.push(appData(r.app)),(t=r.fs)!=null&&t.private&&(e=e.concat((n=r.fs)==null?void 0:n.private.map(u=>withPartition("private",u)))),(o=r.fs)!=null&&o.public&&(e=e.concat((s=r.fs)==null?void 0:s.public.map(u=>withPartition("public",u)))),e}const equal=(r,e)=>{const t=new Uint8Array(r),n=new Uint8Array(e);if(t.length!==n.length)return!1;for(let o=0;o<t.length;o++)if(t[o]!==n[o])return!1;return!0};function decode$g(r){return toString$7(fromString$7(r,"base64pad"))}function encode$e(r){return toString$7(fromString$7(r),"base64pad")}function urlDecode(r){return decode$g(makeUrlUnsafe(r))}function urlEncode(r){return makeUrlSafe(encode$e(r))}function makeUrlSafe(r){return r.replace(/\//g,"_").replace(/\+/g,"-").replace(/=+$/,"")}function makeUrlUnsafe(r){return r.replace(/_/g,"/").replace(/-/g,"+")}const toUint8Array=async r=>new Promise((e,t)=>{const n=()=>t(new Error("Failed to read file")),o=new FileReader;o.addEventListener("load",s=>{var f;const u=((f=s==null?void 0:s.target)==null?void 0:f.result)||null;if(u==null){n();return}if(typeof u=="string"){e(fromString$7(u));return}e(new Uint8Array(u))}),o.addEventListener("error",()=>o.abort()),o.addEventListener("abort",n),o.readAsArrayBuffer(r)});var encode_1$2=encode$d,MSB$3=128,REST$3=127,MSBALL$2=~REST$3,INT$2=Math.pow(2,31);function encode$d(r,e,t){e=e||[],t=t||0;for(var n=t;r>=INT$2;)e[t++]=r&255|MSB$3,r/=128;for(;r&MSBALL$2;)e[t++]=r&255|MSB$3,r>>>=7;return e[t]=r|0,encode$d.bytes=t-n+1,e}var decode$f=read$2,MSB$1$2=128,REST$1$2=127;function read$2(r,n){var t=0,n=n||0,o=0,s=n,u,f=r.length;do{if(s>=f)throw read$2.bytes=0,new RangeError("Could not decode varint");u=r[s++],t+=o<28?(u&REST$1$2)<<o:(u&REST$1$2)*Math.pow(2,o),o+=7}while(u>=MSB$1$2);return read$2.bytes=s-n,t}var N1$2=Math.pow(2,7),N2$2=Math.pow(2,14),N3$2=Math.pow(2,21),N4$2=Math.pow(2,28),N5$2=Math.pow(2,35),N6$2=Math.pow(2,42),N7$2=Math.pow(2,49),N8$2=Math.pow(2,56),N9$2=Math.pow(2,63),length$3=function(r){return r<N1$2?1:r<N2$2?2:r<N3$2?3:r<N4$2?4:r<N5$2?5:r<N6$2?6:r<N7$2?7:r<N8$2?8:r<N9$2?9:10},varint$2={encode:encode_1$2,decode:decode$f,encodingLength:length$3},_brrp_varint$1=varint$2;const decode$e=(r,e=0)=>[_brrp_varint$1.decode(r,e),_brrp_varint$1.decode.bytes],encodeTo$1=(r,e,t=0)=>(_brrp_varint$1.encode(r,e,t),e),encodingLength$1=r=>_brrp_varint$1.encodingLength(r),equals$5=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},coerce$1=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},fromString$6=r=>new TextEncoder().encode(r),toString$6=r=>new TextDecoder().decode(r),create$7=(r,e)=>{const t=e.byteLength,n=encodingLength$1(r),o=n+encodingLength$1(t),s=new Uint8Array(o+t);return encodeTo$1(r,s,0),encodeTo$1(t,s,n),s.set(e,o),new Digest$1(r,t,e,s)},decode$d=r=>{const e=coerce$1(r),[t,n]=decode$e(e),[o,s]=decode$e(e.subarray(n)),u=e.subarray(n+s);if(u.byteLength!==o)throw new Error("Incorrect length");return new Digest$1(t,o,u,e)},equals$4=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&equals$5(r.bytes,t.bytes)}};let Digest$1=class{constructor(e,t,n,o){this.code=e,this.size=t,this.digest=n,this.bytes=o}};function base$1(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var o=0;o<r.length;o++){var s=r.charAt(o),u=s.charCodeAt(0);if(t[u]!==255)throw new TypeError(s+" is ambiguous");t[u]=o}var f=r.length,l=r.charAt(0),h=Math.log(f)/Math.log(256),p=Math.log(256)/Math.log(f);function m(A){if(A instanceof Uint8Array||(ArrayBuffer.isView(A)?A=new Uint8Array(A.buffer,A.byteOffset,A.byteLength):Array.isArray(A)&&(A=Uint8Array.from(A))),!(A instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(A.length===0)return"";for(var L=0,J=0,ne=0,pe=A.length;ne!==pe&&A[ne]===0;)ne++,L++;for(var de=(pe-ne)*p+1>>>0,H=new Uint8Array(de);ne!==pe;){for(var z=A[ne],ue=0,ce=de-1;(z!==0||ue<J)&&ce!==-1;ce--,ue++)z+=256*H[ce]>>>0,H[ce]=z%f>>>0,z=z/f>>>0;if(z!==0)throw new Error("Non-zero carry");J=ue,ne++}for(var Ee=de-J;Ee!==de&&H[Ee]===0;)Ee++;for(var Be=l.repeat(L);Ee<de;++Ee)Be+=r.charAt(H[Ee]);return Be}function b(A){if(typeof A!="string")throw new TypeError("Expected String");if(A.length===0)return new Uint8Array;var L=0;if(A[L]!==" "){for(var J=0,ne=0;A[L]===l;)J++,L++;for(var pe=(A.length-L)*h+1>>>0,de=new Uint8Array(pe);A[L];){var H=t[A.charCodeAt(L)];if(H===255)return;for(var z=0,ue=pe-1;(H!==0||z<ne)&&ue!==-1;ue--,z++)H+=f*de[ue]>>>0,de[ue]=H%256>>>0,H=H/256>>>0;if(H!==0)throw new Error("Non-zero carry");ne=z,L++}if(A[L]!==" "){for(var ce=pe-ne;ce!==pe&&de[ce]===0;)ce++;for(var Ee=new Uint8Array(J+(pe-ce)),Be=J;ce!==pe;)Ee[Be++]=de[ce++];return Ee}}}function S(A){var L=b(A);if(L)return L;throw new Error(`Non-${e} character`)}return{encode:m,decodeUnsafe:b,decode:S}}var src$1=base$1,_brrp__multiformats_scope_baseX$1=src$1;let Encoder$1=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Decoder$1=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or$1(this,e)}},ComposedDecoder$1=class{constructor(e){this.decoders=e}or(e){return or$1(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const or$1=(r,e)=>new ComposedDecoder$1({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let Codec$1=class{constructor(e,t,n,o){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=o,this.encoder=new Encoder$1(e,t,n),this.decoder=new Decoder$1(e,t,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const from$3=({name:r,prefix:e,encode:t,decode:n})=>new Codec$1(r,e,t,n),baseX$1=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:o}=_brrp__multiformats_scope_baseX$1(t,e);return from$3({prefix:r,name:e,encode:n,decode:s=>coerce$1(o(s))})},decode$c=(r,e,t,n)=>{const o={};for(let p=0;p<e.length;++p)o[e[p]]=p;let s=r.length;for(;r[s-1]==="=";)--s;const u=new Uint8Array(s*t/8|0);let f=0,l=0,h=0;for(let p=0;p<s;++p){const m=o[r[p]];if(m===void 0)throw new SyntaxError(`Non-${n} character`);l=l<<t|m,f+=t,f>=8&&(f-=8,u[h++]=255&l>>f)}if(f>=t||255&l<<8-f)throw new SyntaxError("Unexpected end of data");return u},encode$c=(r,e,t)=>{const n=e[e.length-1]==="=",o=(1<<t)-1;let s="",u=0,f=0;for(let l=0;l<r.length;++l)for(f=f<<8|r[l],u+=8;u>t;)u-=t,s+=e[o&f>>u];if(u&&(s+=e[o&f<<t-u]),n)for(;s.length*t&7;)s+="=";return s},rfc4648$1=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>from$3({prefix:e,name:r,encode(o){return encode$c(o,n,t)},decode(o){return decode$c(o,n,t,r)}}),base58btc$1=baseX$1({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr$1=baseX$1({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base58$1=Object.freeze(Object.defineProperty({__proto__:null,base58btc:base58btc$1,base58flickr:base58flickr$1},Symbol.toStringTag,{value:"Module"})),base32$2=rfc4648$1({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper$1=rfc4648$1({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad$1=rfc4648$1({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper$1=rfc4648$1({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex$1=rfc4648$1({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper$1=rfc4648$1({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad$1=rfc4648$1({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper$1=rfc4648$1({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z$1=rfc4648$1({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base32$3=Object.freeze(Object.defineProperty({__proto__:null,base32:base32$2,base32hex:base32hex$1,base32hexpad:base32hexpad$1,base32hexpadupper:base32hexpadupper$1,base32hexupper:base32hexupper$1,base32pad:base32pad$1,base32padupper:base32padupper$1,base32upper:base32upper$1,base32z:base32z$1},Symbol.toStringTag,{value:"Module"})),format$2=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return toStringV0$1(t,baseCache$1(r),e||base58btc$1.encoder);default:return toStringV1$1(t,baseCache$1(r),e||base32$2.encoder)}},cache$1=new WeakMap,baseCache$1=r=>{const e=cache$1.get(r);if(e==null){const t=new Map;return cache$1.set(r,t),t}return e};let CID$1=class hr{constructor(e,t,n,o){this.code=t,this.version=e,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==DAG_PB_CODE$1)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==SHA_256_CODE$1)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return hr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=create$7(e,t);return hr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return hr.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&equals$4(e.multihash,n.multihash)}toString(e){return format$2(this,e)}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof hr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:o,multihash:s,bytes:u}=t;return new hr(n,o,s,u||encodeCID$2(n,o,s.bytes))}else if(t[cidSymbol$1]===!0){const{version:n,multihash:o,code:s}=t,u=decode$d(o);return hr.create(n,s,u)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==DAG_PB_CODE$1)throw new Error(`Version 0 CID must use dag-pb (code: ${DAG_PB_CODE$1}) block encoding`);return new hr(e,t,n,n.bytes)}case 1:{const o=encodeCID$2(e,t,n.bytes);return new hr(e,t,n,o)}default:throw new Error("Invalid version")}}static createV0(e){return hr.create(0,DAG_PB_CODE$1,e)}static createV1(e,t){return hr.create(1,e,t)}static decode(e){const[t,n]=hr.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=hr.inspectBytes(e),n=t.size-t.multihashSize,o=coerce$1(e.subarray(n,n+t.multihashSize));if(o.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=o.subarray(t.multihashSize-t.digestSize),u=new Digest$1(t.multihashCode,t.digestSize,s,o);return[t.version===0?hr.createV0(u):hr.createV1(t.codec,u),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[m,b]=decode$e(e.subarray(t));return t+=b,m};let o=n(),s=DAG_PB_CODE$1;if(o===18?(o=0,t=0):s=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);const u=t,f=n(),l=n(),h=t+l,p=h-u;return{version:o,codec:s,multihashCode:f,digestSize:l,multihashSize:p,size:h}}static parse(e,t){const[n,o]=parseCIDtoBytes$1(e,t),s=hr.decode(o);return baseCache$1(s).set(n,e),s}};const parseCIDtoBytes$1=(r,e)=>{switch(r[0]){case"Q":{const t=e||base58btc$1;return[base58btc$1.prefix,t.decode(`${base58btc$1.prefix}${r}`)]}case base58btc$1.prefix:{const t=e||base58btc$1;return[base58btc$1.prefix,t.decode(r)]}case base32$2.prefix:{const t=e||base32$2;return[base32$2.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},toStringV0$1=(r,e,t)=>{const{prefix:n}=t;if(n!==base58btc$1.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const o=e.get(n);if(o==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return o},toStringV1$1=(r,e,t)=>{const{prefix:n}=t,o=e.get(n);if(o==null){const s=t.encode(r);return e.set(n,s),s}else return o},DAG_PB_CODE$1=112,SHA_256_CODE$1=18,encodeCID$2=(r,e,t)=>{const n=encodingLength$1(r),o=n+encodingLength$1(e),s=new Uint8Array(o+t.byteLength);return encodeTo$1(r,s,0),encodeTo$1(e,s,n),s.set(t,o),s},cidSymbol$1=Symbol.for("@ipld/js-cid/CID");function hasProp(r,e){return typeof r=="object"&&r!=null&&e in r}const isDefined=r=>r!==void 0,notNull=r=>r!==null,isValue=r=>isDefined(r)&&notNull(r),isBool=r=>typeof r=="boolean";function isCryptoKey(r){return hasProp(r,"algorithm")&&hasProp(r,"extractable")&&hasProp(r,"type")}const isNum=r=>typeof r=="number",isString=r=>typeof r=="string",isObject$1=r=>r!==null&&typeof r=="object",isBlob=r=>{var e;return typeof Blob>"u"?!1:r instanceof Blob||isObject$1(r)&&((e=r==null?void 0:r.constructor)==null?void 0:e.name)==="Blob"},EMPTY_CID="Qmc5m94Gu7z62RC8waSKkZUrCCBJPyHbkpmGzEePxy2oXJ";function decodeCID(r){const e=CID$1.asCID(r);if(e)return e;if(typeof r=="string")return CID$1.parse(r);if(typeof r=="object"&&"version"in r&&"code"in r&&"multihash"in r)return CID$1.create(r.version,r.code,r.multihash);if(typeof r=="object"&&hasProp(r,"version")&&hasProp(r,"code")&&isNum(r.code)&&hasProp(r,"hash")&&isObject$1(r.hash)&&Object.values(r.hash).every(isNum)){const t=decode$d(new Uint8Array(Object.values(r.hash)));return CID$1.create(r.version,r.code,t)}throw new Error(`Could not decode CID: ${JSON.stringify(r)}`)}function encodeCID$1(r){return typeof r=="string"?r:r.toString()}const removeKeyFromObj=(r,e)=>{const{[e]:t,...n}=r;return n},mapObj=(r,e)=>{const t={};return Object.entries(r).forEach(([n,o])=>{t[n]=e(o,n)}),t},VERSION="0.36.1",WASM_WNFS_VERSION="0.1.7",isBrowser=typeof self<"u"&&typeof self.location=="object",assertBrowser=r=>{if(!isBrowser)throw new Error(`Must be in browser to use method. Provide a node-compatible implementation for ${r}`)},BASE58_DID_PREFIX="did:key:z",hasPrefix=(r,e)=>equal(e,r.slice(0,e.byteLength));function publicKeyToDid(r,e,t){var s;const n=(s=r.did.keyTypes[t])==null?void 0:s.magicBytes;if(n===null)throw new Error(`Key type '${t}' not supported, available types: ${Object.keys(r.did.keyTypes).join(", ")}`);const o=concat$2([n,e]);return BASE58_DID_PREFIX+toString$7(o,"base58btc")}function didToPublicKey(r,e){if(!e.startsWith(BASE58_DID_PREFIX))throw new Error("Please use a base58-encoded DID formatted `did:key:z...`");const t=e.substr(BASE58_DID_PREFIX.length),n=fromString$7(t,"base58btc"),o=Object.entries(r.did.keyTypes).find(([s,u])=>hasPrefix(n,u.magicBytes));if(!o)throw new Error("Unsupported key algorithm.");return{publicKey:n.slice(o[1].magicBytes.length),type:o[0]}}async function build({addSignature:r=!0,audience:e,dependencies:t,facts:n=[],issuer:o,lifetimeInSeconds:s=30,expiration:u,potency:f="APPEND",proof:l,resource:h}){const p=Math.floor(Date.now()/1e3),m=l?typeof l=="string"?decode$b(l):l:null,b={alg:await t.crypto.keystore.getUcanAlgorithm(),typ:"JWT",uav:"1.0.0"};let S=u||p+s,A=p-60;if(m){const ne=m.payload;S=Math.min(ne.exp,S),A=Math.max(ne.nbf,A)}const L={aud:e,exp:S,fct:n,iss:o,nbf:A,prf:l?typeof l=="string"?l:encode$b(l):null,ptc:f,rsc:h||(m?m.payload.rsc:"*")},J=r?await sign$1(t.crypto,b,L):null;return{header:b,payload:L,signature:J}}function decode$b(r){const e=r.split("."),t=JSON.parse(urlDecode(e[0])),n=JSON.parse(urlDecode(e[1]));return{header:t,payload:n,signature:e[2]||null}}function encode$b(r){const e=encodeHeader(r.header),t=encodePayload(r.payload);return e+"."+t+"."+r.signature}function encodeHeader(r){return urlEncode(JSON.stringify(r))}function encodePayload(r){return urlEncode(JSON.stringify({...r}))}function isExpired(r){return r.payload.exp<=Math.floor(Date.now()/1e3)}function isSelfSigned(r){return r.payload.iss===r.payload.aud}async function isValid(r,e){try{const t=encodeHeader(e.header),n=encodePayload(e.payload),{publicKey:o,type:s}=didToPublicKey(r,e.payload.iss),f=await r.did.keyTypes[s].verify({publicKey:o,message:fromString$7(`${t}.${n}`,"utf8"),signature:fromString$7(e.signature||"","base64url")});if(!f)return f;if(!e.payload.prf)return!0;const l=decode$b(e.payload.prf),h=l.payload.aud===e.payload.iss;return h&&await isValid(r,l)}catch{return!1}}function rootIssuer(r,e=0){const t=typeof r=="string"?extractPayload(r,e):r.payload;return t.prf?rootIssuer(t.prf,e+1):t.iss}async function sign$1(r,e,t){const n=encodeHeader(e),o=encodePayload(t);return toString$7(await r.keystore.sign(fromString$7(`${n}.${o}`,"utf8")),"base64url")}function extractPayload(r,e){try{return JSON.parse(urlDecode(r.split(".")[1]))}catch{throw new Error(`Invalid UCAN (${e} level${e===1?"":"s"} deep): \`${r}\``)}}class Repository{constructor({storage:e,storageName:t}){this.memoryCache=[],this.dictionary={},this.storage=e,this.storageName=t}static async create(e){const t=new this.prototype.constructor(e);return t.memoryCache=await t.getAll(),t.dictionary=t.toDictionary(t.memoryCache),t}async add(e){const t=Array.isArray(e)?e:[e];this.memoryCache=[...this.memoryCache,...t],this.dictionary=this.toDictionary(this.memoryCache),await this.storage.setItem(this.storageName,this.memoryCache.map(this.toJSON).join("|||"))}clear(){return this.memoryCache=[],this.dictionary={},this.storage.removeItem(this.storageName)}find(e){return this.memoryCache.find(e)||null}getByIndex(e){return this.memoryCache[e]}async getAll(){const e=await this.storage.getItem(this.storageName);return isString(e)?e.split("|||").map(this.fromJSON):[]}indexOf(e){return this.memoryCache.indexOf(e)}length(){return this.memoryCache.length}fromJSON(e){return JSON.parse(e)}toJSON(e){return JSON.stringify(e)}getByKey(e){return this.dictionary[e]}toDictionary(e){return e.reduce((t,n,o)=>({...t,[o.toString()]:n}),{})}}function create$6({storage:r}){return Repo$2.create({storage:r,storageName:r.KEYS.UCANS})}let Repo$2=class extends Repository{constructor(e){super(e)}fromJSON(e){return decode$b(e)}toJSON(e){return encode$b(e)}toDictionary(e){return e.reduce((t,n)=>({...t,[resourceLabel(n.payload.rsc)]:n}),{})}async lookupFilesystemUcan(e){const t=this.getByKey("*");if(t)return t;const n=e==="*",o=n?!1:isDirectory(e),s=n?["*"]:unwrap$2(e),u=filesystemPrefix();return s.reduce((f,l,h)=>{if(f)return f;const p=h===0,m=s.slice(0,s.length-h),b=toPosix(p&&!o?file(...m):directory(...m));return this.getByKey(`${u}${b}`)||null},null)}async lookupAppUcan(e){return this.getByKey("*")||this.getByKey("app:*")||this.getByKey(`app:${e}`)}};const WNFS_PREFIX="wnfs";function filesystemPrefix(r){return WNFS_PREFIX+":"}function resourceLabel(r){if(typeof r!="object")return r;const e=Array.from(Object.entries(r))[0];return e[0]+":"+(e[0]===WNFS_PREFIX?e[1].replace(/^\/+/,""):e[1])}const SESSION_TYPE="capabilities";async function collect$1({capabilities:r,crypto:e,reference:t,storage:n}){if(r.ucans.length===0)throw new Error("Expected at least one UCAN");await collectPermissions({reference:t,ucans:r.ucans});const o=await t.didRoot.lookup(r.username);await r.fileSystemSecrets.reduce(async(s,u)=>{await s,await collectSecret({accountDID:o,crypto:e,storage:n,bareNameFilter:u.bareNameFilter,readKey:u.readKey,path:u.path})},Promise.resolve())}async function collectSecret({accountDID:r,bareNameFilter:e,crypto:t,path:n,readKey:o,storage:s}){const u=await readKey({accountDID:r,crypto:t,path:n}),f=await bareNameFilter({accountDID:r,crypto:t,path:n});await t.keystore.importSymmKey(o,u),await s.setItem(f,e)}async function collectPermissions({reference:r,ucans:e}){await r.repositories.ucans.add(e)}function validatePermissions(r,{app:e,fs:t,raw:n}){let o;const s=filesystemPrefix(),u=r.getByKey("*");if(u&&!isExpired(u)&&!isSelfSigned(u))return u;if(e){const f=s+toPosix(appData(e)),l=r.getByKey(f);if(!l||isExpired(l))return null;o=l}return t!=null&&t.private&&!t.private.every(l=>{const h=`${s}private/`+toPosix(l),p=r.getByKey(h);return o=p,p&&!isExpired(p)})||t!=null&&t.public&&!t.public.every(l=>{const h=`${s}public/`+toPosix(l),p=r.getByKey(h);return o=p,p&&!isExpired(p)})||n&&!n.every(l=>{const h=resourceLabel(l.rsc),p=r.getByKey(h);return o=p,p&&!isExpired(p)})?null:o||null}async function validateSecrets(r,e,t){return permissionPaths(t).reduce((n,o)=>n.then(async s=>{if(s===!1||isPartition(RootBranch.Public,o))return s;const u=await readKey({accountDID:e,crypto:r,path:o});return r.keystore.keyExists(u)}),Promise.resolve(!0))}async function exchange(r){const e=await r.keystore.publicExchangeKey(),t=await r.keystore.getAlgorithm();return publicKeyToDid(r,e,t)}async function write(r){const e=await r.keystore.publicWriteKey(),t=await r.keystore.getAlgorithm();return publicKeyToDid(r,e,t)}let EventEmitter$2=class{constructor(){this.events=new Map,this.on=this.addListener,this.off=this.removeListener}addListener(e,t){const n=this.events.get(e);n===void 0?this.events.set(e,new Set([t])):n.add(t)}removeListener(e,t){const n=this.events.get(e);n!==void 0&&(n.delete(t),n.size===0&&this.events.delete(e))}emit(e,t){var n;(n=this.events.get(e))==null||n.forEach(o=>{o.apply(this,[t])})}};function createEmitter(){return new EventEmitter$2}function listenTo(r){return{addListener:r.addListener.bind(r),removeListener:r.removeListener.bind(r),on:r.on.bind(r),off:r.off.bind(r)}}const typeofs=["string","number","bigint","symbol"],objectTypeNames=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function is(r){if(r===null)return"null";if(r===void 0)return"undefined";if(r===!0||r===!1)return"boolean";const e=typeof r;if(typeofs.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(r))return"Array";if(isBuffer$1(r))return"Buffer";const t=getObjectType(r);return t||"Object"}function isBuffer$1(r){return r&&r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer.call(null,r)}function getObjectType(r){const e=Object.prototype.toString.call(r).slice(8,-1);if(objectTypeNames.includes(e))return e}class Type{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}Type.uint=new Type(0,"uint",!0);Type.negint=new Type(1,"negint",!0);Type.bytes=new Type(2,"bytes",!0);Type.string=new Type(3,"string",!0);Type.array=new Type(4,"array",!1);Type.map=new Type(5,"map",!1);Type.tag=new Type(6,"tag",!1);Type.float=new Type(7,"float",!0);Type.false=new Type(7,"false",!0);Type.true=new Type(7,"true",!0);Type.null=new Type(7,"null",!0);Type.undefined=new Type(7,"undefined",!0);Type.break=new Type(7,"break",!0);class Token{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const useBuffer=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",textDecoder$2=new TextDecoder,textEncoder$4=new TextEncoder;function isBuffer(r){return useBuffer&&globalThis.Buffer.isBuffer(r)}function asU8A(r){return r instanceof Uint8Array?isBuffer(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r:Uint8Array.from(r)}const toString$5=useBuffer?(r,e,t)=>t-e>64?globalThis.Buffer.from(r.subarray(e,t)).toString("utf8"):utf8Slice(r,e,t):(r,e,t)=>t-e>64?textDecoder$2.decode(r.subarray(e,t)):utf8Slice(r,e,t),fromString$5=useBuffer?r=>r.length>64?globalThis.Buffer.from(r):utf8ToBytes(r):r=>r.length>64?textEncoder$4.encode(r):utf8ToBytes(r),fromArray=r=>Uint8Array.from(r),slice=useBuffer?(r,e,t)=>isBuffer(r)?new Uint8Array(r.subarray(e,t)):r.slice(e,t):(r,e,t)=>r.slice(e,t),concat$1=useBuffer?(r,e)=>(r=r.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),asU8A(globalThis.Buffer.concat(r,e))):(r,e)=>{const t=new Uint8Array(e);let n=0;for(let o of r)n+o.length>t.length&&(o=o.subarray(0,t.length-n)),t.set(o,n),n+=o.length;return t},alloc=useBuffer?r=>globalThis.Buffer.allocUnsafe(r):r=>new Uint8Array(r);function compare$1(r,e){if(isBuffer(r)&&isBuffer(e))return r.compare(e);for(let t=0;t<r.length;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}function utf8ToBytes(r,e=1/0){let t;const n=r.length;let o=null;const s=[];for(let u=0;u<n;++u){if(t=r.charCodeAt(u),t>55295&&t<57344){if(!o){if(t>56319){(e-=3)>-1&&s.push(239,191,189);continue}else if(u+1===n){(e-=3)>-1&&s.push(239,191,189);continue}o=t;continue}if(t<56320){(e-=3)>-1&&s.push(239,191,189),o=t;continue}t=(o-55296<<10|t-56320)+65536}else o&&(e-=3)>-1&&s.push(239,191,189);if(o=null,t<128){if((e-=1)<0)break;s.push(t)}else if(t<2048){if((e-=2)<0)break;s.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;s.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;s.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return s}function utf8Slice(r,e,t){const n=[];for(;e<t;){const o=r[e];let s=null,u=o>239?4:o>223?3:o>191?2:1;if(e+u<=t){let f,l,h,p;switch(u){case 1:o<128&&(s=o);break;case 2:f=r[e+1],(f&192)===128&&(p=(o&31)<<6|f&63,p>127&&(s=p));break;case 3:f=r[e+1],l=r[e+2],(f&192)===128&&(l&192)===128&&(p=(o&15)<<12|(f&63)<<6|l&63,p>2047&&(p<55296||p>57343)&&(s=p));break;case 4:f=r[e+1],l=r[e+2],h=r[e+3],(f&192)===128&&(l&192)===128&&(h&192)===128&&(p=(o&15)<<18|(f&63)<<12|(l&63)<<6|h&63,p>65535&&p<1114112&&(s=p))}}s===null?(s=65533,u=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|s&1023),n.push(s),e+=u}return decodeCodePointsArray(n)}const MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(r){const e=r.length;if(e<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=MAX_ARGUMENTS_LENGTH));return t}const defaultChunkSize=256;class Bl{constructor(e=defaultChunkSize){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const o=t.length-(this.maxCursor-this.cursor)-1;t.set(e,o)}else{if(t){const o=t.length-(this.maxCursor-this.cursor)-1;o<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,o),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=alloc(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){const n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=slice(n,0,this.cursor)}else t=concat$1(this.chunks,this.cursor);return e&&this.reset(),t}}const decodeErrPrefix="CBOR decode error:",encodeErrPrefix="CBOR encode error:";function assertEnoughData(r,e,t){if(r.length-e<t)throw new Error(`${decodeErrPrefix} not enough data for type`)}const uintBoundaries=[24,256,65536,4294967296,BigInt("18446744073709551616")];function readUint8(r,e,t){assertEnoughData(r,e,1);const n=r[e];if(t.strict===!0&&n<uintBoundaries[0])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return n}function readUint16(r,e,t){assertEnoughData(r,e,2);const n=r[e]<<8|r[e+1];if(t.strict===!0&&n<uintBoundaries[1])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return n}function readUint32(r,e,t){assertEnoughData(r,e,4);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3];if(t.strict===!0&&n<uintBoundaries[2])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return n}function readUint64(r,e,t){assertEnoughData(r,e,8);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3],o=r[e+4]*16777216+(r[e+5]<<16)+(r[e+6]<<8)+r[e+7],s=(BigInt(n)<<BigInt(32))+BigInt(o);if(t.strict===!0&&s<uintBoundaries[3])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);if(s<=Number.MAX_SAFE_INTEGER)return Number(s);if(t.allowBigInt===!0)return s;throw new Error(`${decodeErrPrefix} integers outside of the safe integer range are not supported`)}function decodeUint8(r,e,t,n){return new Token(Type.uint,readUint8(r,e+1,n),2)}function decodeUint16(r,e,t,n){return new Token(Type.uint,readUint16(r,e+1,n),3)}function decodeUint32(r,e,t,n){return new Token(Type.uint,readUint32(r,e+1,n),5)}function decodeUint64(r,e,t,n){return new Token(Type.uint,readUint64(r,e+1,n),9)}function encodeUint(r,e){return encodeUintValue(r,0,e.value)}function encodeUintValue(r,e,t){if(t<uintBoundaries[0]){const n=Number(t);r.push([e|n])}else if(t<uintBoundaries[1]){const n=Number(t);r.push([e|24,n])}else if(t<uintBoundaries[2]){const n=Number(t);r.push([e|25,n>>>8,n&255])}else if(t<uintBoundaries[3]){const n=Number(t);r.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{const n=BigInt(t);if(n<uintBoundaries[4]){const o=[e|27,0,0,0,0,0,0,0];let s=Number(n&BigInt(4294967295)),u=Number(n>>BigInt(32)&BigInt(4294967295));o[8]=s&255,s=s>>8,o[7]=s&255,s=s>>8,o[6]=s&255,s=s>>8,o[5]=s&255,o[4]=u&255,u=u>>8,o[3]=u&255,u=u>>8,o[2]=u&255,u=u>>8,o[1]=u&255,r.push(o)}else throw new Error(`${decodeErrPrefix} encountered BigInt larger than allowable range`)}}encodeUint.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)};encodeUintValue.encodedSize=function(e){return e<uintBoundaries[0]?1:e<uintBoundaries[1]?2:e<uintBoundaries[2]?3:e<uintBoundaries[3]?5:9};encodeUint.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function decodeNegint8(r,e,t,n){return new Token(Type.negint,-1-readUint8(r,e+1,n),2)}function decodeNegint16(r,e,t,n){return new Token(Type.negint,-1-readUint16(r,e+1,n),3)}function decodeNegint32(r,e,t,n){return new Token(Type.negint,-1-readUint32(r,e+1,n),5)}const neg1b=BigInt(-1),pos1b=BigInt(1);function decodeNegint64(r,e,t,n){const o=readUint64(r,e+1,n);if(typeof o!="bigint"){const s=-1-o;if(s>=Number.MIN_SAFE_INTEGER)return new Token(Type.negint,s,9)}if(n.allowBigInt!==!0)throw new Error(`${decodeErrPrefix} integers outside of the safe integer range are not supported`);return new Token(Type.negint,neg1b-BigInt(o),9)}function encodeNegint(r,e){const t=e.value,n=typeof t=="bigint"?t*neg1b-pos1b:t*-1-1;encodeUintValue(r,e.type.majorEncoded,n)}encodeNegint.encodedSize=function(e){const t=e.value,n=typeof t=="bigint"?t*neg1b-pos1b:t*-1-1;return n<uintBoundaries[0]?1:n<uintBoundaries[1]?2:n<uintBoundaries[2]?3:n<uintBoundaries[3]?5:9};encodeNegint.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function toToken$3(r,e,t,n){assertEnoughData(r,e,t+n);const o=slice(r,e+t,e+t+n);return new Token(Type.bytes,o,t+n)}function decodeBytesCompact(r,e,t,n){return toToken$3(r,e,1,t)}function decodeBytes8(r,e,t,n){return toToken$3(r,e,2,readUint8(r,e+1,n))}function decodeBytes16(r,e,t,n){return toToken$3(r,e,3,readUint16(r,e+1,n))}function decodeBytes32(r,e,t,n){return toToken$3(r,e,5,readUint32(r,e+1,n))}function decodeBytes64(r,e,t,n){const o=readUint64(r,e+1,n);if(typeof o=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer bytes lengths not supported`);return toToken$3(r,e,9,o)}function tokenBytes(r){return r.encodedBytes===void 0&&(r.encodedBytes=r.type===Type.string?fromString$5(r.value):r.value),r.encodedBytes}function encodeBytes(r,e){const t=tokenBytes(e);encodeUintValue(r,e.type.majorEncoded,t.length),r.push(t)}encodeBytes.encodedSize=function(e){const t=tokenBytes(e);return encodeUintValue.encodedSize(t.length)+t.length};encodeBytes.compareTokens=function(e,t){return compareBytes(tokenBytes(e),tokenBytes(t))};function compareBytes(r,e){return r.length<e.length?-1:r.length>e.length?1:compare$1(r,e)}function toToken$2(r,e,t,n,o){const s=t+n;assertEnoughData(r,e,s);const u=new Token(Type.string,toString$5(r,e+t,e+s),s);return o.retainStringBytes===!0&&(u.byteValue=slice(r,e+t,e+s)),u}function decodeStringCompact(r,e,t,n){return toToken$2(r,e,1,t,n)}function decodeString8(r,e,t,n){return toToken$2(r,e,2,readUint8(r,e+1,n),n)}function decodeString16(r,e,t,n){return toToken$2(r,e,3,readUint16(r,e+1,n),n)}function decodeString32(r,e,t,n){return toToken$2(r,e,5,readUint32(r,e+1,n),n)}function decodeString64(r,e,t,n){const o=readUint64(r,e+1,n);if(typeof o=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer string lengths not supported`);return toToken$2(r,e,9,o,n)}const encodeString$1=encodeBytes;function toToken$1(r,e,t,n){return new Token(Type.array,n,t)}function decodeArrayCompact(r,e,t,n){return toToken$1(r,e,1,t)}function decodeArray8(r,e,t,n){return toToken$1(r,e,2,readUint8(r,e+1,n))}function decodeArray16(r,e,t,n){return toToken$1(r,e,3,readUint16(r,e+1,n))}function decodeArray32(r,e,t,n){return toToken$1(r,e,5,readUint32(r,e+1,n))}function decodeArray64(r,e,t,n){const o=readUint64(r,e+1,n);if(typeof o=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer array lengths not supported`);return toToken$1(r,e,9,o)}function decodeArrayIndefinite(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${decodeErrPrefix} indefinite length items not allowed`);return toToken$1(r,e,1,1/0)}function encodeArray(r,e){encodeUintValue(r,Type.array.majorEncoded,e.value)}encodeArray.compareTokens=encodeUint.compareTokens;encodeArray.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)};function toToken(r,e,t,n){return new Token(Type.map,n,t)}function decodeMapCompact(r,e,t,n){return toToken(r,e,1,t)}function decodeMap8(r,e,t,n){return toToken(r,e,2,readUint8(r,e+1,n))}function decodeMap16(r,e,t,n){return toToken(r,e,3,readUint16(r,e+1,n))}function decodeMap32(r,e,t,n){return toToken(r,e,5,readUint32(r,e+1,n))}function decodeMap64(r,e,t,n){const o=readUint64(r,e+1,n);if(typeof o=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer map lengths not supported`);return toToken(r,e,9,o)}function decodeMapIndefinite(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${decodeErrPrefix} indefinite length items not allowed`);return toToken(r,e,1,1/0)}function encodeMap(r,e){encodeUintValue(r,Type.map.majorEncoded,e.value)}encodeMap.compareTokens=encodeUint.compareTokens;encodeMap.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)};function decodeTagCompact(r,e,t,n){return new Token(Type.tag,t,1)}function decodeTag8(r,e,t,n){return new Token(Type.tag,readUint8(r,e+1,n),2)}function decodeTag16(r,e,t,n){return new Token(Type.tag,readUint16(r,e+1,n),3)}function decodeTag32(r,e,t,n){return new Token(Type.tag,readUint32(r,e+1,n),5)}function decodeTag64(r,e,t,n){return new Token(Type.tag,readUint64(r,e+1,n),9)}function encodeTag(r,e){encodeUintValue(r,Type.tag.majorEncoded,e.value)}encodeTag.compareTokens=encodeUint.compareTokens;encodeTag.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)};const MINOR_FALSE=20,MINOR_TRUE=21,MINOR_NULL=22,MINOR_UNDEFINED=23;function decodeUndefined(r,e,t,n){if(n.allowUndefined===!1)throw new Error(`${decodeErrPrefix} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new Token(Type.null,null,1):new Token(Type.undefined,void 0,1)}function decodeBreak(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${decodeErrPrefix} indefinite length items not allowed`);return new Token(Type.break,void 0,1)}function createToken(r,e,t){if(t){if(t.allowNaN===!1&&Number.isNaN(r))throw new Error(`${decodeErrPrefix} NaN values are not supported`);if(t.allowInfinity===!1&&(r===1/0||r===-1/0))throw new Error(`${decodeErrPrefix} Infinity values are not supported`)}return new Token(Type.float,r,e)}function decodeFloat16(r,e,t,n){return createToken(readFloat16(r,e+1),3,n)}function decodeFloat32(r,e,t,n){return createToken(readFloat32(r,e+1),5,n)}function decodeFloat64(r,e,t,n){return createToken(readFloat64(r,e+1),9,n)}function encodeFloat(r,e,t){const n=e.value;if(n===!1)r.push([Type.float.majorEncoded|MINOR_FALSE]);else if(n===!0)r.push([Type.float.majorEncoded|MINOR_TRUE]);else if(n===null)r.push([Type.float.majorEncoded|MINOR_NULL]);else if(n===void 0)r.push([Type.float.majorEncoded|MINOR_UNDEFINED]);else{let o,s=!1;(!t||t.float64!==!0)&&(encodeFloat16(n),o=readFloat16(ui8a,1),n===o||Number.isNaN(n)?(ui8a[0]=249,r.push(ui8a.slice(0,3)),s=!0):(encodeFloat32(n),o=readFloat32(ui8a,1),n===o&&(ui8a[0]=250,r.push(ui8a.slice(0,5)),s=!0))),s||(encodeFloat64(n),o=readFloat64(ui8a,1),ui8a[0]=251,r.push(ui8a.slice(0,9)))}}encodeFloat.encodedSize=function(e,t){const n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!t||t.float64!==!0){encodeFloat16(n);let o=readFloat16(ui8a,1);if(n===o||Number.isNaN(n))return 3;if(encodeFloat32(n),o=readFloat32(ui8a,1),n===o)return 5}return 9};const buffer$1=new ArrayBuffer(9),dataView=new DataView(buffer$1,1),ui8a=new Uint8Array(buffer$1,0);function encodeFloat16(r){if(r===1/0)dataView.setUint16(0,31744,!1);else if(r===-1/0)dataView.setUint16(0,64512,!1);else if(Number.isNaN(r))dataView.setUint16(0,32256,!1);else{dataView.setFloat32(0,r);const e=dataView.getUint32(0),t=(e&2139095040)>>23,n=e&8388607;if(t===255)dataView.setUint16(0,31744,!1);else if(t===0)dataView.setUint16(0,(r&2147483648)>>16|n>>13,!1);else{const o=t-127;o<-24?dataView.setUint16(0,0):o<-14?dataView.setUint16(0,(e&2147483648)>>16|1<<24+o,!1):dataView.setUint16(0,(e&2147483648)>>16|o+15<<10|n>>13,!1)}}}function readFloat16(r,e){if(r.length-e<2)throw new Error(`${decodeErrPrefix} not enough data for float16`);const t=(r[e]<<8)+r[e+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;const n=t>>10&31,o=t&1023;let s;return n===0?s=o*2**-24:n!==31?s=(o+1024)*2**(n-25):s=o===0?1/0:NaN,t&32768?-s:s}function encodeFloat32(r){dataView.setFloat32(0,r,!1)}function readFloat32(r,e){if(r.length-e<4)throw new Error(`${decodeErrPrefix} not enough data for float32`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,4).getFloat32(0,!1)}function encodeFloat64(r){dataView.setFloat64(0,r,!1)}function readFloat64(r,e){if(r.length-e<8)throw new Error(`${decodeErrPrefix} not enough data for float64`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,8).getFloat64(0,!1)}encodeFloat.compareTokens=encodeUint.compareTokens;function invalidMinor(r,e,t){throw new Error(`${decodeErrPrefix} encountered invalid minor (${t}) for major ${r[e]>>>5}`)}function errorer(r){return()=>{throw new Error(`${decodeErrPrefix} ${r}`)}}const jump=[];for(let r=0;r<=23;r++)jump[r]=invalidMinor;jump[24]=decodeUint8;jump[25]=decodeUint16;jump[26]=decodeUint32;jump[27]=decodeUint64;jump[28]=invalidMinor;jump[29]=invalidMinor;jump[30]=invalidMinor;jump[31]=invalidMinor;for(let r=32;r<=55;r++)jump[r]=invalidMinor;jump[56]=decodeNegint8;jump[57]=decodeNegint16;jump[58]=decodeNegint32;jump[59]=decodeNegint64;jump[60]=invalidMinor;jump[61]=invalidMinor;jump[62]=invalidMinor;jump[63]=invalidMinor;for(let r=64;r<=87;r++)jump[r]=decodeBytesCompact;jump[88]=decodeBytes8;jump[89]=decodeBytes16;jump[90]=decodeBytes32;jump[91]=decodeBytes64;jump[92]=invalidMinor;jump[93]=invalidMinor;jump[94]=invalidMinor;jump[95]=errorer("indefinite length bytes/strings are not supported");for(let r=96;r<=119;r++)jump[r]=decodeStringCompact;jump[120]=decodeString8;jump[121]=decodeString16;jump[122]=decodeString32;jump[123]=decodeString64;jump[124]=invalidMinor;jump[125]=invalidMinor;jump[126]=invalidMinor;jump[127]=errorer("indefinite length bytes/strings are not supported");for(let r=128;r<=151;r++)jump[r]=decodeArrayCompact;jump[152]=decodeArray8;jump[153]=decodeArray16;jump[154]=decodeArray32;jump[155]=decodeArray64;jump[156]=invalidMinor;jump[157]=invalidMinor;jump[158]=invalidMinor;jump[159]=decodeArrayIndefinite;for(let r=160;r<=183;r++)jump[r]=decodeMapCompact;jump[184]=decodeMap8;jump[185]=decodeMap16;jump[186]=decodeMap32;jump[187]=decodeMap64;jump[188]=invalidMinor;jump[189]=invalidMinor;jump[190]=invalidMinor;jump[191]=decodeMapIndefinite;for(let r=192;r<=215;r++)jump[r]=decodeTagCompact;jump[216]=decodeTag8;jump[217]=decodeTag16;jump[218]=decodeTag32;jump[219]=decodeTag64;jump[220]=invalidMinor;jump[221]=invalidMinor;jump[222]=invalidMinor;jump[223]=invalidMinor;for(let r=224;r<=243;r++)jump[r]=errorer("simple values are not supported");jump[244]=invalidMinor;jump[245]=invalidMinor;jump[246]=invalidMinor;jump[247]=decodeUndefined;jump[248]=errorer("simple values are not supported");jump[249]=decodeFloat16;jump[250]=decodeFloat32;jump[251]=decodeFloat64;jump[252]=invalidMinor;jump[253]=invalidMinor;jump[254]=invalidMinor;jump[255]=decodeBreak;const quick=[];for(let r=0;r<24;r++)quick[r]=new Token(Type.uint,r,1);for(let r=-1;r>=-24;r--)quick[31-r]=new Token(Type.negint,r,1);quick[64]=new Token(Type.bytes,new Uint8Array(0),1);quick[96]=new Token(Type.string,"",1);quick[128]=new Token(Type.array,0,1);quick[160]=new Token(Type.map,0,1);quick[244]=new Token(Type.false,!1,1);quick[245]=new Token(Type.true,!0,1);quick[246]=new Token(Type.null,null,1);function quickEncodeToken(r){switch(r.type){case Type.false:return fromArray([244]);case Type.true:return fromArray([245]);case Type.null:return fromArray([246]);case Type.bytes:return r.value.length?void 0:fromArray([64]);case Type.string:return r.value===""?fromArray([96]):void 0;case Type.array:return r.value===0?fromArray([128]):void 0;case Type.map:return r.value===0?fromArray([160]):void 0;case Type.uint:return r.value<24?fromArray([Number(r.value)]):void 0;case Type.negint:if(r.value>=-24)return fromArray([31-Number(r.value)])}}const defaultEncodeOptions={float64:!1,mapSorter,quickEncodeToken};function makeCborEncoders(){const r=[];return r[Type.uint.major]=encodeUint,r[Type.negint.major]=encodeNegint,r[Type.bytes.major]=encodeBytes,r[Type.string.major]=encodeString$1,r[Type.array.major]=encodeArray,r[Type.map.major]=encodeMap,r[Type.tag.major]=encodeTag,r[Type.float.major]=encodeFloat,r}const cborEncoders=makeCborEncoders(),buf=new Bl;class Ref{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${encodeErrPrefix} object contains circular references`);return new Ref(t,e)}}const simpleTokens={null:new Token(Type.null,null),undefined:new Token(Type.undefined,void 0),true:new Token(Type.true,!0),false:new Token(Type.false,!1),emptyArray:new Token(Type.array,0),emptyMap:new Token(Type.map,0)},typeEncoders={number(r,e,t,n){return!Number.isInteger(r)||!Number.isSafeInteger(r)?new Token(Type.float,r):r>=0?new Token(Type.uint,r):new Token(Type.negint,r)},bigint(r,e,t,n){return r>=BigInt(0)?new Token(Type.uint,r):new Token(Type.negint,r)},Uint8Array(r,e,t,n){return new Token(Type.bytes,r)},string(r,e,t,n){return new Token(Type.string,r)},boolean(r,e,t,n){return r?simpleTokens.true:simpleTokens.false},null(r,e,t,n){return simpleTokens.null},undefined(r,e,t,n){return simpleTokens.undefined},ArrayBuffer(r,e,t,n){return new Token(Type.bytes,new Uint8Array(r))},DataView(r,e,t,n){return new Token(Type.bytes,new Uint8Array(r.buffer,r.byteOffset,r.byteLength))},Array(r,e,t,n){if(!r.length)return t.addBreakTokens===!0?[simpleTokens.emptyArray,new Token(Type.break)]:simpleTokens.emptyArray;n=Ref.createCheck(n,r);const o=[];let s=0;for(const u of r)o[s++]=objectToTokens(u,t,n);return t.addBreakTokens?[new Token(Type.array,r.length),o,new Token(Type.break)]:[new Token(Type.array,r.length),o]},Object(r,e,t,n){const o=e!=="Object",s=o?r.keys():Object.keys(r),u=o?r.size:s.length;if(!u)return t.addBreakTokens===!0?[simpleTokens.emptyMap,new Token(Type.break)]:simpleTokens.emptyMap;n=Ref.createCheck(n,r);const f=[];let l=0;for(const h of s)f[l++]=[objectToTokens(h,t,n),objectToTokens(o?r.get(h):r[h],t,n)];return sortMapEntries(f,t),t.addBreakTokens?[new Token(Type.map,u),f,new Token(Type.break)]:[new Token(Type.map,u),f]}};typeEncoders.Map=typeEncoders.Object;typeEncoders.Buffer=typeEncoders.Uint8Array;for(const r of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))typeEncoders[`${r}Array`]=typeEncoders.DataView;function objectToTokens(r,e={},t){const n=is(r),o=e&&e.typeEncoders&&e.typeEncoders[n]||typeEncoders[n];if(typeof o=="function"){const u=o(r,n,e,t);if(u!=null)return u}const s=typeEncoders[n];if(!s)throw new Error(`${encodeErrPrefix} unsupported type: ${n}`);return s(r,n,e,t)}function sortMapEntries(r,e){e.mapSorter&&r.sort(e.mapSorter)}function mapSorter(r,e){const t=Array.isArray(r[0])?r[0][0]:r[0],n=Array.isArray(e[0])?e[0][0]:e[0];if(t.type!==n.type)return t.type.compare(n.type);const o=t.type.major,s=cborEncoders[o].compareTokens(t,n);return s===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),s}function tokensToEncoded(r,e,t,n){if(Array.isArray(e))for(const o of e)tokensToEncoded(r,o,t,n);else t[e.type.major](r,e,n)}function encodeCustom(r,e,t){const n=objectToTokens(r,t);if(!Array.isArray(n)&&t.quickEncodeToken){const o=t.quickEncodeToken(n);if(o)return o;const s=e[n.type.major];if(s.encodedSize){const u=s.encodedSize(n,t),f=new Bl(u);if(s(f,n,t),f.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return asU8A(f.chunks[0])}}return buf.reset(),tokensToEncoded(buf,n,e,t),buf.toBytes(!0)}function encode$a(r,e){return e=Object.assign({},defaultEncodeOptions,e),encodeCustom(r,cborEncoders,e)}const defaultDecodeOptions={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class Tokeniser{constructor(e,t={}){this.pos=0,this.data=e,this.options=t}done(){return this.pos>=this.data.length}next(){const e=this.data[this.pos];let t=quick[e];if(t===void 0){const n=jump[e];if(!n)throw new Error(`${decodeErrPrefix} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const o=e&31;t=n(this.data,this.pos,o,this.options)}return this.pos+=t.encodedLength,t}}const DONE=Symbol.for("DONE"),BREAK=Symbol.for("BREAK");function tokenToArray(r,e,t){const n=[];for(let o=0;o<r.value;o++){const s=tokensToObject(e,t);if(s===BREAK){if(r.value===1/0)break;throw new Error(`${decodeErrPrefix} got unexpected break to lengthed array`)}if(s===DONE)throw new Error(`${decodeErrPrefix} found array but not enough entries (got ${o}, expected ${r.value})`);n[o]=s}return n}function tokenToMap(r,e,t){const n=t.useMaps===!0,o=n?void 0:{},s=n?new Map:void 0;for(let u=0;u<r.value;u++){const f=tokensToObject(e,t);if(f===BREAK){if(r.value===1/0)break;throw new Error(`${decodeErrPrefix} got unexpected break to lengthed map`)}if(f===DONE)throw new Error(`${decodeErrPrefix} found map but not enough entries (got ${u} [no key], expected ${r.value})`);if(n!==!0&&typeof f!="string")throw new Error(`${decodeErrPrefix} non-string keys not supported (got ${typeof f})`);if(t.rejectDuplicateMapKeys===!0&&(n&&s.has(f)||!n&&f in o))throw new Error(`${decodeErrPrefix} found repeat map key "${f}"`);const l=tokensToObject(e,t);if(l===DONE)throw new Error(`${decodeErrPrefix} found map but not enough entries (got ${u} [no value], expected ${r.value})`);n?s.set(f,l):o[f]=l}return n?s:o}function tokensToObject(r,e){if(r.done())return DONE;const t=r.next();if(t.type===Type.break)return BREAK;if(t.type.terminal)return t.value;if(t.type===Type.array)return tokenToArray(t,r,e);if(t.type===Type.map)return tokenToMap(t,r,e);if(t.type===Type.tag){if(e.tags&&typeof e.tags[t.value]=="function"){const n=tokensToObject(r,e);return e.tags[t.value](n)}throw new Error(`${decodeErrPrefix} tag not supported (${t.value})`)}throw new Error("unsupported")}function decode$a(r,e){if(!(r instanceof Uint8Array))throw new Error(`${decodeErrPrefix} data to decode must be a Uint8Array`);e=Object.assign({},defaultDecodeOptions,e);const t=e.tokenizer||new Tokeniser(r,e),n=tokensToObject(t,e);if(n===DONE)throw new Error(`${decodeErrPrefix} did not find any content to decode`);if(n===BREAK)throw new Error(`${decodeErrPrefix} got unexpected break`);if(!t.done())throw new Error(`${decodeErrPrefix} too many terminals, data makes no sense`);return n}var encode_1$1=encode$9,MSB$2=128,REST$2=127,MSBALL$1=~REST$2,INT$1=Math.pow(2,31);function encode$9(r,e,t){e=e||[],t=t||0;for(var n=t;r>=INT$1;)e[t++]=r&255|MSB$2,r/=128;for(;r&MSBALL$1;)e[t++]=r&255|MSB$2,r>>>=7;return e[t]=r|0,encode$9.bytes=t-n+1,e}var decode$9=read$1,MSB$1$1=128,REST$1$1=127;function read$1(r,n){var t=0,n=n||0,o=0,s=n,u,f=r.length;do{if(s>=f)throw read$1.bytes=0,new RangeError("Could not decode varint");u=r[s++],t+=o<28?(u&REST$1$1)<<o:(u&REST$1$1)*Math.pow(2,o),o+=7}while(u>=MSB$1$1);return read$1.bytes=s-n,t}var N1$1=Math.pow(2,7),N2$1=Math.pow(2,14),N3$1=Math.pow(2,21),N4$1=Math.pow(2,28),N5$1=Math.pow(2,35),N6$1=Math.pow(2,42),N7$1=Math.pow(2,49),N8$1=Math.pow(2,56),N9$1=Math.pow(2,63),length$2=function(r){return r<N1$1?1:r<N2$1?2:r<N3$1?3:r<N4$1?4:r<N5$1?5:r<N6$1?6:r<N7$1?7:r<N8$1?8:r<N9$1?9:10},varint$1={encode:encode_1$1,decode:decode$9,encodingLength:length$2},_brrp_varint=varint$1;const decode$8=(r,e=0)=>[_brrp_varint.decode(r,e),_brrp_varint.decode.bytes],encodeTo=(r,e,t=0)=>(_brrp_varint.encode(r,e,t),e),encodingLength=r=>_brrp_varint.encodingLength(r),equals$3=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},coerce=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},fromString$4=r=>new TextEncoder().encode(r),toString$4=r=>new TextDecoder().decode(r),create$5=(r,e)=>{const t=e.byteLength,n=encodingLength(r),o=n+encodingLength(t),s=new Uint8Array(o+t);return encodeTo(r,s,0),encodeTo(t,s,n),s.set(e,o),new Digest(r,t,e,s)},decode$7=r=>{const e=coerce(r),[t,n]=decode$8(e),[o,s]=decode$8(e.subarray(n)),u=e.subarray(n+s);if(u.byteLength!==o)throw new Error("Incorrect length");return new Digest(t,o,u,e)},equals$2=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&equals$3(r.bytes,t.bytes)}};class Digest{constructor(e,t,n,o){this.code=e,this.size=t,this.digest=n,this.bytes=o}}function base(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var o=0;o<r.length;o++){var s=r.charAt(o),u=s.charCodeAt(0);if(t[u]!==255)throw new TypeError(s+" is ambiguous");t[u]=o}var f=r.length,l=r.charAt(0),h=Math.log(f)/Math.log(256),p=Math.log(256)/Math.log(f);function m(A){if(A instanceof Uint8Array||(ArrayBuffer.isView(A)?A=new Uint8Array(A.buffer,A.byteOffset,A.byteLength):Array.isArray(A)&&(A=Uint8Array.from(A))),!(A instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(A.length===0)return"";for(var L=0,J=0,ne=0,pe=A.length;ne!==pe&&A[ne]===0;)ne++,L++;for(var de=(pe-ne)*p+1>>>0,H=new Uint8Array(de);ne!==pe;){for(var z=A[ne],ue=0,ce=de-1;(z!==0||ue<J)&&ce!==-1;ce--,ue++)z+=256*H[ce]>>>0,H[ce]=z%f>>>0,z=z/f>>>0;if(z!==0)throw new Error("Non-zero carry");J=ue,ne++}for(var Ee=de-J;Ee!==de&&H[Ee]===0;)Ee++;for(var Be=l.repeat(L);Ee<de;++Ee)Be+=r.charAt(H[Ee]);return Be}function b(A){if(typeof A!="string")throw new TypeError("Expected String");if(A.length===0)return new Uint8Array;var L=0;if(A[L]!==" "){for(var J=0,ne=0;A[L]===l;)J++,L++;for(var pe=(A.length-L)*h+1>>>0,de=new Uint8Array(pe);A[L];){var H=t[A.charCodeAt(L)];if(H===255)return;for(var z=0,ue=pe-1;(H!==0||z<ne)&&ue!==-1;ue--,z++)H+=f*de[ue]>>>0,de[ue]=H%256>>>0,H=H/256>>>0;if(H!==0)throw new Error("Non-zero carry");ne=z,L++}if(A[L]!==" "){for(var ce=pe-ne;ce!==pe&&de[ce]===0;)ce++;for(var Ee=new Uint8Array(J+(pe-ce)),Be=J;ce!==pe;)Ee[Be++]=de[ce++];return Ee}}}function S(A){var L=b(A);if(L)return L;throw new Error(`Non-${e} character`)}return{encode:m,decodeUnsafe:b,decode:S}}var src=base,_brrp__multiformats_scope_baseX=src;class Encoder{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Decoder{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or(this,e)}}class ComposedDecoder{constructor(e){this.decoders=e}or(e){return or(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const or=(r,e)=>new ComposedDecoder({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class Codec{constructor(e,t,n,o){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=o,this.encoder=new Encoder(e,t,n),this.decoder=new Decoder(e,t,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const from$2=({name:r,prefix:e,encode:t,decode:n})=>new Codec(r,e,t,n),baseX=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:o}=_brrp__multiformats_scope_baseX(t,e);return from$2({prefix:r,name:e,encode:n,decode:s=>coerce(o(s))})},decode$6=(r,e,t,n)=>{const o={};for(let p=0;p<e.length;++p)o[e[p]]=p;let s=r.length;for(;r[s-1]==="=";)--s;const u=new Uint8Array(s*t/8|0);let f=0,l=0,h=0;for(let p=0;p<s;++p){const m=o[r[p]];if(m===void 0)throw new SyntaxError(`Non-${n} character`);l=l<<t|m,f+=t,f>=8&&(f-=8,u[h++]=255&l>>f)}if(f>=t||255&l<<8-f)throw new SyntaxError("Unexpected end of data");return u},encode$8=(r,e,t)=>{const n=e[e.length-1]==="=",o=(1<<t)-1;let s="",u=0,f=0;for(let l=0;l<r.length;++l)for(f=f<<8|r[l],u+=8;u>t;)u-=t,s+=e[o&f>>u];if(u&&(s+=e[o&f<<t-u]),n)for(;s.length*t&7;)s+="=";return s},rfc4648=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>from$2({prefix:e,name:r,encode(o){return encode$8(o,n,t)},decode(o){return decode$6(o,n,t,r)}}),base58btc=baseX({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr=baseX({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base58=Object.freeze(Object.defineProperty({__proto__:null,base58btc,base58flickr},Symbol.toStringTag,{value:"Module"})),base32=rfc4648({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper=rfc4648({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad=rfc4648({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper=rfc4648({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex=rfc4648({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper=rfc4648({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad=rfc4648({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper=rfc4648({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z=rfc4648({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base32$1=Object.freeze(Object.defineProperty({__proto__:null,base32,base32hex,base32hexpad,base32hexpadupper,base32hexupper,base32pad,base32padupper,base32upper,base32z},Symbol.toStringTag,{value:"Module"})),format$1=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return toStringV0(t,baseCache(r),e||base58btc.encoder);default:return toStringV1(t,baseCache(r),e||base32.encoder)}},cache=new WeakMap,baseCache=r=>{const e=cache.get(r);if(e==null){const t=new Map;return cache.set(r,t),t}return e};class CID{constructor(e,t,n,o){this.code=t,this.version=e,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return CID.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=create$5(e,t);return CID.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return CID.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&equals$2(e.multihash,n.multihash)}toString(e){return format$1(this,e)}toJSON(){return{"/":format$1(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof CID)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:o,multihash:s,bytes:u}=t;return new CID(n,o,s,u||encodeCID(n,o,s.bytes))}else if(t[cidSymbol]===!0){const{version:n,multihash:o,code:s}=t,u=decode$7(o);return CID.create(n,s,u)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${DAG_PB_CODE}) block encoding`);return new CID(e,t,n,n.bytes)}case 1:{const o=encodeCID(e,t,n.bytes);return new CID(e,t,n,o)}default:throw new Error("Invalid version")}}static createV0(e){return CID.create(0,DAG_PB_CODE,e)}static createV1(e,t){return CID.create(1,e,t)}static decode(e){const[t,n]=CID.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=CID.inspectBytes(e),n=t.size-t.multihashSize,o=coerce(e.subarray(n,n+t.multihashSize));if(o.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=o.subarray(t.multihashSize-t.digestSize),u=new Digest(t.multihashCode,t.digestSize,s,o);return[t.version===0?CID.createV0(u):CID.createV1(t.codec,u),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[m,b]=decode$8(e.subarray(t));return t+=b,m};let o=n(),s=DAG_PB_CODE;if(o===18?(o=0,t=0):s=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);const u=t,f=n(),l=n(),h=t+l,p=h-u;return{version:o,codec:s,multihashCode:f,digestSize:l,multihashSize:p,size:h}}static parse(e,t){const[n,o]=parseCIDtoBytes(e,t),s=CID.decode(o);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return baseCache(s).set(n,e),s}}const parseCIDtoBytes=(r,e)=>{switch(r[0]){case"Q":{const t=e||base58btc;return[base58btc.prefix,t.decode(`${base58btc.prefix}${r}`)]}case base58btc.prefix:{const t=e||base58btc;return[base58btc.prefix,t.decode(r)]}case base32.prefix:{const t=e||base32;return[base32.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},toStringV0=(r,e,t)=>{const{prefix:n}=t;if(n!==base58btc.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const o=e.get(n);if(o==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return o},toStringV1=(r,e,t)=>{const{prefix:n}=t,o=e.get(n);if(o==null){const s=t.encode(r);return e.set(n,s),s}else return o},DAG_PB_CODE=112,SHA_256_CODE=18,encodeCID=(r,e,t)=>{const n=encodingLength(r),o=n+encodingLength(e),s=new Uint8Array(o+t.byteLength);return encodeTo(r,s,0),encodeTo(e,s,n),s.set(t,o),s},cidSymbol=Symbol.for("@ipld/js-cid/CID"),CID_CBOR_TAG=42;function cidEncoder(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;const e=CID.asCID(r);if(!e)return null;const t=new Uint8Array(e.bytes.byteLength+1);return t.set(e.bytes,1),[new Token(Type.tag,CID_CBOR_TAG),new Token(Type.bytes,t)]}function undefinedEncoder(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function numberEncoder(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const encodeOptions={float64:!0,typeEncoders:{Object:cidEncoder,undefined:undefinedEncoder,number:numberEncoder}};function cidDecoder(r){if(r[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return CID.decode(r.subarray(1))}const decodeOptions={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,tags:[]};decodeOptions.tags[CID_CBOR_TAG]=cidDecoder;const name$3="dag-cbor",code$4=113,encode$7=r=>encode$a(r,encodeOptions),decode$5=r=>decode$a(r,decodeOptions),dagCBOR=Object.freeze(Object.defineProperty({__proto__:null,code:code$4,decode:decode$5,encode:encode$7,name:name$3},Symbol.toStringTag,{value:"Module"})),textDecoder$1=new TextDecoder;function decodeVarint(r,e){let t=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(e>=r.length)throw new Error("protobuf: unexpected end of data");const o=r[e++];if(t+=n<28?(o&127)<<n:(o&127)*2**n,o<128)break}return[t,e]}function decodeBytes(r,e){let t;[t,e]=decodeVarint(r,e);const n=e+t;if(t<0||n<0)throw new Error("protobuf: invalid length");if(n>r.length)throw new Error("protobuf: unexpected end of data");return[r.subarray(e,n),n]}function decodeKey(r,e){let t;return[t,e]=decodeVarint(r,e),[t&7,t>>3,e]}function decodeLink(r){const e={},t=r.length;let n=0;for(;n<t;){let o,s;if([o,s,n]=decodeKey(r,n),s===1){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(o!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${o}) for Hash`);if(e.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,n]=decodeBytes(r,n)}else if(s===2){if(e.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(o!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${o}) for Name`);if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let u;[u,n]=decodeBytes(r,n),e.Name=textDecoder$1.decode(u)}else if(s===3){if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(o!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${o}) for Tsize`);[e.Tsize,n]=decodeVarint(r,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${s}`)}if(n>t)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function decodeNode(r){const e=r.length;let t=0,n,o=!1,s;for(;t<e;){let f,l;if([f,l,t]=decodeKey(r,t),f!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${f}`);if(l===1){if(s)throw new Error("protobuf: (PBNode) duplicate Data section");[s,t]=decodeBytes(r,t),n&&(o=!0)}else if(l===2){if(o)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let h;[h,t]=decodeBytes(r,t),n.push(decodeLink(h))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${l}`)}if(t>e)throw new Error("protobuf: (PBNode) unexpected end of data");const u={};return s&&(u.Data=s),u.Links=n||[],u}const textEncoder$3=new TextEncoder,maxInt32=2**32,maxUInt32=2**31;function encodeLink(r,e){let t=e.length;if(typeof r.Tsize=="number"){if(r.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(r.Tsize))throw new Error("Tsize too large for encoding");t=encodeVarint(e,t,r.Tsize)-1,e[t]=24}if(typeof r.Name=="string"){const n=textEncoder$3.encode(r.Name);t-=n.length,e.set(n,t),t=encodeVarint(e,t,n.length)-1,e[t]=18}return r.Hash&&(t-=r.Hash.length,e.set(r.Hash,t),t=encodeVarint(e,t,r.Hash.length)-1,e[t]=10),e.length-t}function encodeNode(r){const e=sizeNode(r),t=new Uint8Array(e);let n=e;if(r.Data&&(n-=r.Data.length,t.set(r.Data,n),n=encodeVarint(t,n,r.Data.length)-1,t[n]=10),r.Links)for(let o=r.Links.length-1;o>=0;o--){const s=encodeLink(r.Links[o],t.subarray(0,n));n-=s,n=encodeVarint(t,n,s)-1,t[n]=18}return t}function sizeLink(r){let e=0;if(r.Hash){const t=r.Hash.length;e+=1+t+sov(t)}if(typeof r.Name=="string"){const t=textEncoder$3.encode(r.Name).length;e+=1+t+sov(t)}return typeof r.Tsize=="number"&&(e+=1+sov(r.Tsize)),e}function sizeNode(r){let e=0;if(r.Data){const t=r.Data.length;e+=1+t+sov(t)}if(r.Links)for(const t of r.Links){const n=sizeLink(t);e+=1+n+sov(n)}return e}function encodeVarint(r,e,t){e-=sov(t);const n=e;for(;t>=maxUInt32;)r[e++]=t&127|128,t/=128;for(;t>=128;)r[e++]=t&127|128,t>>>=7;return r[e]=t,n}function sov(r){return r%2===0&&r++,Math.floor((len64(r)+6)/7)}function len64(r){let e=0;return r>=maxInt32&&(r=Math.floor(r/maxInt32),e=32),r>=1<<16&&(r>>>=16,e+=16),r>=1<<8&&(r>>>=8,e+=8),e+len8tab[r]}const len8tab=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],pbNodeProperties=["Data","Links"],pbLinkProperties=["Hash","Name","Tsize"],textEncoder$2=new TextEncoder;function linkComparator(r,e){if(r===e)return 0;const t=r.Name?textEncoder$2.encode(r.Name):[],n=e.Name?textEncoder$2.encode(e.Name):[];let o=t.length,s=n.length;for(let u=0,f=Math.min(o,s);u<f;++u)if(t[u]!==n[u]){o=t[u],s=n[u];break}return o<s?-1:s<o?1:0}function hasOnlyProperties(r,e){return!Object.keys(r).some(t=>!e.includes(t))}function asLink(r){if(typeof r.asCID=="object"){const t=CID.asCID(r);if(!t)throw new TypeError("Invalid DAG-PB form");return{Hash:t}}if(typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");const e={};if(r.Hash){let t=CID.asCID(r.Hash);try{t||(typeof r.Hash=="string"?t=CID.parse(r.Hash):r.Hash instanceof Uint8Array&&(t=CID.decode(r.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}t&&(e.Hash=t)}if(!e.Hash)throw new TypeError("Invalid DAG-PB form");return typeof r.Name=="string"&&(e.Name=r.Name),typeof r.Tsize=="number"&&(e.Tsize=r.Tsize),e}function prepare(r){if((r instanceof Uint8Array||typeof r=="string")&&(r={Data:r}),typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");const e={};if(r.Data!==void 0)if(typeof r.Data=="string")e.Data=textEncoder$2.encode(r.Data);else if(r.Data instanceof Uint8Array)e.Data=r.Data;else throw new TypeError("Invalid DAG-PB form");if(r.Links!==void 0)if(Array.isArray(r.Links))e.Links=r.Links.map(asLink),e.Links.sort(linkComparator);else throw new TypeError("Invalid DAG-PB form");else e.Links=[];return e}function validate(r){if(!r||typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");if(!hasOnlyProperties(r,pbNodeProperties))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(r.Data!==void 0&&!(r.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be a Uint8Array)");if(!Array.isArray(r.Links))throw new TypeError("Invalid DAG-PB form (Links must be an array)");for(let e=0;e<r.Links.length;e++){const t=r.Links[e];if(!t||typeof t!="object"||Array.isArray(t))throw new TypeError("Invalid DAG-PB form (bad link object)");if(!hasOnlyProperties(t,pbLinkProperties))throw new TypeError("Invalid DAG-PB form (extraneous properties on link object)");if(!t.Hash)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(t.Hash.asCID!==t.Hash)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(t.Name!==void 0&&typeof t.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(t.Tsize!==void 0&&(typeof t.Tsize!="number"||t.Tsize%1!==0))throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(e>0&&linkComparator(t,r.Links[e-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function createNode(r,e=[]){return prepare({Data:r,Links:e})}function createLink(r,e,t){return asLink({Hash:t,Name:r,Tsize:e})}const name$2="dag-pb",code$3=112;function encode$6(r){validate(r);const e={};return r.Links&&(e.Links=r.Links.map(t=>{const n={};return t.Hash&&(n.Hash=t.Hash.bytes),t.Name!==void 0&&(n.Name=t.Name),t.Tsize!==void 0&&(n.Tsize=t.Tsize),n})),r.Data&&(e.Data=r.Data),encodeNode(e)}function decode$4(r){const e=decodeNode(r),t={};return e.Data&&(t.Data=e.Data),e.Links&&(t.Links=e.Links.map(n=>{const o={};try{o.Hash=CID.decode(n.Hash)}catch{}if(!o.Hash)throw new Error("Invalid Hash field found in link, expected CID");return n.Name!==void 0&&(o.Name=n.Name),n.Tsize!==void 0&&(o.Tsize=n.Tsize),o})),t}const dagPB=Object.freeze(Object.defineProperty({__proto__:null,code:code$3,createLink,createNode,decode:decode$4,encode:encode$6,name:name$2,prepare,validate},Symbol.toStringTag,{value:"Module"})),name$1="raw",code$2=85,encode$5=r=>coerce$1(r),decode$3=r=>coerce$1(r),raw=Object.freeze(Object.defineProperty({__proto__:null,code:code$2,decode:decode$3,encode:encode$5,name:name$1},Symbol.toStringTag,{value:"Module"})),BY_NAME={[name$2]:dagPB,[name$3]:dagCBOR,[name$1]:raw},BY_CODE={[code$3]:dagPB,[code$4]:dagCBOR,[code$2]:raw};function getByCode(r){const e=BY_CODE[r];if(!e)throw new Error(`No codec was registered for the code: ${numberHex(r)}. Is it part of the multicodec table (https://github.com/multiformats/multicodec/blob/master/table.csv)?`);return e}function getByName$1(r){const e=BY_NAME[r];if(!e)throw new Error(`No codec was registered for the name: ${r}`);return e}function getByIdentifier(r){return typeof r=="string"?getByName$1(r):getByCode(r)}function expect(r,e){const t=getByIdentifier(r);if(e.code!==t.code){const n=getByCode(e.code);throw new Error(`Expected a ${t.name} CID, found a ${n.name} CID instead.`)}}function isIdentifier(r){return typeof r=="string"?!!BY_NAME[r]:!!BY_CODE[r]}function numberHex(r){const e=new Uint8Array(4);return new DataView(e.buffer).setUint32(0,r),`0x${toString$7(e,"hex").replace(/^(00)*/,"")}`}const PB_IPLD_DATA=new Uint8Array([8,1]);async function getPB(r,e){return expect(code$3,e),decode$4(await r.getBlock(e))}function putPB(r,e){const t=createNode(PB_IPLD_DATA,e);return r.putBlock(encode$6(t),code$3)}const isFile=r=>isObject$1(r)&&r.content!==void 0,isTree=r=>isObject$1(r)&&r.ls!==void 0,isBaseLink=r=>isObject$1(r)&&isString(r.name)&&isNum(r.size)&&isBool(r.isFile),isSimpleLink=r=>isObject$1(r)&&isString(r.name)&&isNum(r.size)&&isCID(r.cid),isSoftLink=r=>isObject$1(r)&&isString(r.name)&&isString(r.ipns),isSoftLinkDictionary=r=>{if(isObject$1(r)){const e=Object.values(r);return e.length>0&&e.every(isSoftLink)}return!1},isSoftLinkList=r=>Array.isArray(r)&&r.every(isSoftLink),isHardLink=r=>isBaseLink(r)&&isCID(r.cid),isLinks=r=>isObject$1(r)&&Object.values(r).every(e=>isHardLink(e)||isSoftLink(e)),isUnixMeta=r=>isObject$1(r)&&isNum(r.mtime)&&isNum(r.ctime)&&isNum(r.mode)&&isString(r._type),isMetadata=r=>isObject$1(r)&&isUnixMeta(r.unixMeta)&&isBool(r.isFile)&&isSemVer(r.version),isSkeleton=r=>isObject$1(r)&&Object.values(r).every(isSkeletonInfo),isSkeletonInfo=r=>isObject$1(r)&&isCID(r.cid)&&isCID(r.userland)&&isCID(r.metadata)&&isSkeleton(r.subSkeleton)||isSoftLink(r),isTreeHeader=r=>isObject$1(r)&&isSkeleton(r.skeleton)&&isMetadata(r.metadata)&&r.metadata.isFile===!1,isTreeInfo=r=>isTreeHeader(r)&&isCID(r.userland),isFileHeader=r=>isObject$1(r)&&isMetadata(r.metadata)&&r.metadata.isFile===!0,isFileInfo=r=>isFileHeader(r)&&isCID(r.userland),isCID=r=>!!CID$1.asCID(r)||isString(r)||r&&"code"in r&&"version"in r&&("multihash"in r||"hash"in r),isSemVer=r=>{if(!isObject$1(r))return!1;const{major:e,minor:t,patch:n}=r;return isNum(e)&&isNum(t)&&isNum(n)},arrToMap=r=>r.reduce((e,t)=>(e[t.name]=t,e),{}),fromDAGLink=r=>{const e=r.Name||"",t=r.Hash,n=r.Tsize||0;return{name:e,cid:t,size:n}},make=(r,e,t,n)=>({name:r,cid:encodeCID$1(e),size:n,isFile:t}),toDAGLink=r=>{const{name:e,cid:t,size:n}=r;return createLink(e,n,decodeCID(t))};var CryptoSystem;(function(r){r.ECC="ecc",r.RSA="rsa"})(CryptoSystem||(CryptoSystem={}));var EccCurve;(function(r){r.P_256="P-256",r.P_384="P-384",r.P_521="P-521"})(EccCurve||(EccCurve={}));var RsaSize;(function(r){r[r.B1024=1024]="B1024",r[r.B2048=2048]="B2048",r[r.B4096=4096]="B4096"})(RsaSize||(RsaSize={}));var SymmAlg;(function(r){r.AES_CTR="AES-CTR",r.AES_CBC="AES-CBC",r.AES_GCM="AES-GCM"})(SymmAlg||(SymmAlg={}));var SymmKeyLength;(function(r){r[r.B128=128]="B128",r[r.B192=192]="B192",r[r.B256=256]="B256"})(SymmKeyLength||(SymmKeyLength={}));var HashAlg;(function(r){r.SHA_1="SHA-1",r.SHA_256="SHA-256",r.SHA_384="SHA-384",r.SHA_512="SHA-512"})(HashAlg||(HashAlg={}));var CharSize;(function(r){r[r.B8=8]="B8",r[r.B16=16]="B16"})(CharSize||(CharSize={}));var KeyUse;(function(r){r.Exchange="exchange",r.Write="write"})(KeyUse||(KeyUse={}));const DEFAULT_AES_ALG=SymmAlg.AES_CTR,getFile=async(r,e)=>r.getUnixFile(e),getEncryptedFile=async(r,e,t,n)=>{const o=await getFile(r,t);let s;try{s=decode$5(o)}catch{return o}if(!hasProp(s,"alg")||!hasProp(s,"cip")||!isSymmAlg(s.alg)||!ArrayBuffer.isView(s.cip))throw new Error('Unexpected private block. Expected "alg" and "cip" field.');const u=s.alg,f=new Uint8Array(s.cip.buffer),l=await e.aes.decrypt(f,n,u),h=decode$5(l);return h instanceof Uint8Array?h:fromString$7(typeof h=="string"?h:JSON.stringify(h),"utf8")},putFile$1=async(r,e)=>r.putChunked(e),putEncryptedFile=async(r,e,t,n)=>{const o=isBlob(t)?await toUint8Array(t):t,s=encode$7(o),u=SymmAlg.AES_GCM,f=await e.aes.encrypt(s,n,u),l=encode$7({alg:u,cip:f});return putFile$1(r,l)},getSimpleLinks=async(r,e)=>{const t=await getPB(r,e);return arrToMap(t.Links.map(fromDAGLink))},getFileSystemLinks=async(r,e)=>{const t=await getPB(r,e),n=await Promise.all(t.Links.map(async o=>{const s=await getPB(r,o.Hash),u=arrToMap(s.Links.map(fromDAGLink));if(!!u.softLink){const h=await r.getUnixFile(decodeCID(u.softLink.cid)),p=new TextDecoder().decode(h);return JSON.parse(p)}const l=await decode$5(await getFile(r,decodeCID(u.metadata.cid)));return{...fromDAGLink(o),isFile:hasProp(l,"isFile")?l.isFile:!1}}));return arrToMap(n)},putLinks=async(r,e)=>{const t=Object.values(e).reduce(async(o,s)=>{const u=await o;if(isSoftLink(s)){const f=await r.putChunked(fromString$7(JSON.stringify(s),"utf8")),l=await putPB(r,[createLink("softLink",f.size,f.cid)]),h=await r.size(l);return[...u,createLink(s.name,h,l)]}else return hasProp(s,"Hash")&&s.Hash?[...u,s]:isSimpleLink(s)?[...u,toDAGLink(s)]:u},Promise.resolve([])),n=await putPB(r,await t);return{cid:n,isFile:!1,size:await r.size(n)}};function isSymmAlg(r){return isString(r)&&Object.values(SymmAlg).includes(r)}const putTree=async(r,e,t,n,o)=>{const s=await putLinks(r,e),u=make("userland",s.cid,!0,s.size),[f,l]=await Promise.all([putAndMakeLink(r,"metadata",n),putAndMakeLink(r,"skeleton",t)]),h=o!=null?make("previous",o,!1,await r.size(o)):void 0,p={metadata:f,skeleton:l,userland:u,previous:h},{cid:m,size:b}=await putLinks(r,p);return{cid:m,userland:decodeCID(u.cid),metadata:decodeCID(f.cid),size:b,isFile:!1,skeleton:t}},putFile=async(r,e,t,n)=>{const o=await putFile$1(r,e),s=make("userland",o.cid,!0,o.size),u=await putAndMakeLink(r,"metadata",t),f=n!=null?make("previous",n,!1,await r.size(n)):void 0,l={metadata:u,userland:s,previous:f},{cid:h,size:p}=await putLinks(r,l);return{cid:h,userland:decodeCID(s.cid),metadata:decodeCID(u.cid),size:p,isFile:!0,skeleton:{}}},get$3=async(r,e)=>{var f,l;const t=await getSimpleLinks(r,e),n=await getAndCheckValue(r,t,"metadata",isMetadata),o=n.isFile?void 0:await getAndCheckValue(r,t,"skeleton",isSkeleton),s=((f=t.userland)==null?void 0:f.cid)||null;if(!isCID(s))throw new Error("Could not find userland");const u=((l=t.previous)==null?void 0:l.cid)||void 0;return{userland:s,metadata:n,previous:u,skeleton:o}},getValue=async(r,e,t)=>{const n=CID$1.asCID(e);if(isCID(e)){if(!n)return null;const o=await getSimpleLinks(r,n);return getValueFromLinks(r,o,t)}return getValueFromLinks(r,e,t)},getValueFromLinks=async(r,e,t)=>{var f;const n=(f=e[t])==null?void 0:f.cid;if(!n)return null;const o=await getFile(r,decodeCID(n)),s=decode$5(o);let u;return s instanceof Uint8Array?u=JSON.parse(toString$7(s,"utf8")):u=s,u},getAndCheckValue=async(r,e,t,n,o=!1)=>{const s=await getValue(r,e,t);return checkValue(s,t,n,o)},checkValue=(r,e,t,n=!1)=>{if(!isValue(r)){if(n)return r;throw new Error(`Could not find header value: ${e}`)}if(t(r))return r;throw new Error(`Improperly formatted header value: ${e}`)};async function putAndMakeLink(r,e,t){const{cid:n,size:o}=await putFile$1(r,encode$7(t));return make(e,n,!0,o)}const isDecryptedNode=r=>isPrivateTreeInfo(r)||isPrivateFileInfo(r)||isSoftLink(r),isPrivateFileInfo=r=>isObject$1(r)&&isMetadata(r.metadata)&&r.metadata.isFile&&isString(r.key)&&notNull(r.content),isPrivateTreeInfo=r=>isObject$1(r)&&isMetadata(r.metadata)&&r.metadata.isFile===!1&&isNum(r.revision)&&isPrivateLinks(r.links)&&isPrivateSkeleton(r.skeleton),isPrivateLink=r=>isBaseLink(r)&&isString(r.key)&&isString(r.pointer),isPrivateLinks=r=>isObject$1(r)&&Object.values(r).every(e=>isPrivateLink(e)||isSoftLink(e)),isPrivateSkeleton=r=>isObject$1(r)&&Object.values(r).every(e=>isPrivateSkeletonInfo(e)||isSoftLink(e)),isPrivateSkeletonInfo=r=>isObject$1(r)&&notNull(r.cid)&&isString(r.key)&&isPrivateSkeleton(r.subSkeleton),fromBytes$1=r=>Array.prototype.map.call(r,e=>("00"+e.toString(16)).slice(-2)).join(""),toBytes$1=r=>{const e=new Uint8Array(r.length/2);for(let t=0;t<e.length;t++)e[t]=parseInt(r.slice(t*2,t*2+2),16);return e};var api={},bloomFilter={},baseFilter={},utils$3={},cuint={},uint32Exports={},uint32={get exports(){return uint32Exports},set exports(r){uint32Exports=r}};(function(r){(function(e){t(Math.pow(36,5)),t(Math.pow(16,7)),t(Math.pow(10,9)),t(Math.pow(2,30)),t(36),t(16),t(10),t(2);function t(u,f){if(!(this instanceof t))return new t(u,f);if(this._low=0,this._high=0,this.remainder=null,typeof f>"u")return o.call(this,u);if(typeof u=="string")return s.call(this,u,f);n.call(this,u,f)}function n(u,f){return this._low=u|0,this._high=f|0,this}t.prototype.fromBits=n;function o(u){return this._low=u&65535,this._high=u>>>16,this}t.prototype.fromNumber=o;function s(u,f){var l=parseInt(u,f||10);return this._low=l&65535,this._high=l>>>16,this}t.prototype.fromString=s,t.prototype.toNumber=function(){return this._high*65536+this._low},t.prototype.toString=function(u){return this.toNumber().toString(u||10)},t.prototype.add=function(u){var f=this._low+u._low,l=f>>>16;return l+=this._high+u._high,this._low=f&65535,this._high=l&65535,this},t.prototype.subtract=function(u){return this.add(u.clone().negate())},t.prototype.multiply=function(u){var f=this._high,l=this._low,h=u._high,p=u._low,m,b;return b=l*p,m=b>>>16,m+=f*p,m&=65535,m+=l*h,this._low=b&65535,this._high=m&65535,this},t.prototype.div=function(u){if(u._low==0&&u._high==0)throw Error("division by zero");if(u._high==0&&u._low==1)return this.remainder=new t(0),this;if(u.gt(this))return this.remainder=this.clone(),this._low=0,this._high=0,this;if(this.eq(u))return this.remainder=new t(0),this._low=1,this._high=0,this;for(var f=u.clone(),l=-1;!this.lt(f);)f.shiftLeft(1,!0),l++;for(this.remainder=this.clone(),this._low=0,this._high=0;l>=0;l--)f.shiftRight(1),this.remainder.lt(f)||(this.remainder.subtract(f),l>=16?this._high|=1<<l-16:this._low|=1<<l);return this},t.prototype.negate=function(){var u=(~this._low&65535)+1;return this._low=u&65535,this._high=~this._high+(u>>>16)&65535,this},t.prototype.equals=t.prototype.eq=function(u){return this._low==u._low&&this._high==u._high},t.prototype.greaterThan=t.prototype.gt=function(u){return this._high>u._high?!0:this._high<u._high?!1:this._low>u._low},t.prototype.lessThan=t.prototype.lt=function(u){return this._high<u._high?!0:this._high>u._high?!1:this._low<u._low},t.prototype.or=function(u){return this._low|=u._low,this._high|=u._high,this},t.prototype.and=function(u){return this._low&=u._low,this._high&=u._high,this},t.prototype.not=function(){return this._low=~this._low&65535,this._high=~this._high&65535,this},t.prototype.xor=function(u){return this._low^=u._low,this._high^=u._high,this},t.prototype.shiftRight=t.prototype.shiftr=function(u){return u>16?(this._low=this._high>>u-16,this._high=0):u==16?(this._low=this._high,this._high=0):(this._low=this._low>>u|this._high<<16-u&65535,this._high>>=u),this},t.prototype.shiftLeft=t.prototype.shiftl=function(u,f){return u>16?(this._high=this._low<<u-16,this._low=0,f||(this._high&=65535)):u==16?(this._high=this._low,this._low=0):(this._high=this._high<<u|this._low>>16-u,this._low=this._low<<u&65535,f||(this._high&=65535)),this},t.prototype.rotateLeft=t.prototype.rotl=function(u){var f=this._high<<16|this._low;return f=f<<u|f>>>32-u,this._low=f&65535,this._high=f>>>16,this},t.prototype.rotateRight=t.prototype.rotr=function(u){var f=this._high<<16|this._low;return f=f>>>u|f<<32-u,this._low=f&65535,this._high=f>>>16,this},t.prototype.clone=function(){return new t(this._low,this._high)},r.exports?r.exports=t:e.UINT32=t})(commonjsGlobal)})(uint32);var uint64Exports={},uint64={get exports(){return uint64Exports},set exports(r){uint64Exports=r}};(function(r){(function(e){var t={16:o(Math.pow(16,5)),10:o(Math.pow(10,5)),2:o(Math.pow(2,5))},n={16:o(16),10:o(10),2:o(2)};function o(l,h,p,m){if(!(this instanceof o))return new o(l,h,p,m);if(this.remainder=null,typeof l=="string")return f.call(this,l,h);if(typeof h>"u")return u.call(this,l);s.apply(this,arguments)}function s(l,h,p,m){return typeof p>"u"?(this._a00=l&65535,this._a16=l>>>16,this._a32=h&65535,this._a48=h>>>16,this):(this._a00=l|0,this._a16=h|0,this._a32=p|0,this._a48=m|0,this)}o.prototype.fromBits=s;function u(l){return this._a00=l&65535,this._a16=l>>>16,this._a32=0,this._a48=0,this}o.prototype.fromNumber=u;function f(l,h){h=h||10,this._a00=0,this._a16=0,this._a32=0,this._a48=0;for(var p=t[h]||new o(Math.pow(h,5)),m=0,b=l.length;m<b;m+=5){var S=Math.min(5,b-m),A=parseInt(l.slice(m,m+S),h);this.multiply(S<5?new o(Math.pow(h,S)):p).add(new o(A))}return this}o.prototype.fromString=f,o.prototype.toNumber=function(){return this._a16*65536+this._a00},o.prototype.toString=function(l){l=l||10;var h=n[l]||new o(l);if(!this.gt(h))return this.toNumber().toString(l);for(var p=this.clone(),m=new Array(64),b=63;b>=0&&(p.div(h),m[b]=p.remainder.toNumber().toString(l),!!p.gt(h));b--);return m[b-1]=p.toNumber().toString(l),m.join("")},o.prototype.add=function(l){var h=this._a00+l._a00,p=h>>>16;p+=this._a16+l._a16;var m=p>>>16;m+=this._a32+l._a32;var b=m>>>16;return b+=this._a48+l._a48,this._a00=h&65535,this._a16=p&65535,this._a32=m&65535,this._a48=b&65535,this},o.prototype.subtract=function(l){return this.add(l.clone().negate())},o.prototype.multiply=function(l){var h=this._a00,p=this._a16,m=this._a32,b=this._a48,S=l._a00,A=l._a16,L=l._a32,J=l._a48,ne=h*S,pe=ne>>>16;pe+=h*A;var de=pe>>>16;pe&=65535,pe+=p*S,de+=pe>>>16,de+=h*L;var H=de>>>16;return de&=65535,de+=p*A,H+=de>>>16,de&=65535,de+=m*S,H+=de>>>16,H+=h*J,H&=65535,H+=p*L,H&=65535,H+=m*A,H&=65535,H+=b*S,this._a00=ne&65535,this._a16=pe&65535,this._a32=de&65535,this._a48=H&65535,this},o.prototype.div=function(l){if(l._a16==0&&l._a32==0&&l._a48==0){if(l._a00==0)throw Error("division by zero");if(l._a00==1)return this.remainder=new o(0),this}if(l.gt(this))return this.remainder=this.clone(),this._a00=0,this._a16=0,this._a32=0,this._a48=0,this;if(this.eq(l))return this.remainder=new o(0),this._a00=1,this._a16=0,this._a32=0,this._a48=0,this;for(var h=l.clone(),p=-1;!this.lt(h);)h.shiftLeft(1,!0),p++;for(this.remainder=this.clone(),this._a00=0,this._a16=0,this._a32=0,this._a48=0;p>=0;p--)h.shiftRight(1),this.remainder.lt(h)||(this.remainder.subtract(h),p>=48?this._a48|=1<<p-48:p>=32?this._a32|=1<<p-32:p>=16?this._a16|=1<<p-16:this._a00|=1<<p);return this},o.prototype.negate=function(){var l=(~this._a00&65535)+1;return this._a00=l&65535,l=(~this._a16&65535)+(l>>>16),this._a16=l&65535,l=(~this._a32&65535)+(l>>>16),this._a32=l&65535,this._a48=~this._a48+(l>>>16)&65535,this},o.prototype.equals=o.prototype.eq=function(l){return this._a48==l._a48&&this._a00==l._a00&&this._a32==l._a32&&this._a16==l._a16},o.prototype.greaterThan=o.prototype.gt=function(l){return this._a48>l._a48?!0:this._a48<l._a48?!1:this._a32>l._a32?!0:this._a32<l._a32?!1:this._a16>l._a16?!0:this._a16<l._a16?!1:this._a00>l._a00},o.prototype.lessThan=o.prototype.lt=function(l){return this._a48<l._a48?!0:this._a48>l._a48?!1:this._a32<l._a32?!0:this._a32>l._a32?!1:this._a16<l._a16?!0:this._a16>l._a16?!1:this._a00<l._a00},o.prototype.or=function(l){return this._a00|=l._a00,this._a16|=l._a16,this._a32|=l._a32,this._a48|=l._a48,this},o.prototype.and=function(l){return this._a00&=l._a00,this._a16&=l._a16,this._a32&=l._a32,this._a48&=l._a48,this},o.prototype.xor=function(l){return this._a00^=l._a00,this._a16^=l._a16,this._a32^=l._a32,this._a48^=l._a48,this},o.prototype.not=function(){return this._a00=~this._a00&65535,this._a16=~this._a16&65535,this._a32=~this._a32&65535,this._a48=~this._a48&65535,this},o.prototype.shiftRight=o.prototype.shiftr=function(l){return l%=64,l>=48?(this._a00=this._a48>>l-48,this._a16=0,this._a32=0,this._a48=0):l>=32?(l-=32,this._a00=(this._a32>>l|this._a48<<16-l)&65535,this._a16=this._a48>>l&65535,this._a32=0,this._a48=0):l>=16?(l-=16,this._a00=(this._a16>>l|this._a32<<16-l)&65535,this._a16=(this._a32>>l|this._a48<<16-l)&65535,this._a32=this._a48>>l&65535,this._a48=0):(this._a00=(this._a00>>l|this._a16<<16-l)&65535,this._a16=(this._a16>>l|this._a32<<16-l)&65535,this._a32=(this._a32>>l|this._a48<<16-l)&65535,this._a48=this._a48>>l&65535),this},o.prototype.shiftLeft=o.prototype.shiftl=function(l,h){return l%=64,l>=48?(this._a48=this._a00<<l-48,this._a32=0,this._a16=0,this._a00=0):l>=32?(l-=32,this._a48=this._a16<<l|this._a00>>16-l,this._a32=this._a00<<l&65535,this._a16=0,this._a00=0):l>=16?(l-=16,this._a48=this._a32<<l|this._a16>>16-l,this._a32=(this._a16<<l|this._a00>>16-l)&65535,this._a16=this._a00<<l&65535,this._a00=0):(this._a48=this._a48<<l|this._a32>>16-l,this._a32=(this._a32<<l|this._a16>>16-l)&65535,this._a16=(this._a16<<l|this._a00>>16-l)&65535,this._a00=this._a00<<l&65535),h||(this._a48&=65535),this},o.prototype.rotateLeft=o.prototype.rotl=function(l){if(l%=64,l==0)return this;if(l>=32){var h=this._a00;if(this._a00=this._a32,this._a32=h,h=this._a48,this._a48=this._a16,this._a16=h,l==32)return this;l-=32}var p=this._a48<<16|this._a32,m=this._a16<<16|this._a00,b=p<<l|m>>>32-l,S=m<<l|p>>>32-l;return this._a00=S&65535,this._a16=S>>>16,this._a32=b&65535,this._a48=b>>>16,this},o.prototype.rotateRight=o.prototype.rotr=function(l){if(l%=64,l==0)return this;if(l>=32){var h=this._a00;if(this._a00=this._a32,this._a32=h,h=this._a48,this._a48=this._a16,this._a16=h,l==32)return this;l-=32}var p=this._a48<<16|this._a32,m=this._a16<<16|this._a00,b=p>>>l|m<<32-l,S=m>>>l|p<<32-l;return this._a00=S&65535,this._a16=S>>>16,this._a32=b&65535,this._a48=b>>>16,this},o.prototype.clone=function(){return new o(this._a00,this._a16,this._a32,this._a48)},r.exports?r.exports=o:e.UINT64=o})(commonjsGlobal)})(uint64);cuint.UINT32=uint32Exports;cuint.UINT64=uint64Exports;var UINT32=cuint.UINT32;UINT32.prototype.xxh_update=function(r,e){var t=PRIME32_2._low,n=PRIME32_2._high,o,s;s=r*t,o=s>>>16,o+=e*t,o&=65535,o+=r*n;var u=this._low+(s&65535),f=u>>>16;f+=this._high+(o&65535);var l=f<<16|u&65535;l=l<<13|l>>>19,u=l&65535,f=l>>>16,t=PRIME32_1._low,n=PRIME32_1._high,s=u*t,o=s>>>16,o+=f*t,o&=65535,o+=u*n,this._low=s&65535,this._high=o&65535};var PRIME32_1=UINT32("2654435761"),PRIME32_2=UINT32("2246822519"),PRIME32_3=UINT32("3266489917"),PRIME32_4=UINT32("668265263"),PRIME32_5=UINT32("374761393");function toUTF8Array$1(r){for(var e=[],t=0,n=r.length;t<n;t++){var o=r.charCodeAt(t);o<128?e.push(o):o<2048?e.push(192|o>>6,128|o&63):o<55296||o>=57344?e.push(224|o>>12,128|o>>6&63,128|o&63):(t++,o=65536+((o&1023)<<10|r.charCodeAt(t)&1023),e.push(240|o>>18,128|o>>12&63,128|o>>6&63,128|o&63))}return new Uint8Array(e)}function XXH(){if(arguments.length==2)return new XXH(arguments[1]).update(arguments[0]).digest();if(!(this instanceof XXH))return new XXH(arguments[0]);init$2.call(this,arguments[0])}function init$2(r){return this.seed=r instanceof UINT32?r.clone():UINT32(r),this.v1=this.seed.clone().add(PRIME32_1).add(PRIME32_2),this.v2=this.seed.clone().add(PRIME32_2),this.v3=this.seed.clone(),this.v4=this.seed.clone().subtract(PRIME32_1),this.total_len=0,this.memsize=0,this.memory=null,this}XXH.prototype.init=init$2;XXH.prototype.update=function(r){var e=typeof r=="string",t;e&&(r=toUTF8Array$1(r),e=!1,t=!0),typeof ArrayBuffer<"u"&&r instanceof ArrayBuffer&&(t=!0,r=new Uint8Array(r));var n=0,o=r.length,s=n+o;if(o==0)return this;if(this.total_len+=o,this.memsize==0&&(e?this.memory="":t?this.memory=new Uint8Array(16):this.memory=new Buffer(16)),this.memsize+o<16)return e?this.memory+=r:t?this.memory.set(r.subarray(0,o),this.memsize):r.copy(this.memory,this.memsize,0,o),this.memsize+=o,this;if(this.memsize>0){e?this.memory+=r.slice(0,16-this.memsize):t?this.memory.set(r.subarray(0,16-this.memsize),this.memsize):r.copy(this.memory,this.memsize,0,16-this.memsize);var u=0;e?(this.v1.xxh_update(this.memory.charCodeAt(u+1)<<8|this.memory.charCodeAt(u),this.memory.charCodeAt(u+3)<<8|this.memory.charCodeAt(u+2)),u+=4,this.v2.xxh_update(this.memory.charCodeAt(u+1)<<8|this.memory.charCodeAt(u),this.memory.charCodeAt(u+3)<<8|this.memory.charCodeAt(u+2)),u+=4,this.v3.xxh_update(this.memory.charCodeAt(u+1)<<8|this.memory.charCodeAt(u),this.memory.charCodeAt(u+3)<<8|this.memory.charCodeAt(u+2)),u+=4,this.v4.xxh_update(this.memory.charCodeAt(u+1)<<8|this.memory.charCodeAt(u),this.memory.charCodeAt(u+3)<<8|this.memory.charCodeAt(u+2))):(this.v1.xxh_update(this.memory[u+1]<<8|this.memory[u],this.memory[u+3]<<8|this.memory[u+2]),u+=4,this.v2.xxh_update(this.memory[u+1]<<8|this.memory[u],this.memory[u+3]<<8|this.memory[u+2]),u+=4,this.v3.xxh_update(this.memory[u+1]<<8|this.memory[u],this.memory[u+3]<<8|this.memory[u+2]),u+=4,this.v4.xxh_update(this.memory[u+1]<<8|this.memory[u],this.memory[u+3]<<8|this.memory[u+2])),n+=16-this.memsize,this.memsize=0,e&&(this.memory="")}if(n<=s-16){var f=s-16;do e?(this.v1.xxh_update(r.charCodeAt(n+1)<<8|r.charCodeAt(n),r.charCodeAt(n+3)<<8|r.charCodeAt(n+2)),n+=4,this.v2.xxh_update(r.charCodeAt(n+1)<<8|r.charCodeAt(n),r.charCodeAt(n+3)<<8|r.charCodeAt(n+2)),n+=4,this.v3.xxh_update(r.charCodeAt(n+1)<<8|r.charCodeAt(n),r.charCodeAt(n+3)<<8|r.charCodeAt(n+2)),n+=4,this.v4.xxh_update(r.charCodeAt(n+1)<<8|r.charCodeAt(n),r.charCodeAt(n+3)<<8|r.charCodeAt(n+2))):(this.v1.xxh_update(r[n+1]<<8|r[n],r[n+3]<<8|r[n+2]),n+=4,this.v2.xxh_update(r[n+1]<<8|r[n],r[n+3]<<8|r[n+2]),n+=4,this.v3.xxh_update(r[n+1]<<8|r[n],r[n+3]<<8|r[n+2]),n+=4,this.v4.xxh_update(r[n+1]<<8|r[n],r[n+3]<<8|r[n+2])),n+=4;while(n<=f)}return n<s&&(e?this.memory+=r.slice(n):t?this.memory.set(r.subarray(n,s),this.memsize):r.copy(this.memory,this.memsize,n,s),this.memsize=s-n),this};XXH.prototype.digest=function(){var r=this.memory,e=typeof r=="string",t=0,n=this.memsize,o,s,u=new UINT32;for(this.total_len>=16?o=this.v1.rotl(1).add(this.v2.rotl(7).add(this.v3.rotl(12).add(this.v4.rotl(18)))):o=this.seed.clone().add(PRIME32_5),o.add(u.fromNumber(this.total_len));t<=n-4;)e?u.fromBits(r.charCodeAt(t+1)<<8|r.charCodeAt(t),r.charCodeAt(t+3)<<8|r.charCodeAt(t+2)):u.fromBits(r[t+1]<<8|r[t],r[t+3]<<8|r[t+2]),o.add(u.multiply(PRIME32_3)).rotl(17).multiply(PRIME32_4),t+=4;for(;t<n;)u.fromBits(e?r.charCodeAt(t++):r[t++],0),o.add(u.multiply(PRIME32_5)).rotl(11).multiply(PRIME32_1);return s=o.clone().shiftRight(15),o.xor(s).multiply(PRIME32_2),s=o.clone().shiftRight(13),o.xor(s).multiply(PRIME32_3),s=o.clone().shiftRight(16),o.xor(s),this.init(this.seed),o};var xxhash=XXH,UINT64=cuint.UINT64,PRIME64_1=UINT64("11400714785074694791"),PRIME64_2=UINT64("14029467366897019727"),PRIME64_3=UINT64("1609587929392839161"),PRIME64_4=UINT64("9650029242287828579"),PRIME64_5=UINT64("2870177450012600261");function toUTF8Array(r){for(var e=[],t=0,n=r.length;t<n;t++){var o=r.charCodeAt(t);o<128?e.push(o):o<2048?e.push(192|o>>6,128|o&63):o<55296||o>=57344?e.push(224|o>>12,128|o>>6&63,128|o&63):(t++,o=65536+((o&1023)<<10|r.charCodeAt(t)&1023),e.push(240|o>>18,128|o>>12&63,128|o>>6&63,128|o&63))}return new Uint8Array(e)}function XXH64(){if(arguments.length==2)return new XXH64(arguments[1]).update(arguments[0]).digest();if(!(this instanceof XXH64))return new XXH64(arguments[0]);init$1.call(this,arguments[0])}function init$1(r){return this.seed=r instanceof UINT64?r.clone():UINT64(r),this.v1=this.seed.clone().add(PRIME64_1).add(PRIME64_2),this.v2=this.seed.clone().add(PRIME64_2),this.v3=this.seed.clone(),this.v4=this.seed.clone().subtract(PRIME64_1),this.total_len=0,this.memsize=0,this.memory=null,this}XXH64.prototype.init=init$1;XXH64.prototype.update=function(r){var e=typeof r=="string",t;e&&(r=toUTF8Array(r),e=!1,t=!0),typeof ArrayBuffer<"u"&&r instanceof ArrayBuffer&&(t=!0,r=new Uint8Array(r));var n=0,o=r.length,s=n+o;if(o==0)return this;if(this.total_len+=o,this.memsize==0&&(e?this.memory="":t?this.memory=new Uint8Array(32):this.memory=new Buffer(32)),this.memsize+o<32)return e?this.memory+=r:t?this.memory.set(r.subarray(0,o),this.memsize):r.copy(this.memory,this.memsize,0,o),this.memsize+=o,this;if(this.memsize>0){e?this.memory+=r.slice(0,32-this.memsize):t?this.memory.set(r.subarray(0,32-this.memsize),this.memsize):r.copy(this.memory,this.memsize,0,32-this.memsize);var u=0;if(e){var f;f=UINT64(this.memory.charCodeAt(u+1)<<8|this.memory.charCodeAt(u),this.memory.charCodeAt(u+3)<<8|this.memory.charCodeAt(u+2),this.memory.charCodeAt(u+5)<<8|this.memory.charCodeAt(u+4),this.memory.charCodeAt(u+7)<<8|this.memory.charCodeAt(u+6)),this.v1.add(f.multiply(PRIME64_2)).rotl(31).multiply(PRIME64_1),u+=8,f=UINT64(this.memory.charCodeAt(u+1)<<8|this.memory.charCodeAt(u),this.memory.charCodeAt(u+3)<<8|this.memory.charCodeAt(u+2),this.memory.charCodeAt(u+5)<<8|this.memory.charCodeAt(u+4),this.memory.charCodeAt(u+7)<<8|this.memory.charCodeAt(u+6)),this.v2.add(f.multiply(PRIME64_2)).rotl(31).multiply(PRIME64_1),u+=8,f=UINT64(this.memory.charCodeAt(u+1)<<8|this.memory.charCodeAt(u),this.memory.charCodeAt(u+3)<<8|this.memory.charCodeAt(u+2),this.memory.charCodeAt(u+5)<<8|this.memory.charCodeAt(u+4),this.memory.charCodeAt(u+7)<<8|this.memory.charCodeAt(u+6)),this.v3.add(f.multiply(PRIME64_2)).rotl(31).multiply(PRIME64_1),u+=8,f=UINT64(this.memory.charCodeAt(u+1)<<8|this.memory.charCodeAt(u),this.memory.charCodeAt(u+3)<<8|this.memory.charCodeAt(u+2),this.memory.charCodeAt(u+5)<<8|this.memory.charCodeAt(u+4),this.memory.charCodeAt(u+7)<<8|this.memory.charCodeAt(u+6)),this.v4.add(f.multiply(PRIME64_2)).rotl(31).multiply(PRIME64_1)}else{var f;f=UINT64(this.memory[u+1]<<8|this.memory[u],this.memory[u+3]<<8|this.memory[u+2],this.memory[u+5]<<8|this.memory[u+4],this.memory[u+7]<<8|this.memory[u+6]),this.v1.add(f.multiply(PRIME64_2)).rotl(31).multiply(PRIME64_1),u+=8,f=UINT64(this.memory[u+1]<<8|this.memory[u],this.memory[u+3]<<8|this.memory[u+2],this.memory[u+5]<<8|this.memory[u+4],this.memory[u+7]<<8|this.memory[u+6]),this.v2.add(f.multiply(PRIME64_2)).rotl(31).multiply(PRIME64_1),u+=8,f=UINT64(this.memory[u+1]<<8|this.memory[u],this.memory[u+3]<<8|this.memory[u+2],this.memory[u+5]<<8|this.memory[u+4],this.memory[u+7]<<8|this.memory[u+6]),this.v3.add(f.multiply(PRIME64_2)).rotl(31).multiply(PRIME64_1),u+=8,f=UINT64(this.memory[u+1]<<8|this.memory[u],this.memory[u+3]<<8|this.memory[u+2],this.memory[u+5]<<8|this.memory[u+4],this.memory[u+7]<<8|this.memory[u+6]),this.v4.add(f.multiply(PRIME64_2)).rotl(31).multiply(PRIME64_1)}n+=32-this.memsize,this.memsize=0,e&&(this.memory="")}if(n<=s-32){var l=s-32;do{if(e){var f;f=UINT64(r.charCodeAt(n+1)<<8|r.charCodeAt(n),r.charCodeAt(n+3)<<8|r.charCodeAt(n+2),r.charCodeAt(n+5)<<8|r.charCodeAt(n+4),r.charCodeAt(n+7)<<8|r.charCodeAt(n+6)),this.v1.add(f.multiply(PRIME64_2)).rotl(31).multiply(PRIME64_1),n+=8,f=UINT64(r.charCodeAt(n+1)<<8|r.charCodeAt(n),r.charCodeAt(n+3)<<8|r.charCodeAt(n+2),r.charCodeAt(n+5)<<8|r.charCodeAt(n+4),r.charCodeAt(n+7)<<8|r.charCodeAt(n+6)),this.v2.add(f.multiply(PRIME64_2)).rotl(31).multiply(PRIME64_1),n+=8,f=UINT64(r.charCodeAt(n+1)<<8|r.charCodeAt(n),r.charCodeAt(n+3)<<8|r.charCodeAt(n+2),r.charCodeAt(n+5)<<8|r.charCodeAt(n+4),r.charCodeAt(n+7)<<8|r.charCodeAt(n+6)),this.v3.add(f.multiply(PRIME64_2)).rotl(31).multiply(PRIME64_1),n+=8,f=UINT64(r.charCodeAt(n+1)<<8|r.charCodeAt(n),r.charCodeAt(n+3)<<8|r.charCodeAt(n+2),r.charCodeAt(n+5)<<8|r.charCodeAt(n+4),r.charCodeAt(n+7)<<8|r.charCodeAt(n+6)),this.v4.add(f.multiply(PRIME64_2)).rotl(31).multiply(PRIME64_1)}else{var f;f=UINT64(r[n+1]<<8|r[n],r[n+3]<<8|r[n+2],r[n+5]<<8|r[n+4],r[n+7]<<8|r[n+6]),this.v1.add(f.multiply(PRIME64_2)).rotl(31).multiply(PRIME64_1),n+=8,f=UINT64(r[n+1]<<8|r[n],r[n+3]<<8|r[n+2],r[n+5]<<8|r[n+4],r[n+7]<<8|r[n+6]),this.v2.add(f.multiply(PRIME64_2)).rotl(31).multiply(PRIME64_1),n+=8,f=UINT64(r[n+1]<<8|r[n],r[n+3]<<8|r[n+2],r[n+5]<<8|r[n+4],r[n+7]<<8|r[n+6]),this.v3.add(f.multiply(PRIME64_2)).rotl(31).multiply(PRIME64_1),n+=8,f=UINT64(r[n+1]<<8|r[n],r[n+3]<<8|r[n+2],r[n+5]<<8|r[n+4],r[n+7]<<8|r[n+6]),this.v4.add(f.multiply(PRIME64_2)).rotl(31).multiply(PRIME64_1)}n+=8}while(n<=l)}return n<s&&(e?this.memory+=r.slice(n):t?this.memory.set(r.subarray(n,s),this.memsize):r.copy(this.memory,this.memsize,n,s),this.memsize=s-n),this};XXH64.prototype.digest=function(){var r=this.memory,e=typeof r=="string",t=0,n=this.memsize,o,s,u=new UINT64;for(this.total_len>=32?(o=this.v1.clone().rotl(1),o.add(this.v2.clone().rotl(7)),o.add(this.v3.clone().rotl(12)),o.add(this.v4.clone().rotl(18)),o.xor(this.v1.multiply(PRIME64_2).rotl(31).multiply(PRIME64_1)),o.multiply(PRIME64_1).add(PRIME64_4),o.xor(this.v2.multiply(PRIME64_2).rotl(31).multiply(PRIME64_1)),o.multiply(PRIME64_1).add(PRIME64_4),o.xor(this.v3.multiply(PRIME64_2).rotl(31).multiply(PRIME64_1)),o.multiply(PRIME64_1).add(PRIME64_4),o.xor(this.v4.multiply(PRIME64_2).rotl(31).multiply(PRIME64_1)),o.multiply(PRIME64_1).add(PRIME64_4)):o=this.seed.clone().add(PRIME64_5),o.add(u.fromNumber(this.total_len));t<=n-8;)e?u.fromBits(r.charCodeAt(t+1)<<8|r.charCodeAt(t),r.charCodeAt(t+3)<<8|r.charCodeAt(t+2),r.charCodeAt(t+5)<<8|r.charCodeAt(t+4),r.charCodeAt(t+7)<<8|r.charCodeAt(t+6)):u.fromBits(r[t+1]<<8|r[t],r[t+3]<<8|r[t+2],r[t+5]<<8|r[t+4],r[t+7]<<8|r[t+6]),u.multiply(PRIME64_2).rotl(31).multiply(PRIME64_1),o.xor(u).rotl(27).multiply(PRIME64_1).add(PRIME64_4),t+=8;for(t+4<=n&&(e?u.fromBits(r.charCodeAt(t+1)<<8|r.charCodeAt(t),r.charCodeAt(t+3)<<8|r.charCodeAt(t+2),0,0):u.fromBits(r[t+1]<<8|r[t],r[t+3]<<8|r[t+2],0,0),o.xor(u.multiply(PRIME64_1)).rotl(23).multiply(PRIME64_2).add(PRIME64_3),t+=4);t<n;)u.fromBits(e?r.charCodeAt(t++):r[t++],0,0,0),o.xor(u.multiply(PRIME64_5)).rotl(11).multiply(PRIME64_1);return s=o.clone().shiftRight(33),o.xor(s).multiply(PRIME64_2),s=o.clone().shiftRight(29),o.xor(s).multiply(PRIME64_3),s=o.clone().shiftRight(32),o.xor(s),this.init(this.seed),o};var xxhash64=XXH64,lib={h32:xxhash,h64:xxhash64},buffer={},base64Js={};base64Js.byteLength=byteLength;base64Js.toByteArray=toByteArray;base64Js.fromByteArray=fromByteArray;var lookup$2=[],revLookup=[],Arr=typeof Uint8Array<"u"?Uint8Array:Array,code$1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code$1.length;i<len;++i)lookup$2[i]=code$1[i],revLookup[code$1.charCodeAt(i)]=i;revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function getLens(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function byteLength(r){var e=getLens(r),t=e[0],n=e[1];return(t+n)*3/4-n}function _byteLength(r,e,t){return(e+t)*3/4-t}function toByteArray(r){var e,t=getLens(r),n=t[0],o=t[1],s=new Arr(_byteLength(r,n,o)),u=0,f=o>0?n-4:n,l;for(l=0;l<f;l+=4)e=revLookup[r.charCodeAt(l)]<<18|revLookup[r.charCodeAt(l+1)]<<12|revLookup[r.charCodeAt(l+2)]<<6|revLookup[r.charCodeAt(l+3)],s[u++]=e>>16&255,s[u++]=e>>8&255,s[u++]=e&255;return o===2&&(e=revLookup[r.charCodeAt(l)]<<2|revLookup[r.charCodeAt(l+1)]>>4,s[u++]=e&255),o===1&&(e=revLookup[r.charCodeAt(l)]<<10|revLookup[r.charCodeAt(l+1)]<<4|revLookup[r.charCodeAt(l+2)]>>2,s[u++]=e>>8&255,s[u++]=e&255),s}function tripletToBase64(r){return lookup$2[r>>18&63]+lookup$2[r>>12&63]+lookup$2[r>>6&63]+lookup$2[r&63]}function encodeChunk(r,e,t){for(var n,o=[],s=e;s<t;s+=3)n=(r[s]<<16&16711680)+(r[s+1]<<8&65280)+(r[s+2]&255),o.push(tripletToBase64(n));return o.join("")}function fromByteArray(r){for(var e,t=r.length,n=t%3,o=[],s=16383,u=0,f=t-n;u<f;u+=s)o.push(encodeChunk(r,u,u+s>f?f:u+s));return n===1?(e=r[t-1],o.push(lookup$2[e>>2]+lookup$2[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],o.push(lookup$2[e>>10]+lookup$2[e>>4&63]+lookup$2[e<<2&63]+"=")),o.join("")}var ieee754={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ieee754.read=function(r,e,t,n,o){var s,u,f=o*8-n-1,l=(1<<f)-1,h=l>>1,p=-7,m=t?o-1:0,b=t?-1:1,S=r[e+m];for(m+=b,s=S&(1<<-p)-1,S>>=-p,p+=f;p>0;s=s*256+r[e+m],m+=b,p-=8);for(u=s&(1<<-p)-1,s>>=-p,p+=n;p>0;u=u*256+r[e+m],m+=b,p-=8);if(s===0)s=1-h;else{if(s===l)return u?NaN:(S?-1:1)*(1/0);u=u+Math.pow(2,n),s=s-h}return(S?-1:1)*u*Math.pow(2,s-n)};ieee754.write=function(r,e,t,n,o,s){var u,f,l,h=s*8-o-1,p=(1<<h)-1,m=p>>1,b=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,S=n?0:s-1,A=n?1:-1,L=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(f=isNaN(e)?1:0,u=p):(u=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-u))<1&&(u--,l*=2),u+m>=1?e+=b/l:e+=b*Math.pow(2,1-m),e*l>=2&&(u++,l/=2),u+m>=p?(f=0,u=p):u+m>=1?(f=(e*l-1)*Math.pow(2,o),u=u+m):(f=e*Math.pow(2,m-1)*Math.pow(2,o),u=0));o>=8;r[t+S]=f&255,S+=A,f/=256,o-=8);for(u=u<<o|f,h+=o;h>0;r[t+S]=u&255,S+=A,u/=256,h-=8);r[t+S-A]|=L*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(r){const e=base64Js,t=ieee754,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;r.Buffer=f,r.SlowBuffer=pe,r.INSPECT_MAX_BYTES=50;const o=2147483647;r.kMaxLength=o,f.TYPED_ARRAY_SUPPORT=s(),!f.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const x=new Uint8Array(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,Uint8Array.prototype),Object.setPrototypeOf(x,g),x.foo()===42}catch{return!1}}Object.defineProperty(f.prototype,"parent",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.buffer}}),Object.defineProperty(f.prototype,"offset",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.byteOffset}});function u(x){if(x>o)throw new RangeError('The value "'+x+'" is invalid for option "size"');const g=new Uint8Array(x);return Object.setPrototypeOf(g,f.prototype),g}function f(x,g,w){if(typeof x=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return m(x)}return l(x,g,w)}f.poolSize=8192;function l(x,g,w){if(typeof x=="string")return b(x,g);if(ArrayBuffer.isView(x))return A(x);if(x==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof x);if(It(x,ArrayBuffer)||x&&It(x.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(It(x,SharedArrayBuffer)||x&&It(x.buffer,SharedArrayBuffer)))return L(x,g,w);if(typeof x=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const O=x.valueOf&&x.valueOf();if(O!=null&&O!==x)return f.from(O,g,w);const U=J(x);if(U)return U;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof x[Symbol.toPrimitive]=="function")return f.from(x[Symbol.toPrimitive]("string"),g,w);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof x)}f.from=function(x,g,w){return l(x,g,w)},Object.setPrototypeOf(f.prototype,Uint8Array.prototype),Object.setPrototypeOf(f,Uint8Array);function h(x){if(typeof x!="number")throw new TypeError('"size" argument must be of type number');if(x<0)throw new RangeError('The value "'+x+'" is invalid for option "size"')}function p(x,g,w){return h(x),x<=0?u(x):g!==void 0?typeof w=="string"?u(x).fill(g,w):u(x).fill(g):u(x)}f.alloc=function(x,g,w){return p(x,g,w)};function m(x){return h(x),u(x<0?0:ne(x)|0)}f.allocUnsafe=function(x){return m(x)},f.allocUnsafeSlow=function(x){return m(x)};function b(x,g){if((typeof g!="string"||g==="")&&(g="utf8"),!f.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const w=de(x,g)|0;let O=u(w);const U=O.write(x,g);return U!==w&&(O=O.slice(0,U)),O}function S(x){const g=x.length<0?0:ne(x.length)|0,w=u(g);for(let O=0;O<g;O+=1)w[O]=x[O]&255;return w}function A(x){if(It(x,Uint8Array)){const g=new Uint8Array(x);return L(g.buffer,g.byteOffset,g.byteLength)}return S(x)}function L(x,g,w){if(g<0||x.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(x.byteLength<g+(w||0))throw new RangeError('"length" is outside of buffer bounds');let O;return g===void 0&&w===void 0?O=new Uint8Array(x):w===void 0?O=new Uint8Array(x,g):O=new Uint8Array(x,g,w),Object.setPrototypeOf(O,f.prototype),O}function J(x){if(f.isBuffer(x)){const g=ne(x.length)|0,w=u(g);return w.length===0||x.copy(w,0,0,g),w}if(x.length!==void 0)return typeof x.length!="number"||Zt(x.length)?u(0):S(x);if(x.type==="Buffer"&&Array.isArray(x.data))return S(x.data)}function ne(x){if(x>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return x|0}function pe(x){return+x!=x&&(x=0),f.alloc(+x)}f.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==f.prototype},f.compare=function(g,w){if(It(g,Uint8Array)&&(g=f.from(g,g.offset,g.byteLength)),It(w,Uint8Array)&&(w=f.from(w,w.offset,w.byteLength)),!f.isBuffer(g)||!f.isBuffer(w))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===w)return 0;let O=g.length,U=w.length;for(let W=0,te=Math.min(O,U);W<te;++W)if(g[W]!==w[W]){O=g[W],U=w[W];break}return O<U?-1:U<O?1:0},f.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(g,w){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return f.alloc(0);let O;if(w===void 0)for(w=0,O=0;O<g.length;++O)w+=g[O].length;const U=f.allocUnsafe(w);let W=0;for(O=0;O<g.length;++O){let te=g[O];if(It(te,Uint8Array))W+te.length>U.length?(f.isBuffer(te)||(te=f.from(te)),te.copy(U,W)):Uint8Array.prototype.set.call(U,te,W);else if(f.isBuffer(te))te.copy(U,W);else throw new TypeError('"list" argument must be an Array of Buffers');W+=te.length}return U};function de(x,g){if(f.isBuffer(x))return x.length;if(ArrayBuffer.isView(x)||It(x,ArrayBuffer))return x.byteLength;if(typeof x!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof x);const w=x.length,O=arguments.length>2&&arguments[2]===!0;if(!O&&w===0)return 0;let U=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return w;case"utf8":case"utf-8":return zt(x).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w*2;case"hex":return w>>>1;case"base64":return Xt(x).length;default:if(U)return O?-1:zt(x).length;g=(""+g).toLowerCase(),U=!0}}f.byteLength=de;function H(x,g,w){let O=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((w===void 0||w>this.length)&&(w=this.length),w<=0)||(w>>>=0,g>>>=0,w<=g))return"";for(x||(x="utf8");;)switch(x){case"hex":return pr(this,g,w);case"utf8":case"utf-8":return ht(this,g,w);case"ascii":return Mt(this,g,w);case"latin1":case"binary":return Nt(this,g,w);case"base64":return _t(this,g,w);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _r(this,g,w);default:if(O)throw new TypeError("Unknown encoding: "+x);x=(x+"").toLowerCase(),O=!0}}f.prototype._isBuffer=!0;function z(x,g,w){const O=x[g];x[g]=x[w],x[w]=O}f.prototype.swap16=function(){const g=this.length;if(g%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let w=0;w<g;w+=2)z(this,w,w+1);return this},f.prototype.swap32=function(){const g=this.length;if(g%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let w=0;w<g;w+=4)z(this,w,w+3),z(this,w+1,w+2);return this},f.prototype.swap64=function(){const g=this.length;if(g%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let w=0;w<g;w+=8)z(this,w,w+7),z(this,w+1,w+6),z(this,w+2,w+5),z(this,w+3,w+4);return this},f.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?ht(this,0,g):H.apply(this,arguments)},f.prototype.toLocaleString=f.prototype.toString,f.prototype.equals=function(g){if(!f.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:f.compare(this,g)===0},f.prototype.inspect=function(){let g="";const w=r.INSPECT_MAX_BYTES;return g=this.toString("hex",0,w).replace(/(.{2})/g,"$1 ").trim(),this.length>w&&(g+=" ... "),"<Buffer "+g+">"},n&&(f.prototype[n]=f.prototype.inspect),f.prototype.compare=function(g,w,O,U,W){if(It(g,Uint8Array)&&(g=f.from(g,g.offset,g.byteLength)),!f.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(w===void 0&&(w=0),O===void 0&&(O=g?g.length:0),U===void 0&&(U=0),W===void 0&&(W=this.length),w<0||O>g.length||U<0||W>this.length)throw new RangeError("out of range index");if(U>=W&&w>=O)return 0;if(U>=W)return-1;if(w>=O)return 1;if(w>>>=0,O>>>=0,U>>>=0,W>>>=0,this===g)return 0;let te=W-U,$e=O-w;const tt=Math.min(te,$e),ct=this.slice(U,W),wt=g.slice(w,O);for(let lt=0;lt<tt;++lt)if(ct[lt]!==wt[lt]){te=ct[lt],$e=wt[lt];break}return te<$e?-1:$e<te?1:0};function ue(x,g,w,O,U){if(x.length===0)return-1;if(typeof w=="string"?(O=w,w=0):w>2147483647?w=2147483647:w<-2147483648&&(w=-2147483648),w=+w,Zt(w)&&(w=U?0:x.length-1),w<0&&(w=x.length+w),w>=x.length){if(U)return-1;w=x.length-1}else if(w<0)if(U)w=0;else return-1;if(typeof g=="string"&&(g=f.from(g,O)),f.isBuffer(g))return g.length===0?-1:ce(x,g,w,O,U);if(typeof g=="number")return g=g&255,typeof Uint8Array.prototype.indexOf=="function"?U?Uint8Array.prototype.indexOf.call(x,g,w):Uint8Array.prototype.lastIndexOf.call(x,g,w):ce(x,[g],w,O,U);throw new TypeError("val must be string, number or Buffer")}function ce(x,g,w,O,U){let W=1,te=x.length,$e=g.length;if(O!==void 0&&(O=String(O).toLowerCase(),O==="ucs2"||O==="ucs-2"||O==="utf16le"||O==="utf-16le")){if(x.length<2||g.length<2)return-1;W=2,te/=2,$e/=2,w/=2}function tt(wt,lt){return W===1?wt[lt]:wt.readUInt16BE(lt*W)}let ct;if(U){let wt=-1;for(ct=w;ct<te;ct++)if(tt(x,ct)===tt(g,wt===-1?0:ct-wt)){if(wt===-1&&(wt=ct),ct-wt+1===$e)return wt*W}else wt!==-1&&(ct-=ct-wt),wt=-1}else for(w+$e>te&&(w=te-$e),ct=w;ct>=0;ct--){let wt=!0;for(let lt=0;lt<$e;lt++)if(tt(x,ct+lt)!==tt(g,lt)){wt=!1;break}if(wt)return ct}return-1}f.prototype.includes=function(g,w,O){return this.indexOf(g,w,O)!==-1},f.prototype.indexOf=function(g,w,O){return ue(this,g,w,O,!0)},f.prototype.lastIndexOf=function(g,w,O){return ue(this,g,w,O,!1)};function Ee(x,g,w,O){w=Number(w)||0;const U=x.length-w;O?(O=Number(O),O>U&&(O=U)):O=U;const W=g.length;O>W/2&&(O=W/2);let te;for(te=0;te<O;++te){const $e=parseInt(g.substr(te*2,2),16);if(Zt($e))return te;x[w+te]=$e}return te}function Be(x,g,w,O){return Dt(zt(g,x.length-w),x,w,O)}function ot(x,g,w,O){return Dt(br(g),x,w,O)}function nt(x,g,w,O){return Dt(Xt(g),x,w,O)}function st(x,g,w,O){return Dt(Jt(g,x.length-w),x,w,O)}f.prototype.write=function(g,w,O,U){if(w===void 0)U="utf8",O=this.length,w=0;else if(O===void 0&&typeof w=="string")U=w,O=this.length,w=0;else if(isFinite(w))w=w>>>0,isFinite(O)?(O=O>>>0,U===void 0&&(U="utf8")):(U=O,O=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const W=this.length-w;if((O===void 0||O>W)&&(O=W),g.length>0&&(O<0||w<0)||w>this.length)throw new RangeError("Attempt to write outside buffer bounds");U||(U="utf8");let te=!1;for(;;)switch(U){case"hex":return Ee(this,g,w,O);case"utf8":case"utf-8":return Be(this,g,w,O);case"ascii":case"latin1":case"binary":return ot(this,g,w,O);case"base64":return nt(this,g,w,O);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return st(this,g,w,O);default:if(te)throw new TypeError("Unknown encoding: "+U);U=(""+U).toLowerCase(),te=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function _t(x,g,w){return g===0&&w===x.length?e.fromByteArray(x):e.fromByteArray(x.slice(g,w))}function ht(x,g,w){w=Math.min(x.length,w);const O=[];let U=g;for(;U<w;){const W=x[U];let te=null,$e=W>239?4:W>223?3:W>191?2:1;if(U+$e<=w){let tt,ct,wt,lt;switch($e){case 1:W<128&&(te=W);break;case 2:tt=x[U+1],(tt&192)===128&&(lt=(W&31)<<6|tt&63,lt>127&&(te=lt));break;case 3:tt=x[U+1],ct=x[U+2],(tt&192)===128&&(ct&192)===128&&(lt=(W&15)<<12|(tt&63)<<6|ct&63,lt>2047&&(lt<55296||lt>57343)&&(te=lt));break;case 4:tt=x[U+1],ct=x[U+2],wt=x[U+3],(tt&192)===128&&(ct&192)===128&&(wt&192)===128&&(lt=(W&15)<<18|(tt&63)<<12|(ct&63)<<6|wt&63,lt>65535&&lt<1114112&&(te=lt))}}te===null?(te=65533,$e=1):te>65535&&(te-=65536,O.push(te>>>10&1023|55296),te=56320|te&1023),O.push(te),U+=$e}return At(O)}const Lt=4096;function At(x){const g=x.length;if(g<=Lt)return String.fromCharCode.apply(String,x);let w="",O=0;for(;O<g;)w+=String.fromCharCode.apply(String,x.slice(O,O+=Lt));return w}function Mt(x,g,w){let O="";w=Math.min(x.length,w);for(let U=g;U<w;++U)O+=String.fromCharCode(x[U]&127);return O}function Nt(x,g,w){let O="";w=Math.min(x.length,w);for(let U=g;U<w;++U)O+=String.fromCharCode(x[U]);return O}function pr(x,g,w){const O=x.length;(!g||g<0)&&(g=0),(!w||w<0||w>O)&&(w=O);let U="";for(let W=g;W<w;++W)U+=X[x[W]];return U}function _r(x,g,w){const O=x.slice(g,w);let U="";for(let W=0;W<O.length-1;W+=2)U+=String.fromCharCode(O[W]+O[W+1]*256);return U}f.prototype.slice=function(g,w){const O=this.length;g=~~g,w=w===void 0?O:~~w,g<0?(g+=O,g<0&&(g=0)):g>O&&(g=O),w<0?(w+=O,w<0&&(w=0)):w>O&&(w=O),w<g&&(w=g);const U=this.subarray(g,w);return Object.setPrototypeOf(U,f.prototype),U};function Me(x,g,w){if(x%1!==0||x<0)throw new RangeError("offset is not uint");if(x+g>w)throw new RangeError("Trying to access beyond buffer length")}f.prototype.readUintLE=f.prototype.readUIntLE=function(g,w,O){g=g>>>0,w=w>>>0,O||Me(g,w,this.length);let U=this[g],W=1,te=0;for(;++te<w&&(W*=256);)U+=this[g+te]*W;return U},f.prototype.readUintBE=f.prototype.readUIntBE=function(g,w,O){g=g>>>0,w=w>>>0,O||Me(g,w,this.length);let U=this[g+--w],W=1;for(;w>0&&(W*=256);)U+=this[g+--w]*W;return U},f.prototype.readUint8=f.prototype.readUInt8=function(g,w){return g=g>>>0,w||Me(g,1,this.length),this[g]},f.prototype.readUint16LE=f.prototype.readUInt16LE=function(g,w){return g=g>>>0,w||Me(g,2,this.length),this[g]|this[g+1]<<8},f.prototype.readUint16BE=f.prototype.readUInt16BE=function(g,w){return g=g>>>0,w||Me(g,2,this.length),this[g]<<8|this[g+1]},f.prototype.readUint32LE=f.prototype.readUInt32LE=function(g,w){return g=g>>>0,w||Me(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},f.prototype.readUint32BE=f.prototype.readUInt32BE=function(g,w){return g=g>>>0,w||Me(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},f.prototype.readBigUInt64LE=se(function(g){g=g>>>0,fr(g,"offset");const w=this[g],O=this[g+7];(w===void 0||O===void 0)&&Rt(g,this.length-8);const U=w+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,W=this[++g]+this[++g]*2**8+this[++g]*2**16+O*2**24;return BigInt(U)+(BigInt(W)<<BigInt(32))}),f.prototype.readBigUInt64BE=se(function(g){g=g>>>0,fr(g,"offset");const w=this[g],O=this[g+7];(w===void 0||O===void 0)&&Rt(g,this.length-8);const U=w*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],W=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+O;return(BigInt(U)<<BigInt(32))+BigInt(W)}),f.prototype.readIntLE=function(g,w,O){g=g>>>0,w=w>>>0,O||Me(g,w,this.length);let U=this[g],W=1,te=0;for(;++te<w&&(W*=256);)U+=this[g+te]*W;return W*=128,U>=W&&(U-=Math.pow(2,8*w)),U},f.prototype.readIntBE=function(g,w,O){g=g>>>0,w=w>>>0,O||Me(g,w,this.length);let U=w,W=1,te=this[g+--U];for(;U>0&&(W*=256);)te+=this[g+--U]*W;return W*=128,te>=W&&(te-=Math.pow(2,8*w)),te},f.prototype.readInt8=function(g,w){return g=g>>>0,w||Me(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},f.prototype.readInt16LE=function(g,w){g=g>>>0,w||Me(g,2,this.length);const O=this[g]|this[g+1]<<8;return O&32768?O|4294901760:O},f.prototype.readInt16BE=function(g,w){g=g>>>0,w||Me(g,2,this.length);const O=this[g+1]|this[g]<<8;return O&32768?O|4294901760:O},f.prototype.readInt32LE=function(g,w){return g=g>>>0,w||Me(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},f.prototype.readInt32BE=function(g,w){return g=g>>>0,w||Me(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},f.prototype.readBigInt64LE=se(function(g){g=g>>>0,fr(g,"offset");const w=this[g],O=this[g+7];(w===void 0||O===void 0)&&Rt(g,this.length-8);const U=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(O<<24);return(BigInt(U)<<BigInt(32))+BigInt(w+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),f.prototype.readBigInt64BE=se(function(g){g=g>>>0,fr(g,"offset");const w=this[g],O=this[g+7];(w===void 0||O===void 0)&&Rt(g,this.length-8);const U=(w<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt(U)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+O)}),f.prototype.readFloatLE=function(g,w){return g=g>>>0,w||Me(g,4,this.length),t.read(this,g,!0,23,4)},f.prototype.readFloatBE=function(g,w){return g=g>>>0,w||Me(g,4,this.length),t.read(this,g,!1,23,4)},f.prototype.readDoubleLE=function(g,w){return g=g>>>0,w||Me(g,8,this.length),t.read(this,g,!0,52,8)},f.prototype.readDoubleBE=function(g,w){return g=g>>>0,w||Me(g,8,this.length),t.read(this,g,!1,52,8)};function xt(x,g,w,O,U,W){if(!f.isBuffer(x))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>U||g<W)throw new RangeError('"value" argument is out of bounds');if(w+O>x.length)throw new RangeError("Index out of range")}f.prototype.writeUintLE=f.prototype.writeUIntLE=function(g,w,O,U){if(g=+g,w=w>>>0,O=O>>>0,!U){const $e=Math.pow(2,8*O)-1;xt(this,g,w,O,$e,0)}let W=1,te=0;for(this[w]=g&255;++te<O&&(W*=256);)this[w+te]=g/W&255;return w+O},f.prototype.writeUintBE=f.prototype.writeUIntBE=function(g,w,O,U){if(g=+g,w=w>>>0,O=O>>>0,!U){const $e=Math.pow(2,8*O)-1;xt(this,g,w,O,$e,0)}let W=O-1,te=1;for(this[w+W]=g&255;--W>=0&&(te*=256);)this[w+W]=g/te&255;return w+O},f.prototype.writeUint8=f.prototype.writeUInt8=function(g,w,O){return g=+g,w=w>>>0,O||xt(this,g,w,1,255,0),this[w]=g&255,w+1},f.prototype.writeUint16LE=f.prototype.writeUInt16LE=function(g,w,O){return g=+g,w=w>>>0,O||xt(this,g,w,2,65535,0),this[w]=g&255,this[w+1]=g>>>8,w+2},f.prototype.writeUint16BE=f.prototype.writeUInt16BE=function(g,w,O){return g=+g,w=w>>>0,O||xt(this,g,w,2,65535,0),this[w]=g>>>8,this[w+1]=g&255,w+2},f.prototype.writeUint32LE=f.prototype.writeUInt32LE=function(g,w,O){return g=+g,w=w>>>0,O||xt(this,g,w,4,4294967295,0),this[w+3]=g>>>24,this[w+2]=g>>>16,this[w+1]=g>>>8,this[w]=g&255,w+4},f.prototype.writeUint32BE=f.prototype.writeUInt32BE=function(g,w,O){return g=+g,w=w>>>0,O||xt(this,g,w,4,4294967295,0),this[w]=g>>>24,this[w+1]=g>>>16,this[w+2]=g>>>8,this[w+3]=g&255,w+4};function Vt(x,g,w,O,U){ar(g,O,U,x,w,7);let W=Number(g&BigInt(4294967295));x[w++]=W,W=W>>8,x[w++]=W,W=W>>8,x[w++]=W,W=W>>8,x[w++]=W;let te=Number(g>>BigInt(32)&BigInt(4294967295));return x[w++]=te,te=te>>8,x[w++]=te,te=te>>8,x[w++]=te,te=te>>8,x[w++]=te,w}function pt(x,g,w,O,U){ar(g,O,U,x,w,7);let W=Number(g&BigInt(4294967295));x[w+7]=W,W=W>>8,x[w+6]=W,W=W>>8,x[w+5]=W,W=W>>8,x[w+4]=W;let te=Number(g>>BigInt(32)&BigInt(4294967295));return x[w+3]=te,te=te>>8,x[w+2]=te,te=te>>8,x[w+1]=te,te=te>>8,x[w]=te,w+8}f.prototype.writeBigUInt64LE=se(function(g,w=0){return Vt(this,g,w,BigInt(0),BigInt("0xffffffffffffffff"))}),f.prototype.writeBigUInt64BE=se(function(g,w=0){return pt(this,g,w,BigInt(0),BigInt("0xffffffffffffffff"))}),f.prototype.writeIntLE=function(g,w,O,U){if(g=+g,w=w>>>0,!U){const tt=Math.pow(2,8*O-1);xt(this,g,w,O,tt-1,-tt)}let W=0,te=1,$e=0;for(this[w]=g&255;++W<O&&(te*=256);)g<0&&$e===0&&this[w+W-1]!==0&&($e=1),this[w+W]=(g/te>>0)-$e&255;return w+O},f.prototype.writeIntBE=function(g,w,O,U){if(g=+g,w=w>>>0,!U){const tt=Math.pow(2,8*O-1);xt(this,g,w,O,tt-1,-tt)}let W=O-1,te=1,$e=0;for(this[w+W]=g&255;--W>=0&&(te*=256);)g<0&&$e===0&&this[w+W+1]!==0&&($e=1),this[w+W]=(g/te>>0)-$e&255;return w+O},f.prototype.writeInt8=function(g,w,O){return g=+g,w=w>>>0,O||xt(this,g,w,1,127,-128),g<0&&(g=255+g+1),this[w]=g&255,w+1},f.prototype.writeInt16LE=function(g,w,O){return g=+g,w=w>>>0,O||xt(this,g,w,2,32767,-32768),this[w]=g&255,this[w+1]=g>>>8,w+2},f.prototype.writeInt16BE=function(g,w,O){return g=+g,w=w>>>0,O||xt(this,g,w,2,32767,-32768),this[w]=g>>>8,this[w+1]=g&255,w+2},f.prototype.writeInt32LE=function(g,w,O){return g=+g,w=w>>>0,O||xt(this,g,w,4,2147483647,-2147483648),this[w]=g&255,this[w+1]=g>>>8,this[w+2]=g>>>16,this[w+3]=g>>>24,w+4},f.prototype.writeInt32BE=function(g,w,O){return g=+g,w=w>>>0,O||xt(this,g,w,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[w]=g>>>24,this[w+1]=g>>>16,this[w+2]=g>>>8,this[w+3]=g&255,w+4},f.prototype.writeBigInt64LE=se(function(g,w=0){return Vt(this,g,w,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),f.prototype.writeBigInt64BE=se(function(g,w=0){return pt(this,g,w,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Ze(x,g,w,O,U,W){if(w+O>x.length)throw new RangeError("Index out of range");if(w<0)throw new RangeError("Index out of range")}function Ft(x,g,w,O,U){return g=+g,w=w>>>0,U||Ze(x,g,w,4),t.write(x,g,w,O,23,4),w+4}f.prototype.writeFloatLE=function(g,w,O){return Ft(this,g,w,!0,O)},f.prototype.writeFloatBE=function(g,w,O){return Ft(this,g,w,!1,O)};function jr(x,g,w,O,U){return g=+g,w=w>>>0,U||Ze(x,g,w,8),t.write(x,g,w,O,52,8),w+8}f.prototype.writeDoubleLE=function(g,w,O){return jr(this,g,w,!0,O)},f.prototype.writeDoubleBE=function(g,w,O){return jr(this,g,w,!1,O)},f.prototype.copy=function(g,w,O,U){if(!f.isBuffer(g))throw new TypeError("argument should be a Buffer");if(O||(O=0),!U&&U!==0&&(U=this.length),w>=g.length&&(w=g.length),w||(w=0),U>0&&U<O&&(U=O),U===O||g.length===0||this.length===0)return 0;if(w<0)throw new RangeError("targetStart out of bounds");if(O<0||O>=this.length)throw new RangeError("Index out of range");if(U<0)throw new RangeError("sourceEnd out of bounds");U>this.length&&(U=this.length),g.length-w<U-O&&(U=g.length-w+O);const W=U-O;return this===g&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(w,O,U):Uint8Array.prototype.set.call(g,this.subarray(O,U),w),W},f.prototype.fill=function(g,w,O,U){if(typeof g=="string"){if(typeof w=="string"?(U=w,w=0,O=this.length):typeof O=="string"&&(U=O,O=this.length),U!==void 0&&typeof U!="string")throw new TypeError("encoding must be a string");if(typeof U=="string"&&!f.isEncoding(U))throw new TypeError("Unknown encoding: "+U);if(g.length===1){const te=g.charCodeAt(0);(U==="utf8"&&te<128||U==="latin1")&&(g=te)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(w<0||this.length<w||this.length<O)throw new RangeError("Out of range index");if(O<=w)return this;w=w>>>0,O=O===void 0?this.length:O>>>0,g||(g=0);let W;if(typeof g=="number")for(W=w;W<O;++W)this[W]=g;else{const te=f.isBuffer(g)?g:f.from(g,U),$e=te.length;if($e===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(W=0;W<O-w;++W)this[W+w]=te[W%$e]}return this};const Yt={};function kt(x,g,w){Yt[x]=class extends w{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${x}]`,this.stack,delete this.name}get code(){return x}set code(U){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:U,writable:!0})}toString(){return`${this.name} [${x}]: ${this.message}`}}}kt("ERR_BUFFER_OUT_OF_BOUNDS",function(x){return x?`${x} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),kt("ERR_INVALID_ARG_TYPE",function(x,g){return`The "${x}" argument must be of type number. Received type ${typeof g}`},TypeError),kt("ERR_OUT_OF_RANGE",function(x,g,w){let O=`The value of "${x}" is out of range.`,U=w;return Number.isInteger(w)&&Math.abs(w)>2**32?U=wr(String(w)):typeof w=="bigint"&&(U=String(w),(w>BigInt(2)**BigInt(32)||w<-(BigInt(2)**BigInt(32)))&&(U=wr(U)),U+="n"),O+=` It must be ${g}. Received ${U}`,O},RangeError);function wr(x){let g="",w=x.length;const O=x[0]==="-"?1:0;for(;w>=O+4;w-=3)g=`_${x.slice(w-3,w)}${g}`;return`${x.slice(0,w)}${g}`}function nr(x,g,w){fr(g,"offset"),(x[g]===void 0||x[g+w]===void 0)&&Rt(g,x.length-(w+1))}function ar(x,g,w,O,U,W){if(x>w||x<g){const te=typeof g=="bigint"?"n":"";let $e;throw W>3?g===0||g===BigInt(0)?$e=`>= 0${te} and < 2${te} ** ${(W+1)*8}${te}`:$e=`>= -(2${te} ** ${(W+1)*8-1}${te}) and < 2 ** ${(W+1)*8-1}${te}`:$e=`>= ${g}${te} and <= ${w}${te}`,new Yt.ERR_OUT_OF_RANGE("value",$e,x)}nr(O,U,W)}function fr(x,g){if(typeof x!="number")throw new Yt.ERR_INVALID_ARG_TYPE(g,"number",x)}function Rt(x,g,w){throw Math.floor(x)!==x?(fr(x,w),new Yt.ERR_OUT_OF_RANGE(w||"offset","an integer",x)):g<0?new Yt.ERR_BUFFER_OUT_OF_BOUNDS:new Yt.ERR_OUT_OF_RANGE(w||"offset",`>= ${w?1:0} and <= ${g}`,x)}const qt=/[^+/0-9A-Za-z-_]/g;function Jr(x){if(x=x.split("=")[0],x=x.trim().replace(qt,""),x.length<2)return"";for(;x.length%4!==0;)x=x+"=";return x}function zt(x,g){g=g||1/0;let w;const O=x.length;let U=null;const W=[];for(let te=0;te<O;++te){if(w=x.charCodeAt(te),w>55295&&w<57344){if(!U){if(w>56319){(g-=3)>-1&&W.push(239,191,189);continue}else if(te+1===O){(g-=3)>-1&&W.push(239,191,189);continue}U=w;continue}if(w<56320){(g-=3)>-1&&W.push(239,191,189),U=w;continue}w=(U-55296<<10|w-56320)+65536}else U&&(g-=3)>-1&&W.push(239,191,189);if(U=null,w<128){if((g-=1)<0)break;W.push(w)}else if(w<2048){if((g-=2)<0)break;W.push(w>>6|192,w&63|128)}else if(w<65536){if((g-=3)<0)break;W.push(w>>12|224,w>>6&63|128,w&63|128)}else if(w<1114112){if((g-=4)<0)break;W.push(w>>18|240,w>>12&63|128,w>>6&63|128,w&63|128)}else throw new Error("Invalid code point")}return W}function br(x){const g=[];for(let w=0;w<x.length;++w)g.push(x.charCodeAt(w)&255);return g}function Jt(x,g){let w,O,U;const W=[];for(let te=0;te<x.length&&!((g-=2)<0);++te)w=x.charCodeAt(te),O=w>>8,U=w%256,W.push(U),W.push(O);return W}function Xt(x){return e.toByteArray(Jr(x))}function Dt(x,g,w,O){let U;for(U=0;U<O&&!(U+w>=g.length||U>=x.length);++U)g[U+w]=x[U];return U}function It(x,g){return x instanceof g||x!=null&&x.constructor!=null&&x.constructor.name!=null&&x.constructor.name===g.name}function Zt(x){return x!==x}const X=function(){const x="0123456789abcdef",g=new Array(256);for(let w=0;w<16;++w){const O=w*16;for(let U=0;U<16;++U)g[O+U]=x[w]+x[U]}return g}();function se(x){return typeof BigInt>"u"?we:x}function we(){throw new Error("BigInt not supported")}})(buffer);var __values$1=commonjsGlobal&&commonjsGlobal.__values||function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},__importDefault$c=commonjsGlobal&&commonjsGlobal.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(utils$3,"__esModule",{value:!0});var xxhashjs_1=__importDefault$c(lib),buffer_1$2=buffer;function allocateArray(r,e){for(var t=new Array(r),n=typeof e=="function"?e:function(){return e},o=0;o<r;o++)t[o]=n();return t}utils$3.allocateArray=allocateArray;function hashTwice(r,e,t){e===void 0&&(e=!1),t===void 0&&(t=getDefaultSeed());var n=xxhashjs_1.default.h64(r,t+1),o=xxhashjs_1.default.h64(r,t+2);if(e)return{first:n.toNumber(),second:o.toNumber()};var s=n.toString(16);s.length<16&&(s="0".repeat(16-s.length)+s);var u=o.toString(16);return u.length<16&&(u="0".repeat(16-u.length)+u),{first:Number(s),second:Number(u)}}utils$3.hashTwice=hashTwice;function hashTwiceAsString(r,e){e===void 0&&(e=getDefaultSeed());var t=xxhashjs_1.default.h64(r,e+1),n=xxhashjs_1.default.h64(r,e+2),o=t.toString(16);o.length<16&&(o="0".repeat(16-o.length)+o);var s=n.toString(16);return s.length<16&&(s="0".repeat(16-s.length)+s),{first:o,second:s}}utils$3.hashTwiceAsString=hashTwiceAsString;function allInOneHashTwice(r,e){e===void 0&&(e=getDefaultSeed());var t=xxhashjs_1.default.h64(r,e+1),n=xxhashjs_1.default.h64(r,e+2),o=t.toString(16);o.length<16&&(o="0".repeat(16-o.length)+o);var s=n.toString(16);return s.length<16&&(s="0".repeat(16-s.length)+s),{int:{first:t.toNumber(),second:n.toNumber()},string:{first:o,second:s}}}utils$3.allInOneHashTwice=allInOneHashTwice;function doubleHashing(r,e,t,n){return Math.abs((e+r*t)%n)}utils$3.doubleHashing=doubleHashing;function getDistinctIndices(r,e,t,n){n===void 0&&(n=getDefaultSeed());function o(s,u,f,l,h){if(h===void 0&&(h=[]),h.length===l)return h;var p=hashTwice(u,!0,n+f%s),m=doubleHashing(s,p.first,p.second,f);return h.includes(m)||h.push(m),o(s+1,u,f,l,h)}return o(1,r,e,t)}utils$3.getDistinctIndices=getDistinctIndices;function getIndices(r,e,t,n){n===void 0&&(n=getDefaultSeed());for(var o=[],s=1;s<=t;s++){var u=hashTwice(r,!0,n+e%s);o.push(doubleHashing(s,u.first,u.second,e))}if(o.length!==t)throw new Error("report this, please, shouldnt be of different size");return o}utils$3.getIndices=getIndices;function randomInt(r,e,t){t===void 0&&(t=Math.random),r=Math.ceil(r),e=Math.floor(e);var n=t();return Math.floor(n*(e-r+1))+r}utils$3.randomInt=randomInt;function xorBuffer(r,e){for(var t=Math.max(r.length,e.length),n=buffer_1$2.Buffer.allocUnsafe(t).fill(0),o=0;o<t;++o)o<r.length&&o<e.length?n[t-o-1]=r[r.length-o-1]^e[e.length-o-1]:o<r.length&&o>=e.length?n[t-o-1]^=r[r.length-o-1]:o<e.length&&o>=r.length&&(n[t-o-1]^=e[e.length-o-1]);for(var s=0,u=n.values(),f=u.next();!f.done&&f.value===0;)s++,f=u.next();var l=n.slice(s);return l}utils$3.xorBuffer=xorBuffer;function isEmptyBuffer(r){var e,t;if(r===null||!r)return!0;try{for(var n=__values$1(r),o=n.next();!o.done;o=n.next()){var s=o.value;if(s!==0)return!1}}catch(u){e={error:u}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return!0}utils$3.isEmptyBuffer=isEmptyBuffer;function hashAsInt(r,e,t){switch(e===void 0&&(e=getDefaultSeed()),t){case 32:return xxhashjs_1.default.h32(r,e).toNumber();case 64:return xxhashjs_1.default.h64(r,e).toNumber();default:return xxhashjs_1.default.h64(r,e).toNumber()}}utils$3.hashAsInt=hashAsInt;function hashAsString(r,e,t,n){e===void 0&&(e=getDefaultSeed()),t===void 0&&(t=16),n===void 0&&(n=64);var o;switch(n){case 32:o=xxhashjs_1.default.h32(r,e);break;case 64:o=xxhashjs_1.default.h64(r,e);break;default:o=xxhashjs_1.default.h64(r,e);break}var s="";return t===16?(s=o.toString(t),s.length<n/4&&(s="0".repeat(n/4-s.length)+s)):t===2&&(s=hex2bin(o.toString(16)),s.length<n&&(s="0".repeat(n-s.length)+s)),s}utils$3.hashAsString=hashAsString;function hashIntAndString(r,e,t,n){e===void 0&&(e=getDefaultSeed()),t===void 0&&(t=16),n===void 0&&(n=64);var o;switch(n){case 32:o=xxhashjs_1.default.h32(r,e);break;case 64:o=xxhashjs_1.default.h64(r,e);break;default:o=xxhashjs_1.default.h64(r,e);break}var s="";return t===16?(s=o.toString(t),s.length<n/4&&(s="0".repeat(n/4-s.length)+s)):t===2&&(s=hex2bin(o.toString(16)),s.length<n&&(s="0".repeat(n-s.length)+s)),{int:o.toNumber(),string:s}}utils$3.hashIntAndString=hashIntAndString;function getDefaultSeed(){return 78187493520}utils$3.getDefaultSeed=getDefaultSeed;function power2(r){return Math.ceil(Math.pow(2,Math.floor(Math.log(r)/Math.log(2))))}utils$3.power2=power2;function hex2bin(r){return parseInt(r,16).toString(2)}utils$3.hex2bin=hex2bin;function uint8ToBits(r){return[128,64,32,16,8,4,2,1].map(function(e){return(e&r)>0?1:0})}utils$3.uint8ToBits=uint8ToBits;function bitsToUint8(r){return r.reduce(function(e,t,n){if(t===0)return e;if(t===1)return e+Math.pow(2,7-n);throw new Error("Not binary")},0)}utils$3.bitsToUint8=bitsToUint8;var aleaExports={},alea$1={get exports(){return aleaExports},set exports(r){aleaExports=r}};(function(r){(function(e,t,n){function o(l){var h=this,p=f();h.next=function(){var m=2091639*h.s0+h.c*23283064365386963e-26;return h.s0=h.s1,h.s1=h.s2,h.s2=m-(h.c=m|0)},h.c=1,h.s0=p(" "),h.s1=p(" "),h.s2=p(" "),h.s0-=p(l),h.s0<0&&(h.s0+=1),h.s1-=p(l),h.s1<0&&(h.s1+=1),h.s2-=p(l),h.s2<0&&(h.s2+=1),p=null}function s(l,h){return h.c=l.c,h.s0=l.s0,h.s1=l.s1,h.s2=l.s2,h}function u(l,h){var p=new o(l),m=h&&h.state,b=p.next;return b.int32=function(){return p.next()*4294967296|0},b.double=function(){return b()+(b()*2097152|0)*11102230246251565e-32},b.quick=b,m&&(typeof m=="object"&&s(m,p),b.state=function(){return s(p,{})}),b}function f(){var l=4022871197,h=function(p){p=String(p);for(var m=0;m<p.length;m++){l+=p.charCodeAt(m);var b=.02519603282416938*l;l=b>>>0,b-=l,b*=l,l=b>>>0,b-=l,l+=b*4294967296}return(l>>>0)*23283064365386963e-26};return h}t&&t.exports?t.exports=u:n&&n.amd?n(function(){return u}):this.alea=u})(commonjsGlobal,r,!1)})(alea$1);var xor128Exports={},xor128$1={get exports(){return xor128Exports},set exports(r){xor128Exports=r}};(function(r){(function(e,t,n){function o(f){var l=this,h="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var m=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^m^m>>>8},f===(f|0)?l.x=f:h+=f;for(var p=0;p<h.length+64;p++)l.x^=h.charCodeAt(p)|0,l.next()}function s(f,l){return l.x=f.x,l.y=f.y,l.z=f.z,l.w=f.w,l}function u(f,l){var h=new o(f),p=l&&l.state,m=function(){return(h.next()>>>0)/4294967296};return m.double=function(){do var b=h.next()>>>11,S=(h.next()>>>0)/4294967296,A=(b+S)/(1<<21);while(A===0);return A},m.int32=h.next,m.quick=m,p&&(typeof p=="object"&&s(p,h),m.state=function(){return s(h,{})}),m}t&&t.exports?t.exports=u:n&&n.amd?n(function(){return u}):this.xor128=u})(commonjsGlobal,r,!1)})(xor128$1);var xorwowExports={},xorwow$1={get exports(){return xorwowExports},set exports(r){xorwowExports=r}};(function(r){(function(e,t,n){function o(f){var l=this,h="";l.next=function(){var m=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(m^m<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,f===(f|0)?l.x=f:h+=f;for(var p=0;p<h.length+64;p++)l.x^=h.charCodeAt(p)|0,p==h.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function s(f,l){return l.x=f.x,l.y=f.y,l.z=f.z,l.w=f.w,l.v=f.v,l.d=f.d,l}function u(f,l){var h=new o(f),p=l&&l.state,m=function(){return(h.next()>>>0)/4294967296};return m.double=function(){do var b=h.next()>>>11,S=(h.next()>>>0)/4294967296,A=(b+S)/(1<<21);while(A===0);return A},m.int32=h.next,m.quick=m,p&&(typeof p=="object"&&s(p,h),m.state=function(){return s(h,{})}),m}t&&t.exports?t.exports=u:n&&n.amd?n(function(){return u}):this.xorwow=u})(commonjsGlobal,r,!1)})(xorwow$1);var xorshift7Exports={},xorshift7$1={get exports(){return xorshift7Exports},set exports(r){xorshift7Exports=r}};(function(r){(function(e,t,n){function o(f){var l=this;l.next=function(){var p=l.x,m=l.i,b,S;return b=p[m],b^=b>>>7,S=b^b<<24,b=p[m+1&7],S^=b^b>>>10,b=p[m+3&7],S^=b^b>>>3,b=p[m+4&7],S^=b^b<<7,b=p[m+7&7],b=b^b<<13,S^=b^b<<9,p[m]=S,l.i=m+1&7,S};function h(p,m){var b,S=[];if(m===(m|0))S[0]=m;else for(m=""+m,b=0;b<m.length;++b)S[b&7]=S[b&7]<<15^m.charCodeAt(b)+S[b+1&7]<<13;for(;S.length<8;)S.push(0);for(b=0;b<8&&S[b]===0;++b);for(b==8?S[7]=-1:S[b],p.x=S,p.i=0,b=256;b>0;--b)p.next()}h(l,f)}function s(f,l){return l.x=f.x.slice(),l.i=f.i,l}function u(f,l){f==null&&(f=+new Date);var h=new o(f),p=l&&l.state,m=function(){return(h.next()>>>0)/4294967296};return m.double=function(){do var b=h.next()>>>11,S=(h.next()>>>0)/4294967296,A=(b+S)/(1<<21);while(A===0);return A},m.int32=h.next,m.quick=m,p&&(p.x&&s(p,h),m.state=function(){return s(h,{})}),m}t&&t.exports?t.exports=u:n&&n.amd?n(function(){return u}):this.xorshift7=u})(commonjsGlobal,r,!1)})(xorshift7$1);var xor4096Exports={},xor4096$1={get exports(){return xor4096Exports},set exports(r){xor4096Exports=r}};(function(r){(function(e,t,n){function o(f){var l=this;l.next=function(){var p=l.w,m=l.X,b=l.i,S,A;return l.w=p=p+1640531527|0,A=m[b+34&127],S=m[b=b+1&127],A^=A<<13,S^=S<<17,A^=A>>>15,S^=S>>>12,A=m[b]=A^S,l.i=b,A+(p^p>>>16)|0};function h(p,m){var b,S,A,L,J,ne=[],pe=128;for(m===(m|0)?(S=m,m=null):(m=m+"\0",S=0,pe=Math.max(pe,m.length)),A=0,L=-32;L<pe;++L)m&&(S^=m.charCodeAt((L+32)%m.length)),L===0&&(J=S),S^=S<<10,S^=S>>>15,S^=S<<4,S^=S>>>13,L>=0&&(J=J+1640531527|0,b=ne[L&127]^=S+J,A=b==0?A+1:0);for(A>=128&&(ne[(m&&m.length||0)&127]=-1),A=127,L=4*128;L>0;--L)S=ne[A+34&127],b=ne[A=A+1&127],S^=S<<13,b^=b<<17,S^=S>>>15,b^=b>>>12,ne[A]=S^b;p.w=J,p.X=ne,p.i=A}h(l,f)}function s(f,l){return l.i=f.i,l.w=f.w,l.X=f.X.slice(),l}function u(f,l){f==null&&(f=+new Date);var h=new o(f),p=l&&l.state,m=function(){return(h.next()>>>0)/4294967296};return m.double=function(){do var b=h.next()>>>11,S=(h.next()>>>0)/4294967296,A=(b+S)/(1<<21);while(A===0);return A},m.int32=h.next,m.quick=m,p&&(p.X&&s(p,h),m.state=function(){return s(h,{})}),m}t&&t.exports?t.exports=u:n&&n.amd?n(function(){return u}):this.xor4096=u})(commonjsGlobal,r,!1)})(xor4096$1);var tycheiExports={},tychei$1={get exports(){return tycheiExports},set exports(r){tycheiExports=r}};(function(r){(function(e,t,n){function o(f){var l=this,h="";l.next=function(){var m=l.b,b=l.c,S=l.d,A=l.a;return m=m<<25^m>>>7^b,b=b-S|0,S=S<<24^S>>>8^A,A=A-m|0,l.b=m=m<<20^m>>>12^b,l.c=b=b-S|0,l.d=S<<16^b>>>16^A,l.a=A-m|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,f===Math.floor(f)?(l.a=f/4294967296|0,l.b=f|0):h+=f;for(var p=0;p<h.length+20;p++)l.b^=h.charCodeAt(p)|0,l.next()}function s(f,l){return l.a=f.a,l.b=f.b,l.c=f.c,l.d=f.d,l}function u(f,l){var h=new o(f),p=l&&l.state,m=function(){return(h.next()>>>0)/4294967296};return m.double=function(){do var b=h.next()>>>11,S=(h.next()>>>0)/4294967296,A=(b+S)/(1<<21);while(A===0);return A},m.int32=h.next,m.quick=m,p&&(typeof p=="object"&&s(p,h),m.state=function(){return s(h,{})}),m}t&&t.exports?t.exports=u:n&&n.amd?n(function(){return u}):this.tychei=u})(commonjsGlobal,r,!1)})(tychei$1);var seedrandomExports={},seedrandom$1={get exports(){return seedrandomExports},set exports(r){seedrandomExports=r}};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(__viteBrowserExternal$1);(function(r){(function(e,t,n){var o=256,s=6,u=52,f="random",l=n.pow(o,s),h=n.pow(2,u),p=h*2,m=o-1,b;function S(H,z,ue){var ce=[];z=z==!0?{entropy:!0}:z||{};var Ee=ne(J(z.entropy?[H,de(t)]:H??pe(),3),ce),Be=new A(ce),ot=function(){for(var nt=Be.g(s),st=l,_t=0;nt<h;)nt=(nt+_t)*o,st*=o,_t=Be.g(1);for(;nt>=p;)nt/=2,st/=2,_t>>>=1;return(nt+_t)/st};return ot.int32=function(){return Be.g(4)|0},ot.quick=function(){return Be.g(4)/4294967296},ot.double=ot,ne(de(Be.S),t),(z.pass||ue||function(nt,st,_t,ht){return ht&&(ht.S&&L(ht,Be),nt.state=function(){return L(Be,{})}),_t?(n[f]=nt,st):nt})(ot,Ee,"global"in z?z.global:this==n,z.state)}function A(H){var z,ue=H.length,ce=this,Ee=0,Be=ce.i=ce.j=0,ot=ce.S=[];for(ue||(H=[ue++]);Ee<o;)ot[Ee]=Ee++;for(Ee=0;Ee<o;Ee++)ot[Ee]=ot[Be=m&Be+H[Ee%ue]+(z=ot[Ee])],ot[Be]=z;(ce.g=function(nt){for(var st,_t=0,ht=ce.i,Lt=ce.j,At=ce.S;nt--;)st=At[ht=m&ht+1],_t=_t*o+At[m&(At[ht]=At[Lt=m&Lt+st])+(At[Lt]=st)];return ce.i=ht,ce.j=Lt,_t})(o)}function L(H,z){return z.i=H.i,z.j=H.j,z.S=H.S.slice(),z}function J(H,z){var ue=[],ce=typeof H,Ee;if(z&&ce=="object")for(Ee in H)try{ue.push(J(H[Ee],z-1))}catch{}return ue.length?ue:ce=="string"?H:H+"\0"}function ne(H,z){for(var ue=H+"",ce,Ee=0;Ee<ue.length;)z[m&Ee]=m&(ce^=z[m&Ee]*19)+ue.charCodeAt(Ee++);return de(z)}function pe(){try{var H;return b&&(H=b.randomBytes)?H=H(o):(H=new Uint8Array(o),(e.crypto||e.msCrypto).getRandomValues(H)),de(H)}catch{var z=e.navigator,ue=z&&z.plugins;return[+new Date,e,ue,e.screen,de(t)]}}function de(H){return String.fromCharCode.apply(0,H)}if(ne(n.random(),t),r.exports){r.exports=S;try{b=require$$0}catch{}}else n["seed"+f]=S})(typeof self<"u"?self:commonjsGlobal,[],Math)})(seedrandom$1);var alea=aleaExports,xor128=xor128Exports,xorwow=xorwowExports,xorshift7=xorshift7Exports,xor4096=xor4096Exports,tychei=tycheiExports,sr=seedrandomExports;sr.alea=alea;sr.xor128=xor128;sr.xorwow=xorwow;sr.xorshift7=xorshift7;sr.xor4096=xor4096;sr.tychei=tychei;var seedrandom=sr,__importStar$1=commonjsGlobal&&commonjsGlobal.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)Object.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e.default=r,e},__importDefault$b=commonjsGlobal&&commonjsGlobal.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(baseFilter,"__esModule",{value:!0});var utils$2=__importStar$1(utils$3),seedrandom_1=__importDefault$b(seedrandom),BaseFilter=function(){function r(){this._seed=utils$2.getDefaultSeed(),this._rng=seedrandom_1.default(""+this._seed)}return Object.defineProperty(r.prototype,"seed",{get:function(){return this._seed},set:function(e){this._seed=e,this._rng=seedrandom_1.default(""+this._seed)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"random",{get:function(){return this._rng},enumerable:!0,configurable:!0}),r.prototype.saveAsJSON=function(){throw new Error("not-implemented")},r.fromJSON=function(e){throw new Error("not-implemented")},r}();baseFilter.default=BaseFilter;var exportable={};/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Reflect$1;(function(r){(function(e){var t=typeof commonjsGlobal=="object"?commonjsGlobal:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),n=o(r);typeof t.Reflect>"u"?t.Reflect=r:n=o(t.Reflect,n),e(n);function o(s,u){return function(f,l){typeof s[f]!="function"&&Object.defineProperty(s,f,{configurable:!0,writable:!0,value:l}),u&&u(f,l)}}})(function(e){var t=Object.prototype.hasOwnProperty,n=typeof Symbol=="function",o=n&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",s=n&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",u=typeof Object.create=="function",f={__proto__:[]}instanceof Array,l=!u&&!f,h={create:u?function(){return Zt(Object.create(null))}:f?function(){return Zt({__proto__:null})}:function(){return Zt({})},has:l?function(X,se){return t.call(X,se)}:function(X,se){return se in X},get:l?function(X,se){return t.call(X,se)?X[se]:void 0}:function(X,se){return X[se]}},p=Object.getPrototypeOf(Function),m=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",b=!m&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Xt(),S=!m&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Dt(),A=!m&&typeof WeakMap=="function"?WeakMap:It(),L=new A;function J(X,se,we,x){if(Me(we)){if(!wr(X))throw new TypeError;if(!ar(se))throw new TypeError;return ot(X,se)}else{if(!wr(X))throw new TypeError;if(!pt(se))throw new TypeError;if(!pt(x)&&!Me(x)&&!xt(x))throw new TypeError;return xt(x)&&(x=void 0),we=kt(we),nt(X,se,we,x)}}e("decorate",J);function ne(X,se){function we(x,g){if(!pt(x))throw new TypeError;if(!Me(g)&&!fr(g))throw new TypeError;Mt(X,se,x,g)}return we}e("metadata",ne);function pe(X,se,we,x){if(!pt(we))throw new TypeError;return Me(x)||(x=kt(x)),Mt(X,se,we,x)}e("defineMetadata",pe);function de(X,se,we){if(!pt(se))throw new TypeError;return Me(we)||(we=kt(we)),_t(X,se,we)}e("hasMetadata",de);function H(X,se,we){if(!pt(se))throw new TypeError;return Me(we)||(we=kt(we)),ht(X,se,we)}e("hasOwnMetadata",H);function z(X,se,we){if(!pt(se))throw new TypeError;return Me(we)||(we=kt(we)),Lt(X,se,we)}e("getMetadata",z);function ue(X,se,we){if(!pt(se))throw new TypeError;return Me(we)||(we=kt(we)),At(X,se,we)}e("getOwnMetadata",ue);function ce(X,se){if(!pt(X))throw new TypeError;return Me(se)||(se=kt(se)),Nt(X,se)}e("getMetadataKeys",ce);function Ee(X,se){if(!pt(X))throw new TypeError;return Me(se)||(se=kt(se)),pr(X,se)}e("getOwnMetadataKeys",Ee);function Be(X,se,we){if(!pt(se))throw new TypeError;Me(we)||(we=kt(we));var x=st(se,we,!1);if(Me(x)||!x.delete(X))return!1;if(x.size>0)return!0;var g=L.get(se);return g.delete(we),g.size>0||L.delete(se),!0}e("deleteMetadata",Be);function ot(X,se){for(var we=X.length-1;we>=0;--we){var x=X[we],g=x(se);if(!Me(g)&&!xt(g)){if(!ar(g))throw new TypeError;se=g}}return se}function nt(X,se,we,x){for(var g=X.length-1;g>=0;--g){var w=X[g],O=w(se,we,x);if(!Me(O)&&!xt(O)){if(!pt(O))throw new TypeError;x=O}}return x}function st(X,se,we){var x=L.get(X);if(Me(x)){if(!we)return;x=new b,L.set(X,x)}var g=x.get(se);if(Me(g)){if(!we)return;g=new b,x.set(se,g)}return g}function _t(X,se,we){var x=ht(X,se,we);if(x)return!0;var g=Jt(se);return xt(g)?!1:_t(X,g,we)}function ht(X,se,we){var x=st(se,we,!1);return Me(x)?!1:jr(x.has(X))}function Lt(X,se,we){var x=ht(X,se,we);if(x)return At(X,se,we);var g=Jt(se);if(!xt(g))return Lt(X,g,we)}function At(X,se,we){var x=st(se,we,!1);if(!Me(x))return x.get(X)}function Mt(X,se,we,x){var g=st(we,x,!0);g.set(X,se)}function Nt(X,se){var we=pr(X,se),x=Jt(X);if(x===null)return we;var g=Nt(x,se);if(g.length<=0)return we;if(we.length<=0)return g;for(var w=new S,O=[],U=0,W=we;U<W.length;U++){var te=W[U],$e=w.has(te);$e||(w.add(te),O.push(te))}for(var tt=0,ct=g;tt<ct.length;tt++){var te=ct[tt],$e=w.has(te);$e||(w.add(te),O.push(te))}return O}function pr(X,se){var we=[],x=st(X,se,!1);if(Me(x))return we;for(var g=x.keys(),w=qt(g),O=0;;){var U=zt(w);if(!U)return we.length=O,we;var W=Jr(U);try{we[O]=W}catch(te){try{br(w)}finally{throw te}}O++}}function _r(X){if(X===null)return 1;switch(typeof X){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return X===null?1:6;default:return 6}}function Me(X){return X===void 0}function xt(X){return X===null}function Vt(X){return typeof X=="symbol"}function pt(X){return typeof X=="object"?X!==null:typeof X=="function"}function Ze(X,se){switch(_r(X)){case 0:return X;case 1:return X;case 2:return X;case 3:return X;case 4:return X;case 5:return X}var we=se===3?"string":se===5?"number":"default",x=Rt(X,o);if(x!==void 0){var g=x.call(X,we);if(pt(g))throw new TypeError;return g}return Ft(X,we==="default"?"number":we)}function Ft(X,se){if(se==="string"){var we=X.toString;if(nr(we)){var x=we.call(X);if(!pt(x))return x}var g=X.valueOf;if(nr(g)){var x=g.call(X);if(!pt(x))return x}}else{var g=X.valueOf;if(nr(g)){var x=g.call(X);if(!pt(x))return x}var w=X.toString;if(nr(w)){var x=w.call(X);if(!pt(x))return x}}throw new TypeError}function jr(X){return!!X}function Yt(X){return""+X}function kt(X){var se=Ze(X,3);return Vt(se)?se:Yt(se)}function wr(X){return Array.isArray?Array.isArray(X):X instanceof Object?X instanceof Array:Object.prototype.toString.call(X)==="[object Array]"}function nr(X){return typeof X=="function"}function ar(X){return typeof X=="function"}function fr(X){switch(_r(X)){case 3:return!0;case 4:return!0;default:return!1}}function Rt(X,se){var we=X[se];if(we!=null){if(!nr(we))throw new TypeError;return we}}function qt(X){var se=Rt(X,s);if(!nr(se))throw new TypeError;var we=se.call(X);if(!pt(we))throw new TypeError;return we}function Jr(X){return X.value}function zt(X){var se=X.next();return se.done?!1:se}function br(X){var se=X.return;se&&se.call(X)}function Jt(X){var se=Object.getPrototypeOf(X);if(typeof X!="function"||X===p||se!==p)return se;var we=X.prototype,x=we&&Object.getPrototypeOf(we);if(x==null||x===Object.prototype)return se;var g=x.constructor;return typeof g!="function"||g===X?se:g}function Xt(){var X={},se=[],we=function(){function O(U,W,te){this._index=0,this._keys=U,this._values=W,this._selector=te}return O.prototype["@@iterator"]=function(){return this},O.prototype[s]=function(){return this},O.prototype.next=function(){var U=this._index;if(U>=0&&U<this._keys.length){var W=this._selector(this._keys[U],this._values[U]);return U+1>=this._keys.length?(this._index=-1,this._keys=se,this._values=se):this._index++,{value:W,done:!1}}return{value:void 0,done:!0}},O.prototype.throw=function(U){throw this._index>=0&&(this._index=-1,this._keys=se,this._values=se),U},O.prototype.return=function(U){return this._index>=0&&(this._index=-1,this._keys=se,this._values=se),{value:U,done:!0}},O}();return function(){function O(){this._keys=[],this._values=[],this._cacheKey=X,this._cacheIndex=-2}return Object.defineProperty(O.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),O.prototype.has=function(U){return this._find(U,!1)>=0},O.prototype.get=function(U){var W=this._find(U,!1);return W>=0?this._values[W]:void 0},O.prototype.set=function(U,W){var te=this._find(U,!0);return this._values[te]=W,this},O.prototype.delete=function(U){var W=this._find(U,!1);if(W>=0){for(var te=this._keys.length,$e=W+1;$e<te;$e++)this._keys[$e-1]=this._keys[$e],this._values[$e-1]=this._values[$e];return this._keys.length--,this._values.length--,U===this._cacheKey&&(this._cacheKey=X,this._cacheIndex=-2),!0}return!1},O.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=X,this._cacheIndex=-2},O.prototype.keys=function(){return new we(this._keys,this._values,x)},O.prototype.values=function(){return new we(this._keys,this._values,g)},O.prototype.entries=function(){return new we(this._keys,this._values,w)},O.prototype["@@iterator"]=function(){return this.entries()},O.prototype[s]=function(){return this.entries()},O.prototype._find=function(U,W){return this._cacheKey!==U&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=U)),this._cacheIndex<0&&W&&(this._cacheIndex=this._keys.length,this._keys.push(U),this._values.push(void 0)),this._cacheIndex},O}();function x(O,U){return O}function g(O,U){return U}function w(O,U){return[O,U]}}function Dt(){return function(){function X(){this._map=new b}return Object.defineProperty(X.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),X.prototype.has=function(se){return this._map.has(se)},X.prototype.add=function(se){return this._map.set(se,se),this},X.prototype.delete=function(se){return this._map.delete(se)},X.prototype.clear=function(){this._map.clear()},X.prototype.keys=function(){return this._map.keys()},X.prototype.values=function(){return this._map.values()},X.prototype.entries=function(){return this._map.entries()},X.prototype["@@iterator"]=function(){return this.keys()},X.prototype[s]=function(){return this.keys()},X}()}function It(){var X=16,se=h.create(),we=x();return function(){function W(){this._key=x()}return W.prototype.has=function(te){var $e=g(te,!1);return $e!==void 0?h.has($e,this._key):!1},W.prototype.get=function(te){var $e=g(te,!1);return $e!==void 0?h.get($e,this._key):void 0},W.prototype.set=function(te,$e){var tt=g(te,!0);return tt[this._key]=$e,this},W.prototype.delete=function(te){var $e=g(te,!1);return $e!==void 0?delete $e[this._key]:!1},W.prototype.clear=function(){this._key=x()},W}();function x(){var W;do W="@@WeakMap@@"+U();while(h.has(se,W));return se[W]=!0,W}function g(W,te){if(!t.call(W,we)){if(!te)return;Object.defineProperty(W,we,{value:h.create()})}return W[we]}function w(W,te){for(var $e=0;$e<te;++$e)W[$e]=Math.random()*255|0;return W}function O(W){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(W)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(W)):w(new Uint8Array(W),W):w(new Array(W),W)}function U(){var W=O(X);W[6]=W[6]&79|64,W[8]=W[8]&191|128;for(var te="",$e=0;$e<X;++$e){var tt=W[$e];($e===4||$e===6||$e===8)&&(te+="-"),tt<16&&(te+="0"),te+=tt.toString(16).toLowerCase()}return te}}function Zt(X){return X.__=void 0,delete X.__,X}})})(Reflect$1||(Reflect$1={}));var __read$1=commonjsGlobal&&commonjsGlobal.__read||function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,s=[],u;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(f){u={error:f}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(u)throw u.error}}return s},__spread$1=commonjsGlobal&&commonjsGlobal.__spread||function(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(__read$1(arguments[e]));return r};Object.defineProperty(exportable,"__esModule",{value:!0});function cloneField(r){return r==null?r:Array.isArray(r)?r.map(cloneField):typeof r=="object"?"saveAsJSON"in r?r.saveAsJSON():Object.assign({},r):r}exportable.cloneField=cloneField;function cloneObject(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return function(n){var o={type:r};return e.forEach(function(s){o[s]=cloneField(n[s])}),o}}exportable.cloneObject=cloneObject;function Exportable(r){return function(e){return e.prototype.saveAsJSON=function(){return r.export(this)},e.fromJSON=function(t){return r.import(t)},e}}exportable.Exportable=Exportable;var METADATA_CLASSNAME=Symbol("bloom-filters:exportable:class-name"),METADATA_FIELDS=Symbol("bloom-filters:exportable:fields"),METADATA_PARAMETERS=Symbol("bloom-filters:exportable:constructor-parameters");function Field(r,e){return r===void 0&&(r=cloneField),e===void 0&&(e=function(t){return t}),function(t,n){var o=[];Reflect.hasMetadata(METADATA_FIELDS,t)&&(o=Reflect.getMetadata(METADATA_FIELDS,t)),o.push({name:n,exporter:r,importer:e}),Reflect.defineMetadata(METADATA_FIELDS,o,t)}}exportable.Field=Field;function Parameter(r){return function(e,t,n){var o=new Map;Reflect.hasMetadata(METADATA_PARAMETERS,e)&&(o=Reflect.getMetadata(METADATA_PARAMETERS,e)),o.set(r,n),Reflect.defineMetadata(METADATA_PARAMETERS,o,e)}}exportable.Parameter=Parameter;function AutoExportable(r,e){return e===void 0&&(e=[]),function(t){if(Reflect.defineMetadata(METADATA_CLASSNAME,r,t.prototype),!Reflect.hasMetadata(METADATA_FIELDS,t.prototype)||e.length===0)throw new SyntaxError("No exported fields declared when @AutoExportable is called");Reflect.hasMetadata(METADATA_PARAMETERS,t)||Reflect.defineMetadata(METADATA_PARAMETERS,new Map,t),t.prototype.saveAsJSON=function(){var n=this,o={type:Reflect.getMetadata(METADATA_CLASSNAME,t.prototype)},s=Reflect.getMetadata(METADATA_FIELDS,t.prototype);return s.forEach(function(u){o[u.name]=u.exporter(n[u.name])}),e.forEach(function(u){o[u]=cloneField(n[u])}),o},t.fromJSON=function(n){var o=Reflect.getMetadata(METADATA_CLASSNAME,t.prototype),s=Reflect.getMetadata(METADATA_PARAMETERS,t),u=Reflect.getMetadata(METADATA_FIELDS,t.prototype);if(n.type!==o)throw new Error("Cannot create an object "+o+' from a JSON export with type "'+n.type+'"');var f=[],l=[];e.map(function(p){return{name:p,importer:function(m){return m}}}).concat(u).forEach(function(p){if(!(p.name in n))throw new Error('Invalid import: required field "'+p+'" not found in JSON export "'+n+'"');s.has(p.name)?f[s.get(p.name)]=p.importer(n[p.name]):l.push({name:p.name,value:p.importer(n[p.name])})});var h=new(t.bind.apply(t,__spread$1([void 0],f)));return l.forEach(function(p){h[p.name]=p.value}),h}}}exportable.AutoExportable=AutoExportable;var formulas={};Object.defineProperty(formulas,"__esModule",{value:!0});function optimalFilterSize(r,e){return Math.ceil(-(r*Math.log(e)/Math.pow(Math.log(2),2)))}formulas.optimalFilterSize=optimalFilterSize;function optimalHashes(r,e){return Math.ceil(r/e*Math.log(2))}formulas.optimalHashes=optimalHashes;var __extends$9=commonjsGlobal&&commonjsGlobal.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)o.hasOwnProperty(s)&&(n[s]=o[s])},r(e,t)};return function(e,t){r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),__decorate$a=commonjsGlobal&&commonjsGlobal.__decorate||function(r,e,t,n){var o=arguments.length,s=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,n);else for(var f=r.length-1;f>=0;f--)(u=r[f])&&(s=(o<3?u(s):o>3?u(e,t,s):u(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},__metadata$a=commonjsGlobal&&commonjsGlobal.__metadata||function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$8=commonjsGlobal&&commonjsGlobal.__param||function(r,e){return function(t,n){e(t,n,r)}},__importDefault$a=commonjsGlobal&&commonjsGlobal.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(bloomFilter,"__esModule",{value:!0});var base_filter_1$9=__importDefault$a(baseFilter),exportable_1$a=exportable,formulas_1$2=formulas,utils_1$8=utils$3,BloomFilter$1=function(r){__extends$9(e,r);function e(n,o){var s=r.call(this)||this;if(o<1)throw new Error("A BloomFilter cannot uses less than one hash function, while you tried to use "+o+".");return s._size=n,s._nbHashes=o,s._filter=utils_1$8.allocateArray(s._size,0),s._length=0,s}t=e,e.create=function(n,o){var s=formulas_1$2.optimalFilterSize(n,o),u=formulas_1$2.optimalHashes(s,n);return new t(s,u)},e.from=function(n,o){var s=Array.from(n),u=t.create(s.length,o);return s.forEach(function(f){return u.add(f)}),u},e.fromBytes=function(n,o){for(var s=[],u=0;u<n.length;u++){var f=utils_1$8.uint8ToBits(n[u]);s=s.concat(f)}var l=new t(s.length,o);return l._filter=s,l},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),e.prototype.add=function(n){for(var o=utils_1$8.getDistinctIndices(n,this._size,this._nbHashes,this.seed),s=0;s<o.length;s++)this._filter[o[s]]=1;this._length++},e.prototype.has=function(n){for(var o=utils_1$8.getDistinctIndices(n,this._size,this._nbHashes,this.seed),s=0;s<o.length;s++)if(!this._filter[o[s]])return!1;return!0},e.prototype.rate=function(){return Math.pow(1-Math.exp(-this._nbHashes*this._length/this._size),this._nbHashes)},e.prototype.equals=function(n){return this._size!==n._size||this._nbHashes!==n._nbHashes?!1:this._filter.every(function(o,s){return n._filter[s]===o})},e.prototype.toBytes=function(){for(var n=new Uint8Array(Math.ceil(this._size/8)),o=0;o<n.length;o++){var s=this._filter.slice(o*8,o*8+8);n[o]=utils_1$8.bitsToUint8(s)}return n};var t;return __decorate$a([exportable_1$a.Field(),__metadata$a("design:type",Number)],e.prototype,"_size",void 0),__decorate$a([exportable_1$a.Field(),__metadata$a("design:type",Number)],e.prototype,"_nbHashes",void 0),__decorate$a([exportable_1$a.Field(),__metadata$a("design:type",Array)],e.prototype,"_filter",void 0),__decorate$a([exportable_1$a.Field(),__metadata$a("design:type",Number)],e.prototype,"_length",void 0),e=t=__decorate$a([exportable_1$a.AutoExportable("BloomFilter",["_seed"]),__param$8(0,exportable_1$a.Parameter("_size")),__param$8(1,exportable_1$a.Parameter("_nbHashes")),__metadata$a("design:paramtypes",[Number,Number])],e),e}(base_filter_1$9.default);bloomFilter.default=BloomFilter$1;var countingBloomFilter={},__extends$8=commonjsGlobal&&commonjsGlobal.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)o.hasOwnProperty(s)&&(n[s]=o[s])},r(e,t)};return function(e,t){r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),__decorate$9=commonjsGlobal&&commonjsGlobal.__decorate||function(r,e,t,n){var o=arguments.length,s=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,n);else for(var f=r.length-1;f>=0;f--)(u=r[f])&&(s=(o<3?u(s):o>3?u(e,t,s):u(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},__metadata$9=commonjsGlobal&&commonjsGlobal.__metadata||function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$7=commonjsGlobal&&commonjsGlobal.__param||function(r,e){return function(t,n){e(t,n,r)}},__importDefault$9=commonjsGlobal&&commonjsGlobal.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(countingBloomFilter,"__esModule",{value:!0});var base_filter_1$8=__importDefault$9(baseFilter),exportable_1$9=exportable,formulas_1$1=formulas,utils_1$7=utils$3,CountingBloomFilter=function(r){__extends$8(e,r);function e(n,o){var s=r.call(this)||this;if(o<1)throw new Error("A CountingBloomFilter must used at least one hash function, but you tried to use "+o+" functions. Consider increasing it.");return s._size=n,s._nbHashes=o,s._filter=utils_1$7.allocateArray(s._size,function(){return[0,0]}),s._length=0,s}t=e,e.create=function(n,o){var s=formulas_1$1.optimalFilterSize(n,o);return new t(s,formulas_1$1.optimalHashes(s,n))},e.from=function(n,o){var s=Array.from(n),u=t.create(s.length,o);return s.forEach(function(f){return u.add(f)}),u},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),e.prototype.add=function(n){for(var o=utils_1$7.getDistinctIndices(n,this._size,this._nbHashes,this.seed),s=0;s<o.length;s++)this._filter[o[s]][1]+=1,this._filter[o[s]][1]>0&&(this._filter[o[s]][0]=1);this._length++},e.prototype.remove=function(n){for(var o=utils_1$7.getDistinctIndices(n,this._size,this._nbHashes,this.seed),s=!0,u=0;u<o.length;u++)this._filter[o[u]][1]-=1,this._filter[o[u]][1]<=0&&(this._filter[o[u]][0]=0);return this._length--,s},e.prototype.has=function(n){for(var o=utils_1$7.getDistinctIndices(n,this._size,this._nbHashes,this.seed),s=0;s<o.length;s++)if(!this._filter[o[s]][0])return!1;return!0},e.prototype.rate=function(){return Math.pow(1-Math.exp(-this._nbHashes*this._length/this._size),this._nbHashes)},e.prototype.equals=function(n){return this._size!==n._size||this._nbHashes!==n._nbHashes||this._length!==n._length?!1:this._filter.every(function(o,s){return n._filter[s][0]===o[0]&&n._filter[s][1]===o[1]})};var t;return __decorate$9([exportable_1$9.Field(),__metadata$9("design:type",Number)],e.prototype,"_size",void 0),__decorate$9([exportable_1$9.Field(),__metadata$9("design:type",Number)],e.prototype,"_nbHashes",void 0),__decorate$9([exportable_1$9.Field(),__metadata$9("design:type",Array)],e.prototype,"_filter",void 0),__decorate$9([exportable_1$9.Field(),__metadata$9("design:type",Number)],e.prototype,"_length",void 0),e=t=__decorate$9([exportable_1$9.AutoExportable("CountingBloomFilter",["_seed"]),__param$7(0,exportable_1$9.Parameter("_size")),__param$7(1,exportable_1$9.Parameter("_nbHashes")),__metadata$9("design:paramtypes",[Number,Number])],e),e}(base_filter_1$8.default);countingBloomFilter.default=CountingBloomFilter;var partitionedBloomFilter={},__extends$7=commonjsGlobal&&commonjsGlobal.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)o.hasOwnProperty(s)&&(n[s]=o[s])},r(e,t)};return function(e,t){r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),__decorate$8=commonjsGlobal&&commonjsGlobal.__decorate||function(r,e,t,n){var o=arguments.length,s=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,n);else for(var f=r.length-1;f>=0;f--)(u=r[f])&&(s=(o<3?u(s):o>3?u(e,t,s):u(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},__metadata$8=commonjsGlobal&&commonjsGlobal.__metadata||function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$6=commonjsGlobal&&commonjsGlobal.__param||function(r,e){return function(t,n){e(t,n,r)}},__importDefault$8=commonjsGlobal&&commonjsGlobal.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(partitionedBloomFilter,"__esModule",{value:!0});var base_filter_1$7=__importDefault$8(baseFilter),exportable_1$8=exportable,utils_1$6=utils$3;function computeOptimalNumberOfhashes(r,e){return Math.ceil(Math.log(r)/Math.log(e))}function computeOptimalNumberOfCells(r,e,t){return Math.ceil(r*-Math.log(e)/(Math.log(t)*Math.log(1-t)))}function computeNumberOfItems(r,e,t){return Math.ceil(r*(Math.log(e)*Math.log(1-e))/-(t*Math.log(e)))}var PartitionedBloomFilter=function(r){__extends$7(e,r);function e(n,o,s,u){var f=r.call(this)||this;return f._size=n,f._nbHashes=o,f._loadFactor=s,f._m=Math.ceil(f._size/f._nbHashes),f._filter=utils_1$6.allocateArray(f._nbHashes,function(){return utils_1$6.allocateArray(f._m,0)}),f._capacity=u!==void 0?u:computeNumberOfItems(f._size,s,o),f._length=0,f}t=e,e.create=function(n,o,s){s===void 0&&(s=.5);var u=computeOptimalNumberOfCells(n,o,s),f=computeOptimalNumberOfhashes(o,s);return new t(u,f,s,n)},e.from=function(n,o,s){s===void 0&&(s=.5);var u=Array.from(n),f=t.create(u.length,o,s);return u.forEach(function(l){return f.add(l)}),f},Object.defineProperty(e.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadFactor",{get:function(){return this._loadFactor},enumerable:!0,configurable:!0}),e.prototype.add=function(n){for(var o=utils_1$6.getIndices(n,this._m,this._nbHashes,this.seed),s=0;s<this._nbHashes;s++)this._filter[s][o[s]]=1;this._length++},e.prototype.has=function(n){for(var o=utils_1$6.getIndices(n,this._m,this._nbHashes,this.seed),s=0;s<this._nbHashes;s++)if(!this._filter[s][o[s]])return!1;return!0},e.prototype.rate=function(){var n=this._currentload();return Math.pow(n,this._nbHashes)},e.prototype.equals=function(n){return this._size!==n._size||this._nbHashes!==n._nbHashes||this._length!==n._length||this._loadFactor!==n._loadFactor?!1:this._filter.every(function(o,s){return n._filter[s].every(function(u,f){return o[f]===u})})},e.prototype._currentload=function(){var n=this._filter.map(function(s){return s.reduce(function(u,f){return u+f},0)}),o=n.reduce(function(s,u){return s+u},0);return o/this._size};var t;return __decorate$8([exportable_1$8.Field(),__metadata$8("design:type",Number)],e.prototype,"_size",void 0),__decorate$8([exportable_1$8.Field(),__metadata$8("design:type",Number)],e.prototype,"_nbHashes",void 0),__decorate$8([exportable_1$8.Field(),__metadata$8("design:type",Number)],e.prototype,"_loadFactor",void 0),__decorate$8([exportable_1$8.Field(),__metadata$8("design:type",Number)],e.prototype,"_m",void 0),__decorate$8([exportable_1$8.Field(),__metadata$8("design:type",Array)],e.prototype,"_filter",void 0),__decorate$8([exportable_1$8.Field(),__metadata$8("design:type",Number)],e.prototype,"_capacity",void 0),__decorate$8([exportable_1$8.Field(),__metadata$8("design:type",Number)],e.prototype,"_length",void 0),e=t=__decorate$8([exportable_1$8.AutoExportable("PartitionedBloomFilter",["_seed"]),__param$6(0,exportable_1$8.Parameter("_size")),__param$6(1,exportable_1$8.Parameter("_nbHashes")),__param$6(2,exportable_1$8.Parameter("_loadFactor")),__param$6(3,exportable_1$8.Parameter("_capacity")),__metadata$8("design:paramtypes",[Number,Number,Number,Number])],e),e}(base_filter_1$7.default);partitionedBloomFilter.default=PartitionedBloomFilter;var countMinSketch={},__extends$6=commonjsGlobal&&commonjsGlobal.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)o.hasOwnProperty(s)&&(n[s]=o[s])},r(e,t)};return function(e,t){r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),__decorate$7=commonjsGlobal&&commonjsGlobal.__decorate||function(r,e,t,n){var o=arguments.length,s=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,n);else for(var f=r.length-1;f>=0;f--)(u=r[f])&&(s=(o<3?u(s):o>3?u(e,t,s):u(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},__metadata$7=commonjsGlobal&&commonjsGlobal.__metadata||function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$5=commonjsGlobal&&commonjsGlobal.__param||function(r,e){return function(t,n){e(t,n,r)}},__values=commonjsGlobal&&commonjsGlobal.__values||function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},__importDefault$7=commonjsGlobal&&commonjsGlobal.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(countMinSketch,"__esModule",{value:!0});var base_filter_1$6=__importDefault$7(baseFilter),exportable_1$7=exportable,utils_1$5=utils$3,CountMinSketch=function(r){__extends$6(e,r);function e(n,o){var s=r.call(this)||this;return s._columns=n,s._rows=o,s._matrix=utils_1$5.allocateArray(s._rows,function(){return utils_1$5.allocateArray(s._columns,0)}),s._allSums=0,s}t=e,e.create=function(n,o){o===void 0&&(o=.999);var s=Math.ceil(Math.E/n),u=Math.ceil(Math.log(1/o));return new t(s,u)},e.from=function(n,o,s){var u,f;s===void 0&&(s=.999);var l=t.create(o,s);try{for(var h=__values(n),p=h.next();!p.done;p=h.next()){var m=p.value;l.update(m)}}catch(b){u={error:b}}finally{try{p&&!p.done&&(f=h.return)&&f.call(h)}finally{if(u)throw u.error}}return l},Object.defineProperty(e.prototype,"columns",{get:function(){return this._columns},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rows",{get:function(){return this._rows},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sum",{get:function(){return this._allSums},enumerable:!0,configurable:!0}),e.prototype.update=function(n,o){o===void 0&&(o=1),this._allSums+=o;for(var s=utils_1$5.getDistinctIndices(n,this._columns,this._rows,this.seed),u=0;u<this._rows;u++)this._matrix[u][s[u]]+=o},e.prototype.count=function(n){for(var o=1/0,s=utils_1$5.getDistinctIndices(n,this._columns,this._rows,this.seed),u=0;u<this._rows;u++){var f=this._matrix[u][s[u]];o=Math.min(f,o)}return o},e.prototype.equals=function(n){if(this._columns!==n._columns||this._rows!==n._rows)return!1;for(var o=0;o<this._rows;o++)for(var s=0;s<this._columns;s++)if(this._matrix[o][s]!==n._matrix[o][s])return!1;return!0},e.prototype.merge=function(n){if(this._columns!==n._columns)throw new Error("Cannot merge two sketches with different number of columns");if(this._rows!==n._rows)throw new Error("Cannot merge two sketches with different number of rows");for(var o=0;o<this._rows;o++)for(var s=0;s<this._columns;s++)this._matrix[o][s]+=n._matrix[o][s]},e.prototype.clone=function(){var n=new t(this._columns,this._rows);return n.merge(this),n.seed=this.seed,n};var t;return __decorate$7([exportable_1$7.Field(),__metadata$7("design:type",Number)],e.prototype,"_columns",void 0),__decorate$7([exportable_1$7.Field(),__metadata$7("design:type",Number)],e.prototype,"_rows",void 0),__decorate$7([exportable_1$7.Field(),__metadata$7("design:type",Array)],e.prototype,"_matrix",void 0),__decorate$7([exportable_1$7.Field(),__metadata$7("design:type",Number)],e.prototype,"_allSums",void 0),e=t=__decorate$7([exportable_1$7.AutoExportable("CountMinSketch",["_seed"]),__param$5(0,exportable_1$7.Parameter("_columns")),__param$5(1,exportable_1$7.Parameter("_rows")),__metadata$7("design:paramtypes",[Number,Number])],e),e}(base_filter_1$6.default);countMinSketch.default=CountMinSketch;var hyperloglog={},__extends$5=commonjsGlobal&&commonjsGlobal.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)o.hasOwnProperty(s)&&(n[s]=o[s])},r(e,t)};return function(e,t){r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),__decorate$6=commonjsGlobal&&commonjsGlobal.__decorate||function(r,e,t,n){var o=arguments.length,s=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,n);else for(var f=r.length-1;f>=0;f--)(u=r[f])&&(s=(o<3?u(s):o>3?u(e,t,s):u(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},__metadata$6=commonjsGlobal&&commonjsGlobal.__metadata||function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$4=commonjsGlobal&&commonjsGlobal.__param||function(r,e){return function(t,n){e(t,n,r)}},__importDefault$6=commonjsGlobal&&commonjsGlobal.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(hyperloglog,"__esModule",{value:!0});var base_filter_1$5=__importDefault$6(baseFilter),exportable_1$6=exportable,utils_1$4=utils$3,TWO_POW_32=Math.pow(2,32);function computeAlpha(r){switch(r){case 16:return .673;case 32:return .697;case 64:return .709;default:return .7213/(1+1.079/r)}}var HyperLogLog=function(r){__extends$5(e,r);function e(n){var o=r.call(this)||this;return o._nbRegisters=n,o._nbBytesPerHash=Math.round(Math.log2(n)),o._correctionBias=computeAlpha(n),o._registers=utils_1$4.allocateArray(o._nbRegisters,0),o}t=e,Object.defineProperty(e.prototype,"nbRegisters",{get:function(){return this._nbRegisters},enumerable:!0,configurable:!0}),e.prototype.update=function(n){for(var o=utils_1$4.hashAsInt(n,this.seed).toString(2),s=1+parseInt(o.slice(0,this._nbBytesPerHash-1),2),u=o.slice(this._nbBytesPerHash),f=0;u[f]!=="1"&&f<u.length-1;)f++;this._registers[s]=Math.max(this._registers[s],f)},e.prototype.count=function(n){n===void 0&&(n=!1);var o=this._registers.reduce(function(u,f){return u+Math.pow(2,-f)},0),s=this._correctionBias*Math.pow(this._nbRegisters,2)/o;return s>TWO_POW_32/30&&(s=-TWO_POW_32*Math.log(1-s/TWO_POW_32)),n&&(s=Math.round(s)),s},e.prototype.accuracy=function(){return 1.04/Math.sqrt(this._nbRegisters)},e.prototype.merge=function(n){if(this.nbRegisters!==n.nbRegisters)throw new Error("Two HyperLogLog must have the same number of registers to be merged. Tried to merge two HyperLogLog with m = "+this.nbRegisters+" and m = "+n.nbRegisters);for(var o=new t(this.nbRegisters),s=0;s<this.nbRegisters-1;s++)o._registers[s]=Math.max(this._registers[s],n._registers[s]);return o},e.prototype.equals=function(n){if(this.nbRegisters!==n.nbRegisters)return!1;for(var o=0;o<this.nbRegisters-1;o++)if(this._registers[o]!==n._registers[o])return!1;return!0};var t;return __decorate$6([exportable_1$6.Field(),__metadata$6("design:type",Number)],e.prototype,"_nbRegisters",void 0),__decorate$6([exportable_1$6.Field(),__metadata$6("design:type",Number)],e.prototype,"_nbBytesPerHash",void 0),__decorate$6([exportable_1$6.Field(),__metadata$6("design:type",Number)],e.prototype,"_correctionBias",void 0),__decorate$6([exportable_1$6.Field(),__metadata$6("design:type",Array)],e.prototype,"_registers",void 0),e=t=__decorate$6([exportable_1$6.AutoExportable("HyperLogLog",["_seed"]),__param$4(0,exportable_1$6.Parameter("_nbRegisters")),__metadata$6("design:paramtypes",[Number])],e),e}(base_filter_1$5.default);hyperloglog.default=HyperLogLog;var topk={},lodashExports={},lodash={get exports(){return lodashExports},set exports(r){lodashExports=r}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(r,e){(function(){var t,n="4.17.21",o=200,s="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",u="Expected a function",f="Invalid `variable` option passed into `_.template`",l="__lodash_hash_undefined__",h=500,p="__lodash_placeholder__",m=1,b=2,S=4,A=1,L=2,J=1,ne=2,pe=4,de=8,H=16,z=32,ue=64,ce=128,Ee=256,Be=512,ot=30,nt="...",st=800,_t=16,ht=1,Lt=2,At=3,Mt=1/0,Nt=9007199254740991,pr=17976931348623157e292,_r=0/0,Me=4294967295,xt=Me-1,Vt=Me>>>1,pt=[["ary",ce],["bind",J],["bindKey",ne],["curry",de],["curryRight",H],["flip",Be],["partial",z],["partialRight",ue],["rearg",Ee]],Ze="[object Arguments]",Ft="[object Array]",jr="[object AsyncFunction]",Yt="[object Boolean]",kt="[object Date]",wr="[object DOMException]",nr="[object Error]",ar="[object Function]",fr="[object GeneratorFunction]",Rt="[object Map]",qt="[object Number]",Jr="[object Null]",zt="[object Object]",br="[object Promise]",Jt="[object Proxy]",Xt="[object RegExp]",Dt="[object Set]",It="[object String]",Zt="[object Symbol]",X="[object Undefined]",se="[object WeakMap]",we="[object WeakSet]",x="[object ArrayBuffer]",g="[object DataView]",w="[object Float32Array]",O="[object Float64Array]",U="[object Int8Array]",W="[object Int16Array]",te="[object Int32Array]",$e="[object Uint8Array]",tt="[object Uint8ClampedArray]",ct="[object Uint16Array]",wt="[object Uint32Array]",lt=/\b__p \+= '';/g,Xr=/\b(__p \+=) '' \+/g,vr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,wn=/&(?:amp|lt|gt|quot|#39);/g,Dn=/[&<>"']/g,In=RegExp(wn.source),Ar=RegExp(Dn.source),Kr=/<%-([\s\S]+?)%>/g,Vr=/<%([\s\S]+?)%>/g,cn=/<%=([\s\S]+?)%>/g,bn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Pn=/^\w*$/,Vn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,er=/[\\^$.*+?()[\]{}|]/g,On=RegExp(er.source),v=/^\s+/,T=/\s/,k=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,y=/\{\n\/\* \[wrapped with (.+)\] \*/,B=/,? & /,Q=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Z=/[()=,{}\[\]\/\s]/,ye=/\\(\\)?/g,xe=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Le=/\w*$/,Ce=/^[-+]0x[0-9a-f]+$/i,yt=/^0b[01]+$/i,Ie=/^\[object .+?Constructor\]$/,Ge=/^0o[0-7]+$/i,Qe=/^(?:0|[1-9]\d*)$/,et=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ye=/($^)/,We=/['\n\r\u2028\u2029\\]/g,je="\\ud800-\\udfff",He="\\u0300-\\u036f",De="\\ufe20-\\ufe2f",Ne="\\u20d0-\\u20ff",Se=He+De+Ne,Pe="\\u2700-\\u27bf",Fe="a-z\\xdf-\\xf6\\xf8-\\xff",Ae="\\xac\\xb1\\xd7\\xf7",re="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ie="\\u2000-\\u206f",_e=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",E="A-Z\\xc0-\\xd6\\xd8-\\xde",P="\\ufe0e\\ufe0f",C=Ae+re+ie+_e,M="['’]",K="["+je+"]",j="["+C+"]",ee="["+Se+"]",I="\\d+",ae="["+Pe+"]",fe="["+Fe+"]",he="[^"+je+C+I+Pe+Fe+E+"]",be="\\ud83c[\\udffb-\\udfff]",ke="(?:"+ee+"|"+be+")",Oe="[^"+je+"]",Ke="(?:\\ud83c[\\udde6-\\uddff]){2}",ze="[\\ud800-\\udbff][\\udc00-\\udfff]",Ve="["+E+"]",dt="\\u200d",vt="(?:"+fe+"|"+he+")",Pt="(?:"+Ve+"|"+he+")",Gt="(?:"+M+"(?:d|ll|m|re|s|t|ve))?",Ut="(?:"+M+"(?:D|LL|M|RE|S|T|VE))?",Qt=ke+"?",fi="["+P+"]?",Ji="(?:"+dt+"(?:"+[Oe,Ke,ze].join("|")+")"+fi+Qt+")*",li="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",_u="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",as=fi+Qt+Ji,wu="(?:"+[ae,Ke,ze].join("|")+")"+as,bu="(?:"+[Oe+ee+"?",ee,Ke,ze,K].join("|")+")",vu=RegExp(M,"g"),Eu=RegExp(ee,"g"),Xi=RegExp(be+"(?="+be+")|"+bu+as,"g"),xu=RegExp([Ve+"?"+fe+"+"+Gt+"(?="+[j,Ve,"$"].join("|")+")",Pt+"+"+Ut+"(?="+[j,Ve+vt,"$"].join("|")+")",Ve+"?"+vt+"+"+Gt,Ve+"+"+Ut,_u,li,I,wu].join("|"),"g"),$u=RegExp("["+dt+je+Se+P+"]"),Su=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Au=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Cu=-1,Ot={};Ot[w]=Ot[O]=Ot[U]=Ot[W]=Ot[te]=Ot[$e]=Ot[tt]=Ot[ct]=Ot[wt]=!0,Ot[Ze]=Ot[Ft]=Ot[x]=Ot[Yt]=Ot[g]=Ot[kt]=Ot[nr]=Ot[ar]=Ot[Rt]=Ot[qt]=Ot[zt]=Ot[Xt]=Ot[Dt]=Ot[It]=Ot[se]=!1;var Tt={};Tt[Ze]=Tt[Ft]=Tt[x]=Tt[g]=Tt[Yt]=Tt[kt]=Tt[w]=Tt[O]=Tt[U]=Tt[W]=Tt[te]=Tt[Rt]=Tt[qt]=Tt[zt]=Tt[Xt]=Tt[Dt]=Tt[It]=Tt[Zt]=Tt[$e]=Tt[tt]=Tt[ct]=Tt[wt]=!0,Tt[nr]=Tt[ar]=Tt[se]=!1;var ku={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},Tu={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Du={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Iu={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Pu=parseFloat,Ou=parseInt,us=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,Fu=typeof self=="object"&&self&&self.Object===Object&&self,ur=us||Fu||Function("return this")(),Zi=e&&!e.nodeType&&e,vn=Zi&&!0&&r&&!r.nodeType&&r,cs=vn&&vn.exports===Zi,eo=cs&&us.process,Or=function(){try{var q=vn&&vn.require&&vn.require("util").types;return q||eo&&eo.binding&&eo.binding("util")}catch{}}(),fs=Or&&Or.isArrayBuffer,ls=Or&&Or.isDate,ds=Or&&Or.isMap,hs=Or&&Or.isRegExp,ps=Or&&Or.isSet,ys=Or&&Or.isTypedArray;function Cr(q,le,oe){switch(oe.length){case 0:return q.call(le);case 1:return q.call(le,oe[0]);case 2:return q.call(le,oe[0],oe[1]);case 3:return q.call(le,oe[0],oe[1],oe[2])}return q.apply(le,oe)}function Ru(q,le,oe,Re){for(var rt=-1,Et=q==null?0:q.length;++rt<Et;){var tr=q[rt];le(Re,tr,oe(tr),q)}return Re}function Fr(q,le){for(var oe=-1,Re=q==null?0:q.length;++oe<Re&&le(q[oe],oe,q)!==!1;);return q}function Bu(q,le){for(var oe=q==null?0:q.length;oe--&&le(q[oe],oe,q)!==!1;);return q}function gs(q,le){for(var oe=-1,Re=q==null?0:q.length;++oe<Re;)if(!le(q[oe],oe,q))return!1;return!0}function fn(q,le){for(var oe=-1,Re=q==null?0:q.length,rt=0,Et=[];++oe<Re;){var tr=q[oe];le(tr,oe,q)&&(Et[rt++]=tr)}return Et}function di(q,le){var oe=q==null?0:q.length;return!!oe&&Fn(q,le,0)>-1}function to(q,le,oe){for(var Re=-1,rt=q==null?0:q.length;++Re<rt;)if(oe(le,q[Re]))return!0;return!1}function Bt(q,le){for(var oe=-1,Re=q==null?0:q.length,rt=Array(Re);++oe<Re;)rt[oe]=le(q[oe],oe,q);return rt}function ln(q,le){for(var oe=-1,Re=le.length,rt=q.length;++oe<Re;)q[rt+oe]=le[oe];return q}function ro(q,le,oe,Re){var rt=-1,Et=q==null?0:q.length;for(Re&&Et&&(oe=q[++rt]);++rt<Et;)oe=le(oe,q[rt],rt,q);return oe}function Lu(q,le,oe,Re){var rt=q==null?0:q.length;for(Re&&rt&&(oe=q[--rt]);rt--;)oe=le(oe,q[rt],rt,q);return oe}function no(q,le){for(var oe=-1,Re=q==null?0:q.length;++oe<Re;)if(le(q[oe],oe,q))return!0;return!1}var Mu=io("length");function Nu(q){return q.split("")}function Uu(q){return q.match(Q)||[]}function _s(q,le,oe){var Re;return oe(q,function(rt,Et,tr){if(le(rt,Et,tr))return Re=Et,!1}),Re}function hi(q,le,oe,Re){for(var rt=q.length,Et=oe+(Re?1:-1);Re?Et--:++Et<rt;)if(le(q[Et],Et,q))return Et;return-1}function Fn(q,le,oe){return le===le?Xu(q,le,oe):hi(q,ws,oe)}function ju(q,le,oe,Re){for(var rt=oe-1,Et=q.length;++rt<Et;)if(Re(q[rt],le))return rt;return-1}function ws(q){return q!==q}function bs(q,le){var oe=q==null?0:q.length;return oe?so(q,le)/oe:_r}function io(q){return function(le){return le==null?t:le[q]}}function oo(q){return function(le){return q==null?t:q[le]}}function vs(q,le,oe,Re,rt){return rt(q,function(Et,tr,Ct){oe=Re?(Re=!1,Et):le(oe,Et,tr,Ct)}),oe}function Ku(q,le){var oe=q.length;for(q.sort(le);oe--;)q[oe]=q[oe].value;return q}function so(q,le){for(var oe,Re=-1,rt=q.length;++Re<rt;){var Et=le(q[Re]);Et!==t&&(oe=oe===t?Et:oe+Et)}return oe}function ao(q,le){for(var oe=-1,Re=Array(q);++oe<q;)Re[oe]=le(oe);return Re}function zu(q,le){return Bt(le,function(oe){return[oe,q[oe]]})}function Es(q){return q&&q.slice(0,As(q)+1).replace(v,"")}function kr(q){return function(le){return q(le)}}function uo(q,le){return Bt(le,function(oe){return q[oe]})}function qn(q,le){return q.has(le)}function xs(q,le){for(var oe=-1,Re=q.length;++oe<Re&&Fn(le,q[oe],0)>-1;);return oe}function $s(q,le){for(var oe=q.length;oe--&&Fn(le,q[oe],0)>-1;);return oe}function Gu(q,le){for(var oe=q.length,Re=0;oe--;)q[oe]===le&&++Re;return Re}var Wu=oo(ku),Hu=oo(Tu);function Vu(q){return"\\"+Iu[q]}function qu(q,le){return q==null?t:q[le]}function Rn(q){return $u.test(q)}function Qu(q){return Su.test(q)}function Yu(q){for(var le,oe=[];!(le=q.next()).done;)oe.push(le.value);return oe}function co(q){var le=-1,oe=Array(q.size);return q.forEach(function(Re,rt){oe[++le]=[rt,Re]}),oe}function Ss(q,le){return function(oe){return q(le(oe))}}function dn(q,le){for(var oe=-1,Re=q.length,rt=0,Et=[];++oe<Re;){var tr=q[oe];(tr===le||tr===p)&&(q[oe]=p,Et[rt++]=oe)}return Et}function pi(q){var le=-1,oe=Array(q.size);return q.forEach(function(Re){oe[++le]=Re}),oe}function Ju(q){var le=-1,oe=Array(q.size);return q.forEach(function(Re){oe[++le]=[Re,Re]}),oe}function Xu(q,le,oe){for(var Re=oe-1,rt=q.length;++Re<rt;)if(q[Re]===le)return Re;return-1}function Zu(q,le,oe){for(var Re=oe+1;Re--;)if(q[Re]===le)return Re;return Re}function Bn(q){return Rn(q)?tc(q):Mu(q)}function zr(q){return Rn(q)?rc(q):Nu(q)}function As(q){for(var le=q.length;le--&&T.test(q.charAt(le)););return le}var ec=oo(Du);function tc(q){for(var le=Xi.lastIndex=0;Xi.test(q);)++le;return le}function rc(q){return q.match(Xi)||[]}function nc(q){return q.match(xu)||[]}var ic=function q(le){le=le==null?ur:Ln.defaults(ur.Object(),le,Ln.pick(ur,Au));var oe=le.Array,Re=le.Date,rt=le.Error,Et=le.Function,tr=le.Math,Ct=le.Object,fo=le.RegExp,oc=le.String,Rr=le.TypeError,yi=oe.prototype,sc=Et.prototype,Mn=Ct.prototype,mi=le["__core-js_shared__"],gi=sc.toString,St=Mn.hasOwnProperty,ac=0,Cs=function(){var a=/[^.]+$/.exec(mi&&mi.keys&&mi.keys.IE_PROTO||"");return a?"Symbol(src)_1."+a:""}(),_i=Mn.toString,uc=gi.call(Ct),cc=ur._,fc=fo("^"+gi.call(St).replace(er,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),wi=cs?le.Buffer:t,hn=le.Symbol,bi=le.Uint8Array,ks=wi?wi.allocUnsafe:t,vi=Ss(Ct.getPrototypeOf,Ct),Ts=Ct.create,Ds=Mn.propertyIsEnumerable,Ei=yi.splice,Is=hn?hn.isConcatSpreadable:t,Qn=hn?hn.iterator:t,En=hn?hn.toStringTag:t,xi=function(){try{var a=Cn(Ct,"defineProperty");return a({},"",{}),a}catch{}}(),lc=le.clearTimeout!==ur.clearTimeout&&le.clearTimeout,dc=Re&&Re.now!==ur.Date.now&&Re.now,hc=le.setTimeout!==ur.setTimeout&&le.setTimeout,$i=tr.ceil,Si=tr.floor,lo=Ct.getOwnPropertySymbols,pc=wi?wi.isBuffer:t,Ps=le.isFinite,yc=yi.join,mc=Ss(Ct.keys,Ct),rr=tr.max,lr=tr.min,_c=Re.now,wc=le.parseInt,Os=tr.random,bc=yi.reverse,ho=Cn(le,"DataView"),Yn=Cn(le,"Map"),po=Cn(le,"Promise"),Nn=Cn(le,"Set"),Jn=Cn(le,"WeakMap"),Xn=Cn(Ct,"create"),Ai=Jn&&new Jn,Un={},vc=kn(ho),Ec=kn(Yn),xc=kn(po),$c=kn(Nn),Sc=kn(Jn),Ci=hn?hn.prototype:t,Zn=Ci?Ci.valueOf:t,Fs=Ci?Ci.toString:t;function D(a){if(Kt(a)&&!it(a)&&!(a instanceof gt)){if(a instanceof Br)return a;if(St.call(a,"__wrapped__"))return Ba(a)}return new Br(a)}var jn=function(){function a(){}return function(c){if(!jt(c))return{};if(Ts)return Ts(c);a.prototype=c;var d=new a;return a.prototype=t,d}}();function ki(){}function Br(a,c){this.__wrapped__=a,this.__actions__=[],this.__chain__=!!c,this.__index__=0,this.__values__=t}D.templateSettings={escape:Kr,evaluate:Vr,interpolate:cn,variable:"",imports:{_:D}},D.prototype=ki.prototype,D.prototype.constructor=D,Br.prototype=jn(ki.prototype),Br.prototype.constructor=Br;function gt(a){this.__wrapped__=a,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Me,this.__views__=[]}function Ac(){var a=new gt(this.__wrapped__);return a.__actions__=Er(this.__actions__),a.__dir__=this.__dir__,a.__filtered__=this.__filtered__,a.__iteratees__=Er(this.__iteratees__),a.__takeCount__=this.__takeCount__,a.__views__=Er(this.__views__),a}function Cc(){if(this.__filtered__){var a=new gt(this);a.__dir__=-1,a.__filtered__=!0}else a=this.clone(),a.__dir__*=-1;return a}function kc(){var a=this.__wrapped__.value(),c=this.__dir__,d=it(a),_=c<0,$=d?a.length:0,F=jf(0,$,this.__views__),N=F.start,G=F.end,Y=G-N,me=_?G:N-1,ge=this.__iteratees__,ve=ge.length,Te=0,Ue=lr(Y,this.__takeCount__);if(!d||!_&&$==Y&&Ue==Y)return ia(a,this.__actions__);var Je=[];e:for(;Y--&&Te<Ue;){me+=c;for(var ut=-1,Xe=a[me];++ut<ve;){var mt=ge[ut],bt=mt.iteratee,Ir=mt.type,gr=bt(Xe);if(Ir==Lt)Xe=gr;else if(!gr){if(Ir==ht)continue e;break e}}Je[Te++]=Xe}return Je}gt.prototype=jn(ki.prototype),gt.prototype.constructor=gt;function xn(a){var c=-1,d=a==null?0:a.length;for(this.clear();++c<d;){var _=a[c];this.set(_[0],_[1])}}function Tc(){this.__data__=Xn?Xn(null):{},this.size=0}function Dc(a){var c=this.has(a)&&delete this.__data__[a];return this.size-=c?1:0,c}function Ic(a){var c=this.__data__;if(Xn){var d=c[a];return d===l?t:d}return St.call(c,a)?c[a]:t}function Pc(a){var c=this.__data__;return Xn?c[a]!==t:St.call(c,a)}function Oc(a,c){var d=this.__data__;return this.size+=this.has(a)?0:1,d[a]=Xn&&c===t?l:c,this}xn.prototype.clear=Tc,xn.prototype.delete=Dc,xn.prototype.get=Ic,xn.prototype.has=Pc,xn.prototype.set=Oc;function Zr(a){var c=-1,d=a==null?0:a.length;for(this.clear();++c<d;){var _=a[c];this.set(_[0],_[1])}}function Fc(){this.__data__=[],this.size=0}function Rc(a){var c=this.__data__,d=Ti(c,a);if(d<0)return!1;var _=c.length-1;return d==_?c.pop():Ei.call(c,d,1),--this.size,!0}function Bc(a){var c=this.__data__,d=Ti(c,a);return d<0?t:c[d][1]}function Lc(a){return Ti(this.__data__,a)>-1}function Mc(a,c){var d=this.__data__,_=Ti(d,a);return _<0?(++this.size,d.push([a,c])):d[_][1]=c,this}Zr.prototype.clear=Fc,Zr.prototype.delete=Rc,Zr.prototype.get=Bc,Zr.prototype.has=Lc,Zr.prototype.set=Mc;function en(a){var c=-1,d=a==null?0:a.length;for(this.clear();++c<d;){var _=a[c];this.set(_[0],_[1])}}function Nc(){this.size=0,this.__data__={hash:new xn,map:new(Yn||Zr),string:new xn}}function Uc(a){var c=ji(this,a).delete(a);return this.size-=c?1:0,c}function jc(a){return ji(this,a).get(a)}function Kc(a){return ji(this,a).has(a)}function zc(a,c){var d=ji(this,a),_=d.size;return d.set(a,c),this.size+=d.size==_?0:1,this}en.prototype.clear=Nc,en.prototype.delete=Uc,en.prototype.get=jc,en.prototype.has=Kc,en.prototype.set=zc;function $n(a){var c=-1,d=a==null?0:a.length;for(this.__data__=new en;++c<d;)this.add(a[c])}function Gc(a){return this.__data__.set(a,l),this}function Wc(a){return this.__data__.has(a)}$n.prototype.add=$n.prototype.push=Gc,$n.prototype.has=Wc;function Gr(a){var c=this.__data__=new Zr(a);this.size=c.size}function Hc(){this.__data__=new Zr,this.size=0}function Vc(a){var c=this.__data__,d=c.delete(a);return this.size=c.size,d}function qc(a){return this.__data__.get(a)}function Qc(a){return this.__data__.has(a)}function Yc(a,c){var d=this.__data__;if(d instanceof Zr){var _=d.__data__;if(!Yn||_.length<o-1)return _.push([a,c]),this.size=++d.size,this;d=this.__data__=new en(_)}return d.set(a,c),this.size=d.size,this}Gr.prototype.clear=Hc,Gr.prototype.delete=Vc,Gr.prototype.get=qc,Gr.prototype.has=Qc,Gr.prototype.set=Yc;function Rs(a,c){var d=it(a),_=!d&&Tn(a),$=!d&&!_&&_n(a),F=!d&&!_&&!$&&Wn(a),N=d||_||$||F,G=N?ao(a.length,oc):[],Y=G.length;for(var me in a)(c||St.call(a,me))&&!(N&&(me=="length"||$&&(me=="offset"||me=="parent")||F&&(me=="buffer"||me=="byteLength"||me=="byteOffset")||on(me,Y)))&&G.push(me);return G}function Bs(a){var c=a.length;return c?a[So(0,c-1)]:t}function Jc(a,c){return Ki(Er(a),Sn(c,0,a.length))}function Xc(a){return Ki(Er(a))}function yo(a,c,d){(d!==t&&!Wr(a[c],d)||d===t&&!(c in a))&&tn(a,c,d)}function ei(a,c,d){var _=a[c];(!(St.call(a,c)&&Wr(_,d))||d===t&&!(c in a))&&tn(a,c,d)}function Ti(a,c){for(var d=a.length;d--;)if(Wr(a[d][0],c))return d;return-1}function Zc(a,c,d,_){return pn(a,function($,F,N){c(_,$,d($),N)}),_}function Ls(a,c){return a&&Qr(c,ir(c),a)}function ef(a,c){return a&&Qr(c,$r(c),a)}function tn(a,c,d){c=="__proto__"&&xi?xi(a,c,{configurable:!0,enumerable:!0,value:d,writable:!0}):a[c]=d}function mo(a,c){for(var d=-1,_=c.length,$=oe(_),F=a==null;++d<_;)$[d]=F?t:Yo(a,c[d]);return $}function Sn(a,c,d){return a===a&&(d!==t&&(a=a<=d?a:d),c!==t&&(a=a>=c?a:c)),a}function Lr(a,c,d,_,$,F){var N,G=c&m,Y=c&b,me=c&S;if(d&&(N=$?d(a,_,$,F):d(a)),N!==t)return N;if(!jt(a))return a;var ge=it(a);if(ge){if(N=zf(a),!G)return Er(a,N)}else{var ve=dr(a),Te=ve==ar||ve==fr;if(_n(a))return aa(a,G);if(ve==zt||ve==Ze||Te&&!$){if(N=Y||Te?{}:Ca(a),!G)return Y?Pf(a,ef(N,a)):If(a,Ls(N,a))}else{if(!Tt[ve])return $?a:{};N=Gf(a,ve,G)}}F||(F=new Gr);var Ue=F.get(a);if(Ue)return Ue;F.set(a,N),ru(a)?a.forEach(function(Xe){N.add(Lr(Xe,c,d,Xe,a,F))}):eu(a)&&a.forEach(function(Xe,mt){N.set(mt,Lr(Xe,c,d,mt,a,F))});var Je=me?Y?Bo:Ro:Y?$r:ir,ut=ge?t:Je(a);return Fr(ut||a,function(Xe,mt){ut&&(mt=Xe,Xe=a[mt]),ei(N,mt,Lr(Xe,c,d,mt,a,F))}),N}function tf(a){var c=ir(a);return function(d){return Ms(d,a,c)}}function Ms(a,c,d){var _=d.length;if(a==null)return!_;for(a=Ct(a);_--;){var $=d[_],F=c[$],N=a[$];if(N===t&&!($ in a)||!F(N))return!1}return!0}function Ns(a,c,d){if(typeof a!="function")throw new Rr(u);return ai(function(){a.apply(t,d)},c)}function ti(a,c,d,_){var $=-1,F=di,N=!0,G=a.length,Y=[],me=c.length;if(!G)return Y;d&&(c=Bt(c,kr(d))),_?(F=to,N=!1):c.length>=o&&(F=qn,N=!1,c=new $n(c));e:for(;++$<G;){var ge=a[$],ve=d==null?ge:d(ge);if(ge=_||ge!==0?ge:0,N&&ve===ve){for(var Te=me;Te--;)if(c[Te]===ve)continue e;Y.push(ge)}else F(c,ve,_)||Y.push(ge)}return Y}var pn=da(qr),Us=da(_o,!0);function rf(a,c){var d=!0;return pn(a,function(_,$,F){return d=!!c(_,$,F),d}),d}function Di(a,c,d){for(var _=-1,$=a.length;++_<$;){var F=a[_],N=c(F);if(N!=null&&(G===t?N===N&&!Dr(N):d(N,G)))var G=N,Y=F}return Y}function nf(a,c,d,_){var $=a.length;for(d=at(d),d<0&&(d=-d>$?0:$+d),_=_===t||_>$?$:at(_),_<0&&(_+=$),_=d>_?0:iu(_);d<_;)a[d++]=c;return a}function js(a,c){var d=[];return pn(a,function(_,$,F){c(_,$,F)&&d.push(_)}),d}function cr(a,c,d,_,$){var F=-1,N=a.length;for(d||(d=Hf),$||($=[]);++F<N;){var G=a[F];c>0&&d(G)?c>1?cr(G,c-1,d,_,$):ln($,G):_||($[$.length]=G)}return $}var go=ha(),Ks=ha(!0);function qr(a,c){return a&&go(a,c,ir)}function _o(a,c){return a&&Ks(a,c,ir)}function Ii(a,c){return fn(c,function(d){return sn(a[d])})}function An(a,c){c=mn(c,a);for(var d=0,_=c.length;a!=null&&d<_;)a=a[Yr(c[d++])];return d&&d==_?a:t}function zs(a,c,d){var _=c(a);return it(a)?_:ln(_,d(a))}function yr(a){return a==null?a===t?X:Jr:En&&En in Ct(a)?Uf(a):Zf(a)}function wo(a,c){return a>c}function of(a,c){return a!=null&&St.call(a,c)}function sf(a,c){return a!=null&&c in Ct(a)}function af(a,c,d){return a>=lr(c,d)&&a<rr(c,d)}function bo(a,c,d){for(var _=d?to:di,$=a[0].length,F=a.length,N=F,G=oe(F),Y=1/0,me=[];N--;){var ge=a[N];N&&c&&(ge=Bt(ge,kr(c))),Y=lr(ge.length,Y),G[N]=!d&&(c||$>=120&&ge.length>=120)?new $n(N&&ge):t}ge=a[0];var ve=-1,Te=G[0];e:for(;++ve<$&&me.length<Y;){var Ue=ge[ve],Je=c?c(Ue):Ue;if(Ue=d||Ue!==0?Ue:0,!(Te?qn(Te,Je):_(me,Je,d))){for(N=F;--N;){var ut=G[N];if(!(ut?qn(ut,Je):_(a[N],Je,d)))continue e}Te&&Te.push(Je),me.push(Ue)}}return me}function uf(a,c,d,_){return qr(a,function($,F,N){c(_,d($),F,N)}),_}function ri(a,c,d){c=mn(c,a),a=Ia(a,c);var _=a==null?a:a[Yr(Nr(c))];return _==null?t:Cr(_,a,d)}function Gs(a){return Kt(a)&&yr(a)==Ze}function cf(a){return Kt(a)&&yr(a)==x}function ff(a){return Kt(a)&&yr(a)==kt}function ni(a,c,d,_,$){return a===c?!0:a==null||c==null||!Kt(a)&&!Kt(c)?a!==a&&c!==c:lf(a,c,d,_,ni,$)}function lf(a,c,d,_,$,F){var N=it(a),G=it(c),Y=N?Ft:dr(a),me=G?Ft:dr(c);Y=Y==Ze?zt:Y,me=me==Ze?zt:me;var ge=Y==zt,ve=me==zt,Te=Y==me;if(Te&&_n(a)){if(!_n(c))return!1;N=!0,ge=!1}if(Te&&!ge)return F||(F=new Gr),N||Wn(a)?$a(a,c,d,_,$,F):Mf(a,c,Y,d,_,$,F);if(!(d&A)){var Ue=ge&&St.call(a,"__wrapped__"),Je=ve&&St.call(c,"__wrapped__");if(Ue||Je){var ut=Ue?a.value():a,Xe=Je?c.value():c;return F||(F=new Gr),$(ut,Xe,d,_,F)}}return Te?(F||(F=new Gr),Nf(a,c,d,_,$,F)):!1}function df(a){return Kt(a)&&dr(a)==Rt}function vo(a,c,d,_){var $=d.length,F=$,N=!_;if(a==null)return!F;for(a=Ct(a);$--;){var G=d[$];if(N&&G[2]?G[1]!==a[G[0]]:!(G[0]in a))return!1}for(;++$<F;){G=d[$];var Y=G[0],me=a[Y],ge=G[1];if(N&&G[2]){if(me===t&&!(Y in a))return!1}else{var ve=new Gr;if(_)var Te=_(me,ge,Y,a,c,ve);if(!(Te===t?ni(ge,me,A|L,_,ve):Te))return!1}}return!0}function Ws(a){if(!jt(a)||qf(a))return!1;var c=sn(a)?fc:Ie;return c.test(kn(a))}function hf(a){return Kt(a)&&yr(a)==Xt}function pf(a){return Kt(a)&&dr(a)==Dt}function yf(a){return Kt(a)&&qi(a.length)&&!!Ot[yr(a)]}function Hs(a){return typeof a=="function"?a:a==null?Sr:typeof a=="object"?it(a)?Qs(a[0],a[1]):qs(a):yu(a)}function Eo(a){if(!si(a))return mc(a);var c=[];for(var d in Ct(a))St.call(a,d)&&d!="constructor"&&c.push(d);return c}function mf(a){if(!jt(a))return Xf(a);var c=si(a),d=[];for(var _ in a)_=="constructor"&&(c||!St.call(a,_))||d.push(_);return d}function xo(a,c){return a<c}function Vs(a,c){var d=-1,_=xr(a)?oe(a.length):[];return pn(a,function($,F,N){_[++d]=c($,F,N)}),_}function qs(a){var c=Mo(a);return c.length==1&&c[0][2]?Ta(c[0][0],c[0][1]):function(d){return d===a||vo(d,a,c)}}function Qs(a,c){return Uo(a)&&ka(c)?Ta(Yr(a),c):function(d){var _=Yo(d,a);return _===t&&_===c?Jo(d,a):ni(c,_,A|L)}}function Pi(a,c,d,_,$){a!==c&&go(c,function(F,N){if($||($=new Gr),jt(F))gf(a,c,N,d,Pi,_,$);else{var G=_?_(Ko(a,N),F,N+"",a,c,$):t;G===t&&(G=F),yo(a,N,G)}},$r)}function gf(a,c,d,_,$,F,N){var G=Ko(a,d),Y=Ko(c,d),me=N.get(Y);if(me){yo(a,d,me);return}var ge=F?F(G,Y,d+"",a,c,N):t,ve=ge===t;if(ve){var Te=it(Y),Ue=!Te&&_n(Y),Je=!Te&&!Ue&&Wn(Y);ge=Y,Te||Ue||Je?it(G)?ge=G:Wt(G)?ge=Er(G):Ue?(ve=!1,ge=aa(Y,!0)):Je?(ve=!1,ge=ua(Y,!0)):ge=[]:ui(Y)||Tn(Y)?(ge=G,Tn(G)?ge=ou(G):(!jt(G)||sn(G))&&(ge=Ca(Y))):ve=!1}ve&&(N.set(Y,ge),$(ge,Y,_,F,N),N.delete(Y)),yo(a,d,ge)}function Ys(a,c){var d=a.length;if(d)return c+=c<0?d:0,on(c,d)?a[c]:t}function Js(a,c,d){c.length?c=Bt(c,function(F){return it(F)?function(N){return An(N,F.length===1?F[0]:F)}:F}):c=[Sr];var _=-1;c=Bt(c,kr(qe()));var $=Vs(a,function(F,N,G){var Y=Bt(c,function(me){return me(F)});return{criteria:Y,index:++_,value:F}});return Ku($,function(F,N){return Df(F,N,d)})}function _f(a,c){return Xs(a,c,function(d,_){return Jo(a,_)})}function Xs(a,c,d){for(var _=-1,$=c.length,F={};++_<$;){var N=c[_],G=An(a,N);d(G,N)&&ii(F,mn(N,a),G)}return F}function wf(a){return function(c){return An(c,a)}}function $o(a,c,d,_){var $=_?ju:Fn,F=-1,N=c.length,G=a;for(a===c&&(c=Er(c)),d&&(G=Bt(a,kr(d)));++F<N;)for(var Y=0,me=c[F],ge=d?d(me):me;(Y=$(G,ge,Y,_))>-1;)G!==a&&Ei.call(G,Y,1),Ei.call(a,Y,1);return a}function Zs(a,c){for(var d=a?c.length:0,_=d-1;d--;){var $=c[d];if(d==_||$!==F){var F=$;on($)?Ei.call(a,$,1):ko(a,$)}}return a}function So(a,c){return a+Si(Os()*(c-a+1))}function bf(a,c,d,_){for(var $=-1,F=rr($i((c-a)/(d||1)),0),N=oe(F);F--;)N[_?F:++$]=a,a+=d;return N}function Ao(a,c){var d="";if(!a||c<1||c>Nt)return d;do c%2&&(d+=a),c=Si(c/2),c&&(a+=a);while(c);return d}function ft(a,c){return zo(Da(a,c,Sr),a+"")}function vf(a){return Bs(Hn(a))}function Ef(a,c){var d=Hn(a);return Ki(d,Sn(c,0,d.length))}function ii(a,c,d,_){if(!jt(a))return a;c=mn(c,a);for(var $=-1,F=c.length,N=F-1,G=a;G!=null&&++$<F;){var Y=Yr(c[$]),me=d;if(Y==="__proto__"||Y==="constructor"||Y==="prototype")return a;if($!=N){var ge=G[Y];me=_?_(ge,Y,G):t,me===t&&(me=jt(ge)?ge:on(c[$+1])?[]:{})}ei(G,Y,me),G=G[Y]}return a}var ea=Ai?function(a,c){return Ai.set(a,c),a}:Sr,xf=xi?function(a,c){return xi(a,"toString",{configurable:!0,enumerable:!1,value:Zo(c),writable:!0})}:Sr;function $f(a){return Ki(Hn(a))}function Mr(a,c,d){var _=-1,$=a.length;c<0&&(c=-c>$?0:$+c),d=d>$?$:d,d<0&&(d+=$),$=c>d?0:d-c>>>0,c>>>=0;for(var F=oe($);++_<$;)F[_]=a[_+c];return F}function Sf(a,c){var d;return pn(a,function(_,$,F){return d=c(_,$,F),!d}),!!d}function Oi(a,c,d){var _=0,$=a==null?_:a.length;if(typeof c=="number"&&c===c&&$<=Vt){for(;_<$;){var F=_+$>>>1,N=a[F];N!==null&&!Dr(N)&&(d?N<=c:N<c)?_=F+1:$=F}return $}return Co(a,c,Sr,d)}function Co(a,c,d,_){var $=0,F=a==null?0:a.length;if(F===0)return 0;c=d(c);for(var N=c!==c,G=c===null,Y=Dr(c),me=c===t;$<F;){var ge=Si(($+F)/2),ve=d(a[ge]),Te=ve!==t,Ue=ve===null,Je=ve===ve,ut=Dr(ve);if(N)var Xe=_||Je;else me?Xe=Je&&(_||Te):G?Xe=Je&&Te&&(_||!Ue):Y?Xe=Je&&Te&&!Ue&&(_||!ut):Ue||ut?Xe=!1:Xe=_?ve<=c:ve<c;Xe?$=ge+1:F=ge}return lr(F,xt)}function ta(a,c){for(var d=-1,_=a.length,$=0,F=[];++d<_;){var N=a[d],G=c?c(N):N;if(!d||!Wr(G,Y)){var Y=G;F[$++]=N===0?0:N}}return F}function ra(a){return typeof a=="number"?a:Dr(a)?_r:+a}function Tr(a){if(typeof a=="string")return a;if(it(a))return Bt(a,Tr)+"";if(Dr(a))return Fs?Fs.call(a):"";var c=a+"";return c=="0"&&1/a==-Mt?"-0":c}function yn(a,c,d){var _=-1,$=di,F=a.length,N=!0,G=[],Y=G;if(d)N=!1,$=to;else if(F>=o){var me=c?null:Bf(a);if(me)return pi(me);N=!1,$=qn,Y=new $n}else Y=c?[]:G;e:for(;++_<F;){var ge=a[_],ve=c?c(ge):ge;if(ge=d||ge!==0?ge:0,N&&ve===ve){for(var Te=Y.length;Te--;)if(Y[Te]===ve)continue e;c&&Y.push(ve),G.push(ge)}else $(Y,ve,d)||(Y!==G&&Y.push(ve),G.push(ge))}return G}function ko(a,c){return c=mn(c,a),a=Ia(a,c),a==null||delete a[Yr(Nr(c))]}function na(a,c,d,_){return ii(a,c,d(An(a,c)),_)}function Fi(a,c,d,_){for(var $=a.length,F=_?$:-1;(_?F--:++F<$)&&c(a[F],F,a););return d?Mr(a,_?0:F,_?F+1:$):Mr(a,_?F+1:0,_?$:F)}function ia(a,c){var d=a;return d instanceof gt&&(d=d.value()),ro(c,function(_,$){return $.func.apply($.thisArg,ln([_],$.args))},d)}function To(a,c,d){var _=a.length;if(_<2)return _?yn(a[0]):[];for(var $=-1,F=oe(_);++$<_;)for(var N=a[$],G=-1;++G<_;)G!=$&&(F[$]=ti(F[$]||N,a[G],c,d));return yn(cr(F,1),c,d)}function oa(a,c,d){for(var _=-1,$=a.length,F=c.length,N={};++_<$;){var G=_<F?c[_]:t;d(N,a[_],G)}return N}function Do(a){return Wt(a)?a:[]}function Io(a){return typeof a=="function"?a:Sr}function mn(a,c){return it(a)?a:Uo(a,c)?[a]:Ra($t(a))}var Af=ft;function gn(a,c,d){var _=a.length;return d=d===t?_:d,!c&&d>=_?a:Mr(a,c,d)}var sa=lc||function(a){return ur.clearTimeout(a)};function aa(a,c){if(c)return a.slice();var d=a.length,_=ks?ks(d):new a.constructor(d);return a.copy(_),_}function Po(a){var c=new a.constructor(a.byteLength);return new bi(c).set(new bi(a)),c}function Cf(a,c){var d=c?Po(a.buffer):a.buffer;return new a.constructor(d,a.byteOffset,a.byteLength)}function kf(a){var c=new a.constructor(a.source,Le.exec(a));return c.lastIndex=a.lastIndex,c}function Tf(a){return Zn?Ct(Zn.call(a)):{}}function ua(a,c){var d=c?Po(a.buffer):a.buffer;return new a.constructor(d,a.byteOffset,a.length)}function ca(a,c){if(a!==c){var d=a!==t,_=a===null,$=a===a,F=Dr(a),N=c!==t,G=c===null,Y=c===c,me=Dr(c);if(!G&&!me&&!F&&a>c||F&&N&&Y&&!G&&!me||_&&N&&Y||!d&&Y||!$)return 1;if(!_&&!F&&!me&&a<c||me&&d&&$&&!_&&!F||G&&d&&$||!N&&$||!Y)return-1}return 0}function Df(a,c,d){for(var _=-1,$=a.criteria,F=c.criteria,N=$.length,G=d.length;++_<N;){var Y=ca($[_],F[_]);if(Y){if(_>=G)return Y;var me=d[_];return Y*(me=="desc"?-1:1)}}return a.index-c.index}function fa(a,c,d,_){for(var $=-1,F=a.length,N=d.length,G=-1,Y=c.length,me=rr(F-N,0),ge=oe(Y+me),ve=!_;++G<Y;)ge[G]=c[G];for(;++$<N;)(ve||$<F)&&(ge[d[$]]=a[$]);for(;me--;)ge[G++]=a[$++];return ge}function la(a,c,d,_){for(var $=-1,F=a.length,N=-1,G=d.length,Y=-1,me=c.length,ge=rr(F-G,0),ve=oe(ge+me),Te=!_;++$<ge;)ve[$]=a[$];for(var Ue=$;++Y<me;)ve[Ue+Y]=c[Y];for(;++N<G;)(Te||$<F)&&(ve[Ue+d[N]]=a[$++]);return ve}function Er(a,c){var d=-1,_=a.length;for(c||(c=oe(_));++d<_;)c[d]=a[d];return c}function Qr(a,c,d,_){var $=!d;d||(d={});for(var F=-1,N=c.length;++F<N;){var G=c[F],Y=_?_(d[G],a[G],G,d,a):t;Y===t&&(Y=a[G]),$?tn(d,G,Y):ei(d,G,Y)}return d}function If(a,c){return Qr(a,No(a),c)}function Pf(a,c){return Qr(a,Sa(a),c)}function Ri(a,c){return function(d,_){var $=it(d)?Ru:Zc,F=c?c():{};return $(d,a,qe(_,2),F)}}function Kn(a){return ft(function(c,d){var _=-1,$=d.length,F=$>1?d[$-1]:t,N=$>2?d[2]:t;for(F=a.length>3&&typeof F=="function"?($--,F):t,N&&mr(d[0],d[1],N)&&(F=$<3?t:F,$=1),c=Ct(c);++_<$;){var G=d[_];G&&a(c,G,_,F)}return c})}function da(a,c){return function(d,_){if(d==null)return d;if(!xr(d))return a(d,_);for(var $=d.length,F=c?$:-1,N=Ct(d);(c?F--:++F<$)&&_(N[F],F,N)!==!1;);return d}}function ha(a){return function(c,d,_){for(var $=-1,F=Ct(c),N=_(c),G=N.length;G--;){var Y=N[a?G:++$];if(d(F[Y],Y,F)===!1)break}return c}}function Of(a,c,d){var _=c&J,$=oi(a);function F(){var N=this&&this!==ur&&this instanceof F?$:a;return N.apply(_?d:this,arguments)}return F}function pa(a){return function(c){c=$t(c);var d=Rn(c)?zr(c):t,_=d?d[0]:c.charAt(0),$=d?gn(d,1).join(""):c.slice(1);return _[a]()+$}}function zn(a){return function(c){return ro(hu(du(c).replace(vu,"")),a,"")}}function oi(a){return function(){var c=arguments;switch(c.length){case 0:return new a;case 1:return new a(c[0]);case 2:return new a(c[0],c[1]);case 3:return new a(c[0],c[1],c[2]);case 4:return new a(c[0],c[1],c[2],c[3]);case 5:return new a(c[0],c[1],c[2],c[3],c[4]);case 6:return new a(c[0],c[1],c[2],c[3],c[4],c[5]);case 7:return new a(c[0],c[1],c[2],c[3],c[4],c[5],c[6])}var d=jn(a.prototype),_=a.apply(d,c);return jt(_)?_:d}}function Ff(a,c,d){var _=oi(a);function $(){for(var F=arguments.length,N=oe(F),G=F,Y=Gn($);G--;)N[G]=arguments[G];var me=F<3&&N[0]!==Y&&N[F-1]!==Y?[]:dn(N,Y);if(F-=me.length,F<d)return ba(a,c,Bi,$.placeholder,t,N,me,t,t,d-F);var ge=this&&this!==ur&&this instanceof $?_:a;return Cr(ge,this,N)}return $}function ya(a){return function(c,d,_){var $=Ct(c);if(!xr(c)){var F=qe(d,3);c=ir(c),d=function(G){return F($[G],G,$)}}var N=a(c,d,_);return N>-1?$[F?c[N]:N]:t}}function ma(a){return nn(function(c){var d=c.length,_=d,$=Br.prototype.thru;for(a&&c.reverse();_--;){var F=c[_];if(typeof F!="function")throw new Rr(u);if($&&!N&&Ui(F)=="wrapper")var N=new Br([],!0)}for(_=N?_:d;++_<d;){F=c[_];var G=Ui(F),Y=G=="wrapper"?Lo(F):t;Y&&jo(Y[0])&&Y[1]==(ce|de|z|Ee)&&!Y[4].length&&Y[9]==1?N=N[Ui(Y[0])].apply(N,Y[3]):N=F.length==1&&jo(F)?N[G]():N.thru(F)}return function(){var me=arguments,ge=me[0];if(N&&me.length==1&&it(ge))return N.plant(ge).value();for(var ve=0,Te=d?c[ve].apply(this,me):ge;++ve<d;)Te=c[ve].call(this,Te);return Te}})}function Bi(a,c,d,_,$,F,N,G,Y,me){var ge=c&ce,ve=c&J,Te=c&ne,Ue=c&(de|H),Je=c&Be,ut=Te?t:oi(a);function Xe(){for(var mt=arguments.length,bt=oe(mt),Ir=mt;Ir--;)bt[Ir]=arguments[Ir];if(Ue)var gr=Gn(Xe),Pr=Gu(bt,gr);if(_&&(bt=fa(bt,_,$,Ue)),F&&(bt=la(bt,F,N,Ue)),mt-=Pr,Ue&&mt<me){var Ht=dn(bt,gr);return ba(a,c,Bi,Xe.placeholder,d,bt,Ht,G,Y,me-mt)}var Hr=ve?d:this,un=Te?Hr[a]:a;return mt=bt.length,G?bt=el(bt,G):Je&&mt>1&&bt.reverse(),ge&&Y<mt&&(bt.length=Y),this&&this!==ur&&this instanceof Xe&&(un=ut||oi(un)),un.apply(Hr,bt)}return Xe}function ga(a,c){return function(d,_){return uf(d,a,c(_),{})}}function Li(a,c){return function(d,_){var $;if(d===t&&_===t)return c;if(d!==t&&($=d),_!==t){if($===t)return _;typeof d=="string"||typeof _=="string"?(d=Tr(d),_=Tr(_)):(d=ra(d),_=ra(_)),$=a(d,_)}return $}}function Oo(a){return nn(function(c){return c=Bt(c,kr(qe())),ft(function(d){var _=this;return a(c,function($){return Cr($,_,d)})})})}function Mi(a,c){c=c===t?" ":Tr(c);var d=c.length;if(d<2)return d?Ao(c,a):c;var _=Ao(c,$i(a/Bn(c)));return Rn(c)?gn(zr(_),0,a).join(""):_.slice(0,a)}function Rf(a,c,d,_){var $=c&J,F=oi(a);function N(){for(var G=-1,Y=arguments.length,me=-1,ge=_.length,ve=oe(ge+Y),Te=this&&this!==ur&&this instanceof N?F:a;++me<ge;)ve[me]=_[me];for(;Y--;)ve[me++]=arguments[++G];return Cr(Te,$?d:this,ve)}return N}function wa(a){return function(c,d,_){return _&&typeof _!="number"&&mr(c,d,_)&&(d=_=t),c=an(c),d===t?(d=c,c=0):d=an(d),_=_===t?c<d?1:-1:an(_),bf(c,d,_,a)}}function Ni(a){return function(c,d){return typeof c=="string"&&typeof d=="string"||(c=Ur(c),d=Ur(d)),a(c,d)}}function ba(a,c,d,_,$,F,N,G,Y,me){var ge=c&de,ve=ge?N:t,Te=ge?t:N,Ue=ge?F:t,Je=ge?t:F;c|=ge?z:ue,c&=~(ge?ue:z),c&pe||(c&=~(J|ne));var ut=[a,c,$,Ue,ve,Je,Te,G,Y,me],Xe=d.apply(t,ut);return jo(a)&&Pa(Xe,ut),Xe.placeholder=_,Oa(Xe,a,c)}function Fo(a){var c=tr[a];return function(d,_){if(d=Ur(d),_=_==null?0:lr(at(_),292),_&&Ps(d)){var $=($t(d)+"e").split("e"),F=c($[0]+"e"+(+$[1]+_));return $=($t(F)+"e").split("e"),+($[0]+"e"+(+$[1]-_))}return c(d)}}var Bf=Nn&&1/pi(new Nn([,-0]))[1]==Mt?function(a){return new Nn(a)}:rs;function va(a){return function(c){var d=dr(c);return d==Rt?co(c):d==Dt?Ju(c):zu(c,a(c))}}function rn(a,c,d,_,$,F,N,G){var Y=c&ne;if(!Y&&typeof a!="function")throw new Rr(u);var me=_?_.length:0;if(me||(c&=~(z|ue),_=$=t),N=N===t?N:rr(at(N),0),G=G===t?G:at(G),me-=$?$.length:0,c&ue){var ge=_,ve=$;_=$=t}var Te=Y?t:Lo(a),Ue=[a,c,d,_,$,ge,ve,F,N,G];if(Te&&Jf(Ue,Te),a=Ue[0],c=Ue[1],d=Ue[2],_=Ue[3],$=Ue[4],G=Ue[9]=Ue[9]===t?Y?0:a.length:rr(Ue[9]-me,0),!G&&c&(de|H)&&(c&=~(de|H)),!c||c==J)var Je=Of(a,c,d);else c==de||c==H?Je=Ff(a,c,G):(c==z||c==(J|z))&&!$.length?Je=Rf(a,c,d,_):Je=Bi.apply(t,Ue);var ut=Te?ea:Pa;return Oa(ut(Je,Ue),a,c)}function Ea(a,c,d,_){return a===t||Wr(a,Mn[d])&&!St.call(_,d)?c:a}function xa(a,c,d,_,$,F){return jt(a)&&jt(c)&&(F.set(c,a),Pi(a,c,t,xa,F),F.delete(c)),a}function Lf(a){return ui(a)?t:a}function $a(a,c,d,_,$,F){var N=d&A,G=a.length,Y=c.length;if(G!=Y&&!(N&&Y>G))return!1;var me=F.get(a),ge=F.get(c);if(me&&ge)return me==c&&ge==a;var ve=-1,Te=!0,Ue=d&L?new $n:t;for(F.set(a,c),F.set(c,a);++ve<G;){var Je=a[ve],ut=c[ve];if(_)var Xe=N?_(ut,Je,ve,c,a,F):_(Je,ut,ve,a,c,F);if(Xe!==t){if(Xe)continue;Te=!1;break}if(Ue){if(!no(c,function(mt,bt){if(!qn(Ue,bt)&&(Je===mt||$(Je,mt,d,_,F)))return Ue.push(bt)})){Te=!1;break}}else if(!(Je===ut||$(Je,ut,d,_,F))){Te=!1;break}}return F.delete(a),F.delete(c),Te}function Mf(a,c,d,_,$,F,N){switch(d){case g:if(a.byteLength!=c.byteLength||a.byteOffset!=c.byteOffset)return!1;a=a.buffer,c=c.buffer;case x:return!(a.byteLength!=c.byteLength||!F(new bi(a),new bi(c)));case Yt:case kt:case qt:return Wr(+a,+c);case nr:return a.name==c.name&&a.message==c.message;case Xt:case It:return a==c+"";case Rt:var G=co;case Dt:var Y=_&A;if(G||(G=pi),a.size!=c.size&&!Y)return!1;var me=N.get(a);if(me)return me==c;_|=L,N.set(a,c);var ge=$a(G(a),G(c),_,$,F,N);return N.delete(a),ge;case Zt:if(Zn)return Zn.call(a)==Zn.call(c)}return!1}function Nf(a,c,d,_,$,F){var N=d&A,G=Ro(a),Y=G.length,me=Ro(c),ge=me.length;if(Y!=ge&&!N)return!1;for(var ve=Y;ve--;){var Te=G[ve];if(!(N?Te in c:St.call(c,Te)))return!1}var Ue=F.get(a),Je=F.get(c);if(Ue&&Je)return Ue==c&&Je==a;var ut=!0;F.set(a,c),F.set(c,a);for(var Xe=N;++ve<Y;){Te=G[ve];var mt=a[Te],bt=c[Te];if(_)var Ir=N?_(bt,mt,Te,c,a,F):_(mt,bt,Te,a,c,F);if(!(Ir===t?mt===bt||$(mt,bt,d,_,F):Ir)){ut=!1;break}Xe||(Xe=Te=="constructor")}if(ut&&!Xe){var gr=a.constructor,Pr=c.constructor;gr!=Pr&&"constructor"in a&&"constructor"in c&&!(typeof gr=="function"&&gr instanceof gr&&typeof Pr=="function"&&Pr instanceof Pr)&&(ut=!1)}return F.delete(a),F.delete(c),ut}function nn(a){return zo(Da(a,t,Na),a+"")}function Ro(a){return zs(a,ir,No)}function Bo(a){return zs(a,$r,Sa)}var Lo=Ai?function(a){return Ai.get(a)}:rs;function Ui(a){for(var c=a.name+"",d=Un[c],_=St.call(Un,c)?d.length:0;_--;){var $=d[_],F=$.func;if(F==null||F==a)return $.name}return c}function Gn(a){var c=St.call(D,"placeholder")?D:a;return c.placeholder}function qe(){var a=D.iteratee||es;return a=a===es?Hs:a,arguments.length?a(arguments[0],arguments[1]):a}function ji(a,c){var d=a.__data__;return Vf(c)?d[typeof c=="string"?"string":"hash"]:d.map}function Mo(a){for(var c=ir(a),d=c.length;d--;){var _=c[d],$=a[_];c[d]=[_,$,ka($)]}return c}function Cn(a,c){var d=qu(a,c);return Ws(d)?d:t}function Uf(a){var c=St.call(a,En),d=a[En];try{a[En]=t;var _=!0}catch{}var $=_i.call(a);return _&&(c?a[En]=d:delete a[En]),$}var No=lo?function(a){return a==null?[]:(a=Ct(a),fn(lo(a),function(c){return Ds.call(a,c)}))}:ns,Sa=lo?function(a){for(var c=[];a;)ln(c,No(a)),a=vi(a);return c}:ns,dr=yr;(ho&&dr(new ho(new ArrayBuffer(1)))!=g||Yn&&dr(new Yn)!=Rt||po&&dr(po.resolve())!=br||Nn&&dr(new Nn)!=Dt||Jn&&dr(new Jn)!=se)&&(dr=function(a){var c=yr(a),d=c==zt?a.constructor:t,_=d?kn(d):"";if(_)switch(_){case vc:return g;case Ec:return Rt;case xc:return br;case $c:return Dt;case Sc:return se}return c});function jf(a,c,d){for(var _=-1,$=d.length;++_<$;){var F=d[_],N=F.size;switch(F.type){case"drop":a+=N;break;case"dropRight":c-=N;break;case"take":c=lr(c,a+N);break;case"takeRight":a=rr(a,c-N);break}}return{start:a,end:c}}function Kf(a){var c=a.match(y);return c?c[1].split(B):[]}function Aa(a,c,d){c=mn(c,a);for(var _=-1,$=c.length,F=!1;++_<$;){var N=Yr(c[_]);if(!(F=a!=null&&d(a,N)))break;a=a[N]}return F||++_!=$?F:($=a==null?0:a.length,!!$&&qi($)&&on(N,$)&&(it(a)||Tn(a)))}function zf(a){var c=a.length,d=new a.constructor(c);return c&&typeof a[0]=="string"&&St.call(a,"index")&&(d.index=a.index,d.input=a.input),d}function Ca(a){return typeof a.constructor=="function"&&!si(a)?jn(vi(a)):{}}function Gf(a,c,d){var _=a.constructor;switch(c){case x:return Po(a);case Yt:case kt:return new _(+a);case g:return Cf(a,d);case w:case O:case U:case W:case te:case $e:case tt:case ct:case wt:return ua(a,d);case Rt:return new _;case qt:case It:return new _(a);case Xt:return kf(a);case Dt:return new _;case Zt:return Tf(a)}}function Wf(a,c){var d=c.length;if(!d)return a;var _=d-1;return c[_]=(d>1?"& ":"")+c[_],c=c.join(d>2?", ":" "),a.replace(k,`{
/* [wrapped with `+c+`] */
`)}function Hf(a){return it(a)||Tn(a)||!!(Is&&a&&a[Is])}function on(a,c){var d=typeof a;return c=c??Nt,!!c&&(d=="number"||d!="symbol"&&Qe.test(a))&&a>-1&&a%1==0&&a<c}function mr(a,c,d){if(!jt(d))return!1;var _=typeof c;return(_=="number"?xr(d)&&on(c,d.length):_=="string"&&c in d)?Wr(d[c],a):!1}function Uo(a,c){if(it(a))return!1;var d=typeof a;return d=="number"||d=="symbol"||d=="boolean"||a==null||Dr(a)?!0:Pn.test(a)||!bn.test(a)||c!=null&&a in Ct(c)}function Vf(a){var c=typeof a;return c=="string"||c=="number"||c=="symbol"||c=="boolean"?a!=="__proto__":a===null}function jo(a){var c=Ui(a),d=D[c];if(typeof d!="function"||!(c in gt.prototype))return!1;if(a===d)return!0;var _=Lo(d);return!!_&&a===_[0]}function qf(a){return!!Cs&&Cs in a}var Qf=mi?sn:os;function si(a){var c=a&&a.constructor,d=typeof c=="function"&&c.prototype||Mn;return a===d}function ka(a){return a===a&&!jt(a)}function Ta(a,c){return function(d){return d==null?!1:d[a]===c&&(c!==t||a in Ct(d))}}function Yf(a){var c=Hi(a,function(_){return d.size===h&&d.clear(),_}),d=c.cache;return c}function Jf(a,c){var d=a[1],_=c[1],$=d|_,F=$<(J|ne|ce),N=_==ce&&d==de||_==ce&&d==Ee&&a[7].length<=c[8]||_==(ce|Ee)&&c[7].length<=c[8]&&d==de;if(!(F||N))return a;_&J&&(a[2]=c[2],$|=d&J?0:pe);var G=c[3];if(G){var Y=a[3];a[3]=Y?fa(Y,G,c[4]):G,a[4]=Y?dn(a[3],p):c[4]}return G=c[5],G&&(Y=a[5],a[5]=Y?la(Y,G,c[6]):G,a[6]=Y?dn(a[5],p):c[6]),G=c[7],G&&(a[7]=G),_&ce&&(a[8]=a[8]==null?c[8]:lr(a[8],c[8])),a[9]==null&&(a[9]=c[9]),a[0]=c[0],a[1]=$,a}function Xf(a){var c=[];if(a!=null)for(var d in Ct(a))c.push(d);return c}function Zf(a){return _i.call(a)}function Da(a,c,d){return c=rr(c===t?a.length-1:c,0),function(){for(var _=arguments,$=-1,F=rr(_.length-c,0),N=oe(F);++$<F;)N[$]=_[c+$];$=-1;for(var G=oe(c+1);++$<c;)G[$]=_[$];return G[c]=d(N),Cr(a,this,G)}}function Ia(a,c){return c.length<2?a:An(a,Mr(c,0,-1))}function el(a,c){for(var d=a.length,_=lr(c.length,d),$=Er(a);_--;){var F=c[_];a[_]=on(F,d)?$[F]:t}return a}function Ko(a,c){if(!(c==="constructor"&&typeof a[c]=="function")&&c!="__proto__")return a[c]}var Pa=Fa(ea),ai=hc||function(a,c){return ur.setTimeout(a,c)},zo=Fa(xf);function Oa(a,c,d){var _=c+"";return zo(a,Wf(_,tl(Kf(_),d)))}function Fa(a){var c=0,d=0;return function(){var _=_c(),$=_t-(_-d);if(d=_,$>0){if(++c>=st)return arguments[0]}else c=0;return a.apply(t,arguments)}}function Ki(a,c){var d=-1,_=a.length,$=_-1;for(c=c===t?_:c;++d<c;){var F=So(d,$),N=a[F];a[F]=a[d],a[d]=N}return a.length=c,a}var Ra=Yf(function(a){var c=[];return a.charCodeAt(0)===46&&c.push(""),a.replace(Vn,function(d,_,$,F){c.push($?F.replace(ye,"$1"):_||d)}),c});function Yr(a){if(typeof a=="string"||Dr(a))return a;var c=a+"";return c=="0"&&1/a==-Mt?"-0":c}function kn(a){if(a!=null){try{return gi.call(a)}catch{}try{return a+""}catch{}}return""}function tl(a,c){return Fr(pt,function(d){var _="_."+d[0];c&d[1]&&!di(a,_)&&a.push(_)}),a.sort()}function Ba(a){if(a instanceof gt)return a.clone();var c=new Br(a.__wrapped__,a.__chain__);return c.__actions__=Er(a.__actions__),c.__index__=a.__index__,c.__values__=a.__values__,c}function rl(a,c,d){(d?mr(a,c,d):c===t)?c=1:c=rr(at(c),0);var _=a==null?0:a.length;if(!_||c<1)return[];for(var $=0,F=0,N=oe($i(_/c));$<_;)N[F++]=Mr(a,$,$+=c);return N}function nl(a){for(var c=-1,d=a==null?0:a.length,_=0,$=[];++c<d;){var F=a[c];F&&($[_++]=F)}return $}function il(){var a=arguments.length;if(!a)return[];for(var c=oe(a-1),d=arguments[0],_=a;_--;)c[_-1]=arguments[_];return ln(it(d)?Er(d):[d],cr(c,1))}var ol=ft(function(a,c){return Wt(a)?ti(a,cr(c,1,Wt,!0)):[]}),sl=ft(function(a,c){var d=Nr(c);return Wt(d)&&(d=t),Wt(a)?ti(a,cr(c,1,Wt,!0),qe(d,2)):[]}),al=ft(function(a,c){var d=Nr(c);return Wt(d)&&(d=t),Wt(a)?ti(a,cr(c,1,Wt,!0),t,d):[]});function ul(a,c,d){var _=a==null?0:a.length;return _?(c=d||c===t?1:at(c),Mr(a,c<0?0:c,_)):[]}function cl(a,c,d){var _=a==null?0:a.length;return _?(c=d||c===t?1:at(c),c=_-c,Mr(a,0,c<0?0:c)):[]}function fl(a,c){return a&&a.length?Fi(a,qe(c,3),!0,!0):[]}function ll(a,c){return a&&a.length?Fi(a,qe(c,3),!0):[]}function dl(a,c,d,_){var $=a==null?0:a.length;return $?(d&&typeof d!="number"&&mr(a,c,d)&&(d=0,_=$),nf(a,c,d,_)):[]}function La(a,c,d){var _=a==null?0:a.length;if(!_)return-1;var $=d==null?0:at(d);return $<0&&($=rr(_+$,0)),hi(a,qe(c,3),$)}function Ma(a,c,d){var _=a==null?0:a.length;if(!_)return-1;var $=_-1;return d!==t&&($=at(d),$=d<0?rr(_+$,0):lr($,_-1)),hi(a,qe(c,3),$,!0)}function Na(a){var c=a==null?0:a.length;return c?cr(a,1):[]}function hl(a){var c=a==null?0:a.length;return c?cr(a,Mt):[]}function pl(a,c){var d=a==null?0:a.length;return d?(c=c===t?1:at(c),cr(a,c)):[]}function yl(a){for(var c=-1,d=a==null?0:a.length,_={};++c<d;){var $=a[c];_[$[0]]=$[1]}return _}function Ua(a){return a&&a.length?a[0]:t}function ml(a,c,d){var _=a==null?0:a.length;if(!_)return-1;var $=d==null?0:at(d);return $<0&&($=rr(_+$,0)),Fn(a,c,$)}function gl(a){var c=a==null?0:a.length;return c?Mr(a,0,-1):[]}var _l=ft(function(a){var c=Bt(a,Do);return c.length&&c[0]===a[0]?bo(c):[]}),wl=ft(function(a){var c=Nr(a),d=Bt(a,Do);return c===Nr(d)?c=t:d.pop(),d.length&&d[0]===a[0]?bo(d,qe(c,2)):[]}),bl=ft(function(a){var c=Nr(a),d=Bt(a,Do);return c=typeof c=="function"?c:t,c&&d.pop(),d.length&&d[0]===a[0]?bo(d,t,c):[]});function vl(a,c){return a==null?"":yc.call(a,c)}function Nr(a){var c=a==null?0:a.length;return c?a[c-1]:t}function El(a,c,d){var _=a==null?0:a.length;if(!_)return-1;var $=_;return d!==t&&($=at(d),$=$<0?rr(_+$,0):lr($,_-1)),c===c?Zu(a,c,$):hi(a,ws,$,!0)}function xl(a,c){return a&&a.length?Ys(a,at(c)):t}var $l=ft(ja);function ja(a,c){return a&&a.length&&c&&c.length?$o(a,c):a}function Sl(a,c,d){return a&&a.length&&c&&c.length?$o(a,c,qe(d,2)):a}function Al(a,c,d){return a&&a.length&&c&&c.length?$o(a,c,t,d):a}var Cl=nn(function(a,c){var d=a==null?0:a.length,_=mo(a,c);return Zs(a,Bt(c,function($){return on($,d)?+$:$}).sort(ca)),_});function kl(a,c){var d=[];if(!(a&&a.length))return d;var _=-1,$=[],F=a.length;for(c=qe(c,3);++_<F;){var N=a[_];c(N,_,a)&&(d.push(N),$.push(_))}return Zs(a,$),d}function Go(a){return a==null?a:bc.call(a)}function Tl(a,c,d){var _=a==null?0:a.length;return _?(d&&typeof d!="number"&&mr(a,c,d)?(c=0,d=_):(c=c==null?0:at(c),d=d===t?_:at(d)),Mr(a,c,d)):[]}function Dl(a,c){return Oi(a,c)}function Il(a,c,d){return Co(a,c,qe(d,2))}function Pl(a,c){var d=a==null?0:a.length;if(d){var _=Oi(a,c);if(_<d&&Wr(a[_],c))return _}return-1}function Ol(a,c){return Oi(a,c,!0)}function Fl(a,c,d){return Co(a,c,qe(d,2),!0)}function Rl(a,c){var d=a==null?0:a.length;if(d){var _=Oi(a,c,!0)-1;if(Wr(a[_],c))return _}return-1}function Ll(a){return a&&a.length?ta(a):[]}function Ml(a,c){return a&&a.length?ta(a,qe(c,2)):[]}function Nl(a){var c=a==null?0:a.length;return c?Mr(a,1,c):[]}function Ul(a,c,d){return a&&a.length?(c=d||c===t?1:at(c),Mr(a,0,c<0?0:c)):[]}function jl(a,c,d){var _=a==null?0:a.length;return _?(c=d||c===t?1:at(c),c=_-c,Mr(a,c<0?0:c,_)):[]}function Kl(a,c){return a&&a.length?Fi(a,qe(c,3),!1,!0):[]}function zl(a,c){return a&&a.length?Fi(a,qe(c,3)):[]}var Gl=ft(function(a){return yn(cr(a,1,Wt,!0))}),Wl=ft(function(a){var c=Nr(a);return Wt(c)&&(c=t),yn(cr(a,1,Wt,!0),qe(c,2))}),Hl=ft(function(a){var c=Nr(a);return c=typeof c=="function"?c:t,yn(cr(a,1,Wt,!0),t,c)});function Vl(a){return a&&a.length?yn(a):[]}function ql(a,c){return a&&a.length?yn(a,qe(c,2)):[]}function Ql(a,c){return c=typeof c=="function"?c:t,a&&a.length?yn(a,t,c):[]}function Wo(a){if(!(a&&a.length))return[];var c=0;return a=fn(a,function(d){if(Wt(d))return c=rr(d.length,c),!0}),ao(c,function(d){return Bt(a,io(d))})}function Ka(a,c){if(!(a&&a.length))return[];var d=Wo(a);return c==null?d:Bt(d,function(_){return Cr(c,t,_)})}var Yl=ft(function(a,c){return Wt(a)?ti(a,c):[]}),Jl=ft(function(a){return To(fn(a,Wt))}),Xl=ft(function(a){var c=Nr(a);return Wt(c)&&(c=t),To(fn(a,Wt),qe(c,2))}),Zl=ft(function(a){var c=Nr(a);return c=typeof c=="function"?c:t,To(fn(a,Wt),t,c)}),ed=ft(Wo);function td(a,c){return oa(a||[],c||[],ei)}function rd(a,c){return oa(a||[],c||[],ii)}var nd=ft(function(a){var c=a.length,d=c>1?a[c-1]:t;return d=typeof d=="function"?(a.pop(),d):t,Ka(a,d)});function za(a){var c=D(a);return c.__chain__=!0,c}function id(a,c){return c(a),a}function zi(a,c){return c(a)}var od=nn(function(a){var c=a.length,d=c?a[0]:0,_=this.__wrapped__,$=function(F){return mo(F,a)};return c>1||this.__actions__.length||!(_ instanceof gt)||!on(d)?this.thru($):(_=_.slice(d,+d+(c?1:0)),_.__actions__.push({func:zi,args:[$],thisArg:t}),new Br(_,this.__chain__).thru(function(F){return c&&!F.length&&F.push(t),F}))});function sd(){return za(this)}function ad(){return new Br(this.value(),this.__chain__)}function ud(){this.__values__===t&&(this.__values__=nu(this.value()));var a=this.__index__>=this.__values__.length,c=a?t:this.__values__[this.__index__++];return{done:a,value:c}}function cd(){return this}function fd(a){for(var c,d=this;d instanceof ki;){var _=Ba(d);_.__index__=0,_.__values__=t,c?$.__wrapped__=_:c=_;var $=_;d=d.__wrapped__}return $.__wrapped__=a,c}function ld(){var a=this.__wrapped__;if(a instanceof gt){var c=a;return this.__actions__.length&&(c=new gt(this)),c=c.reverse(),c.__actions__.push({func:zi,args:[Go],thisArg:t}),new Br(c,this.__chain__)}return this.thru(Go)}function dd(){return ia(this.__wrapped__,this.__actions__)}var hd=Ri(function(a,c,d){St.call(a,d)?++a[d]:tn(a,d,1)});function pd(a,c,d){var _=it(a)?gs:rf;return d&&mr(a,c,d)&&(c=t),_(a,qe(c,3))}function yd(a,c){var d=it(a)?fn:js;return d(a,qe(c,3))}var md=ya(La),gd=ya(Ma);function _d(a,c){return cr(Gi(a,c),1)}function wd(a,c){return cr(Gi(a,c),Mt)}function bd(a,c,d){return d=d===t?1:at(d),cr(Gi(a,c),d)}function Ga(a,c){var d=it(a)?Fr:pn;return d(a,qe(c,3))}function Wa(a,c){var d=it(a)?Bu:Us;return d(a,qe(c,3))}var vd=Ri(function(a,c,d){St.call(a,d)?a[d].push(c):tn(a,d,[c])});function Ed(a,c,d,_){a=xr(a)?a:Hn(a),d=d&&!_?at(d):0;var $=a.length;return d<0&&(d=rr($+d,0)),Qi(a)?d<=$&&a.indexOf(c,d)>-1:!!$&&Fn(a,c,d)>-1}var xd=ft(function(a,c,d){var _=-1,$=typeof c=="function",F=xr(a)?oe(a.length):[];return pn(a,function(N){F[++_]=$?Cr(c,N,d):ri(N,c,d)}),F}),$d=Ri(function(a,c,d){tn(a,d,c)});function Gi(a,c){var d=it(a)?Bt:Vs;return d(a,qe(c,3))}function Sd(a,c,d,_){return a==null?[]:(it(c)||(c=c==null?[]:[c]),d=_?t:d,it(d)||(d=d==null?[]:[d]),Js(a,c,d))}var Ad=Ri(function(a,c,d){a[d?0:1].push(c)},function(){return[[],[]]});function Cd(a,c,d){var _=it(a)?ro:vs,$=arguments.length<3;return _(a,qe(c,4),d,$,pn)}function kd(a,c,d){var _=it(a)?Lu:vs,$=arguments.length<3;return _(a,qe(c,4),d,$,Us)}function Td(a,c){var d=it(a)?fn:js;return d(a,Vi(qe(c,3)))}function Dd(a){var c=it(a)?Bs:vf;return c(a)}function Id(a,c,d){(d?mr(a,c,d):c===t)?c=1:c=at(c);var _=it(a)?Jc:Ef;return _(a,c)}function Pd(a){var c=it(a)?Xc:$f;return c(a)}function Od(a){if(a==null)return 0;if(xr(a))return Qi(a)?Bn(a):a.length;var c=dr(a);return c==Rt||c==Dt?a.size:Eo(a).length}function Fd(a,c,d){var _=it(a)?no:Sf;return d&&mr(a,c,d)&&(c=t),_(a,qe(c,3))}var Rd=ft(function(a,c){if(a==null)return[];var d=c.length;return d>1&&mr(a,c[0],c[1])?c=[]:d>2&&mr(c[0],c[1],c[2])&&(c=[c[0]]),Js(a,cr(c,1),[])}),Wi=dc||function(){return ur.Date.now()};function Bd(a,c){if(typeof c!="function")throw new Rr(u);return a=at(a),function(){if(--a<1)return c.apply(this,arguments)}}function Ha(a,c,d){return c=d?t:c,c=a&&c==null?a.length:c,rn(a,ce,t,t,t,t,c)}function Va(a,c){var d;if(typeof c!="function")throw new Rr(u);return a=at(a),function(){return--a>0&&(d=c.apply(this,arguments)),a<=1&&(c=t),d}}var Ho=ft(function(a,c,d){var _=J;if(d.length){var $=dn(d,Gn(Ho));_|=z}return rn(a,_,c,d,$)}),qa=ft(function(a,c,d){var _=J|ne;if(d.length){var $=dn(d,Gn(qa));_|=z}return rn(c,_,a,d,$)});function Qa(a,c,d){c=d?t:c;var _=rn(a,de,t,t,t,t,t,c);return _.placeholder=Qa.placeholder,_}function Ya(a,c,d){c=d?t:c;var _=rn(a,H,t,t,t,t,t,c);return _.placeholder=Ya.placeholder,_}function Ja(a,c,d){var _,$,F,N,G,Y,me=0,ge=!1,ve=!1,Te=!0;if(typeof a!="function")throw new Rr(u);c=Ur(c)||0,jt(d)&&(ge=!!d.leading,ve="maxWait"in d,F=ve?rr(Ur(d.maxWait)||0,c):F,Te="trailing"in d?!!d.trailing:Te);function Ue(Ht){var Hr=_,un=$;return _=$=t,me=Ht,N=a.apply(un,Hr),N}function Je(Ht){return me=Ht,G=ai(mt,c),ge?Ue(Ht):N}function ut(Ht){var Hr=Ht-Y,un=Ht-me,mu=c-Hr;return ve?lr(mu,F-un):mu}function Xe(Ht){var Hr=Ht-Y,un=Ht-me;return Y===t||Hr>=c||Hr<0||ve&&un>=F}function mt(){var Ht=Wi();if(Xe(Ht))return bt(Ht);G=ai(mt,ut(Ht))}function bt(Ht){return G=t,Te&&_?Ue(Ht):(_=$=t,N)}function Ir(){G!==t&&sa(G),me=0,_=Y=$=G=t}function gr(){return G===t?N:bt(Wi())}function Pr(){var Ht=Wi(),Hr=Xe(Ht);if(_=arguments,$=this,Y=Ht,Hr){if(G===t)return Je(Y);if(ve)return sa(G),G=ai(mt,c),Ue(Y)}return G===t&&(G=ai(mt,c)),N}return Pr.cancel=Ir,Pr.flush=gr,Pr}var Ld=ft(function(a,c){return Ns(a,1,c)}),Md=ft(function(a,c,d){return Ns(a,Ur(c)||0,d)});function Nd(a){return rn(a,Be)}function Hi(a,c){if(typeof a!="function"||c!=null&&typeof c!="function")throw new Rr(u);var d=function(){var _=arguments,$=c?c.apply(this,_):_[0],F=d.cache;if(F.has($))return F.get($);var N=a.apply(this,_);return d.cache=F.set($,N)||F,N};return d.cache=new(Hi.Cache||en),d}Hi.Cache=en;function Vi(a){if(typeof a!="function")throw new Rr(u);return function(){var c=arguments;switch(c.length){case 0:return!a.call(this);case 1:return!a.call(this,c[0]);case 2:return!a.call(this,c[0],c[1]);case 3:return!a.call(this,c[0],c[1],c[2])}return!a.apply(this,c)}}function Ud(a){return Va(2,a)}var jd=Af(function(a,c){c=c.length==1&&it(c[0])?Bt(c[0],kr(qe())):Bt(cr(c,1),kr(qe()));var d=c.length;return ft(function(_){for(var $=-1,F=lr(_.length,d);++$<F;)_[$]=c[$].call(this,_[$]);return Cr(a,this,_)})}),Vo=ft(function(a,c){var d=dn(c,Gn(Vo));return rn(a,z,t,c,d)}),Xa=ft(function(a,c){var d=dn(c,Gn(Xa));return rn(a,ue,t,c,d)}),Kd=nn(function(a,c){return rn(a,Ee,t,t,t,c)});function zd(a,c){if(typeof a!="function")throw new Rr(u);return c=c===t?c:at(c),ft(a,c)}function Gd(a,c){if(typeof a!="function")throw new Rr(u);return c=c==null?0:rr(at(c),0),ft(function(d){var _=d[c],$=gn(d,0,c);return _&&ln($,_),Cr(a,this,$)})}function Wd(a,c,d){var _=!0,$=!0;if(typeof a!="function")throw new Rr(u);return jt(d)&&(_="leading"in d?!!d.leading:_,$="trailing"in d?!!d.trailing:$),Ja(a,c,{leading:_,maxWait:c,trailing:$})}function Hd(a){return Ha(a,1)}function Vd(a,c){return Vo(Io(c),a)}function qd(){if(!arguments.length)return[];var a=arguments[0];return it(a)?a:[a]}function Qd(a){return Lr(a,S)}function Yd(a,c){return c=typeof c=="function"?c:t,Lr(a,S,c)}function Jd(a){return Lr(a,m|S)}function Xd(a,c){return c=typeof c=="function"?c:t,Lr(a,m|S,c)}function Zd(a,c){return c==null||Ms(a,c,ir(c))}function Wr(a,c){return a===c||a!==a&&c!==c}var eh=Ni(wo),th=Ni(function(a,c){return a>=c}),Tn=Gs(function(){return arguments}())?Gs:function(a){return Kt(a)&&St.call(a,"callee")&&!Ds.call(a,"callee")},it=oe.isArray,rh=fs?kr(fs):cf;function xr(a){return a!=null&&qi(a.length)&&!sn(a)}function Wt(a){return Kt(a)&&xr(a)}function nh(a){return a===!0||a===!1||Kt(a)&&yr(a)==Yt}var _n=pc||os,ih=ls?kr(ls):ff;function oh(a){return Kt(a)&&a.nodeType===1&&!ui(a)}function sh(a){if(a==null)return!0;if(xr(a)&&(it(a)||typeof a=="string"||typeof a.splice=="function"||_n(a)||Wn(a)||Tn(a)))return!a.length;var c=dr(a);if(c==Rt||c==Dt)return!a.size;if(si(a))return!Eo(a).length;for(var d in a)if(St.call(a,d))return!1;return!0}function ah(a,c){return ni(a,c)}function uh(a,c,d){d=typeof d=="function"?d:t;var _=d?d(a,c):t;return _===t?ni(a,c,t,d):!!_}function qo(a){if(!Kt(a))return!1;var c=yr(a);return c==nr||c==wr||typeof a.message=="string"&&typeof a.name=="string"&&!ui(a)}function ch(a){return typeof a=="number"&&Ps(a)}function sn(a){if(!jt(a))return!1;var c=yr(a);return c==ar||c==fr||c==jr||c==Jt}function Za(a){return typeof a=="number"&&a==at(a)}function qi(a){return typeof a=="number"&&a>-1&&a%1==0&&a<=Nt}function jt(a){var c=typeof a;return a!=null&&(c=="object"||c=="function")}function Kt(a){return a!=null&&typeof a=="object"}var eu=ds?kr(ds):df;function fh(a,c){return a===c||vo(a,c,Mo(c))}function lh(a,c,d){return d=typeof d=="function"?d:t,vo(a,c,Mo(c),d)}function dh(a){return tu(a)&&a!=+a}function hh(a){if(Qf(a))throw new rt(s);return Ws(a)}function ph(a){return a===null}function yh(a){return a==null}function tu(a){return typeof a=="number"||Kt(a)&&yr(a)==qt}function ui(a){if(!Kt(a)||yr(a)!=zt)return!1;var c=vi(a);if(c===null)return!0;var d=St.call(c,"constructor")&&c.constructor;return typeof d=="function"&&d instanceof d&&gi.call(d)==uc}var Qo=hs?kr(hs):hf;function mh(a){return Za(a)&&a>=-Nt&&a<=Nt}var ru=ps?kr(ps):pf;function Qi(a){return typeof a=="string"||!it(a)&&Kt(a)&&yr(a)==It}function Dr(a){return typeof a=="symbol"||Kt(a)&&yr(a)==Zt}var Wn=ys?kr(ys):yf;function gh(a){return a===t}function _h(a){return Kt(a)&&dr(a)==se}function wh(a){return Kt(a)&&yr(a)==we}var bh=Ni(xo),vh=Ni(function(a,c){return a<=c});function nu(a){if(!a)return[];if(xr(a))return Qi(a)?zr(a):Er(a);if(Qn&&a[Qn])return Yu(a[Qn]());var c=dr(a),d=c==Rt?co:c==Dt?pi:Hn;return d(a)}function an(a){if(!a)return a===0?a:0;if(a=Ur(a),a===Mt||a===-Mt){var c=a<0?-1:1;return c*pr}return a===a?a:0}function at(a){var c=an(a),d=c%1;return c===c?d?c-d:c:0}function iu(a){return a?Sn(at(a),0,Me):0}function Ur(a){if(typeof a=="number")return a;if(Dr(a))return _r;if(jt(a)){var c=typeof a.valueOf=="function"?a.valueOf():a;a=jt(c)?c+"":c}if(typeof a!="string")return a===0?a:+a;a=Es(a);var d=yt.test(a);return d||Ge.test(a)?Ou(a.slice(2),d?2:8):Ce.test(a)?_r:+a}function ou(a){return Qr(a,$r(a))}function Eh(a){return a?Sn(at(a),-Nt,Nt):a===0?a:0}function $t(a){return a==null?"":Tr(a)}var xh=Kn(function(a,c){if(si(c)||xr(c)){Qr(c,ir(c),a);return}for(var d in c)St.call(c,d)&&ei(a,d,c[d])}),su=Kn(function(a,c){Qr(c,$r(c),a)}),Yi=Kn(function(a,c,d,_){Qr(c,$r(c),a,_)}),$h=Kn(function(a,c,d,_){Qr(c,ir(c),a,_)}),Sh=nn(mo);function Ah(a,c){var d=jn(a);return c==null?d:Ls(d,c)}var Ch=ft(function(a,c){a=Ct(a);var d=-1,_=c.length,$=_>2?c[2]:t;for($&&mr(c[0],c[1],$)&&(_=1);++d<_;)for(var F=c[d],N=$r(F),G=-1,Y=N.length;++G<Y;){var me=N[G],ge=a[me];(ge===t||Wr(ge,Mn[me])&&!St.call(a,me))&&(a[me]=F[me])}return a}),kh=ft(function(a){return a.push(t,xa),Cr(au,t,a)});function Th(a,c){return _s(a,qe(c,3),qr)}function Dh(a,c){return _s(a,qe(c,3),_o)}function Ih(a,c){return a==null?a:go(a,qe(c,3),$r)}function Ph(a,c){return a==null?a:Ks(a,qe(c,3),$r)}function Oh(a,c){return a&&qr(a,qe(c,3))}function Fh(a,c){return a&&_o(a,qe(c,3))}function Rh(a){return a==null?[]:Ii(a,ir(a))}function Bh(a){return a==null?[]:Ii(a,$r(a))}function Yo(a,c,d){var _=a==null?t:An(a,c);return _===t?d:_}function Lh(a,c){return a!=null&&Aa(a,c,of)}function Jo(a,c){return a!=null&&Aa(a,c,sf)}var Mh=ga(function(a,c,d){c!=null&&typeof c.toString!="function"&&(c=_i.call(c)),a[c]=d},Zo(Sr)),Nh=ga(function(a,c,d){c!=null&&typeof c.toString!="function"&&(c=_i.call(c)),St.call(a,c)?a[c].push(d):a[c]=[d]},qe),Uh=ft(ri);function ir(a){return xr(a)?Rs(a):Eo(a)}function $r(a){return xr(a)?Rs(a,!0):mf(a)}function jh(a,c){var d={};return c=qe(c,3),qr(a,function(_,$,F){tn(d,c(_,$,F),_)}),d}function Kh(a,c){var d={};return c=qe(c,3),qr(a,function(_,$,F){tn(d,$,c(_,$,F))}),d}var zh=Kn(function(a,c,d){Pi(a,c,d)}),au=Kn(function(a,c,d,_){Pi(a,c,d,_)}),Gh=nn(function(a,c){var d={};if(a==null)return d;var _=!1;c=Bt(c,function(F){return F=mn(F,a),_||(_=F.length>1),F}),Qr(a,Bo(a),d),_&&(d=Lr(d,m|b|S,Lf));for(var $=c.length;$--;)ko(d,c[$]);return d});function Wh(a,c){return uu(a,Vi(qe(c)))}var Hh=nn(function(a,c){return a==null?{}:_f(a,c)});function uu(a,c){if(a==null)return{};var d=Bt(Bo(a),function(_){return[_]});return c=qe(c),Xs(a,d,function(_,$){return c(_,$[0])})}function Vh(a,c,d){c=mn(c,a);var _=-1,$=c.length;for($||($=1,a=t);++_<$;){var F=a==null?t:a[Yr(c[_])];F===t&&(_=$,F=d),a=sn(F)?F.call(a):F}return a}function qh(a,c,d){return a==null?a:ii(a,c,d)}function Qh(a,c,d,_){return _=typeof _=="function"?_:t,a==null?a:ii(a,c,d,_)}var cu=va(ir),fu=va($r);function Yh(a,c,d){var _=it(a),$=_||_n(a)||Wn(a);if(c=qe(c,4),d==null){var F=a&&a.constructor;$?d=_?new F:[]:jt(a)?d=sn(F)?jn(vi(a)):{}:d={}}return($?Fr:qr)(a,function(N,G,Y){return c(d,N,G,Y)}),d}function Jh(a,c){return a==null?!0:ko(a,c)}function Xh(a,c,d){return a==null?a:na(a,c,Io(d))}function Zh(a,c,d,_){return _=typeof _=="function"?_:t,a==null?a:na(a,c,Io(d),_)}function Hn(a){return a==null?[]:uo(a,ir(a))}function ep(a){return a==null?[]:uo(a,$r(a))}function tp(a,c,d){return d===t&&(d=c,c=t),d!==t&&(d=Ur(d),d=d===d?d:0),c!==t&&(c=Ur(c),c=c===c?c:0),Sn(Ur(a),c,d)}function rp(a,c,d){return c=an(c),d===t?(d=c,c=0):d=an(d),a=Ur(a),af(a,c,d)}function np(a,c,d){if(d&&typeof d!="boolean"&&mr(a,c,d)&&(c=d=t),d===t&&(typeof c=="boolean"?(d=c,c=t):typeof a=="boolean"&&(d=a,a=t)),a===t&&c===t?(a=0,c=1):(a=an(a),c===t?(c=a,a=0):c=an(c)),a>c){var _=a;a=c,c=_}if(d||a%1||c%1){var $=Os();return lr(a+$*(c-a+Pu("1e-"+(($+"").length-1))),c)}return So(a,c)}var ip=zn(function(a,c,d){return c=c.toLowerCase(),a+(d?lu(c):c)});function lu(a){return Xo($t(a).toLowerCase())}function du(a){return a=$t(a),a&&a.replace(et,Wu).replace(Eu,"")}function op(a,c,d){a=$t(a),c=Tr(c);var _=a.length;d=d===t?_:Sn(at(d),0,_);var $=d;return d-=c.length,d>=0&&a.slice(d,$)==c}function sp(a){return a=$t(a),a&&Ar.test(a)?a.replace(Dn,Hu):a}function ap(a){return a=$t(a),a&&On.test(a)?a.replace(er,"\\$&"):a}var up=zn(function(a,c,d){return a+(d?"-":"")+c.toLowerCase()}),cp=zn(function(a,c,d){return a+(d?" ":"")+c.toLowerCase()}),fp=pa("toLowerCase");function lp(a,c,d){a=$t(a),c=at(c);var _=c?Bn(a):0;if(!c||_>=c)return a;var $=(c-_)/2;return Mi(Si($),d)+a+Mi($i($),d)}function dp(a,c,d){a=$t(a),c=at(c);var _=c?Bn(a):0;return c&&_<c?a+Mi(c-_,d):a}function hp(a,c,d){a=$t(a),c=at(c);var _=c?Bn(a):0;return c&&_<c?Mi(c-_,d)+a:a}function pp(a,c,d){return d||c==null?c=0:c&&(c=+c),wc($t(a).replace(v,""),c||0)}function yp(a,c,d){return(d?mr(a,c,d):c===t)?c=1:c=at(c),Ao($t(a),c)}function mp(){var a=arguments,c=$t(a[0]);return a.length<3?c:c.replace(a[1],a[2])}var gp=zn(function(a,c,d){return a+(d?"_":"")+c.toLowerCase()});function _p(a,c,d){return d&&typeof d!="number"&&mr(a,c,d)&&(c=d=t),d=d===t?Me:d>>>0,d?(a=$t(a),a&&(typeof c=="string"||c!=null&&!Qo(c))&&(c=Tr(c),!c&&Rn(a))?gn(zr(a),0,d):a.split(c,d)):[]}var wp=zn(function(a,c,d){return a+(d?" ":"")+Xo(c)});function bp(a,c,d){return a=$t(a),d=d==null?0:Sn(at(d),0,a.length),c=Tr(c),a.slice(d,d+c.length)==c}function vp(a,c,d){var _=D.templateSettings;d&&mr(a,c,d)&&(c=t),a=$t(a),c=Yi({},c,_,Ea);var $=Yi({},c.imports,_.imports,Ea),F=ir($),N=uo($,F),G,Y,me=0,ge=c.interpolate||Ye,ve="__p += '",Te=fo((c.escape||Ye).source+"|"+ge.source+"|"+(ge===cn?xe:Ye).source+"|"+(c.evaluate||Ye).source+"|$","g"),Ue="//# sourceURL="+(St.call(c,"sourceURL")?(c.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Cu+"]")+`
`;a.replace(Te,function(Xe,mt,bt,Ir,gr,Pr){return bt||(bt=Ir),ve+=a.slice(me,Pr).replace(We,Vu),mt&&(G=!0,ve+=`' +
__e(`+mt+`) +
'`),gr&&(Y=!0,ve+=`';
`+gr+`;
__p += '`),bt&&(ve+=`' +
((__t = (`+bt+`)) == null ? '' : __t) +
'`),me=Pr+Xe.length,Xe}),ve+=`';
`;var Je=St.call(c,"variable")&&c.variable;if(!Je)ve=`with (obj) {
`+ve+`
}
`;else if(Z.test(Je))throw new rt(f);ve=(Y?ve.replace(lt,""):ve).replace(Xr,"$1").replace(vr,"$1;"),ve="function("+(Je||"obj")+`) {
`+(Je?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(G?", __e = _.escape":"")+(Y?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+ve+`return __p
}`;var ut=pu(function(){return Et(F,Ue+"return "+ve).apply(t,N)});if(ut.source=ve,qo(ut))throw ut;return ut}function Ep(a){return $t(a).toLowerCase()}function xp(a){return $t(a).toUpperCase()}function $p(a,c,d){if(a=$t(a),a&&(d||c===t))return Es(a);if(!a||!(c=Tr(c)))return a;var _=zr(a),$=zr(c),F=xs(_,$),N=$s(_,$)+1;return gn(_,F,N).join("")}function Sp(a,c,d){if(a=$t(a),a&&(d||c===t))return a.slice(0,As(a)+1);if(!a||!(c=Tr(c)))return a;var _=zr(a),$=$s(_,zr(c))+1;return gn(_,0,$).join("")}function Ap(a,c,d){if(a=$t(a),a&&(d||c===t))return a.replace(v,"");if(!a||!(c=Tr(c)))return a;var _=zr(a),$=xs(_,zr(c));return gn(_,$).join("")}function Cp(a,c){var d=ot,_=nt;if(jt(c)){var $="separator"in c?c.separator:$;d="length"in c?at(c.length):d,_="omission"in c?Tr(c.omission):_}a=$t(a);var F=a.length;if(Rn(a)){var N=zr(a);F=N.length}if(d>=F)return a;var G=d-Bn(_);if(G<1)return _;var Y=N?gn(N,0,G).join(""):a.slice(0,G);if($===t)return Y+_;if(N&&(G+=Y.length-G),Qo($)){if(a.slice(G).search($)){var me,ge=Y;for($.global||($=fo($.source,$t(Le.exec($))+"g")),$.lastIndex=0;me=$.exec(ge);)var ve=me.index;Y=Y.slice(0,ve===t?G:ve)}}else if(a.indexOf(Tr($),G)!=G){var Te=Y.lastIndexOf($);Te>-1&&(Y=Y.slice(0,Te))}return Y+_}function kp(a){return a=$t(a),a&&In.test(a)?a.replace(wn,ec):a}var Tp=zn(function(a,c,d){return a+(d?" ":"")+c.toUpperCase()}),Xo=pa("toUpperCase");function hu(a,c,d){return a=$t(a),c=d?t:c,c===t?Qu(a)?nc(a):Uu(a):a.match(c)||[]}var pu=ft(function(a,c){try{return Cr(a,t,c)}catch(d){return qo(d)?d:new rt(d)}}),Dp=nn(function(a,c){return Fr(c,function(d){d=Yr(d),tn(a,d,Ho(a[d],a))}),a});function Ip(a){var c=a==null?0:a.length,d=qe();return a=c?Bt(a,function(_){if(typeof _[1]!="function")throw new Rr(u);return[d(_[0]),_[1]]}):[],ft(function(_){for(var $=-1;++$<c;){var F=a[$];if(Cr(F[0],this,_))return Cr(F[1],this,_)}})}function Pp(a){return tf(Lr(a,m))}function Zo(a){return function(){return a}}function Fp(a,c){return a==null||a!==a?c:a}var Rp=ma(),Bp=ma(!0);function Sr(a){return a}function es(a){return Hs(typeof a=="function"?a:Lr(a,m))}function Lp(a){return qs(Lr(a,m))}function Mp(a,c){return Qs(a,Lr(c,m))}var Np=ft(function(a,c){return function(d){return ri(d,a,c)}}),Up=ft(function(a,c){return function(d){return ri(a,d,c)}});function ts(a,c,d){var _=ir(c),$=Ii(c,_);d==null&&!(jt(c)&&($.length||!_.length))&&(d=c,c=a,a=this,$=Ii(c,ir(c)));var F=!(jt(d)&&"chain"in d)||!!d.chain,N=sn(a);return Fr($,function(G){var Y=c[G];a[G]=Y,N&&(a.prototype[G]=function(){var me=this.__chain__;if(F||me){var ge=a(this.__wrapped__),ve=ge.__actions__=Er(this.__actions__);return ve.push({func:Y,args:arguments,thisArg:a}),ge.__chain__=me,ge}return Y.apply(a,ln([this.value()],arguments))})}),a}function jp(){return ur._===this&&(ur._=cc),this}function rs(){}function Kp(a){return a=at(a),ft(function(c){return Ys(c,a)})}var zp=Oo(Bt),Gp=Oo(gs),Wp=Oo(no);function yu(a){return Uo(a)?io(Yr(a)):wf(a)}function Hp(a){return function(c){return a==null?t:An(a,c)}}var Vp=wa(),qp=wa(!0);function ns(){return[]}function os(){return!1}function Qp(){return{}}function Yp(){return""}function Jp(){return!0}function Xp(a,c){if(a=at(a),a<1||a>Nt)return[];var d=Me,_=lr(a,Me);c=qe(c),a-=Me;for(var $=ao(_,c);++d<a;)c(d);return $}function Zp(a){return it(a)?Bt(a,Yr):Dr(a)?[a]:Er(Ra($t(a)))}function ey(a){var c=++ac;return $t(a)+c}var ty=Li(function(a,c){return a+c},0),ry=Fo("ceil"),ny=Li(function(a,c){return a/c},1),iy=Fo("floor");function oy(a){return a&&a.length?Di(a,Sr,wo):t}function sy(a,c){return a&&a.length?Di(a,qe(c,2),wo):t}function ay(a){return bs(a,Sr)}function uy(a,c){return bs(a,qe(c,2))}function cy(a){return a&&a.length?Di(a,Sr,xo):t}function fy(a,c){return a&&a.length?Di(a,qe(c,2),xo):t}var ly=Li(function(a,c){return a*c},1),dy=Fo("round"),hy=Li(function(a,c){return a-c},0);function py(a){return a&&a.length?so(a,Sr):0}function yy(a,c){return a&&a.length?so(a,qe(c,2)):0}return D.after=Bd,D.ary=Ha,D.assign=xh,D.assignIn=su,D.assignInWith=Yi,D.assignWith=$h,D.at=Sh,D.before=Va,D.bind=Ho,D.bindAll=Dp,D.bindKey=qa,D.castArray=qd,D.chain=za,D.chunk=rl,D.compact=nl,D.concat=il,D.cond=Ip,D.conforms=Pp,D.constant=Zo,D.countBy=hd,D.create=Ah,D.curry=Qa,D.curryRight=Ya,D.debounce=Ja,D.defaults=Ch,D.defaultsDeep=kh,D.defer=Ld,D.delay=Md,D.difference=ol,D.differenceBy=sl,D.differenceWith=al,D.drop=ul,D.dropRight=cl,D.dropRightWhile=fl,D.dropWhile=ll,D.fill=dl,D.filter=yd,D.flatMap=_d,D.flatMapDeep=wd,D.flatMapDepth=bd,D.flatten=Na,D.flattenDeep=hl,D.flattenDepth=pl,D.flip=Nd,D.flow=Rp,D.flowRight=Bp,D.fromPairs=yl,D.functions=Rh,D.functionsIn=Bh,D.groupBy=vd,D.initial=gl,D.intersection=_l,D.intersectionBy=wl,D.intersectionWith=bl,D.invert=Mh,D.invertBy=Nh,D.invokeMap=xd,D.iteratee=es,D.keyBy=$d,D.keys=ir,D.keysIn=$r,D.map=Gi,D.mapKeys=jh,D.mapValues=Kh,D.matches=Lp,D.matchesProperty=Mp,D.memoize=Hi,D.merge=zh,D.mergeWith=au,D.method=Np,D.methodOf=Up,D.mixin=ts,D.negate=Vi,D.nthArg=Kp,D.omit=Gh,D.omitBy=Wh,D.once=Ud,D.orderBy=Sd,D.over=zp,D.overArgs=jd,D.overEvery=Gp,D.overSome=Wp,D.partial=Vo,D.partialRight=Xa,D.partition=Ad,D.pick=Hh,D.pickBy=uu,D.property=yu,D.propertyOf=Hp,D.pull=$l,D.pullAll=ja,D.pullAllBy=Sl,D.pullAllWith=Al,D.pullAt=Cl,D.range=Vp,D.rangeRight=qp,D.rearg=Kd,D.reject=Td,D.remove=kl,D.rest=zd,D.reverse=Go,D.sampleSize=Id,D.set=qh,D.setWith=Qh,D.shuffle=Pd,D.slice=Tl,D.sortBy=Rd,D.sortedUniq=Ll,D.sortedUniqBy=Ml,D.split=_p,D.spread=Gd,D.tail=Nl,D.take=Ul,D.takeRight=jl,D.takeRightWhile=Kl,D.takeWhile=zl,D.tap=id,D.throttle=Wd,D.thru=zi,D.toArray=nu,D.toPairs=cu,D.toPairsIn=fu,D.toPath=Zp,D.toPlainObject=ou,D.transform=Yh,D.unary=Hd,D.union=Gl,D.unionBy=Wl,D.unionWith=Hl,D.uniq=Vl,D.uniqBy=ql,D.uniqWith=Ql,D.unset=Jh,D.unzip=Wo,D.unzipWith=Ka,D.update=Xh,D.updateWith=Zh,D.values=Hn,D.valuesIn=ep,D.without=Yl,D.words=hu,D.wrap=Vd,D.xor=Jl,D.xorBy=Xl,D.xorWith=Zl,D.zip=ed,D.zipObject=td,D.zipObjectDeep=rd,D.zipWith=nd,D.entries=cu,D.entriesIn=fu,D.extend=su,D.extendWith=Yi,ts(D,D),D.add=ty,D.attempt=pu,D.camelCase=ip,D.capitalize=lu,D.ceil=ry,D.clamp=tp,D.clone=Qd,D.cloneDeep=Jd,D.cloneDeepWith=Xd,D.cloneWith=Yd,D.conformsTo=Zd,D.deburr=du,D.defaultTo=Fp,D.divide=ny,D.endsWith=op,D.eq=Wr,D.escape=sp,D.escapeRegExp=ap,D.every=pd,D.find=md,D.findIndex=La,D.findKey=Th,D.findLast=gd,D.findLastIndex=Ma,D.findLastKey=Dh,D.floor=iy,D.forEach=Ga,D.forEachRight=Wa,D.forIn=Ih,D.forInRight=Ph,D.forOwn=Oh,D.forOwnRight=Fh,D.get=Yo,D.gt=eh,D.gte=th,D.has=Lh,D.hasIn=Jo,D.head=Ua,D.identity=Sr,D.includes=Ed,D.indexOf=ml,D.inRange=rp,D.invoke=Uh,D.isArguments=Tn,D.isArray=it,D.isArrayBuffer=rh,D.isArrayLike=xr,D.isArrayLikeObject=Wt,D.isBoolean=nh,D.isBuffer=_n,D.isDate=ih,D.isElement=oh,D.isEmpty=sh,D.isEqual=ah,D.isEqualWith=uh,D.isError=qo,D.isFinite=ch,D.isFunction=sn,D.isInteger=Za,D.isLength=qi,D.isMap=eu,D.isMatch=fh,D.isMatchWith=lh,D.isNaN=dh,D.isNative=hh,D.isNil=yh,D.isNull=ph,D.isNumber=tu,D.isObject=jt,D.isObjectLike=Kt,D.isPlainObject=ui,D.isRegExp=Qo,D.isSafeInteger=mh,D.isSet=ru,D.isString=Qi,D.isSymbol=Dr,D.isTypedArray=Wn,D.isUndefined=gh,D.isWeakMap=_h,D.isWeakSet=wh,D.join=vl,D.kebabCase=up,D.last=Nr,D.lastIndexOf=El,D.lowerCase=cp,D.lowerFirst=fp,D.lt=bh,D.lte=vh,D.max=oy,D.maxBy=sy,D.mean=ay,D.meanBy=uy,D.min=cy,D.minBy=fy,D.stubArray=ns,D.stubFalse=os,D.stubObject=Qp,D.stubString=Yp,D.stubTrue=Jp,D.multiply=ly,D.nth=xl,D.noConflict=jp,D.noop=rs,D.now=Wi,D.pad=lp,D.padEnd=dp,D.padStart=hp,D.parseInt=pp,D.random=np,D.reduce=Cd,D.reduceRight=kd,D.repeat=yp,D.replace=mp,D.result=Vh,D.round=dy,D.runInContext=q,D.sample=Dd,D.size=Od,D.snakeCase=gp,D.some=Fd,D.sortedIndex=Dl,D.sortedIndexBy=Il,D.sortedIndexOf=Pl,D.sortedLastIndex=Ol,D.sortedLastIndexBy=Fl,D.sortedLastIndexOf=Rl,D.startCase=wp,D.startsWith=bp,D.subtract=hy,D.sum=py,D.sumBy=yy,D.template=vp,D.times=Xp,D.toFinite=an,D.toInteger=at,D.toLength=iu,D.toLower=Ep,D.toNumber=Ur,D.toSafeInteger=Eh,D.toString=$t,D.toUpper=xp,D.trim=$p,D.trimEnd=Sp,D.trimStart=Ap,D.truncate=Cp,D.unescape=kp,D.uniqueId=ey,D.upperCase=Tp,D.upperFirst=Xo,D.each=Ga,D.eachRight=Wa,D.first=Ua,ts(D,function(){var a={};return qr(D,function(c,d){St.call(D.prototype,d)||(a[d]=c)}),a}(),{chain:!1}),D.VERSION=n,Fr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(a){D[a].placeholder=D}),Fr(["drop","take"],function(a,c){gt.prototype[a]=function(d){d=d===t?1:rr(at(d),0);var _=this.__filtered__&&!c?new gt(this):this.clone();return _.__filtered__?_.__takeCount__=lr(d,_.__takeCount__):_.__views__.push({size:lr(d,Me),type:a+(_.__dir__<0?"Right":"")}),_},gt.prototype[a+"Right"]=function(d){return this.reverse()[a](d).reverse()}}),Fr(["filter","map","takeWhile"],function(a,c){var d=c+1,_=d==ht||d==At;gt.prototype[a]=function($){var F=this.clone();return F.__iteratees__.push({iteratee:qe($,3),type:d}),F.__filtered__=F.__filtered__||_,F}}),Fr(["head","last"],function(a,c){var d="take"+(c?"Right":"");gt.prototype[a]=function(){return this[d](1).value()[0]}}),Fr(["initial","tail"],function(a,c){var d="drop"+(c?"":"Right");gt.prototype[a]=function(){return this.__filtered__?new gt(this):this[d](1)}}),gt.prototype.compact=function(){return this.filter(Sr)},gt.prototype.find=function(a){return this.filter(a).head()},gt.prototype.findLast=function(a){return this.reverse().find(a)},gt.prototype.invokeMap=ft(function(a,c){return typeof a=="function"?new gt(this):this.map(function(d){return ri(d,a,c)})}),gt.prototype.reject=function(a){return this.filter(Vi(qe(a)))},gt.prototype.slice=function(a,c){a=at(a);var d=this;return d.__filtered__&&(a>0||c<0)?new gt(d):(a<0?d=d.takeRight(-a):a&&(d=d.drop(a)),c!==t&&(c=at(c),d=c<0?d.dropRight(-c):d.take(c-a)),d)},gt.prototype.takeRightWhile=function(a){return this.reverse().takeWhile(a).reverse()},gt.prototype.toArray=function(){return this.take(Me)},qr(gt.prototype,function(a,c){var d=/^(?:filter|find|map|reject)|While$/.test(c),_=/^(?:head|last)$/.test(c),$=D[_?"take"+(c=="last"?"Right":""):c],F=_||/^find/.test(c);$&&(D.prototype[c]=function(){var N=this.__wrapped__,G=_?[1]:arguments,Y=N instanceof gt,me=G[0],ge=Y||it(N),ve=function(mt){var bt=$.apply(D,ln([mt],G));return _&&Te?bt[0]:bt};ge&&d&&typeof me=="function"&&me.length!=1&&(Y=ge=!1);var Te=this.__chain__,Ue=!!this.__actions__.length,Je=F&&!Te,ut=Y&&!Ue;if(!F&&ge){N=ut?N:new gt(this);var Xe=a.apply(N,G);return Xe.__actions__.push({func:zi,args:[ve],thisArg:t}),new Br(Xe,Te)}return Je&&ut?a.apply(this,G):(Xe=this.thru(ve),Je?_?Xe.value()[0]:Xe.value():Xe)})}),Fr(["pop","push","shift","sort","splice","unshift"],function(a){var c=yi[a],d=/^(?:push|sort|unshift)$/.test(a)?"tap":"thru",_=/^(?:pop|shift)$/.test(a);D.prototype[a]=function(){var $=arguments;if(_&&!this.__chain__){var F=this.value();return c.apply(it(F)?F:[],$)}return this[d](function(N){return c.apply(it(N)?N:[],$)})}}),qr(gt.prototype,function(a,c){var d=D[c];if(d){var _=d.name+"";St.call(Un,_)||(Un[_]=[]),Un[_].push({name:c,func:d})}}),Un[Bi(t,ne).name]=[{name:"wrapper",func:t}],gt.prototype.clone=Ac,gt.prototype.reverse=Cc,gt.prototype.value=kc,D.prototype.at=od,D.prototype.chain=sd,D.prototype.commit=ad,D.prototype.next=ud,D.prototype.plant=fd,D.prototype.reverse=ld,D.prototype.toJSON=D.prototype.valueOf=D.prototype.value=dd,D.prototype.first=D.prototype.head,Qn&&(D.prototype[Qn]=cd),D},Ln=ic();vn?((vn.exports=Ln)._=Ln,Zi._=Ln):ur._=Ln}).call(commonjsGlobal)})(lodash,lodashExports);var __extends$4=commonjsGlobal&&commonjsGlobal.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)o.hasOwnProperty(s)&&(n[s]=o[s])},r(e,t)};return function(e,t){r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),__decorate$5=commonjsGlobal&&commonjsGlobal.__decorate||function(r,e,t,n){var o=arguments.length,s=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,n);else for(var f=r.length-1;f>=0;f--)(u=r[f])&&(s=(o<3?u(s):o>3?u(e,t,s):u(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},__metadata$5=commonjsGlobal&&commonjsGlobal.__metadata||function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$3=commonjsGlobal&&commonjsGlobal.__param||function(r,e){return function(t,n){e(t,n,r)}},__generator$1=commonjsGlobal&&commonjsGlobal.__generator||function(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,u;return u={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function f(h){return function(p){return l([h,p])}}function l(h){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,o&&(s=h[0]&2?o.return:h[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,h[1])).done)return s;switch(o=0,s&&(h=[h[0]&2,s.value]),h[0]){case 0:case 1:s=h;break;case 4:return t.label++,{value:h[1],done:!1};case 5:t.label++,o=h[1],h=[0];continue;case 7:h=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(h[0]===6||h[0]===2)){t=0;continue}if(h[0]===3&&(!s||h[1]>s[0]&&h[1]<s[3])){t.label=h[1];break}if(h[0]===6&&t.label<s[1]){t.label=s[1],s=h;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(h);break}s[2]&&t.ops.pop(),t.trys.pop();continue}h=e.call(r,t)}catch(p){h=[6,p],o=0}finally{n=s=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}},__importDefault$5=commonjsGlobal&&commonjsGlobal.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(topk,"__esModule",{value:!0});var base_filter_1$4=__importDefault$5(baseFilter),count_min_sketch_1$1=__importDefault$5(countMinSketch),exportable_1$5=exportable,lodash_1$2=lodashExports,MinHeap=function(){function r(){this._content=[]}return Object.defineProperty(r.prototype,"length",{get:function(){return this._content.length},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"content",{get:function(){return this._content},set:function(e){this._content=e},enumerable:!0,configurable:!0}),r.prototype.get=function(e){return this._content[e]},r.prototype.add=function(e){var t=lodash_1$2.sortedIndexBy(this._content,e,function(n){return n.frequency});this._content.splice(t,0,e)},r.prototype.remove=function(e){this._content.splice(e,1)},r.prototype.popMin=function(){return this._content.shift()},r.prototype.indexOf=function(e){return this._content.findIndex(function(t){return t.value===e})},r.prototype.clear=function(){this._content=[]},r}(),TopK=function(r){__extends$4(e,r);function e(t,n,o){var s=r.call(this)||this;return s._k=t,s._errorRate=n,s._accuracy=o,s._sketch=count_min_sketch_1$1.default.create(n,o),s._heap=new MinHeap,s}return e.prototype.add=function(t){this._sketch.update(t);var n=this._sketch.count(t);if(this._heap.length<this._k||n>=this._heap.get(0).frequency){var o=this._heap.indexOf(t);o>-1&&this._heap.remove(o),this._heap.add({value:t,frequency:n}),this._heap.length>this._k&&this._heap.popMin()}},e.prototype.clear=function(){this._sketch=count_min_sketch_1$1.default.create(this._errorRate,this._accuracy),this._heap.clear()},e.prototype.values=function(){for(var t=[],n=this._heap.length-1;n>=0;n--){var o=this._heap.get(n);t.push({value:o.value,frequency:o.frequency,rank:this._heap.length-n})}return t},e.prototype.iterator=function(){var t=this._heap;return function(){var n,o;return __generator$1(this,function(s){switch(s.label){case 0:n=t.length-1,s.label=1;case 1:return n>=0?(o=t.get(n),[4,{value:o.value,frequency:o.frequency,rank:t.length-n}]):[3,4];case 2:s.sent(),s.label=3;case 3:return n--,[3,1];case 4:return[2]}})}()},__decorate$5([exportable_1$5.Field(),__metadata$5("design:type",Number)],e.prototype,"_k",void 0),__decorate$5([exportable_1$5.Field(),__metadata$5("design:type",Number)],e.prototype,"_errorRate",void 0),__decorate$5([exportable_1$5.Field(),__metadata$5("design:type",Number)],e.prototype,"_accuracy",void 0),__decorate$5([exportable_1$5.Field(),__metadata$5("design:type",count_min_sketch_1$1.default)],e.prototype,"_sketch",void 0),__decorate$5([exportable_1$5.Field(function(t){return t.content},function(t){var n=new MinHeap;return n.content=t,n}),__metadata$5("design:type",MinHeap)],e.prototype,"_heap",void 0),e=__decorate$5([exportable_1$5.AutoExportable("TopK",["_seed"]),__param$3(0,exportable_1$5.Parameter("_k")),__param$3(1,exportable_1$5.Parameter("_errorRate")),__param$3(2,exportable_1$5.Parameter("_accuracy")),__metadata$5("design:paramtypes",[Number,Number,Number])],e),e}(base_filter_1$4.default);topk.default=TopK;var minHash={},__extends$3=commonjsGlobal&&commonjsGlobal.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)o.hasOwnProperty(s)&&(n[s]=o[s])},r(e,t)};return function(e,t){r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),__decorate$4=commonjsGlobal&&commonjsGlobal.__decorate||function(r,e,t,n){var o=arguments.length,s=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,n);else for(var f=r.length-1;f>=0;f--)(u=r[f])&&(s=(o<3?u(s):o>3?u(e,t,s):u(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},__metadata$4=commonjsGlobal&&commonjsGlobal.__metadata||function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$2=commonjsGlobal&&commonjsGlobal.__param||function(r,e){return function(t,n){e(t,n,r)}},__read=commonjsGlobal&&commonjsGlobal.__read||function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,s=[],u;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(f){u={error:f}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(u)throw u.error}}return s},__spread=commonjsGlobal&&commonjsGlobal.__spread||function(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(__read(arguments[e]));return r},__importDefault$4=commonjsGlobal&&commonjsGlobal.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(minHash,"__esModule",{value:!0});var base_filter_1$3=__importDefault$4(baseFilter),exportable_1$4=exportable,utils_1$3=utils$3,lodash_1$1=lodashExports,EmptyMinHashError=function(r){__extends$3(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(Error);function applyHashFunction(r,e){return(e.a*r+e.b)%e.c}var MinHash=function(r){__extends$3(e,r);function e(t,n){var o=r.call(this)||this;return o._nbHashes=t,o._hashFunctions=n,o._signature=utils_1$3.allocateArray(o._nbHashes,1/0),o}return Object.defineProperty(e.prototype,"nbHashes",{get:function(){return this._nbHashes},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(){return this._signature[0]===1/0},e.prototype.add=function(t){for(var n=0;n<this._nbHashes;n++)this._signature[n]=Math.min(this._signature[n],applyHashFunction(t,this._hashFunctions[n]))},e.prototype.bulkLoad=function(t){for(var n=this,o=function(f){var l=t.map(function(h){return applyHashFunction(h,n._hashFunctions[f])});s._signature[f]=Math.min.apply(Math,__spread([s._signature[f]],l))},s=this,u=0;u<this._nbHashes;u++)o(u)},e.prototype.compareWith=function(t){if(this.isEmpty()||t.isEmpty())throw new EmptyMinHashError("Cannot compute a Jaccard similairty with a MinHash that contains no values");return lodash_1$1.intersection(this._signature,t._signature).length/this._nbHashes},__decorate$4([exportable_1$4.Field(),__metadata$4("design:type",Number)],e.prototype,"_nbHashes",void 0),__decorate$4([exportable_1$4.Field(),__metadata$4("design:type",Array)],e.prototype,"_hashFunctions",void 0),__decorate$4([exportable_1$4.Field(),__metadata$4("design:type",Array)],e.prototype,"_signature",void 0),e=__decorate$4([exportable_1$4.AutoExportable("MinHash",["_seed"]),__param$2(0,exportable_1$4.Parameter("_nbHashes")),__param$2(1,exportable_1$4.Parameter("_hashFunctions")),__metadata$4("design:paramtypes",[Number,Array])],e),e}(base_filter_1$3.default);minHash.MinHash=MinHash;var minHashFactory={};Object.defineProperty(minHashFactory,"__esModule",{value:!0});var min_hash_1$1=minHash,lodash_1=lodashExports;function isPrime(r){if(r!==2&&r%2===0)return!1;for(var e=2;e<Math.sqrt(r);e++)if(r%e===0)return!1;return!0}function closestPrime(r){for(var e=0;;){if(isPrime(r+e))return r+e;e++}}var MinHashFactory=function(){function r(e,t){this._nbHashes=e,this._maxValue=t,this._hashFunctions=[];for(var n=closestPrime(this._maxValue),o=0;o<this._nbHashes;o++){var s=lodash_1.random(0,this._maxValue,!1),u=lodash_1.random(0,this._maxValue,!1);this._hashFunctions.push({a:s,b:u,c:n})}}return r.prototype.create=function(){return new min_hash_1$1.MinHash(this._nbHashes,this._hashFunctions)},r}();minHashFactory.default=MinHashFactory;var cuckooFilter={},bucket={};function eq(r,e){return r===e||r!==r&&e!==e}var lodash_eq=eq,INFINITY=1/0,MAX_INTEGER=17976931348623157e292,NAN=0/0,symbolTag="[object Symbol]",reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt;function baseFindIndex(r,e,t,n){for(var o=r.length,s=t+(n?1:-1);n?s--:++s<o;)if(e(r[s],s,r))return s;return-1}function baseIndexOf(r,e,t){if(e!==e)return baseFindIndex(r,baseIsNaN,t);for(var n=t-1,o=r.length;++n<o;)if(r[n]===e)return n;return-1}function baseIsNaN(r){return r!==r}var objectProto=Object.prototype,objectToString=objectProto.toString,nativeMax=Math.max;function indexOf(r,e,t){var n=r?r.length:0;if(!n)return-1;var o=t==null?0:toInteger(t);return o<0&&(o=nativeMax(n+o,0)),baseIndexOf(r,e,o)}function isObject(r){var e=typeof r;return!!r&&(e=="object"||e=="function")}function isObjectLike(r){return!!r&&typeof r=="object"}function isSymbol(r){return typeof r=="symbol"||isObjectLike(r)&&objectToString.call(r)==symbolTag}function toFinite(r){if(!r)return r===0?r:0;if(r=toNumber(r),r===INFINITY||r===-INFINITY){var e=r<0?-1:1;return e*MAX_INTEGER}return r===r?r:0}function toInteger(r){var e=toFinite(r),t=e%1;return e===e?t?e-t:e:0}function toNumber(r){if(typeof r=="number")return r;if(isSymbol(r))return NAN;if(isObject(r)){var e=typeof r.valueOf=="function"?r.valueOf():r;r=isObject(e)?e+"":e}if(typeof r!="string")return r===0?r:+r;r=r.replace(reTrim,"");var t=reIsBinary.test(r);return t||reIsOctal.test(r)?freeParseInt(r.slice(2),t?2:8):reIsBadHex.test(r)?NAN:+r}var lodash_indexof=indexOf,__decorate$3=commonjsGlobal&&commonjsGlobal.__decorate||function(r,e,t,n){var o=arguments.length,s=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,n);else for(var f=r.length-1;f>=0;f--)(u=r[f])&&(s=(o<3?u(s):o>3?u(e,t,s):u(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},__metadata$3=commonjsGlobal&&commonjsGlobal.__metadata||function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__importDefault$3=commonjsGlobal&&commonjsGlobal.__importDefault||function(r){return r&&r.__esModule?r:{default:r}},__importStar=commonjsGlobal&&commonjsGlobal.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)Object.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e.default=r,e};Object.defineProperty(bucket,"__esModule",{value:!0});var lodash_eq_1=__importDefault$3(lodash_eq),lodash_indexof_1=__importDefault$3(lodash_indexof),utils$1=__importStar(utils$3),exportable_1$3=exportable,exportable_2=exportable,Bucket=function(){function r(t){this._elements=utils$1.allocateArray(t,null),this._size=t,this._length=0}e=r,Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),r.prototype.isFree=function(){return this._length<this._size},r.prototype.nextEmptySlot=function(){return lodash_indexof_1.default(this._elements,null)},r.prototype.at=function(t){return this._elements[t]},r.prototype.add=function(t){return t===null||!this.isFree()?!1:(this.set(this.nextEmptySlot(),t),this._length++,!0)},r.prototype.remove=function(t){var n=lodash_indexof_1.default(this._elements,t);return n<=-1?!1:(this.unset(n),!0)},r.prototype.has=function(t){return lodash_indexof_1.default(this._elements,t)>-1},r.prototype.set=function(t,n){this._elements[t]=n},r.prototype.unset=function(t){this._elements[t]=null,this._length--},r.prototype.swapRandom=function(t,n){n===void 0&&(n=Math.random);var o=utils$1.randomInt(0,this._length-1,n),s=this._elements[o];return this._elements[o]=t,s},r.prototype.swap=function(t,n){var o=this._elements[t];return this._elements[t]=n,o},r.prototype.equals=function(t){return this._size!==t.size||this._length!==t.length?!1:this._elements.every(function(n,o){return lodash_eq_1.default(t.at(o),n)})};var e;return r=e=__decorate$3([exportable_1$3.Exportable({export:exportable_2.cloneObject("Bucket","_size","_elements"),import:function(t){if(t.type!=="Bucket"||"_size"in t,!("_elements"in t))throw new Error("Cannot create a Bucket from a JSON export which does not represent a bucket");var n=new e(t._size);return t._elements.forEach(function(o,s){o!==null&&(n._elements[s]=o,n._length++)}),n}}),__metadata$3("design:paramtypes",[Number])],r),r}();bucket.default=Bucket;var __extends$2=commonjsGlobal&&commonjsGlobal.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)o.hasOwnProperty(s)&&(n[s]=o[s])},r(e,t)};return function(e,t){r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),__decorate$2=commonjsGlobal&&commonjsGlobal.__decorate||function(r,e,t,n){var o=arguments.length,s=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,n);else for(var f=r.length-1;f>=0;f--)(u=r[f])&&(s=(o<3?u(s):o>3?u(e,t,s):u(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},__metadata$2=commonjsGlobal&&commonjsGlobal.__metadata||function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__importDefault$2=commonjsGlobal&&commonjsGlobal.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(cuckooFilter,"__esModule",{value:!0});var base_filter_1$2=__importDefault$2(baseFilter),bucket_1=__importDefault$2(bucket),exportable_1$2=exportable,utils_1$2=utils$3;function computeFingerpintLength(r,e){var t=Math.ceil(Math.log2(1/e)+Math.log2(2*r));return Math.ceil(t/4)}var CuckooFilter=function(r){__extends$2(e,r);function e(n,o,s,u){u===void 0&&(u=500);var f=r.call(this)||this;return f._filter=utils_1$2.allocateArray(n,function(){return new bucket_1.default(s)}),f._size=n,f._bucketSize=s,f._fingerprintLength=o,f._length=0,f._maxKicks=u,f}t=e,e.create=function(n,o,s,u){s===void 0&&(s=4),u===void 0&&(u=500);var f=computeFingerpintLength(s,o),l=Math.ceil(n/s/.955);return new t(l,f,s,u)},e.from=function(n,o,s,u){s===void 0&&(s=4),u===void 0&&(u=500);var f=Array.from(n),l=t.create(f.length,o,s,u);return f.forEach(function(h){return l.add(h)}),l},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullSize",{get:function(){return this.size*this.bucketSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fingerprintLength",{get:function(){return this._fingerprintLength},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bucketSize",{get:function(){return this._bucketSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxKicks",{get:function(){return this._maxKicks},enumerable:!0,configurable:!0}),e.prototype.add=function(n,o,s){o===void 0&&(o=!1),s===void 0&&(s=!1);var u=this._locations(n);if(this._filter[u.firstIndex].isFree())this._filter[u.firstIndex].add(u.fingerprint);else if(this._filter[u.secondIndex].isFree())this._filter[u.secondIndex].add(u.fingerprint);else{for(var f=this.random()<.5?u.firstIndex:u.secondIndex,l=u.fingerprint,h=[],p=0;p<this._maxKicks;p++){var m=utils_1$2.randomInt(0,this._filter[f].length-1,this.random),b=this._filter[f].at(m);h.push([f,m,b]),this._filter[f].set(m,l),l=b;var S=utils_1$2.hashAsInt(l,this.seed,64);if(f=Math.abs(f^Math.abs(S))%this._filter.length,this._filter[f].isFree())return this._filter[f].add(l),this._length++,!0}if(!s)for(var A=h.length-1;A>=0;A--){var L=h[A];this._filter[L[0]].set(L[1],L[2])}if(o)throw new Error('The Cuckoo Filter is full, cannot insert element "'+n+'"');return!1}return this._length++,!0},e.prototype.remove=function(n){var o=this._locations(n);return this._filter[o.firstIndex].has(o.fingerprint)?(this._filter[o.firstIndex].remove(o.fingerprint),this._length--,!0):this._filter[o.secondIndex].has(o.fingerprint)?(this._filter[o.secondIndex].remove(o.fingerprint),this._length--,!0):!1},e.prototype.has=function(n){var o=this._locations(n);return this._filter[o.firstIndex].has(o.fingerprint)||this._filter[o.secondIndex].has(o.fingerprint)},e.prototype.rate=function(){var n=this._computeHashTableLoad(),o=this._fingerprintLength/n.load;return Math.pow(2,Math.log2(2*this._bucketSize)-n.load*o)},e.prototype._computeHashTableLoad=function(){var n=this._filter.length*this._bucketSize,o=this._filter.reduce(function(s,u){return s+u.length},0);return{used:o,free:n-o,size:n,load:o/n}},e.prototype._locations=function(n){var o=utils_1$2.hashIntAndString(n,this.seed,16,64),s=o.int;if(this._fingerprintLength>o.string.length)throw new Error("The fingerprint length ("+this._fingerprintLength+") is higher than the hash length ("+o.string.length+"). Please reduce the fingerprint length or report if it is an unexpected behavior.");var u=o.string.substring(0,this._fingerprintLength),f=Math.abs(s),l=Math.abs(utils_1$2.hashAsInt(u,this.seed,64)),h=Math.abs(f^l),p={fingerprint:u,firstIndex:f%this._size,secondIndex:h%this._size};return p},e.prototype.equals=function(n){for(var o=0,s=!0;s&&o<this._filter.length;){var u=this._filter[o];n._filter[o].equals(u)||(s=!1),o++}return s};var t;return e=t=__decorate$2([exportable_1$2.Exportable({export:exportable_1$2.cloneObject("CuckooFilter","_size","_fingerprintLength","_length","_maxKicks","_filter","_seed"),import:function(n){if(n.type!=="CuckooFilter"||!("_size"in n)||!("_fingerprintLength"in n)||!("_length"in n)||!("_maxKicks"in n)||!("_filter"in n)||!("_seed"in n))throw new Error("Cannot create a CuckooFilter from a JSON export which does not represent a cuckoo filter");var o=new t(n._size,n._fingerprintLength,n._bucketSize,n._maxKicks);return o._length=n._length,o._filter=n._filter.map(function(s){var u=new bucket_1.default(s._size);return s._elements.forEach(function(f,l){f!==null&&(u._elements[l]=f,u._length++)}),u}),o.seed=n.seed,o}}),__metadata$2("design:paramtypes",[Number,Number,Number,Number])],e),e}(base_filter_1$2.default);cuckooFilter.default=CuckooFilter;var invertibleBloomLookupTables={},cell={},__extends$1=commonjsGlobal&&commonjsGlobal.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)o.hasOwnProperty(s)&&(n[s]=o[s])},r(e,t)};return function(e,t){r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),__decorate$1=commonjsGlobal&&commonjsGlobal.__decorate||function(r,e,t,n){var o=arguments.length,s=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,n);else for(var f=r.length-1;f>=0;f--)(u=r[f])&&(s=(o<3?u(s):o>3?u(e,t,s):u(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},__metadata$1=commonjsGlobal&&commonjsGlobal.__metadata||function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$1=commonjsGlobal&&commonjsGlobal.__param||function(r,e){return function(t,n){e(t,n,r)}},__importDefault$1=commonjsGlobal&&commonjsGlobal.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(cell,"__esModule",{value:!0});var buffer_1$1=buffer,utils_1$1=utils$3,exportable_1$1=exportable,base_filter_1$1=__importDefault$1(baseFilter),inspect$1=Symbol.for("nodejs.util.inspect.custom"),Cell=function(r){__extends$1(e,r);function e(n,o,s){var u=r.call(this)||this;return u._idSum=n,u._hashSum=o,u._count=s,u}t=e,e.empty=function(){return new t(buffer_1$1.Buffer.allocUnsafe(0).fill(0),buffer_1$1.Buffer.allocUnsafe(0).fill(0),0)},e.prototype[inspect$1]=function(){return"Cell:<"+JSON.stringify(this._idSum.toJSON().data)+", "+JSON.stringify(this._hashSum.toJSON().data)+", "+this._count+">"},Object.defineProperty(e.prototype,"idSum",{get:function(){return this._idSum},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hashSum",{get:function(){return this._hashSum},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),e.prototype.add=function(n,o){this._idSum=utils_1$1.xorBuffer(this._idSum,n),this._hashSum=utils_1$1.xorBuffer(this._hashSum,o),this._count++},e.prototype.xorm=function(n){return new t(utils_1$1.xorBuffer(this._idSum,n.idSum),utils_1$1.xorBuffer(this._hashSum,n.hashSum),this._count-n.count)},e.prototype.isEmpty=function(){return this._idSum.equals(buffer_1$1.Buffer.from(""))&&this._hashSum.equals(buffer_1$1.Buffer.from(""))&&this._count===0},e.prototype.equals=function(n){return this._count===n.count&&this._idSum.equals(n.idSum)&&this._hashSum.equals(n.hashSum)},e.prototype.isPure=function(){if(this.isEmpty()||this._count!==1&&this._count!==-1)return!1;var n=utils_1$1.hashTwiceAsString(JSON.stringify(this._idSum.toJSON()),this.seed);return this._hashSum.equals(buffer_1$1.Buffer.from(n.first))};var t;return __decorate$1([exportable_1$1.Field(function(n){return n.toString()},buffer_1$1.Buffer.from),__metadata$1("design:type",Object)],e.prototype,"_idSum",void 0),__decorate$1([exportable_1$1.Field(function(n){return n.toString()},buffer_1$1.Buffer.from),__metadata$1("design:type",Object)],e.prototype,"_hashSum",void 0),__decorate$1([exportable_1$1.Field(),__metadata$1("design:type",Number)],e.prototype,"_count",void 0),e=t=__decorate$1([exportable_1$1.AutoExportable("Cell",["_seed"]),__param$1(0,exportable_1$1.Parameter("_idSum")),__param$1(1,exportable_1$1.Parameter("_hashSum")),__param$1(2,exportable_1$1.Parameter("_count")),__metadata$1("design:paramtypes",[Object,Object,Number])],e),e}(base_filter_1$1.default);cell.default=Cell;var __extends=commonjsGlobal&&commonjsGlobal.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)o.hasOwnProperty(s)&&(n[s]=o[s])},r(e,t)};return function(e,t){r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),__decorate=commonjsGlobal&&commonjsGlobal.__decorate||function(r,e,t,n){var o=arguments.length,s=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,n);else for(var f=r.length-1;f>=0;f--)(u=r[f])&&(s=(o<3?u(s):o>3?u(e,t,s):u(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},__metadata=commonjsGlobal&&commonjsGlobal.__metadata||function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param=commonjsGlobal&&commonjsGlobal.__param||function(r,e){return function(t,n){e(t,n,r)}},__generator=commonjsGlobal&&commonjsGlobal.__generator||function(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,u;return u={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function f(h){return function(p){return l([h,p])}}function l(h){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,o&&(s=h[0]&2?o.return:h[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,h[1])).done)return s;switch(o=0,s&&(h=[h[0]&2,s.value]),h[0]){case 0:case 1:s=h;break;case 4:return t.label++,{value:h[1],done:!1};case 5:t.label++,o=h[1],h=[0];continue;case 7:h=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(h[0]===6||h[0]===2)){t=0;continue}if(h[0]===3&&(!s||h[1]>s[0]&&h[1]<s[3])){t.label=h[1];break}if(h[0]===6&&t.label<s[1]){t.label=s[1],s=h;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(h);break}s[2]&&t.ops.pop(),t.trys.pop();continue}h=e.call(r,t)}catch(p){h=[6,p],o=0}finally{n=s=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}},__importDefault=commonjsGlobal&&commonjsGlobal.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(invertibleBloomLookupTables,"__esModule",{value:!0});var buffer_1=buffer,base_filter_1=__importDefault(baseFilter),cell_1$1=__importDefault(cell),exportable_1=exportable,utils_1=utils$3,formulas_1=formulas,InvertibleBloomFilter=function(r){__extends(e,r);function e(n,o){o===void 0&&(o=3);var s=r.call(this)||this;if(buffer_1.Buffer===void 0)throw new Error('No native Buffer implementation bound in your JavaScript env. If you are in a Web browser, consider importing the polyfill "feross/buffer" (https://github.com/feross/buffer).');if(o<=0)throw new Error("The hashCount must be a non-zero, positive integer");return s._size=n,s._hashCount=o,s._elements=utils_1.allocateArray(s._size,function(){return cell_1$1.default.empty()}),s}t=e,e.create=function(n,o){var s=formulas_1.optimalFilterSize(n,o),u=formulas_1.optimalHashes(s,n);return new t(s,u)},e.from=function(n,o){var s=Array.from(n),u=t.create(s.length,o);return s.forEach(function(f){return u.add(f)}),u},Object.defineProperty(e.prototype,"hashCount",{get:function(){return this._hashCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._elements.reduce(function(n,o){return n+o.count},0)/this._hashCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elements",{get:function(){return this._elements},enumerable:!0,configurable:!0}),e.prototype.add=function(n){for(var o=utils_1.allInOneHashTwice(JSON.stringify(n.toJSON()),this.seed),s=utils_1.getDistinctIndices(o.string.first,this._size,this._hashCount,this.seed),u=0;u<this._hashCount;++u)this._elements[s[u]].add(n,buffer_1.Buffer.from(o.string.first))},e.prototype.remove=function(n){for(var o=utils_1.allInOneHashTwice(JSON.stringify(n.toJSON()),this.seed),s=utils_1.getDistinctIndices(o.string.first,this.size,this._hashCount,this.seed),u=0;u<this._hashCount;++u)this._elements[s[u]]=this._elements[s[u]].xorm(new cell_1$1.default(buffer_1.Buffer.from(n),buffer_1.Buffer.from(o.string.first),1));return!0},e.prototype.has=function(n){for(var o=utils_1.allInOneHashTwice(JSON.stringify(n.toJSON()),this.seed),s=utils_1.getDistinctIndices(o.string.first,this.size,this._hashCount,this.seed),u=0;u<this._hashCount;++u){if(this._elements[s[u]].count===0)return!1;if(this._elements[s[u]].count===1)return!!this._elements[s[u]].idSum.equals(n)}return!0},e.prototype.listEntries=function(){var n=this,o=[];return function(){var s,u,f;return __generator(this,function(l){switch(l.label){case 0:s=function(h){var p;return __generator(this,function(m){switch(m.label){case 0:return p=n._elements[h],p.count>0&&o.findIndex(function(b){return b.equals(p.idSum)})===-1?n.has(p.idSum)?(o.push(p.idSum),[4,p.idSum]):[3,2]:[3,3];case 1:return m.sent(),[3,3];case 2:return[2,{value:!1}];case 3:return[2]}})},u=0,l.label=1;case 1:return u<n._elements.length-1?[5,s(u)]:[3,4];case 2:if(f=l.sent(),typeof f=="object")return[2,f.value];l.label=3;case 3:return u++,[3,1];case 4:return[2,!0]}})}()},e.prototype.substract=function(n){if(this.size!==n.size)throw new Error("The two Invertible Bloom Filters must be of the same size");var o=new t(n._size,n._hashCount);o.seed=this.seed;for(var s=0;s<this.size;++s)o._elements[s]=this._elements[s].xorm(n._elements[s]);return o},e.prototype.equals=function(n){if(n._size!==this._size||n._hashCount!==this._hashCount||n.seed!==this.seed)return!1;for(var o=0;o<n._elements.length;++o)if(!n._elements[o].equals(this._elements[o]))return!1;return!0},e.prototype.decode=function(n,o){n===void 0&&(n=[]),o===void 0&&(o=[]);for(var s=[],u=null,f=0;f<this._elements.length;++f)u=this._elements[f],u.isPure()&&s.push(f);for(;s.length!==0;){u=this._elements[s.pop()];var l=u.idSum,h=u.count;if(u.isPure()){if(h===1)n.push(l);else if(h===-1)o.push(l);else throw new Error("Please report, not possible");for(var p=utils_1.allInOneHashTwice(JSON.stringify(l.toJSON()),this.seed),m=utils_1.getDistinctIndices(p.string.first,this._size,this._hashCount,this.seed),f=0;f<m.length;++f)this._elements[m[f]]=this._elements[m[f]].xorm(new cell_1$1.default(l,buffer_1.Buffer.from(p.string.first),h)),this._elements[m[f]].isPure()&&s.push(m[f])}}return this._elements.findIndex(function(b){return!b.isEmpty()})>-1?{success:!1,reason:{cell:u,iblt:this},additional:n,missing:o}:{success:!0,additional:n,missing:o}};var t;return __decorate([exportable_1.Field(),__metadata("design:type",Number)],e.prototype,"_size",void 0),__decorate([exportable_1.Field(),__metadata("design:type",Number)],e.prototype,"_hashCount",void 0),__decorate([exportable_1.Field(void 0,function(n){return n.map(function(o){var s=new cell_1$1.default(buffer_1.Buffer.from(o._idSum),buffer_1.Buffer.from(o._hashSum),o._count);return s.seed=o._seed,s})}),__metadata("design:type",Array)],e.prototype,"_elements",void 0),e=t=__decorate([exportable_1.AutoExportable("InvertibleBloomFilter",["_seed"]),__param(0,exportable_1.Parameter("_size")),__param(1,exportable_1.Parameter("_hashCount")),__metadata("design:paramtypes",[Number,Number])],e),e}(base_filter_1.default);invertibleBloomLookupTables.default=InvertibleBloomFilter;Object.defineProperty(api,"__esModule",{value:!0});var bloom_filter_1=bloomFilter,BloomFilter=api.BloomFilter=bloom_filter_1.default,counting_bloom_filter_1=countingBloomFilter;api.CountingBloomFilter=counting_bloom_filter_1.default;var partitioned_bloom_filter_1=partitionedBloomFilter;api.PartitionedBloomFilter=partitioned_bloom_filter_1.default;var count_min_sketch_1=countMinSketch;api.CountMinSketch=count_min_sketch_1.default;var hyperloglog_1=hyperloglog;api.HyperLogLog=hyperloglog_1.default;var topk_1=topk;api.TopK=topk_1.default;var min_hash_1=minHash;api.MinHash=min_hash_1.MinHash;var min_hash_factory_1=minHashFactory;api.MinHashFactory=min_hash_factory_1.default;var cuckoo_filter_1=cuckooFilter;api.CuckooFilter=cuckoo_filter_1.default;var invertible_bloom_lookup_tables_1=invertibleBloomLookupTables;api.InvertibleBloomFilter=invertible_bloom_lookup_tables_1.default;var cell_1=cell;api.Cell=cell_1.default;const FILTER_SIZE=1024,HASH_COUNT=16,SATURATION_THRESHOLD=320,createBare=async(r,e)=>{const t="0".repeat(FILTER_SIZE/4);return addToBare(r,t,legacyEncodingMistake(e,"base64pad"))},addToBare=async(r,e,t)=>{const n=fromHex(e),o=await r.hash.sha256(t);return n.add(toString$7(o,"hex")),await toHex(n)},addRevision=async(r,e,t,n)=>{const o=toString$7(t,"base64pad"),s=fromString$7(`${n}${o}`,"utf8");return await addToBare(r,e,s)},toPrivateName=async(r,e)=>{const t=await saturateFilter(r,fromHex(e));return toHash(r,t)},toHash=async(r,e)=>{const t=e.toBytes(),n=await r.hash.sha256(t);return fromBytes$1(n)},saturate=async(r,e,t=SATURATION_THRESHOLD)=>{const n=await saturateFilter(r,fromHex(e),t);return await toHex(n)},saturateFilter=async(r,e,t=SATURATION_THRESHOLD)=>{if(t>e.toBytes().byteLength*8)throw new Error("threshold is bigger than filter size");if(countOnes(e)>=t)return e;const o=e.toBytes();let s=o;do{const u=await r.hash.sha256(s);e.add(fromBytes$1(u)),s=u}while(bufEquals(o,e.toBytes()));return saturateFilter(r,e,t)},countOnes=r=>{const e=new Uint32Array(r.toBytes());let t=0;for(let n=0;n<e.length;n++)t+=bitCount32(e[n]);return t},toHex=r=>fromBytes$1(r.toBytes()),fromHex=r=>{const e=toBytes$1(r);return BloomFilter.fromBytes(e,HASH_COUNT)},bufEquals=(r,e)=>{if(r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let o=0;o<t.length;o++)if(t[o]!==n[o])return!1;return!0},bitCount32=r=>{const e=r-(r>>1&1431655765),t=(e&858993459)+(e>>2&858993459);return(t+(t>>4)&252645135)*16843009>>24};function legacyEncodingMistake(r,e){return fromString$7(toString$7(r,e),"utf8")}const addNode=async(r,e,t,n,o)=>{const{cid:s,size:u}=await putEncryptedFile(r,e,n,o),f=await addRevision(e,n.bareNameFilter,o,n.revision),l=await toPrivateName(e,f);if(await t.add(l,s),isPrivateFileInfo(n)){const m=fromString$7(n.key,"base64pad"),b=await addToBare(e,n.bareNameFilter,legacyEncodingMistake(m,"base64pad")),S=await addRevision(e,b,m,n.revision),A=await toPrivateName(e,S);await t.add(A,decodeCID(n.content))}const[h,p]=isPrivateFileInfo(n)?[{},!0]:[n.skeleton,!1];return{cid:s,name:l,key:o,size:u,isFile:p,skeleton:h}},readNode=async(r,e,t,n)=>{const o=await getEncryptedFile(r,e,t,n),s=JSON.parse(toString$7(o,"utf8"));if(!isDecryptedNode(s))throw new Error(`Could not parse a valid filesystem object: ${s}`);return s},getByName=async(r,e,t,n,o)=>{const s=await t.get(n);return s===null?null:getByCID(r,e,s,o)},getByCID=async(r,e,t,n)=>await readNode(r,e,t,n),getLatestByName=async(r,e,t,n,o)=>{const s=await t.get(n);return s===null?null:getLatestByCID(r,e,t,s,o)},getLatestByCID=async(r,e,t,n,o)=>{const s=await getByCID(r,e,n,o),u=await findLatestRevision(e,t,s.bareNameFilter,o,s.revision);return u!=null&&u.cid?await getByCID(r,e,decodeCID(u==null?void 0:u.cid),o):s},getLatestByBareNameFilter=async(r,e,t,n,o)=>{const s=await addRevision(e,n,o,1),u=await toPrivateName(e,s);return getLatestByName(r,e,t,u,o)},findLatestRevision=async(r,e,t,n,o)=>{let s=o,u=null,f=0,l=null;for(;u===null;){const h=o+Math.pow(2,f),p=await getRevision(r,e,t,n,h);p!==null?(l=p,s=h):u=h,f++}for(;s<u-1;){const h=Math.floor((u+s)/2),p=await getRevision(r,e,t,n,h);p!==null?(l=p,s=h):u=h}return l},getRevision=async(r,e,t,n,o)=>{const s=await addRevision(r,t,n,o),u=await toPrivateName(r,s),f=await e.get(u);return f?{cid:f,name:u,number:o}:null};async function namefilter(r,{bareFilter:e,shareKey:t}){const n=await r.hash.sha256(fromString$7(t,"base64pad"));return saturate(r,await addToBare(r,e,legacyEncodingMistake(n,"hex")))}async function create$4(r,{counter:e,recipientExchangeDid:t,senderRootDid:n}){const o=fromString$7(`${t}${n}${e}`,"utf8");return toString$7(await r.hash.sha256(o),"base64pad")}function payload({entryIndexCid:r,symmKey:e,symmKeyAlgo:t}){const n=r;return{algo:t,key:typeof e=="string"?fromString$7(e,"base64pad"):e,cid:n}}class BaseFile{constructor(e){this.content=e,this.readOnly=!1}async put(){const{cid:e}=await this.putDetailed();return e}async updateContent(e){if(this.readOnly)throw new Error("File is read-only");return this.content=e,this}}class BareFile extends BaseFile{constructor(e,t){super(t),this.depot=e}static create(e,t){return new BareFile(e,t)}static async fromCID(e,t){const n=await getFile(e,t);return new BareFile(e,n)}static instanceOf(e){return isObject$1(e)&&hasProp(e,"content")}async put(){const{cid:e}=await this.putDetailed();return e}async putDetailed(){return putFile$1(this.depot,this.content)}}class BaseTree{constructor(){this.readOnly=!1}async put(){const{cid:e}=await this.putDetailed();return e}async ls(e){const t=await this.get(e);if(t===null)throw new Error("Path does not exist");if(isFile(t))throw new Error("Can not `ls` a file");return t.getLinks()}async cat(e){const t=await this.get(e);if(t===null)throw new Error("Path does not exist");if(!isFile(t))throw new Error("Can not `cat` a directory");return t.content}async mkdir(e){return this.mkdirRecurse(e,()=>this.put())}async mkdirRecurse(e,t){const[n,...o]=e;if(!n)throw new Error("Invalid path: empty");const s=await this.getOrCreateDirectChild(n,t);if(isFile(s))throw new Error(`There is a file along the given path: ${log$8(e)}`);return o.length&&await s.mkdirRecurse(o,()=>this.updateDirectChild(s,n,t)),this}async add(e,t){return await this.addRecurse(e,t,()=>this.put()),this}async addRecurse(e,t,n){const[o,...s]=e;if(!o)throw new Error("Invalid path: empty");if(s.length===0)await this.createOrUpdateChildFile(t,o,n);else{const u=await this.getOrCreateDirectChild(o,n);if(isFile(u))throw new Error(`There is a file along the given path: ${log$8(e)}`);await u.addRecurse(s,t,async()=>{await this.updateDirectChild(u,o,n)})}return this}async rm(e){return await this.rmRecurse(e,()=>this.put()),this}async rmRecurse(e,t){const[n,...o]=e;if(!n)throw new Error("Invalid path: empty");if(o.length===0)this.removeDirectChild(n),t&&await t();else{const s=await this.getDirectChild(n);if(s===null)throw new Error("Invalid path: does not exist");if(isFile(s))throw new Error(`There is a file along the given path: ${log$8(e)}`);await s.rmRecurse(o,async()=>{await this.updateDirectChild(s,n,t)})}return this}async mv(e,t){const n=await this.get(e);if(n===null)throw new Error(`Path does not exist: ${log$8(e)}`);if(t.length<1)throw new Error(`Path does not exist: ${log$8(t)}`);const o=t.slice(0,-1);let s=await this.get(o);if(!s)await this.mkdir(o),s=await this.get(o);else if(isFile(s))throw new Error(`Can not \`mv\` to a file: ${log$8(o)}`);return await this.rm(e),await[...t].reverse().reduce((u,f,l)=>u.then(async h=>{const p=t.slice(0,-(l+1)),m=p.length?await this.get(p):this;if(m&&!isFile(m))return await m.updateDirectChild(h,f,null),m;throw new Error("Failed to update tree while moving node")}),Promise.resolve(n)),this}async exists(e){return await this.get(e)!==null}read(e){return this.get(e)}write(e,t){return this.add(e,t)}async getOrCreateDirectChild(e,t){const n=await this.getDirectChild(e);return n!==null?n:this.createChildTree(e,t)}async updateChild(e,t){const n=[];return await t.reduce(async(o,s,u)=>{const f=await o;if(n.push([s,f]),u+1===t.length)return f;const l=await f.getDirectChild(s);if(!isTree(l)){const h=t.slice(u+1);throw new Error(`Expected a tree at the given path: ${log$8(h)}`)}return l},Promise.resolve(this)),await n.reverse().reduce(async(o,[s,u])=>(await u.updateDirectChild(await o,s,null),u),Promise.resolve(e)),this}}class BareTree extends BaseTree{constructor(e,t){super(),this.type="BareTree",this.links=t,this.children={},this.depot=e}static async empty(e){return new BareTree(e,{})}static async fromCID(e,t){const n=arrToMap(await e.getUnixDirectory(t));return new BareTree(e,n)}static fromLinks(e,t){return new BareTree(e,t)}static instanceOf(e){return isObject$1(e)&&hasProp(e,"links")&&hasProp(e,"children")&&hasProp(e,"type")&&e.type==="BareTree"}async createChildTree(e,t){const n=await BareTree.empty(this.depot),o=this.children[e];if(o){if(isFile(o))throw new Error(`There is a file at the given path: ${e}`);return o}return await this.updateDirectChild(n,e,t),n}async createOrUpdateChildFile(e,t,n){const o=await this.getDirectChild(t);let s;if(o===null)s=await BareFile.create(this.depot,e);else if(BareFile.instanceOf(o))s=await o.updateContent(e);else throw new Error(`There is already a directory with that name: ${t}`);return await this.updateDirectChild(s,t,n),s}async putDetailed(){return putLinks(this.depot,this.links)}async putAndUpdateLink(e,t,n){const o=await e.putDetailed();return this.updateLink(t,o),n&&await n(),this}async updateDirectChild(e,t,n){return this.children[t]=e,this.putAndUpdateLink(e,t,n)}removeDirectChild(e){return delete this.links[e],this.children[e]&&delete this.children[e],this}async getDirectChild(e){if(this.children[e])return this.children[e];const t=this.links[e]||null;if(t===null)return null;const n=decodeCID(t.cid),o=t.isFile?await BareFile.fromCID(this.depot,n):await BareTree.fromCID(this.depot,n);return this.children[e]?this.children[e]:(this.children[e]=o,o)}async get(e){const[t,...n]=e;if(!t)return this;const o=await this.getDirectChild(t);if(n.length){if(o===null||isFile(o))return null}else return o;return o.get(n)}updateLink(e,t){const{cid:n,size:o,isFile:s}=t;return this.links[e]=make(e,n,s,o),this}getLinks(){return this.links}}const nibbles={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0,a:!0,b:!0,c:!0,d:!0,e:!0,f:!0},isNibble=r=>nibbles[r]===!0;class MMPT{constructor(e,t){this.links=t,this.children={},this.depot=e}static create(e){return new MMPT(e,{})}static async fromCID(e,t){const n=await getSimpleLinks(e,t);return new MMPT(e,n)}async putDetailed(){return putLinks(this.depot,this.links)}async put(){const{cid:e}=await this.putDetailed();return e}async add(e,t){if(!isNibble(e[0]))throw new Error("Not a valid name, must be hexadecimal");const n=this.nextTreeOrSiblingName(e);if(e!==n)if(n===null)this.links[e]=make(e,t,!0,0);else if(n.length===1)await(await this.getDirectChild(n)).add(e.slice(1),t),await this.putAndUpdateChildLink(n);else{const o=this.addEmptyChild(e[0]),s=this.links[n].cid;this.removeChild(n),await Promise.all([o.add(e.slice(1),t),o.add(n.slice(1),decodeCID(s))]),await this.putAndUpdateChildLink(e[0])}}async putAndUpdateChildLink(e){var u,f;const t=(u=this.links[e])==null?void 0:u.cid,{cid:n,size:o}=await this.children[e].putDetailed(),s=(f=this.links[e])==null?void 0:f.cid;if(t!=s)return await this.putAndUpdateChildLink(e);this.links[e]=make(e,n,!1,o)}addEmptyChild(e){const t=MMPT.create(this.depot);return this.children[e]=t,t}async get(e){const t=this.nextTreeName(e);return t===null?null:t.length>1?decodeCID(this.links[t].cid):(await this.getDirectChild(t)).get(e.slice(1))}async exists(e){return await this.get(e)!==null}async members(){return(await Promise.all(Object.values(this.links).map(async({name:t,cid:n})=>t.length>1?[{name:t,cid:decodeCID(n)}]:(await(await MMPT.fromCID(this.depot,decodeCID(n))).members()).map(u=>({...u,name:t+u.name}))))).reduce((t,n)=>t.concat(n))}async getDirectChild(e){if(this.children[e])return this.children[e];const t=await MMPT.fromCID(this.depot,decodeCID(this.links[e].cid));return this.children[e]?this.children[e]:(this.children[e]=t,t)}removeChild(e){delete this.links[e],this.children[e]&&delete this.children[e]}directChildExists(e){return this.links[e]!==void 0||this.children[e]!==void 0}nextTreeName(e){return this.directChildExists(e[0])?e[0]:this.directChildExists(e)?e:null}nextTreeOrSiblingName(e){const t=e[0];return this.directChildExists(t)?t:Object.keys(this.links).find(n=>t===n[0])||null}}var UnixNodeType;(function(r){r.Raw="raw",r.Directory="dir",r.File="file",r.Metadata="metadata",r.Symlink="symlink",r.HAMTShard="hamtShard"})(UnixNodeType||(UnixNodeType={}));const emptyUnix=r=>({mtime:Date.now(),ctime:Date.now(),mode:r?644:755,_type:r?UnixNodeType.File:UnixNodeType.Directory}),empty=(r,e)=>({isFile:r,version:e,unixMeta:emptyUnix(r)}),updateMtime=r=>({...r,unixMeta:{...r.unixMeta,mtime:Date.now()}}),encode$4=(r,e,t)=>({major:r,minor:e,patch:t}),fromString$3=r=>{const e=r.split(".").map(t=>parseInt(t));return e.length!==3||e.some(t=>typeof t!="number")?null:{major:e[0],minor:e[1],patch:e[2]}},toString$3=r=>{const{major:e,minor:t,patch:n}=r;return`${e}.${t}.${n}`},equals$1=(r,e)=>r.major===e.major&&r.minor===e.minor&&r.patch===e.patch,isSmallerThan=(r,e)=>r.major!=e.major?r.major<e.major:r.minor!=e.minor?r.minor<e.minor:r.patch<e.patch,isBiggerThan=(r,e)=>isSmallerThan(e,r);function isBiggerThanOrEqualTo(r,e){return isSmallerThan(e,r)||equals$1(r,e)}const isSupported$1=r=>isSmallerThan(r,latest)?"too-low":isBiggerThan(r,wnfsWasm)?"too-high":!0,v0=encode$4(0,0,0),latest=encode$4(2,0,0),wnfsWasm=encode$4(3,0,0),supported=[latest,wnfsWasm];class PrivateHistory{constructor(e,t,n){this.crypto=e,this.depot=t,this.node=n}async back(e=-1){var o;const t=Math.min(e,-1),n=(o=this.node.header)==null?void 0:o.revision;return n&&await this._getRevision(n+t)||null}async prior(e){return this.node.header.metadata.unixMeta.mtime<e?this.node:this._prior(this.node.header.revision-1,e)}async list(e=5){const t=this.node.header.revision;return Promise.all(Array.from({length:e},(n,o)=>{const s=o+1;return this._getRevisionInfoFromNumber(t-s).then(u=>({revisionInfo:u,delta:-s}))})).then(n=>n.filter(o=>!!o.revisionInfo)).then(n=>n.map(o=>{const s=o.revisionInfo.metadata.unixMeta.mtime;return{delta:o.delta,timestamp:s}}))}async _getRevision(e){const t=await this._getRevisionInfoFromNumber(e);return t&&await this.node.fromInfo(this.node.mmpt,this.node.key,t)}_getRevisionInfo(e){return readNode(this.depot,this.crypto,decodeCID(e.cid),this.node.key)}async _getRevisionInfoFromNumber(e){const{mmpt:t}=this.node,{bareNameFilter:n}=this.node.header,o=this.node.key,s=await getRevision(this.crypto,t,n,o,e);return s&&this._getRevisionInfo(s)}async _prior(e,t){const n=await this._getRevisionInfoFromNumber(e);return n!=null&&n.revision?n.metadata.unixMeta.mtime<t?this._getRevision(n.revision):this._prior(n.revision-1,t):null}}class PrivateFile extends BaseFile{constructor({crypto:e,depot:t,content:n,mmpt:o,key:s,header:u}){super(n),this.crypto=e,this.depot=t,this.header=u,this.key=s,this.mmpt=o,this.history=new PrivateHistory(e,t,f(this));function f(l){return{...l,fromInfo:async(h,p,m)=>f(await PrivateFile.fromInfo(e,t,h,p,m))}}}static instanceOf(e){return isObject$1(e)&&hasProp(e,"content")&&hasProp(e,"mmpt")&&hasProp(e,"header")&&isPrivateFileInfo(e.header)}static async create(e,t,n,o,s,u){const f=await e.aes.exportKey(await e.aes.genKey(DEFAULT_AES_ALG)),l=await addToBare(e,s,legacyEncodingMistake(u,"base64pad")),h=await putEncryptedFile(t,e,o,f);return new PrivateFile({crypto:e,depot:t,content:o,mmpt:n,key:u,header:{bareNameFilter:l,key:toString$7(f,"base64pad"),revision:1,metadata:empty(!0,latest),content:encodeCID$1(h.cid)}})}static async fromBareNameFilter(e,t,n,o,s){const u=await getLatestByBareNameFilter(t,e,n,o,s);return this.fromInfo(e,t,n,s,u)}static async fromLatestName(e,t,n,o,s){const u=await getLatestByName(t,e,n,o,s);return PrivateFile.fromInfo(e,t,n,s,u)}static async fromName(e,t,n,o,s){const u=await getByName(t,e,n,o,s);return PrivateFile.fromInfo(e,t,n,s,u)}static async fromInfo(e,t,n,o,s){if(!isPrivateFileInfo(s))throw new Error("Could not parse a valid private file using the given key");const u=await getEncryptedFile(t,e,decodeCID(s.content),fromString$7(s.key,"base64pad"));return new PrivateFile({crypto:e,depot:t,content:u,key:o,mmpt:n,header:s})}async getName(){const{bareNameFilter:e,revision:t}=this.header,n=await addRevision(this.crypto,e,this.key,t);return toPrivateName(this.crypto,n)}async updateParentNameFilter(e){return this.header.bareNameFilter=await addToBare(this.crypto,e,legacyEncodingMistake(fromString$7(this.header.key,"base64pad"),"base64pad")),this}async updateContent(e){const t=await putEncryptedFile(this.depot,this.crypto,e,fromString$7(this.header.key,"base64pad"));return this.content=e,this.header={...this.header,revision:this.header.revision+1,content:encodeCID$1(t.cid)},this}async putDetailed(){return addNode(this.depot,this.crypto,this.mmpt,{...this.header,metadata:updateMtime(this.header.metadata)},this.key)}}class PrivateTree extends BaseTree{constructor({crypto:e,depot:t,manners:n,reference:o,mmpt:s,key:u,header:f}){super(),this.crypto=e,this.depot=t,this.manners=n,this.reference=o,this.children={},this.header=f,this.key=u,this.mmpt=s,this.history=new PrivateHistory(e,t,l(this));function l(h){return{...h,fromInfo:async(p,m,b)=>l(await PrivateTree.fromInfo(e,t,n,o,p,m,b))}}}static instanceOf(e){return isObject$1(e)&&hasProp(e,"mmpt")&&hasProp(e,"header")&&isPrivateTreeInfo(e.header)}static async create(e,t,n,o,s,u,f){const l=f?await addToBare(e,f,legacyEncodingMistake(u,"base64pad")):await createBare(e,u);return new PrivateTree({crypto:e,depot:t,manners:n,reference:o,mmpt:s,key:u,header:{metadata:empty(!1,latest),bareNameFilter:l,revision:1,links:{},skeleton:{}}})}static async fromBaseKey(e,t,n,o,s,u){const f=await createBare(e,u);return this.fromBareNameFilter(e,t,n,o,s,f,u)}static async fromBareNameFilter(e,t,n,o,s,u,f){const l=await getLatestByBareNameFilter(t,e,s,u,f);return this.fromInfo(e,t,n,o,s,f,l)}static async fromLatestName(e,t,n,o,s,u,f){const l=await getLatestByName(t,e,s,u,f);return this.fromInfo(e,t,n,o,s,f,l)}static async fromName(e,t,n,o,s,u,f){const l=await getByName(t,e,s,u,f);return this.fromInfo(e,t,n,o,s,f,l)}static async fromInfo(e,t,n,o,s,u,f){if(!isPrivateTreeInfo(f))throw new Error("Could not parse a valid private tree using the given key");return new PrivateTree({crypto:e,depot:t,manners:n,reference:o,mmpt:s,key:u,header:f})}async createChildTree(e,t){const n=await this.crypto.aes.genKey(DEFAULT_AES_ALG).then(this.crypto.aes.exportKey),o=await PrivateTree.create(this.crypto,this.depot,this.manners,this.reference,this.mmpt,n,this.header.bareNameFilter),s=this.children[e];if(s){if(PrivateFile.instanceOf(s))throw new Error(`There is a file at the given path: ${e}`);return s}return await this.updateDirectChild(o,e,t),o}async createOrUpdateChildFile(e,t,n){const o=await this.getDirectChild(t);let s;if(o===null){const u=await this.crypto.aes.genKey(DEFAULT_AES_ALG).then(this.crypto.aes.exportKey);s=await PrivateFile.create(this.crypto,this.depot,this.mmpt,e,this.header.bareNameFilter,u)}else if(PrivateFile.instanceOf(o))s=await o.updateContent(e);else throw new Error(`There is already a directory with that name: ${t}`);return await this.updateDirectChild(s,t,n),s}async putDetailed(){const e=Object.assign({},this.header);return e.skeleton=ensureSkeletonStringCIDs(e.skeleton),addNode(this.depot,this.crypto,this.mmpt,e,this.key)}async updateDirectChild(e,t,n){if(this.readOnly)throw new Error("Tree is read-only");await e.updateParentNameFilter(this.header.bareNameFilter),this.children[t]=e;const o=await e.putDetailed();return this.updateLink(t,o),n&&await n(),this}removeDirectChild(e){return this.header={...this.header,revision:this.header.revision+1,links:removeKeyFromObj(this.header.links,e),skeleton:removeKeyFromObj(this.header.skeleton,e)},this.children[e]&&delete this.children[e],this}async getDirectChild(e){let t=null;if(this.children[e])return this.children[e];const n=this.header.links[e];if(n===void 0)return null;if(isPrivateLink(n)){const o=fromString$7(n.key,"base64pad");t=n.isFile?await PrivateFile.fromLatestName(this.crypto,this.depot,this.mmpt,n.pointer,o):await PrivateTree.fromLatestName(this.crypto,this.depot,this.manners,this.reference,this.mmpt,n.pointer,o)}else if(isSoftLink(n))return PrivateTree.resolveSoftLink(this.crypto,this.depot,this.manners,this.reference,n);return this.children[e]?this.children[e]:(t&&(this.children[e]=t),t)}async getName(){const{bareNameFilter:e,revision:t}=this.header,n=await addRevision(this.crypto,e,this.key,t);return toPrivateName(this.crypto,n)}async updateParentNameFilter(e){return this.header.bareNameFilter=await addToBare(this.crypto,e,legacyEncodingMistake(this.key,"base64pad")),this}async get(e){if(e.length===0)return this;const[t,...n]=e,o=this.header.skeleton[t];return o===void 0?null:this.getRecurse(o,n)}async getRecurse(e,t){const[n,...o]=t;if(isSoftLink(e)){const l=await PrivateTree.resolveSoftLink(this.crypto,this.depot,this.manners,this.reference,e);if(!l)return null;if(n===void 0)return l;if(PrivateTree.instanceOf(l))return l.get(t).then(makeReadOnly$1);throw new Error("Was expecting a directory at: "+log$8(t))}if(n===void 0)return getNode(this.crypto,this.depot,this.manners,this.reference,this.mmpt,e);const s=e.subSkeleton[n];if(s!==void 0)return this.getRecurse(s,o);const u=await getLatestByCID(this.depot,this.crypto,this.mmpt,decodeCID(e.cid),fromString$7(e.key,"base64pad"));if(!isPrivateTreeInfo(u))return null;const f=u.skeleton[n];return f===void 0?null:this.getRecurse(f,o)}assignLink({name:e,link:t,skeleton:n}){this.header.links[e]=t,this.header.skeleton[e]=n,this.header.revision=this.header.revision+1,this.header.metadata.unixMeta.mtime=Date.now()}static async resolveSoftLink(e,t,n,o,s){const u=s.ipns.split("/")[0];if(!s.privateName||!s.key)throw new Error("Mixing public and private soft links is not supported yet.");const f=await o.dns.lookupDnsLink(u);if(!f)throw new Error(`Failed to resolve the soft link: ${s.ipns} - Could not resolve DNSLink`);const l=(await getSimpleLinks(t,decodeCID(f))).private.cid,h=await MMPT.fromCID(t,decodeCID(l)),p=fromString$7(s.key,"base64pad"),m=await getLatestByName(t,e,h,s.privateName,p);if(!m)return null;const b=m.metadata.isFile?await PrivateFile.fromInfo(e,t,h,p,m):await PrivateTree.fromInfo(e,t,n,o,h,p,m);return b&&(b.readOnly=!0),b}getLinks(){return mapObj(this.header.links,e=>{if(isSoftLink(e))return{...e};{const{key:t,...n}=e;return{...n}}})}updateLink(e,t){const{cid:n,size:o,isFile:s,skeleton:u}=t,f=toString$7(t.key,"base64pad"),l=t.name;return this.assignLink({name:e,link:{name:e,key:f,pointer:l,size:o,isFile:s},skeleton:{cid:encodeCID$1(n),key:f,subSkeleton:u}}),this}insertSoftLink({name:e,key:t,privateName:n,username:o}){const s={ipns:this.reference.dataRoot.domain(o),name:e,privateName:n,key:toString$7(t,"base64pad")};return this.assignLink({name:e,link:s,skeleton:s}),this}}async function getNode(r,e,t,n,o,s){const u=fromString$7(s.key,"base64pad"),f=await getLatestByCID(e,r,o,decodeCID(s.cid),u);return isPrivateFileInfo(f)?await PrivateFile.fromInfo(r,e,o,u,f):await PrivateTree.fromInfo(r,e,t,n,o,u,f)}function ensureSkeletonStringCIDs(r){return Object.entries(r).reduce((e,[t,n])=>{let o=n;return isPrivateSkeletonInfo(n)&&(n.cid=decodeCID(n.cid).toString(),n.subSkeleton=ensureSkeletonStringCIDs(n.subSkeleton)),{...e,[t]:o}},{})}function makeReadOnly$1(r){return r&&(r.readOnly=!0),r}const EXCHANGE_PATH=directory("public",".well-known","exchange");async function privateNode(r,e,t,n,o,s,{shareWith:u,sharedBy:f}){const l=Array.isArray(u)?u:u.startsWith("did:")?[u]:await listExchangeDIDs(e,n,u),h=o.sharedCounter||1,p=o.mmpt,m=await Promise.all(l.map(async de=>[de,await create$4(r,{counter:h,recipientExchangeDid:de,senderRootDid:f.rootDid})])),b=await r.aes.genKey(SymmAlg.AES_GCM).then(r.aes.exportKey),S=await PrivateTree.create(r,e,t,n,p,b,null);await Promise.all(s.map(async([de,H])=>{const z=await H.getName();return S.insertSoftLink({key:H.key,name:de,privateName:z,username:f.username})}));const A=SymmAlg.AES_GCM,L=Object.assign({},S.header),J=await putFile$1(e,await r.aes.encrypt(fromString$7(JSON.stringify(L),"utf8"),S.key,A));if(m.length){const de=await namefilter(r,{bareFilter:L.bareNameFilter,shareKey:m[0][1]});await p.add(de,J.cid)}const ne=encode$7(payload({entryIndexCid:encodeCID$1(J.cid),symmKey:S.key,symmKeyAlgo:A})),pe=await Promise.all(m.map(async([de,H])=>{const{publicKey:z}=didToPublicKey(r,de),ue=await r.rsa.encrypt(ne,z),ce=await e.putChunked(ue);return{name:H,cid:ce.cid,size:ce.size}}));return await o.addShares(pe),{shareId:h.toString(),sharedBy:f}}async function listExchangeDIDs(r,e,t){var h;const n=await e.dataRoot.lookup(t);if(!n)throw new Error("This person doesn't have a filesystem yet.");const s=((h=(await getSimpleLinks(r,n))[RootBranch.Pretty])==null?void 0:h.cid)||null;if(!s)throw new Error("This person's filesystem doesn't have a pretty tree.");const u=await BareTree.fromCID(r,decodeCID(s)),f=unwrap$2(removePartition(EXCHANGE_PATH)),l=await u.get(f);return l&&l instanceof BareTree?Object.keys(l.getLinks()):[]}async function addSampleData(r){await r.mkdir(directory("private","Apps")),await r.mkdir(directory("private","Audio")),await r.mkdir(directory("private","Documents")),await r.mkdir(directory("private","Photos")),await r.mkdir(directory("private","Video")),await r.write(file("private","Welcome.txt"),new TextEncoder().encode("Welcome to your personal transportable encrypted file system 👋"))}async function addPublicExchangeKey(r,e){const t=await exchange(r);await e.mkdir(combine(EXCHANGE_PATH,directory(t)))}async function hasPublicExchangeKey(r,e){const t=await exchange(r);return e.exists(combine(EXCHANGE_PATH,directory(t)))}async function retrieve({crypto:r,accountDID:e}){const t=await identifier(r,e);return r.keystore.exportSymmKey(t)}async function store({crypto:r,accountDID:e,readKey:t}){const n=await identifier(r,e);return r.keystore.importSymmKey(t,n)}function fromString$2(r){return fromString$7(r,"base64pad")}function identifier(r,e){const t=directory(RootBranch.Private);return readKey({crypto:r,path:t,accountDID:e})}var __classPrivateFieldSet$2=globalThis&&globalThis.__classPrivateFieldSet||function(r,e,t,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!o:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(r,t):o?o.value=t:e.set(r,t),t},__classPrivateFieldGet$3=globalThis&&globalThis.__classPrivateFieldGet||function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},_Session_crypto,_Session_storage;class Session{constructor(e){_Session_crypto.set(this,void 0),_Session_storage.set(this,void 0),__classPrivateFieldSet$2(this,_Session_crypto,e.crypto,"f"),__classPrivateFieldSet$2(this,_Session_storage,e.storage,"f"),this.fs=e.fs,this.type=e.type,this.username=e.username}async destroy(){await __classPrivateFieldGet$3(this,_Session_storage,"f").removeItem(__classPrivateFieldGet$3(this,_Session_storage,"f").KEYS.ACCOUNT_UCAN),await __classPrivateFieldGet$3(this,_Session_storage,"f").removeItem(__classPrivateFieldGet$3(this,_Session_storage,"f").KEYS.CID_LOG),await __classPrivateFieldGet$3(this,_Session_storage,"f").removeItem(__classPrivateFieldGet$3(this,_Session_storage,"f").KEYS.SESSION),await __classPrivateFieldGet$3(this,_Session_storage,"f").removeItem(__classPrivateFieldGet$3(this,_Session_storage,"f").KEYS.UCANS),await __classPrivateFieldGet$3(this,_Session_crypto,"f").keystore.clearStore(),this.fs&&this.fs.deactivate()}}_Session_crypto=new WeakMap,_Session_storage=new WeakMap;function isSessionInfo(r){return isObject$1(r)&&hasProp(r,"username")&&hasProp(r,"type")}async function restore(r){return r.getItem(r.KEYS.SESSION).then(e=>e||null).then(e=>e?JSON.parse(e):null).then(e=>isSessionInfo(e)?e:null)}function provide(r,e){return r.setItem(r.KEYS.SESSION,JSON.stringify({type:e.type,username:e.username}))}const TYPE="webCrypto";async function canDelegateAccount$1(r,e){const t=await r.reference.didRoot.lookup(e),n=await r.storage.getItem(r.storage.KEYS.ACCOUNT_UCAN);if(n){const o=rootIssuer(n),s=decode$b(n),{ptc:u}=s.payload;return t===o&&u==="SUPER_USER"}else{const o=await write(r.crypto);return t===o}}async function delegateAccount$2(r,e,t){const n=await r.storage.getItem(r.storage.KEYS.ACCOUNT_UCAN)??void 0,o=await build({dependencies:r,audience:t,issuer:await write(r.crypto),lifetimeInSeconds:60*60*24*30*12*1e3,potency:"SUPER_USER",proof:n});return{token:encode$b(o)}}async function linkDevice$2(r,e,t){const{token:n}=t,o=decode$b(n);await isValid(r.crypto,o)&&(await r.storage.setItem(r.storage.KEYS.ACCOUNT_UCAN,n),await provide(r.storage,{type:TYPE,username:e}))}async function register$1(r,e){return await provide(r.storage,{type:e.type||TYPE,username:e.username}),{success:!0}}async function session$1(r,e,t){return e?new Session({crypto:r.crypto,storage:r.storage,type:TYPE,username:e}):null}function implementation$g(r){return{type:TYPE,canDelegateAccount:(...e)=>canDelegateAccount$1(r,...e),delegateAccount:(...e)=>delegateAccount$2(r,...e),linkDevice:(...e)=>linkDevice$2(r,...e),register:(...e)=>register$1(r,...e),session:session$1,createChannel:()=>{throw new Error("Not implemented")},isUsernameValid:()=>{throw new Error("Not implemented")},isUsernameAvailable:()=>{throw new Error("Not implemented")}}}var LinkingStep;(function(r){r.Broadcast="BROADCAST",r.Negotiation="NEGOTIATION",r.Delegation="DELEGATION"})(LinkingStep||(LinkingStep={}));class LinkingError extends Error{constructor(e){super(e),this.name="LinkingError"}}class LinkingWarning extends Error{constructor(e){super(e),this.name="LinkingWarning"}}const handleLinkingError=(r,e)=>{switch(e.name){case"LinkingWarning":r.warn(e.message);break;case"LinkingError":throw e;default:throw e}},tryParseMessage=(r,e,t)=>{try{const n=JSON.parse(r);return e(n)?{ok:!0,value:n}:{ok:!1,error:new LinkingWarning(`${t.participant} received an unexpected message in ${t.callSite}: ${r}. Ignoring message.`)}}catch{return{ok:!1,error:new LinkingWarning(`${t.participant} received a message in ${t.callSite} that it could not parse: ${r}. Ignoring message.`)}}},createConsumer=async(r,e)=>{const{username:t}=e,n=p=>handleLinkingError(r.manners,p);let o=new EventEmitter$2;const s={username:t,sessionKey:null,temporaryRsaPair:null,step:LinkingStep.Broadcast},u=async p=>{const{data:m}=p,b=m.arrayBuffer?new TextDecoder().decode(await m.arrayBuffer()):m;switch(s.step){case LinkingStep.Broadcast:return n(new LinkingWarning("Consumer is not ready to start linking"));case LinkingStep.Negotiation:if(s.sessionKey)n(new LinkingWarning("Consumer already received a session key"));else if(!s.temporaryRsaPair||!s.temporaryRsaPair.privateKey)n(new LinkingError("Consumer missing RSA key pair when handling session key message"));else{const S=await handleSessionKey(r.crypto,s.temporaryRsaPair.privateKey,b);if(S.ok){s.sessionKey=S.value;const{pin:A,challenge:L}=await generateUserChallenge(r.crypto,s.sessionKey);l.send(L),o==null||o.emit("challenge",{pin:Array.from(A)}),s.step=LinkingStep.Delegation}else n(S.error)}break;case LinkingStep.Delegation:if(!s.sessionKey)n(new LinkingError("Consumer was missing session key when linking device"));else if(!s.username)n(new LinkingError("Consumer was missing username when linking device"));else{const S=await linkDevice$1(r.auth,r.crypto,s.sessionKey,s.username,b);if(S.ok){const{approved:A}=S.value;o==null||o.emit("link",{approved:A,username:s.username}),await f()}else n(S.error)}break}},f=async()=>{o==null||o.emit("done",void 0),o=null,l.close(),clearInterval(h)},l=await r.auth.createChannel({handleMessage:u,username:t}),h=setInterval(async()=>{if(s.sessionKey)clearInterval(h);else{const{temporaryRsaPair:p,temporaryDID:m}=await generateTemporaryExchangeKey(r.crypto);s.temporaryRsaPair=p,s.step=LinkingStep.Negotiation,l.send(m)}},2e3);return{on:(...p)=>o==null?void 0:o.on(...p),cancel:f}},generateTemporaryExchangeKey=async r=>{const e=await r.rsa.genKey(),t=await r.rsa.exportPublicKey(e.publicKey),n=publicKeyToDid(r,t,"rsa");return{temporaryRsaPair:e,temporaryDID:n}},handleSessionKey=async(r,e,t)=>{const o=tryParseMessage(t,s=>isObject$1(s)&&"iv"in s&&typeof s.iv=="string"&&"msg"in s&&typeof s.msg=="string"&&"sessionKey"in s&&typeof s.sessionKey=="string",{participant:"Consumer",callSite:"handleSessionKey"});if(o.ok){const{iv:s,msg:u,sessionKey:f}=o.value,l=fromString$7(s,"base64pad");let h;try{const A=fromString$7(f,"base64pad");h=await r.rsa.decrypt(A,e)}catch{return{ok:!1,error:new LinkingWarning(`Consumer received a session key in handleSessionKey that it could not decrypt: ${t}. Ignoring message`)}}let p=null;try{p=await r.aes.decrypt(fromString$7(u,"base64pad"),h,SymmAlg.AES_GCM,l)}catch{return{ok:!1,error:new LinkingError("Consumer could not decrypt closed UCAN with provided session key.")}}const m=decode$b(toString$7(p,"utf8"));if(await isValid(r,m)===!1)return{ok:!1,error:new LinkingError("Consumer received an invalid closed UCAN")};if(m.payload.ptc)return{ok:!1,error:new LinkingError("Consumer received a closed UCAN with potency. Closed UCAN must not have potency.")};const b=m.payload.fct[0]&&m.payload.fct[0].sessionKey;if(!b)return{ok:!1,error:new LinkingError("Consumer received a closed UCAN that was missing a session key in facts.")};const S=toString$7(h,"base64pad");return b!==S?{ok:!1,error:new LinkingError("Consumer received a closed UCAN session key does not match the session key")}:{ok:!0,value:h}}else return o},generateUserChallenge=async(r,e)=>{const t=Array.from(r.misc.randomNumbers({amount:6})).map(u=>u%9),n=r.misc.randomNumbers({amount:16}),o=await r.aes.encrypt(fromString$7(JSON.stringify({did:await write(r),pin:t}),"utf8"),e,SymmAlg.AES_GCM,n),s=JSON.stringify({iv:toString$7(n,"base64pad"),msg:toString$7(o,"base64pad")});return{pin:t,challenge:s}},linkDevice$1=async(r,e,t,n,o)=>{const u=tryParseMessage(o,f=>isObject$1(f)&&"iv"in f&&typeof f.iv=="string"&&"msg"in f&&typeof f.msg=="string",{participant:"Consumer",callSite:"linkDevice"});if(u.ok){const{iv:f,msg:l}=u.value,h=fromString$7(f,"base64");let p=null;try{p=await e.aes.decrypt(fromString$7(l,"base64pad"),t,SymmAlg.AES_GCM,h)}catch{return{ok:!1,error:new LinkingWarning("Consumer ignoring message that could not be decrypted in linkDevice.")}}const m=tryParseMessage(toString$7(p,"utf8"),isObject$1,{participant:"Consumer",callSite:"linkDevice"});return m.ok?(m==null?void 0:m.value.linkStatus)==="DENIED"?{ok:!0,value:{approved:!1}}:(await r.linkDevice(n,m.value),{ok:!0,value:{approved:!0}}):m}else return u},createProducer=async(r,e)=>{const{username:t}=e,n=b=>handleLinkingError(r.manners,b);if(!await r.auth.canDelegateAccount(t))throw new LinkingError(`Producer cannot delegate account for username ${t}`);let s=new EventEmitter$2;const u={username:t,sessionKey:null,step:LinkingStep.Broadcast},f=async b=>{const{data:S}=b,A=S.arrayBuffer?new TextDecoder().decode(await S.arrayBuffer()):S;switch(u.step){case LinkingStep.Broadcast:{const{sessionKey:L,sessionKeyMessage:J}=await generateSessionKey(r.crypto,A);return u.sessionKey=L,u.step=LinkingStep.Negotiation,m.send(J)}case LinkingStep.Negotiation:if(u.sessionKey){const L=await handleUserChallenge(r.crypto,u.sessionKey,A);if(u.step=LinkingStep.Delegation,L.ok){const{pin:J,audience:ne}=L.value,pe=()=>{let z=!1;return{confirmPin:async()=>{z||(z=!0,u.sessionKey?await delegateAccount$1(r.auth,r.crypto,u.sessionKey,t,ne,l):n(new LinkingError("Producer missing session key when delegating account")))},rejectPin:async()=>{z||(z=!0,u.sessionKey?await declineDelegation(r.crypto,u.sessionKey,l):n(new LinkingError("Producer missing session key when declining account delegation")))}}},{confirmPin:de,rejectPin:H}=pe();s==null||s.emit("challenge",{pin:J,confirmPin:de,rejectPin:H})}else n(L.error)}else n(new LinkingError("Producer missing session key when handling user challenge"));break;case LinkingStep.Delegation:return n(new LinkingWarning("Producer received an unexpected message while delegating an account. The message will be ignored."))}},l=async(b,S)=>{await m.send(b),u.username!=null&&(s==null||s.emit("link",{approved:S,username:u.username}),h())},h=()=>{u.sessionKey=null,u.step=LinkingStep.Broadcast},p=async()=>{s==null||s.emit("done",void 0),s=null,m.close()},m=await r.auth.createChannel({username:t,handleMessage:f});return{on:(...b)=>s==null?void 0:s.on(...b),cancel:p}},generateSessionKey=async(r,e)=>{const t=await r.aes.genKey(SymmAlg.AES_GCM),n=await r.aes.exportKey(t),{publicKey:o}=didToPublicKey(r,e),s=await r.rsa.encrypt(n,o),u=await build({dependencies:{crypto:r},issuer:await write(r),audience:e,lifetimeInSeconds:60*5,facts:[{sessionKey:toString$7(n,"base64pad")}],potency:null}),f=r.misc.randomNumbers({amount:16}),l=await r.aes.encrypt(fromString$7(encode$b(u),"utf8"),t,SymmAlg.AES_GCM,f),h=JSON.stringify({iv:toString$7(f,"base64pad"),msg:toString$7(l,"base64pad"),sessionKey:toString$7(s,"base64pad")});return{sessionKey:t,sessionKeyMessage:h}},handleUserChallenge=async(r,e,t)=>{const o=tryParseMessage(t,s=>isObject$1(s)&&"iv"in s&&typeof s.iv=="string"&&"msg"in s&&typeof s.msg=="string",{participant:"Producer",callSite:"handleUserChallenge"});if(o.ok){const{iv:s,msg:u}=o.value,f=fromString$7(s,"base64pad");let l=null;try{l=await r.aes.decrypt(fromString$7(u,"base64pad"),e,SymmAlg.AES_GCM,f)}catch{return{ok:!1,error:new LinkingWarning("Ignoring message that could not be decrypted.")}}const h=JSON.parse(toString$7(l,"utf8")),p=h.pin??null,m=h.did??null;return p!==null&&m!==null?{ok:!0,value:{pin:p,audience:m}}:{ok:!1,error:new LinkingError(`Producer received invalid pin ${h.pin} or audience ${h.audience}`)}}else return o},delegateAccount$1=async(r,e,t,n,o,s)=>{const u=await r.delegateAccount(n,o),f=JSON.stringify(u),l=e.misc.randomNumbers({amount:16}),h=await e.aes.encrypt(fromString$7(f,"utf8"),t,SymmAlg.AES_GCM,l),p=JSON.stringify({iv:toString$7(l,"base64pad"),msg:toString$7(h,"base64pad")});await s(p,!0)},declineDelegation=async(r,e,t)=>{const n=JSON.stringify({linkStatus:"DENIED"}),o=r.misc.randomNumbers({amount:16}),s=await r.aes.encrypt(fromString$7(n,"utf8"),e,SymmAlg.AES_GCM,o),u=JSON.stringify({iv:toString$7(o,"base64pad"),msg:toString$7(s,"base64pad")});await t(u,!1)};function namespace(r){return isString(r.namespace)?r.namespace:appId(r.namespace)}function throttle(r,e,t,n){var o,s=!1,u=0;function f(){o&&clearTimeout(o)}function l(){f(),s=!0}typeof e!="boolean"&&(n=t,t=e,e=void 0);function h(){for(var p=arguments.length,m=new Array(p),b=0;b<p;b++)m[b]=arguments[b];var S=this,A=Date.now()-u;if(s)return;function L(){u=Date.now(),t.apply(S,m)}function J(){o=void 0}n&&!o&&L(),f(),n===void 0&&A>r?L():e!==!0&&(o=setTimeout(n?J:L,n===void 0?r-A:r))}return h.cancel=l,h}class NoPermissionError extends Error{constructor(e){super(e),this.name="NoPermissionError"}}function nextNonEmpty(r){const e=r.slice(1);return e.length<1?null:e}class PublicHistory{constructor(e){this.node=e}back(e=-1){const t=Math.abs(Math.min(e,-1));return Array.from({length:t},(n,o)=>o).reduce(n=>n.then(o=>o?PublicHistory._getPreviousVersion(o):null),Promise.resolve(this.node))}async prior(e){return PublicHistory._prior(this.node,e)}async list(e=5){const{acc:t}=await Array.from({length:e},(n,o)=>o).reduce((n,o)=>n.then(({node:s,acc:u})=>s?PublicHistory._getPreviousVersion(s).then(f=>({node:f,acc:[...u,{delta:-(o+1),timestamp:s.header.metadata.unixMeta.mtime}]})):Promise.resolve({node:null,acc:u})),PublicHistory._getPreviousVersion(this.node).then(n=>({node:n,acc:[]})));return t}static async _getPreviousVersion(e){return e.header.previous?e.fromCID(decodeCID(e.header.previous)):Promise.resolve(null)}static async _prior(e,t){if(e.header.metadata.unixMeta.mtime<t)return e;const n=await PublicHistory._getPreviousVersion(e);return n?PublicHistory._prior(n,t):null}}let PublicFile$1=class ci extends BaseFile{constructor({depot:e,content:t,header:n,cid:o}){super(t),this.depot=e,this.cid=o,this.header=n,this.history=new PublicHistory(s(this));function s(u){return{...u,fromCID:async f=>s(await ci.fromCID(e,f))}}}static instanceOf(e){return isObject$1(e)&&hasProp(e,"content")&&hasProp(e,"header")&&isFileHeader(e.header)}static async create(e,t){return new ci({depot:e,content:t,header:{metadata:empty(!0,latest)},cid:null})}static async fromCID(e,t){const n=await get$3(e,t);return ci.fromInfo(e,n,t)}static async fromInfo(e,t,n){const{userland:o,metadata:s,previous:u}=t,f=await getFile(e,decodeCID(o));return new ci({depot:e,content:f,header:{metadata:s,previous:u},cid:n})}async putDetailed(){const e=await putFile(this.depot,this.content,updateMtime(this.header.metadata),this.cid);return this.cid=e.cid,e}};class PublicTree extends BaseTree{constructor({depot:e,reference:t,links:n,header:o,cid:s}){super(),this.depot=e,this.reference=t,this.children={},this.cid=s,this.links=n,this.header=o,this.history=new PublicHistory(u(this));function u(f){return{...f,fromCID:async l=>u(await PublicTree.fromCID(e,t,l))}}}static async empty(e,t){return new PublicTree({depot:e,reference:t,links:{},header:{metadata:empty(!1,latest),skeleton:{}},cid:null})}static async fromCID(e,t,n){const o=await get$3(e,n);if(!isTreeInfo(o))throw new Error(`Could not parse a valid public tree at: ${n}`);return PublicTree.fromInfo(e,t,o,n)}static async fromInfo(e,t,n,o){const{userland:s,metadata:u,previous:f,skeleton:l}=n,h=await getFileSystemLinks(e,decodeCID(s));return new PublicTree({depot:e,reference:t,links:h,header:{metadata:u,previous:f,skeleton:l},cid:o})}static instanceOf(e){return hasProp(e,"links")&&hasProp(e,"header")&&isLinks(e.links)&&isTreeHeader(e.header)}async createChildTree(e,t){const n=await PublicTree.empty(this.depot,this.reference),o=this.children[e];if(o){if(PublicFile$1.instanceOf(o))throw new Error(`There is a file at the given path: ${e}`);if(PublicTree.instanceOf(o))return o;throw new Error(`Not a public tree at the given path: ${e}`)}return await this.updateDirectChild(n,e,t),n}async createOrUpdateChildFile(e,t,n){const o=await this.getDirectChild(t);let s;if(o===null)s=await PublicFile$1.create(this.depot,e);else if(PublicFile$1.instanceOf(o))s=await o.updateContent(e);else throw new Error(`There is already a directory with that name: ${t}`);return await this.updateDirectChild(s,t,n),s}async putDetailed(){const e=await putTree(this.depot,this.links,this.header.skeleton,this.header.metadata,this.cid);return this.header.previous=this.cid||void 0,this.cid=e.cid,e}async updateDirectChild(e,t,n){if(this.readOnly)throw new Error("Tree is read-only");this.children[t]=e;const o=await e.putDetailed();return this.updateLink(t,o),n&&await n(),this}removeDirectChild(e){return delete this.links[e],delete this.header.skeleton[e],this.children[e]&&delete this.children[e],this}async getDirectChild(e){let t=null;if(this.children[e])return this.children[e];const n=this.header.skeleton[e]||null;if(n===null)return null;if(isSkeletonInfo(n)){const o=decodeCID(n.cid);t=n.isFile?await PublicFile$1.fromCID(this.depot,o):await PublicTree.fromCID(this.depot,this.reference,o)}else if(isSoftLink(n))return PublicTree.resolveSoftLink(this.depot,this.reference,n);return this.children[e]?this.children[e]:(t&&(this.children[e]=t),t)}async get(e){if(e.length<1)return this;const t=await this.getRecurse(this.header.skeleton,e);if(isSkeletonInfo(t)){const n=decodeCID(t.cid),o=await get$3(this.depot,n);return isFileInfo(o)?PublicFile$1.fromInfo(this.depot,o,n):PublicTree.fromInfo(this.depot,this.reference,o,n)}return t}async getRecurse(e,t){const n=t[0],o=e[n]||null,s=nextNonEmpty(t);if(isSoftLink(o)){const u=await PublicTree.resolveSoftLink(this.depot,this.reference,o);return s?PublicTree.instanceOf(u)?u.get(s).then(makeReadOnly):null:u}else return o===null||s===null?o:o.subSkeleton?this.getRecurse(o.subSkeleton,s):null}assignLink({name:e,link:t,skeleton:n}){this.links[e]=t,this.header.skeleton[e]=n,this.header.metadata.unixMeta.mtime=Date.now()}static async resolveSoftLink(e,t,n){const[o,...s]=n.ipns.split("/"),u=fromPosix(s.join("/"));if(!(isOnRootBranch(RootBranch.Public,u)||isOnRootBranch(RootBranch.Pretty,u)))throw new Error("Mixing public and private soft links is not supported yet.");const l=await t.dns.lookupDnsLink(o);if(!l)throw new Error(`Failed to resolve the soft link: ${n.ipns} - Could not resolve DNSLink`);const h=(await getSimpleLinks(e,decodeCID(l))).public.cid,p=removePartition(u),b=await(await PublicTree.fromCID(e,t,decodeCID(h))).get(unwrap$2(p));return b&&(b.readOnly=!0),b}getLinks(){return Object.values(this.links).reduce((e,t)=>{const n=this.header.skeleton[t.name];return{...e,[t.name]:n&&n.isFile!==void 0?{...t,isFile:n.isFile}:{...t}}},{})}updateLink(e,t){const{cid:n,metadata:o,userland:s,size:u,isFile:f,skeleton:l}=t;return this.assignLink({name:e,link:make(e,n,!1,u),skeleton:{cid:encodeCID$1(n),metadata:o,userland:s,subSkeleton:l,isFile:f}}),this}insertSoftLink({name:e,path:t,username:n}){const o={ipns:this.reference.dataRoot.domain(n)+`/public/${toPosix(t)}`,name:e};return this.assignLink({name:e,link:o,skeleton:o}),this}}function makeReadOnly(r){return r&&(r.readOnly=!0),r}const from$1=({name:r,code:e,encode:t})=>new Hasher(r,e,t);class Hasher{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?create$7(this.code,t):t.then(n=>create$7(this.code,n))}else throw Error("Unknown type, must be binary type")}}let wasm;const heap=new Array(32).fill(void 0);heap.push(void 0,null,!0,!1);function getObject(r){return heap[r]}let WASM_VECTOR_LEN=0,cachedUint8Memory0;function getUint8Memory0(){return cachedUint8Memory0.byteLength===0&&(cachedUint8Memory0=new Uint8Array(wasm.memory.buffer)),cachedUint8Memory0}const cachedTextEncoder=new TextEncoder("utf-8"),encodeString=typeof cachedTextEncoder.encodeInto=="function"?function(r,e){return cachedTextEncoder.encodeInto(r,e)}:function(r,e){const t=cachedTextEncoder.encode(r);return e.set(t),{read:r.length,written:t.length}};function passStringToWasm0(r,e,t){if(t===void 0){const f=cachedTextEncoder.encode(r),l=e(f.length);return getUint8Memory0().subarray(l,l+f.length).set(f),WASM_VECTOR_LEN=f.length,l}let n=r.length,o=e(n);const s=getUint8Memory0();let u=0;for(;u<n;u++){const f=r.charCodeAt(u);if(f>127)break;s[o+u]=f}if(u!==n){u!==0&&(r=r.slice(u)),o=t(o,n,n=u+r.length*3);const f=getUint8Memory0().subarray(o+u,o+n),l=encodeString(r,f);u+=l.written}return WASM_VECTOR_LEN=u,o}function isLikeNone(r){return r==null}let cachedInt32Memory0;function getInt32Memory0(){return cachedInt32Memory0.byteLength===0&&(cachedInt32Memory0=new Int32Array(wasm.memory.buffer)),cachedInt32Memory0}let heap_next=heap.length;function dropObject(r){r<36||(heap[r]=heap_next,heap_next=r)}function takeObject(r){const e=getObject(r);return dropObject(r),e}const cachedTextDecoder=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});cachedTextDecoder.decode();function getStringFromWasm0(r,e){return cachedTextDecoder.decode(getUint8Memory0().subarray(r,r+e))}function addHeapObject(r){heap_next===heap.length&&heap.push(heap.length+1);const e=heap_next;return heap_next=heap[e],heap[e]=r,e}function debugString(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const o=r.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=r.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(r)){const o=r.length;let s="[";o>0&&(s+=debugString(r[0]));for(let u=1;u<o;u++)s+=", "+debugString(r[u]);return s+="]",s}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}const CLOSURE_DTORS=new FinalizationRegistry(r=>{wasm.__wbindgen_export_2.get(r.dtor)(r.a,r.b)});function makeMutClosure(r,e,t,n){const o={a:r,b:e,cnt:1,dtor:t},s=(...u)=>{o.cnt++;const f=o.a;o.a=0;try{return n(f,o.b,...u)}finally{--o.cnt===0?(wasm.__wbindgen_export_2.get(o.dtor)(f,o.b),CLOSURE_DTORS.unregister(o)):o.a=f}};return s.original=o,CLOSURE_DTORS.register(s,o,o),s}function __wbg_adapter_20(r,e,t){wasm._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__ha1ec3a5271c97341(r,e,addHeapObject(t))}let stack_pointer=32;function addBorrowedObject(r){if(stack_pointer==1)throw new Error("out of js stack");return heap[--stack_pointer]=r,stack_pointer}function passArray8ToWasm0(r,e){const t=e(r.length*1);return getUint8Memory0().set(r,t/1),WASM_VECTOR_LEN=r.length,t}function _assertClass(r,e){if(!(r instanceof e))throw new Error(`expected instance of ${e.name}`);return r.ptr}function getArrayU8FromWasm0(r,e){return getUint8Memory0().subarray(r/1,r/1+e)}function handleError(r,e){try{return r.apply(this,e)}catch(t){wasm.__wbindgen_exn_store(addHeapObject(t))}}function __wbg_adapter_82(r,e,t,n){wasm.wasm_bindgen__convert__closures__invoke2_mut__h1338dfb1e5ae1cd8(r,e,addHeapObject(t),addHeapObject(n))}new FinalizationRegistry(r=>wasm.__wbg_foreignblockstore_free(r));const PublicDirectoryFinalization=new FinalizationRegistry(r=>wasm.__wbg_publicdirectory_free(r));class PublicDirectory{static __wrap(e){const t=Object.create(PublicDirectory.prototype);return t.ptr=e,PublicDirectoryFinalization.register(t,t.ptr,t),t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,PublicDirectoryFinalization.unregister(this),e}free(){const e=this.__destroy_into_raw();wasm.__wbg_publicdirectory_free(e)}constructor(e){try{const t=wasm.publicdirectory_new(addBorrowedObject(e));return PublicDirectory.__wrap(t)}finally{heap[stack_pointer++]=void 0}}getNode(e,t){try{const u=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicdirectory_getNode(u,this.ptr,addBorrowedObject(e),addHeapObject(t));var n=getInt32Memory0()[u/4+0],o=getInt32Memory0()[u/4+1],s=getInt32Memory0()[u/4+2];if(s)throw takeObject(o);return takeObject(n)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0}}lookupNode(e,t){try{const u=wasm.__wbindgen_add_to_stack_pointer(-16),f=passStringToWasm0(e,wasm.__wbindgen_malloc,wasm.__wbindgen_realloc),l=WASM_VECTOR_LEN;wasm.publicdirectory_lookupNode(u,this.ptr,f,l,addHeapObject(t));var n=getInt32Memory0()[u/4+0],o=getInt32Memory0()[u/4+1],s=getInt32Memory0()[u/4+2];if(s)throw takeObject(o);return takeObject(n)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}store(e){try{const s=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicdirectory_store(s,this.ptr,addHeapObject(e));var t=getInt32Memory0()[s/4+0],n=getInt32Memory0()[s/4+1],o=getInt32Memory0()[s/4+2];if(o)throw takeObject(n);return takeObject(t)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}static load(e,t){try{const u=wasm.__wbindgen_add_to_stack_pointer(-16),f=passArray8ToWasm0(e,wasm.__wbindgen_malloc),l=WASM_VECTOR_LEN;wasm.publicdirectory_load(u,f,l,addHeapObject(t));var n=getInt32Memory0()[u/4+0],o=getInt32Memory0()[u/4+1],s=getInt32Memory0()[u/4+2];if(s)throw takeObject(o);return takeObject(n)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}read(e,t){try{const u=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicdirectory_read(u,this.ptr,addBorrowedObject(e),addHeapObject(t));var n=getInt32Memory0()[u/4+0],o=getInt32Memory0()[u/4+1],s=getInt32Memory0()[u/4+2];if(s)throw takeObject(o);return takeObject(n)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0}}ls(e,t){try{const u=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicdirectory_ls(u,this.ptr,addBorrowedObject(e),addHeapObject(t));var n=getInt32Memory0()[u/4+0],o=getInt32Memory0()[u/4+1],s=getInt32Memory0()[u/4+2];if(s)throw takeObject(o);return takeObject(n)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0}}rm(e,t){try{const u=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicdirectory_rm(u,this.ptr,addBorrowedObject(e),addHeapObject(t));var n=getInt32Memory0()[u/4+0],o=getInt32Memory0()[u/4+1],s=getInt32Memory0()[u/4+2];if(s)throw takeObject(o);return takeObject(n)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0}}write(e,t,n,o){try{const l=wasm.__wbindgen_add_to_stack_pointer(-16),h=passArray8ToWasm0(t,wasm.__wbindgen_malloc),p=WASM_VECTOR_LEN;wasm.publicdirectory_write(l,this.ptr,addBorrowedObject(e),h,p,addBorrowedObject(n),addHeapObject(o));var s=getInt32Memory0()[l/4+0],u=getInt32Memory0()[l/4+1],f=getInt32Memory0()[l/4+2];if(f)throw takeObject(u);return takeObject(s)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0,heap[stack_pointer++]=void 0}}basicMv(e,t,n,o){try{const l=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicdirectory_basicMv(l,this.ptr,addBorrowedObject(e),addBorrowedObject(t),addBorrowedObject(n),addHeapObject(o));var s=getInt32Memory0()[l/4+0],u=getInt32Memory0()[l/4+1],f=getInt32Memory0()[l/4+2];if(f)throw takeObject(u);return takeObject(s)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0,heap[stack_pointer++]=void 0,heap[stack_pointer++]=void 0}}mkdir(e,t,n){try{const f=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicdirectory_mkdir(f,this.ptr,addBorrowedObject(e),addBorrowedObject(t),addHeapObject(n));var o=getInt32Memory0()[f/4+0],s=getInt32Memory0()[f/4+1],u=getInt32Memory0()[f/4+2];if(u)throw takeObject(s);return takeObject(o)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0,heap[stack_pointer++]=void 0}}baseHistoryOn(e,t){try{const u=wasm.__wbindgen_add_to_stack_pointer(-16);_assertClass(e,PublicDirectory),wasm.publicdirectory_baseHistoryOn(u,this.ptr,e.ptr,addHeapObject(t));var n=getInt32Memory0()[u/4+0],o=getInt32Memory0()[u/4+1],s=getInt32Memory0()[u/4+2];if(s)throw takeObject(o);return takeObject(n)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}previousCid(){const e=wasm.publicdirectory_previousCid(this.ptr);return takeObject(e)}metadata(){try{const o=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicdirectory_metadata(o,this.ptr);var e=getInt32Memory0()[o/4+0],t=getInt32Memory0()[o/4+1],n=getInt32Memory0()[o/4+2];if(n)throw takeObject(t);return takeObject(e)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}asNode(){const e=wasm.publicdirectory_asNode(this.ptr);return PublicNode.__wrap(e)}getId(){try{const n=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicdirectory_getId(n,this.ptr);var e=getInt32Memory0()[n/4+0],t=getInt32Memory0()[n/4+1];return getStringFromWasm0(e,t)}finally{wasm.__wbindgen_add_to_stack_pointer(16),wasm.__wbindgen_free(e,t)}}}const PublicFileFinalization=new FinalizationRegistry(r=>wasm.__wbg_publicfile_free(r));class PublicFile{static __wrap(e){const t=Object.create(PublicFile.prototype);return t.ptr=e,PublicFileFinalization.register(t,t.ptr,t),t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,PublicFileFinalization.unregister(this),e}free(){const e=this.__destroy_into_raw();wasm.__wbg_publicfile_free(e)}constructor(e,t){try{const u=wasm.__wbindgen_add_to_stack_pointer(-16),f=passArray8ToWasm0(t,wasm.__wbindgen_malloc),l=WASM_VECTOR_LEN;wasm.publicfile_new(u,addBorrowedObject(e),f,l);var n=getInt32Memory0()[u/4+0],o=getInt32Memory0()[u/4+1],s=getInt32Memory0()[u/4+2];if(s)throw takeObject(o);return PublicFile.__wrap(n)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0}}getId(){try{const n=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicfile_getId(n,this.ptr);var e=getInt32Memory0()[n/4+0],t=getInt32Memory0()[n/4+1];return getStringFromWasm0(e,t)}finally{wasm.__wbindgen_add_to_stack_pointer(16),wasm.__wbindgen_free(e,t)}}store(e){try{const s=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicfile_store(s,this.ptr,addHeapObject(e));var t=getInt32Memory0()[s/4+0],n=getInt32Memory0()[s/4+1],o=getInt32Memory0()[s/4+2];if(o)throw takeObject(n);return takeObject(t)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}static load(e,t){try{const u=wasm.__wbindgen_add_to_stack_pointer(-16),f=passArray8ToWasm0(e,wasm.__wbindgen_malloc),l=WASM_VECTOR_LEN;wasm.publicfile_load(u,f,l,addHeapObject(t));var n=getInt32Memory0()[u/4+0],o=getInt32Memory0()[u/4+1],s=getInt32Memory0()[u/4+2];if(s)throw takeObject(o);return takeObject(n)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}previousCid(){const e=wasm.publicfile_previousCid(this.ptr);return takeObject(e)}metadata(){try{const o=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicfile_metadata(o,this.ptr);var e=getInt32Memory0()[o/4+0],t=getInt32Memory0()[o/4+1],n=getInt32Memory0()[o/4+2];if(n)throw takeObject(t);return takeObject(e)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}contentCid(){try{const o=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicfile_contentCid(o,this.ptr);var e=getInt32Memory0()[o/4+0],t=getInt32Memory0()[o/4+1],n=getArrayU8FromWasm0(e,t).slice();return wasm.__wbindgen_free(e,t*1),n}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}}const PublicNodeFinalization=new FinalizationRegistry(r=>wasm.__wbg_publicnode_free(r));class PublicNode{static __wrap(e){const t=Object.create(PublicNode.prototype);return t.ptr=e,PublicNodeFinalization.register(t,t.ptr,t),t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,PublicNodeFinalization.unregister(this),e}free(){const e=this.__destroy_into_raw();wasm.__wbg_publicnode_free(e)}asDir(){try{const o=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicnode_asDir(o,this.ptr);var e=getInt32Memory0()[o/4+0],t=getInt32Memory0()[o/4+1],n=getInt32Memory0()[o/4+2];if(n)throw takeObject(t);return PublicDirectory.__wrap(e)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}asFile(){try{const o=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicnode_asFile(o,this.ptr);var e=getInt32Memory0()[o/4+0],t=getInt32Memory0()[o/4+1],n=getInt32Memory0()[o/4+2];if(n)throw takeObject(t);return PublicFile.__wrap(e)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}isDir(){return wasm.publicnode_isDir(this.ptr)!==0}isFile(){return wasm.publicnode_isFile(this.ptr)!==0}getId(){try{const n=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicnode_getId(n,this.ptr);var e=getInt32Memory0()[n/4+0],t=getInt32Memory0()[n/4+1];return getStringFromWasm0(e,t)}finally{wasm.__wbindgen_add_to_stack_pointer(16),wasm.__wbindgen_free(e,t)}}}async function load(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function getImports(){const r={};return r.wbg={},r.wbg.__wbindgen_string_get=function(e,t){const n=getObject(t),o=typeof n=="string"?n:void 0;var s=isLikeNone(o)?0:passStringToWasm0(o,wasm.__wbindgen_malloc,wasm.__wbindgen_realloc),u=WASM_VECTOR_LEN;getInt32Memory0()[e/4+1]=u,getInt32Memory0()[e/4+0]=s},r.wbg.__wbindgen_object_drop_ref=function(e){takeObject(e)},r.wbg.__wbg_publicdirectory_new=function(e){const t=PublicDirectory.__wrap(e);return addHeapObject(t)},r.wbg.__wbg_publicfile_new=function(e){const t=PublicFile.__wrap(e);return addHeapObject(t)},r.wbg.__wbg_publicnode_new=function(e){const t=PublicNode.__wrap(e);return addHeapObject(t)},r.wbg.__wbindgen_string_new=function(e,t){const n=getStringFromWasm0(e,t);return addHeapObject(n)},r.wbg.__wbg_putBlock_88cdb3be9020efb7=function(e,t,n,o){var s=getArrayU8FromWasm0(t,n).slice();wasm.__wbindgen_free(t,n*1);const u=getObject(e).putBlock(s,o>>>0);return addHeapObject(u)},r.wbg.__wbg_getBlock_ef67031e09d5c6fd=function(e,t,n){var o=getArrayU8FromWasm0(t,n).slice();wasm.__wbindgen_free(t,n*1);const s=getObject(e).getBlock(o);return addHeapObject(s)},r.wbg.__wbindgen_bigint_new=function(e,t){const n=BigInt(getStringFromWasm0(e,t));return addHeapObject(n)},r.wbg.__wbindgen_number_new=function(e){return addHeapObject(e)},r.wbg.__wbindgen_cb_drop=function(e){const t=takeObject(e).original;return t.cnt--==1?(t.a=0,!0):!1},r.wbg.__wbg_new_693216e109162396=function(){const e=new Error;return addHeapObject(e)},r.wbg.__wbg_stack_0ddaca5d1abfb52f=function(e,t){const n=getObject(t).stack,o=passStringToWasm0(n,wasm.__wbindgen_malloc,wasm.__wbindgen_realloc),s=WASM_VECTOR_LEN;getInt32Memory0()[e/4+1]=s,getInt32Memory0()[e/4+0]=o},r.wbg.__wbg_error_09919627ac0992f5=function(e,t){try{console.error(getStringFromWasm0(e,t))}finally{wasm.__wbindgen_free(e,t)}},r.wbg.__wbg_get_f0f4f1608ebf633e=function(e,t){const n=getObject(e)[t>>>0];return addHeapObject(n)},r.wbg.__wbg_length_93debb0e2e184ab6=function(e){return getObject(e).length},r.wbg.__wbg_new_2ab697f1555e0dbc=function(){const e=new Array;return addHeapObject(e)},r.wbg.__wbg_new_306ce8d57919e6ae=function(){const e=new Object;return addHeapObject(e)},r.wbg.__wbg_push_811c8b08bf4ff9d5=function(e,t){return getObject(e).push(getObject(t))},r.wbg.__wbg_new_651776e932b7e9c7=function(e,t){const n=new Error(getStringFromWasm0(e,t));return addHeapObject(n)},r.wbg.__wbg_call_9855a4612eb496cb=function(){return handleError(function(e,t,n){const o=getObject(e).call(getObject(t),getObject(n));return addHeapObject(o)},arguments)},r.wbg.__wbg_getTime_7c8d3b79f51e2b87=function(e){return getObject(e).getTime()},r.wbg.__wbg_new_78403b138428b684=function(e,t){try{var n={a:e,b:t},o=(u,f)=>{const l=n.a;n.a=0;try{return __wbg_adapter_82(l,n.b,u,f)}finally{n.a=l}};const s=new Promise(o);return addHeapObject(s)}finally{n.a=n.b=0}},r.wbg.__wbg_resolve_f269ce174f88b294=function(e){const t=Promise.resolve(getObject(e));return addHeapObject(t)},r.wbg.__wbg_then_1c698eedca15eed6=function(e,t){const n=getObject(e).then(getObject(t));return addHeapObject(n)},r.wbg.__wbg_then_4debc41d4fc92ce5=function(e,t,n){const o=getObject(e).then(getObject(t),getObject(n));return addHeapObject(o)},r.wbg.__wbg_buffer_de1150f91b23aa89=function(e){const t=getObject(e).buffer;return addHeapObject(t)},r.wbg.__wbg_newwithbyteoffsetandlength_9ca61320599a2c84=function(e,t,n){const o=new Uint8Array(getObject(e),t>>>0,n>>>0);return addHeapObject(o)},r.wbg.__wbg_new_97cf52648830a70d=function(e){const t=new Uint8Array(getObject(e));return addHeapObject(t)},r.wbg.__wbg_set_a0172b213e2469e9=function(e,t,n){getObject(e).set(getObject(t),n>>>0)},r.wbg.__wbg_length_e09c0b925ab8de5d=function(e){return getObject(e).length},r.wbg.__wbg_set_b12cd0ab82903c2f=function(){return handleError(function(e,t,n){return Reflect.set(getObject(e),getObject(t),getObject(n))},arguments)},r.wbg.__wbindgen_debug_string=function(e,t){const n=debugString(getObject(t)),o=passStringToWasm0(n,wasm.__wbindgen_malloc,wasm.__wbindgen_realloc),s=WASM_VECTOR_LEN;getInt32Memory0()[e/4+1]=s,getInt32Memory0()[e/4+0]=o},r.wbg.__wbindgen_throw=function(e,t){throw new Error(getStringFromWasm0(e,t))},r.wbg.__wbindgen_memory=function(){const e=wasm.memory;return addHeapObject(e)},r.wbg.__wbindgen_closure_wrapper945=function(e,t,n){const o=makeMutClosure(e,t,417,__wbg_adapter_20);return addHeapObject(o)},r}function finalizeInit(r,e){return wasm=r.exports,init.__wbindgen_wasm_module=e,cachedInt32Memory0=new Int32Array(wasm.memory.buffer),cachedUint8Memory0=new Uint8Array(wasm.memory.buffer),wasm}async function init(r){typeof r>"u"&&(r=new URL(""+new URL("../assets/wasm_wnfs_bg-f3b54d92.wasm",import.meta.url).href,self.location));const e=getImports();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await load(await r,e);return finalizeInit(t,n)}class DepotBlockStore{constructor(e){this.depot=e}async getBlock(e){const t=CID$1.decode(e);return await this.depot.getBlock(t)}async putBlock(e,t){if(!isIdentifier(t))throw new Error(`No codec was registered for the code: ${numberHex(t)}`);return(await this.depot.putBlock(e,t)).bytes}}async function loadWasm({manners:r}){r.log("⏬ Loading WNFS WASM");const e=performance.now();await init(r.wnfsWasmLookup(WASM_WNFS_VERSION));const t=performance.now()-e;r.log(`🧪 Loaded WNFS WASM (${t.toFixed(0)}ms)`)}class PublicRootWasm{constructor(e,t,n,o){this.dependencies=e,this.root=Promise.resolve(t),this.lastRoot=t,this.store=n,this.readOnly=o}static async empty(e){await loadWasm(e);const t=new DepotBlockStore(e.depot),n=new PublicDirectory(new Date);return new PublicRootWasm(e,n,t,!1)}static async fromCID(e,t){await loadWasm(e);const n=new DepotBlockStore(e.depot),o=await PublicDirectory.load(t.bytes,n);return new PublicRootWasm(e,o,n,!1)}async atomically(e){const t=await this.root;this.root=e(t),await this.root}async withError(e,t){try{return await e}catch(n){throw console.error(`Error during WASM operation ${t}:`),n}}async ls(e){const t=await this.root,{result:n}=await this.withError(t.getNode(e,this.store),`ls(${e.join("/")})`);if(n==null)throw new Error(`Can't ls ${e.join("/")}: No such directory`);if(!n.isDir())throw new Error(`Can't ls ${e.join("/")}: Not a directory`);const o=n.asDir(),{result:s}=await this.withError(t.ls(e,this.store),`ls(${e.join("/")})`),u={};for(const f of s){const l=await o.lookupNode(f.name,this.store),h=l.isFile()?CID$1.decode(await l.asFile().store(this.store)):CID$1.decode(await l.asDir().store(this.store));u[f.name]={name:f.name,isFile:f.metadata.unixMeta.kind==="file",size:0,cid:h}}return u}async mkdir(e){return await this.atomically(async t=>{const{rootDir:n}=await this.withError(t.mkdir(e,new Date,this.store),`mkdir(${e.join("/")})`);return n}),this}async cat(e){const t=await this.root,{result:n}=await this.withError(t.read(e,this.store),`read(${e.join("/")})`),o=CID$1.decode(n);return this.dependencies.depot.getUnixFile(o)}async add(e,t){const{cid:n}=await this.dependencies.depot.putChunked(t);return await this.atomically(async o=>{const{rootDir:s}=await this.withError(o.write(e,n.bytes,new Date,this.store),`write(${e.join("/")})`);return s}),this}async rm(e){return await this.atomically(async t=>{const{rootDir:n}=await this.withError(t.rm(e,this.store),`rm(${e.join("/")})`);return n}),this}async mv(e,t){return await this.atomically(async n=>{const{rootDir:o}=await this.withError(n.basicMv(e,t,new Date,this.store),`basicMv(${e.join("/")}, ${t.join("/")})`);return o}),this}async get(e){const t=await this.root,{result:n}=await this.withError(t.getNode(e,this.store),`getNode(${e.join("/")})`);if(n==null)return null;if(n.isFile()){const o=n.asFile(),s=await this.cat(e),u=e.slice(0,-1),f=e[e.length-1];return new PublicFileWasm(s,u,f,this,o)}else if(n.isDir()){const o=n.asDir();return new PublicDirectoryWasm(this.readOnly,e,this,o)}throw new Error("Unknown node type. Can only handle files and directories.")}async exists(e){const t=await this.root;try{return await t.getNode(e,this.store),!0}catch{return!1}}async historyStep(){return await this.atomically(async e=>{const{rootDir:t}=await e.baseHistoryOn(this.lastRoot,this.store);return this.lastRoot=e,t}),await this.root}async put(){const t=await(await this.historyStep()).store(this.store);return CID$1.decode(t)}async putDetailed(){return{cid:await this.put(),size:0,isFile:!1}}}class PublicDirectoryWasm{constructor(e,t,n,o){this.readOnly=e,this.directory=t,this.publicRoot=n,this.cachedDir=o}checkMutability(e){if(this.readOnly)throw new Error(`Directory is read-only. Cannot ${e}`)}async updateCache(){const t=await(await this.publicRoot.root).getNode(this.directory,this.publicRoot.store);this.cachedDir=t.asDir()}get header(){return nodeHeader(this.cachedDir)}async ls(e){return await this.publicRoot.ls([...this.directory,...e])}async mkdir(e){return this.checkMutability(`mkdir at ${[...this.directory,...e].join("/")}`),await this.publicRoot.mkdir([...this.directory,...e]),await this.updateCache(),this}async cat(e){return await this.publicRoot.cat([...this.directory,...e])}async add(e,t){return this.checkMutability(`write at ${[...this.directory,...e].join("/")}`),await this.publicRoot.add([...this.directory,...e],t),await this.updateCache(),this}async rm(e){return this.checkMutability(`remove at ${[...this.directory,...e].join("/")}`),await this.publicRoot.rm([...this.directory,...e]),await this.updateCache(),this}async mv(e,t){return this.checkMutability(`mv from ${[...this.directory,...e].join("/")} to ${[...this.directory,...t].join("/")}`),await this.publicRoot.mv([...this.directory,...e],[...this.directory,...t]),await this.updateCache(),this}async get(e){return await this.publicRoot.get([...this.directory,...e])}async exists(e){return await this.publicRoot.exists([...this.directory,...e])}async put(){await this.publicRoot.put();const t=await(await this.publicRoot.root).store(this.publicRoot.store);return CID$1.decode(t)}async putDetailed(){return{isFile:!1,size:0,cid:await this.put()}}}class PublicFileWasm extends BaseFile{constructor(e,t,n,o,s){super(e),this.directory=t,this.filename=n,this.publicRoot=o,this.cachedFile=s}async updateCache(){const t=await(await this.publicRoot.root).getNode([...this.directory,this.filename],this.publicRoot.store);this.cachedFile=t.asFile()}get header(){return nodeHeader(this.cachedFile)}async updateContent(e){return await super.updateContent(e),await this.updateCache(),this}async putDetailed(){const e=await this.publicRoot.root,t=[...this.directory,this.filename],{result:n}=await e.getNode(t,this.publicRoot.store);if(n==null)throw new Error(`No file at /${t.join("/")}.`);if(!n.isFile())throw new Error(`Not a file at /${t.join("/")}`);const o=n.asFile();return{isFile:!0,size:0,cid:CID$1.decode(await o.store(this.publicRoot.store))}}}function nodeHeader(r){const e=r.metadata(),t={isFile:e.unixMeta.kind==="file",version:e.version,unixMeta:{_type:e.unixMeta.kind,ctime:Number(e.unixMeta.created),mtime:Number(e.unixMeta.modified),mode:e.unixMeta.mode}},n=r.previousCid();return n==null?{metadata:t}:{metadata:t,previous:CID$1.decode(n)}}class RootTree{constructor({dependencies:e,links:t,mmpt:n,privateLog:o,sharedCounter:s,sharedLinks:u,publicTree:f,prettyTree:l,privateNodes:h}){this.dependencies=e,this.links=t,this.mmpt=n,this.privateLog=o,this.sharedCounter=s,this.sharedLinks=u,this.publicTree=f,this.prettyTree=l,this.privateNodes=h}static async empty({accountDID:e,dependencies:t,rootKey:n,wnfsWasm:o}){o&&t.manners.log("⚠️ Running an EXPERIMENTAL new version of the file system: 3.0.0");const s=o?await PublicRootWasm.empty(t):await PublicTree.empty(t.depot,t.reference),u=await BareTree.empty(t.depot),f=MMPT.create(t.depot),l=toPosix(directory(RootBranch.Private)),h=await PrivateTree.create(t.crypto,t.depot,t.manners,t.reference,f,n,null);await h.put();const p=new RootTree({dependencies:t,links:{},mmpt:f,privateLog:[],sharedCounter:1,sharedLinks:{},publicTree:s,prettyTree:u,privateNodes:{[l]:h}});return await store({accountDID:e,crypto:t.crypto,readKey:n}),await p.setVersion(o?wnfsWasm:latest),await Promise.all([p.updatePuttable(RootBranch.Public,s),p.updatePuttable(RootBranch.Pretty,u),p.updatePuttable(RootBranch.Private,f)]),p}static async fromCID({accountDID:e,dependencies:t,cid:n,permissions:o}){var Be,ot,nt,st,_t;const{crypto:s,depot:u,manners:f}=t,l=await getSimpleLinks(t.depot,n),h=await permissionKeys(s,e,o||ROOT_FILESYSTEM_PERMISSIONS),p=await parseVersionFromLinks(t.depot,l),m=equals$1(p,wnfsWasm);m&&t.manners.log("⚠️ Running an EXPERIMENTAL new version of the file system: 3.0.0");const b=((Be=l[RootBranch.Public])==null?void 0:Be.cid)||null,S=b===null?await PublicTree.empty(t.depot,t.reference):m?await PublicRootWasm.fromCID({depot:u,manners:f},decodeCID(b)):await PublicTree.fromCID(t.depot,t.reference,decodeCID(b)),A=l[RootBranch.Pretty]?await BareTree.fromCID(t.depot,decodeCID(l[RootBranch.Pretty].cid)):await BareTree.empty(t.depot),L=((ot=l[RootBranch.Private])==null?void 0:ot.cid)||null;let J,ne;L===null?(J=MMPT.create(t.depot),ne={}):(J=await MMPT.fromCID(t.depot,decodeCID(L)),ne=await loadPrivateNodes(t,e,h,J));const pe=(nt=l[RootBranch.PrivateLog])==null?void 0:nt.cid,de=pe?await getPB(u,decodeCID(pe)).then(ht=>ht.Links.map(fromDAGLink)).then(ht=>ht.sort((Lt,At)=>parseInt(Lt.name,10)-parseInt(At.name,10))):[],H=((st=l[RootBranch.Shared])==null?void 0:st.cid)||null,z=H?await this.getSharedLinks(u,decodeCID(H)):{},ue=((_t=l[RootBranch.SharedCounter])==null?void 0:_t.cid)||null,ce=ue?await getFile(t.depot,decodeCID(ue)).then(ht=>JSON.parse(toString$7(ht,"utf8"))):1,Ee=new RootTree({dependencies:t,links:l,mmpt:J,privateLog:de,sharedCounter:ce,sharedLinks:z,publicTree:S,prettyTree:A,privateNodes:ne});return l[RootBranch.Version]==null&&await Ee.setVersion(latest),Ee}async put(){const{cid:e}=await this.putDetailed();return e}async putDetailed(){return putLinks(this.dependencies.depot,this.links)}updateLink(e,t){const{cid:n,size:o,isFile:s}=t;return this.links[e]=make(e,n,s,o),this}async updatePuttable(e,t){return this.updateLink(e,await t.putDetailed())}findPrivateNode(e){return findPrivateNode(this.privateNodes,e)}async addPrivateLogEntry(e,t){var m;const n=[...this.privateLog];let o=Math.max(0,n.length-1),s=(m=n[o])!=null&&m.cid?await e.getUnixFile(decodeCID(n[o].cid)).then(b=>toString$7(b,"utf8")).then(b=>b.split(",")):[];s.length+1>RootTree.LOG_CHUNK_SIZE&&(o=o+1,s=[]);const f=await this.dependencies.crypto.hash.sha256(fromString$7(encodeCID$1(t),"utf8")),l=[...s,f],h=await putFile$1(this.dependencies.depot,fromString$7(l.join(","),"utf8"));n[o]={name:o.toString(),cid:h.cid,size:h.size};const p=await putPB(this.dependencies.depot,n.map(toDAGLink));this.updateLink(RootBranch.PrivateLog,{cid:p,isFile:!1,size:await this.dependencies.depot.size(p)}),this.privateLog=n}async addShares(e){this.sharedLinks=e.reduce((o,s)=>({...o,[s.name]:s}),this.sharedLinks);const t=Object.values(this.sharedLinks).reduce((o,{cid:s,name:u,size:f})=>({...o,[u]:{cid:s,name:u,size:f}}),{}),n=await this.dependencies.depot.putBlock(encode$7(t),code$4);return this.updateLink(RootBranch.Shared,{cid:n,isFile:!1,size:await this.dependencies.depot.size(n)}),this}static async getSharedLinks(e,t){const n=await e.getBlock(t),o=decode$5(n);if(!isObject$1(o))throw new Error("Invalid shared section, not an object");return Object.values(o).reduce((s,u)=>{if(!isObject$1(u))return s;const f=u.name?u.name:null,l=u.cid?decodeCID(u.cid):null;return!f||!l?s:{...s,[f]:{name:f,cid:l,size:u.size||0}}},{})}async setSharedCounter(e){this.sharedCounter=e;const{cid:t,size:n}=await putFile$1(this.dependencies.depot,fromString$7(JSON.stringify(e),"utf8"));return this.updateLink(RootBranch.SharedCounter,{cid:t,isFile:!0,size:n}),e}async bumpSharedCounter(){const e=this.sharedCounter+1;return this.setSharedCounter(e)}async setVersion(e){const t=fromString$7(toString$3(e),"utf8"),n=await putFile$1(this.dependencies.depot,t);return this.updateLink(RootBranch.Version,n)}async getVersion(){return await parseVersionFromLinks(this.dependencies.depot,this.links)}}RootTree.LOG_CHUNK_SIZE=1020;async function findBareNameFilter(r,e,t,n,o){const s=await bareNameFilter({accountDID:t,crypto:r,path:o}),u=await e.getItem(s);if(u)return u;const[f,l]=findPrivateNode(n,o);if(!l)return null;const p=unwrap$2(o).slice(unwrap$2(f).length);return PrivateFile.instanceOf(l)?p.length===0?l.header.bareNameFilter:null:(l.exists(p)||(isDirectory(o)?await l.mkdir(p):await l.add(p,new Uint8Array)),l.get(p).then(m=>m?m.header.bareNameFilter:null))}function findPrivateNode(r,e){const t=r[toPosix(e)];if(t)return[e,t];const n=parent(e);return n?findPrivateNode(r,n):[e,null]}function loadPrivateNodes(r,e,t,n){const{crypto:o,storage:s}=r;return sortedPathKeys(t).reduce((u,{path:f,key:l})=>u.then(async h=>{let p;const m=unwrap$2(f);if(m.length===1&&m[0]===RootBranch.Private)p=await PrivateTree.fromBaseKey(r.crypto,r.depot,r.manners,r.reference,n,l);else{const S=await findBareNameFilter(o,s,e,h,f);if(!S)throw new Error(`Was trying to load the PrivateTree for the path \`${f}\`, but couldn't find the bare name filter for it.`);isDirectory(f)?p=await PrivateTree.fromBareNameFilter(r.crypto,r.depot,r.manners,r.reference,n,S,l):p=await PrivateFile.fromBareNameFilter(r.crypto,r.depot,n,S,l)}const b=toPosix(f);return{...h,[b]:p}}),Promise.resolve({}))}async function parseVersionFromLinks(r,e){const t=await getFile(r,decodeCID(e[RootBranch.Version].cid));return fromString$3(toString$7(t))??v0}async function permissionKeys(r,e,t){return permissionPaths(t).reduce(async(n,o)=>{if(isPartition(RootBranch.Public,o))return n;const s=await readKey({accountDID:e,crypto:r,path:o}),u=await r.keystore.exportSymmKey(s),f={path:o,key:u};return n.then(l=>[...l,f])},Promise.resolve([]))}function sortedPathKeys(r){return r.sort((e,t)=>toPosix(e.path).localeCompare(toPosix(t.path)))}class FileSystem{constructor({account:e,dependencies:t,eventEmitter:n,root:o,localOnly:s}){this.account=e,this.dependencies=t,this.eventEmitter=n,this.localOnly=s||!1,this.proofs={},this.publishHooks=[],this.root=o,this._publishWhenOnline=[],this._publishing=!1,this._whenOnline=this._whenOnline.bind(this),this._beforeLeaving=this._beforeLeaving.bind(this);const u=async l=>{await this.dependencies.reference.repositories.cidLog.add(l),this.dependencies.manners.log("📓 Adding to the CID ledger:",l.toString())},f=throttle(3e3,!1,(l,h)=>{if(globalThis.navigator.onLine)return this._publishing=[l,!0],this.dependencies.reference.dataRoot.update(l,h).then(()=>{this._publishing&&this._publishing[0]===l&&(n.emit("publish",{root:l}),this._publishing=!1)});this._publishWhenOnline.push([l,h])},!1);this.publishHooks.push(u),this.publishHooks.push(f),this.localOnly||(globalThis.addEventListener("online",this._whenOnline),globalThis.addEventListener("beforeunload",this._beforeLeaving))}static async empty(e){const{account:t,dependencies:n,eventEmitter:o,localOnly:s}=e,u=e.rootKey||await n.crypto.aes.genKey(DEFAULT_AES_ALG).then(n.crypto.aes.exportKey),f=e.version===toString$3(wnfsWasm),l=await RootTree.empty({accountDID:t.rootDID,dependencies:n,rootKey:u,wnfsWasm:f});return new FileSystem({account:t,dependencies:n,eventEmitter:o,root:l,localOnly:s})}static async fromCID(e,t){const{account:n,dependencies:o,eventEmitter:s,permissions:u,localOnly:f}=t,l=await RootTree.fromCID({accountDID:n.rootDID,dependencies:o,cid:e,permissions:u});return new FileSystem({account:n,dependencies:o,eventEmitter:s,root:l,localOnly:f})}deactivate(){this.localOnly||(globalThis.removeEventListener("online",this._whenOnline),globalThis.removeEventListener("beforeunload",this._beforeLeaving))}async ls(e){if(isFile$1(e))throw new Error("`ls` only accepts directory paths");return this.runOnNode(e,{public:async(t,n)=>t.ls(n),private:async(t,n)=>{if(isFile(t))throw new Error("Tried to `ls` a file");return t.ls(n)}})}async mkdir(e,t={}){if(isFile$1(e))throw new Error("`mkdir` only accepts directory paths");return await this.runMutationOnNode(e,{public:async(n,o)=>{await n.mkdir(o)},private:async(n,o)=>{if(isFile(n))throw new Error("Tried to `mkdir` a file");await n.mkdir(o)}}),t.publish&&await this.publish(),this}async write(e,t,n={}){if(isSoftLink(t)||isSoftLinkDictionary(t)||isSoftLinkList(t)){if(isFile$1(e))throw new Error("Can't add soft links to a file");await this.runMutationOnNode(e,{public:async(s,u)=>{const f=Array.isArray(t)?t:isObject$1(t)?Object.values(t):[t];await this.runOnChildTree(s,u,async l=>(f.forEach(h=>{(PrivateTree.instanceOf(l)||PublicTree.instanceOf(l))&&l.assignLink({name:h.name,link:h,skeleton:h})}),l))},private:async(s,u)=>{const f=Array.isArray(t)?t:isObject$1(t)?Object.values(t):[t];await this.runOnChildTree(s,u,async l=>(f.forEach(h=>{(PrivateTree.instanceOf(l)||PublicTree.instanceOf(l))&&l.assignLink({name:h.name,link:h,skeleton:h})}),l))}})}else{if(isDirectory(e))throw new Error("`add` only accepts file paths when working with regular files");await this.runMutationOnNode(e,{public:async(s,u)=>{await s.add(u,t)},private:async(s,u)=>{isFile(s)?await s.updateContent(t):await s.add(u,t)}})}return n.publish&&await this.publish(),this}async read(e){if(isDirectory(e))throw new Error("`cat` only accepts file paths");return this.runOnNode(e,{public:async(t,n)=>await t.cat(n),private:async(t,n)=>isFile(t)?t.content:await t.cat(n)})}async exists(e){return this.runOnNode(e,{public:async(t,n)=>await t.exists(n),private:async(t,n)=>isFile(t)||await t.exists(n)})}async get(e){return this.runOnNode(e,{public:async(t,n)=>await t.get(n),private:async(t,n)=>isFile(t)?t:await t.get(n)})}async mv(e,t){const n=isSamePartition(e,t);if(!isSameKind(e,t)){const o=kind(e),s=kind(t);throw new Error(`Can't move to a different kind of path, from is a ${o} and to is a ${s}`)}if(!n)throw new Error("`mv` is only supported on the same tree for now");if(await this.exists(t))throw new Error("Destination already exists");return await this.runMutationOnNode(e,{public:async(o,s)=>{const[u,...f]=unwrap$2(t);await o.mv(s,f)},private:async(o,s)=>{if(isFile(o))throw new Error("Tried to `mv` within a file");const[u,...f]=unwrap$2(t);await o.mv(s,f)}}),this}resolveSymlink(e){return hasProp(e,"privateName")?PrivateTree.resolveSoftLink(this.dependencies.crypto,this.dependencies.depot,this.dependencies.manners,this.dependencies.reference,e):PublicTree.resolveSoftLink(this.dependencies.depot,this.dependencies.reference,e)}async rm(e){return await this.runMutationOnNode(e,{public:async(t,n)=>{await t.rm(n)},private:async(t,n)=>{if(isFile(t))throw new Error("Cannot `rm` a file you've asked permission for");await t.rm(n)}}),this}async symlink(e){const{at:t,referringTo:n,name:o}=e,s=this.account.username;if(t==null)throw new Error("Missing parameter `symlink.at`");if(isFile$1(t))throw new Error("`symlink.at` only accepts directory paths");const u=isSamePartition(t,n);if(!s)throw new Error("I need a username in order to use this method");if(!u)throw new Error("`link` is only supported on the same tree for now");return await this.runMutationOnNode(t,{public:async(f,l)=>{if(!BareTree.instanceOf(f))if(PublicTree.instanceOf(f))await this.runOnChildTree(f,l,async h=>(PublicTree.instanceOf(h)&&h.insertSoftLink({path:removePartition(n),name:o,username:s}),h));else throw new Error("Symlinks not supported in WASM-WNFS yet.")},private:async(f,l)=>{if(isFile(f))throw new Error("Cannot add a soft link to a file");await this.runOnChildTree(f,l,async h=>{if(PrivateTree.instanceOf(h)){const p=await this.runOnNode(n,{public:async()=>{throw new Error("File system hit a public node within a private node. This is not supported/this should not happen.")},private:async(m,b)=>{const S=isFile(m)?m:await m.get(b);if(PrivateTree.instanceOf(S))return S;if(PrivateFile.instanceOf(S))return S;throw new Error("`symlink.referringTo` is not of the right type")}});if(!p)throw new Error("Could not find the item the symlink is referring to");h.insertSoftLink({name:o,username:s,key:p.key,privateName:await p.getName()})}return h})}}),this}async publish(){const e=Array.from(Object.entries(this.proofs));this.proofs={};const t=await this.root.put();return e.forEach(([n,o])=>{this.publishHooks.forEach(s=>s(t,o))}),t}async historyStep(){const e=this.root.publicTree;hasProp(e,"historyStep")&&typeof e.historyStep=="function"&&await e.historyStep()}async acceptShare({shareId:e,sharedBy:t}){const n=await this.loadShare({shareId:e,sharedBy:t});return await this.write(directory(RootBranch.Private,"Shared with me",t),await n.ls([]).then(Object.values).then(o=>o.filter(isSoftLink))),this}async loadShare({shareId:e,sharedBy:t}){var ce,Ee,Be;const n=await exchange(this.dependencies.crypto),o=await this.dependencies.reference.didRoot.lookup(t),s=await create$4(this.dependencies.crypto,{counter:parseInt(e,10),recipientExchangeDid:n,senderRootDid:o}),u=await this.dependencies.reference.dataRoot.lookup(t);if(!u)throw new Error("This user doesn't have a filesystem yet.");const f=await getSimpleLinks(this.dependencies.depot,u),l=((ce=f[RootBranch.Shared])==null?void 0:ce.cid)||null;if(!l)throw new Error("This user hasn't shared anything yet.");const h=await RootTree.getSharedLinks(this.dependencies.depot,decodeCID(l)),p=isObject$1(h)?h[s]:null;if(!p)throw new Error("Couldn't find a matching share.");const m=isObject$1(p)?p.cid:null;if(!m)throw new Error("Couldn't find a matching share.");const b=await this.dependencies.depot.getBlock(decodeCID(m)),S=await this.dependencies.crypto.keystore.decrypt(b),A=decode$5(S);if(!hasProp(A,"cid"))throw new Error("Share payload is missing the `cid` property");if(!hasProp(A,"key"))throw new Error("Share payload is missing the `key` property");if(!hasProp(A,"algo"))throw new Error("Share payload is missing the `algo` property");const L=A.cid,J=A.key,ne=A.algo;if(!((Ee=f[RootBranch.Private])==null?void 0:Ee.cid))throw new Error("This user's filesystem doesn't have a private branch");const de=await MMPT.fromCID(this.dependencies.depot,decodeCID((Be=f[RootBranch.Private])==null?void 0:Be.cid)),H=await this.dependencies.depot.getBlock(decodeCID(L)),z=await this.dependencies.crypto.aes.decrypt(H,J,ne),ue=JSON.parse(toString$7(z,"utf8"));if(!isDecryptedNode(ue))throw new Error("The share payload did not point to a valid entry index");return PrivateTree.fromInfo(this.dependencies.crypto,this.dependencies.depot,this.dependencies.manners,this.dependencies.reference,de,J,ue)}async sharePrivate(e,{sharedBy:t,shareWith:n}){const o=e.filter(f=>isOnRootBranch(RootBranch.Private,f));if(!t){if(!this.account.username)throw new Error("I need a username in order to use this method");t={rootDid:this.account.rootDID,username:this.account.username}}const s=await o.reduce(async(f,l)=>{const h=await f,p=terminus(l),m=await this.get(l);return p&&(PrivateFile.instanceOf(m)||PrivateTree.instanceOf(m))?[...h,[p,m]]:h},Promise.resolve([]));if(!s.length)throw new Error("Didn't find any items to share");const u=await privateNode(this.dependencies.crypto,this.dependencies.depot,this.dependencies.manners,this.dependencies.reference,this.root,s,{shareWith:n,sharedBy:t});return await this.root.bumpSharedCounter(),await this.root.updatePuttable(RootBranch.Private,this.root.mmpt),await this.publish(),u}async checkMutationPermissionAndAddProof(e,t){const n=t?"make changes to":"query";if(!this.localOnly){const o=await this.dependencies.reference.repositories.ucans.lookupFilesystemUcan(e);if(!o||isExpired(o)||!o.signature)throw new NoPermissionError(`I don't have the necessary permissions to ${n} the file system at "${toPosix(e)}"`);this.proofs[o.signature]=o}}async runMutationOnNode(e,t){const n=unwrap$2(e),o=n[0],s=n.slice(1);if(await this.checkMutationPermissionAndAddProof(e,!0),o===RootBranch.Public)await t.public(this.root.publicTree,s),await t.public(this.root.prettyTree,s),await Promise.all([this.root.updatePuttable(RootBranch.Public,this.root.publicTree),this.root.updatePuttable(RootBranch.Pretty,this.root.prettyTree)]);else if(o===RootBranch.Private){const[u,f]=this.root.findPrivateNode(e);if(!f)throw new NoPermissionError(`I don't have the necessary permissions to make changes to the file system at "${toPosix(e)}"`);await t.private(f,n.slice(unwrap$2(u).length)),await f.put(),await this.root.updatePuttable(RootBranch.Private,this.root.mmpt);const l=await this.root.mmpt.put();await this.root.addPrivateLogEntry(this.dependencies.depot,l)}else throw o===RootBranch.Pretty?new Error("The pretty path is read only"):new Error("Not a valid FileSystem path");this.eventEmitter.emit("local-change",{root:await this.root.put(),path:e})}async runOnNode(e,t){const n=unwrap$2(e),o=n[0],s=n.slice(1);if(await this.checkMutationPermissionAndAddProof(e,!1),o===RootBranch.Public)return await t.public(this.root.publicTree,s);if(o===RootBranch.Private){const[u,f]=this.root.findPrivateNode(e);if(!f)throw new NoPermissionError(`I don't have the necessary permissions to query the file system at "${toPosix(e)}"`);return await t.private(f,n.slice(unwrap$2(u).length))}else{if(o===RootBranch.Pretty)return await t.public(this.root.prettyTree,s);throw new Error("Not a valid FileSystem path")}}async runOnChildTree(e,t,n){let o=e;if(t.length){await o.exists(t)||await o.mkdir(t);const s=await o.get(t);if(isTree(s))o=s;else throw new Error("Path does not point to a directory")}return o=await n(o),t.length?await e.updateChild(o,t):e}_whenOnline(){const e=[...this._publishWhenOnline];this._publishWhenOnline=[],e.forEach(([t,n])=>{this.publishHooks.forEach(o=>o(t,n))})}_beforeLeaving(e){const t="Are you sure you want to leave? We don't control the browser so you may lose your data.";if(this._publishing||this._publishWhenOnline.length)return(e||globalThis.event).returnValue=t,t}}async function loadFileSystem({config:r,dependencies:e,eventEmitter:t,rootKey:n,username:o}){var pe;const{crypto:s,depot:u,manners:f,reference:l,storage:h}=e;let p,m;const b=l.repositories.cidLog,S={username:o,rootDID:await l.didRoot.lookup(o)},A=navigator.onLine?await getDataRoot(l,o,{maxRetries:20}):null,L=A?b.indexOf(A):-1;if(navigator.onLine)if(!A)p=b.newest(),p?f.log("📓 No DNSLink, using local CID:",p.toString()):f.log("📓 Creating a new file system");else if(L===b.length()-1)p=A,f.log("📓 DNSLink is up to date:",p.toString());else if(L!==-1&&L<b.length()-1){p=b.newest();const de=b.length()-1-L,H=de===1?"1 newer local entry":de.toString()+" newer local entries";f.log("📓 DNSLink is outdated ("+H+"), using local CID:",p.toString())}else p=A,await b.add(p),f.log("📓 DNSLink is newer:",p.toString());else throw p=b.newest(),p&&f.log("📓 Working offline, using local CID:",p.toString()),new Error("Offline, don't have a filesystem to work with.");const J=r.permissions,ne={crypto:s,depot:u,reference:l,storage:h};return p?(await checkFileSystemVersion(e.depot,r,p),await f.fileSystem.hooks.beforeLoadExisting(p,S,ne),m=await FileSystem.fromCID(p,{account:S,dependencies:e,eventEmitter:t,permissions:J}),await f.fileSystem.hooks.afterLoadExisting(m,S,ne),m):(await f.fileSystem.hooks.beforeLoadNew(S,ne),m=await FileSystem.empty({account:S,dependencies:e,eventEmitter:t,rootKey:n,permissions:J,version:(pe=r.fileSystem)==null?void 0:pe.version}),await f.fileSystem.hooks.afterLoadNew(m,S,ne),m)}async function recoverFileSystem({auth:r,dependencies:e,oldUsername:t,newUsername:n,readKey:o}){const{crypto:s,reference:u,storage:f}=e,l=await write(s),{success:h}=await r.register({username:n});if(!h)throw new Error("Failed to register new user");const p=await f.getItem(f.KEYS.ACCOUNT_UCAN),m=await build({dependencies:e,potency:"APPEND",resource:"*",proof:p||void 0,lifetimeInSeconds:60*3,audience:l,issuer:l}),b=await u.dataRoot.lookup(t);if(!b)throw new Error("Failed to lookup oldUsername");return await u.dataRoot.update(b,m),await store({accountDID:l,crypto:s,readKey:o}),{success:!0}}const DEFAULT_USER_MESSAGES={versionMismatch:{newer:async()=>alertIfPossible(`Sorry, we can't sync your filesystem with this app. This app only understands older versions of filesystems.

Please try to hard refresh this site or let this app's developer know.

Feel free to contact Fission support: support@fission.codes`),older:async()=>alertIfPossible(`Sorry, we can't sync your filesystem with this app. Your filesystem version is out-dated and it needs to be migrated.

Run a migration (https://guide.fission.codes/accounts/account-signup/account-migration) or talk to Fission support: support@fission.codes`)}};async function checkFileSystemVersion(r,e,t){const n=await getSimpleLinks(r,t),o=n[RootBranch.Version]==null?"1.0.0":new TextDecoder().decode(await getFile(r,decodeCID(n[RootBranch.Version].cid))),s=async()=>(await(e.userMessages||DEFAULT_USER_MESSAGES).versionMismatch.newer(o),new Error(`Incompatible filesystem version. Version: ${o} Supported versions: ${supported.map(h=>toString$3(h)).join(", ")}. Please upgrade this app's webnative version.`)),u=async()=>(await(e.userMessages||DEFAULT_USER_MESSAGES).versionMismatch.older(o),new Error(`Incompatible filesystem version. Version: ${o} Supported versions: ${supported.map(h=>toString$3(h)).join(", ")}. The user should migrate their filesystem.`)),f=fromString$3(o);if(f==null)throw await s();const l=isSupported$1(f);if(l==="too-high")throw await s();if(l==="too-low")throw await u()}function alertIfPossible(r){globalThis.alert!=null&&globalThis.alert(r)}async function getDataRoot(r,e,t={}){const n=t.maxRetries??0,o=t.retryInterval??500;let s=await r.dataRoot.lookup(e).catch(()=>null);return s?s.toString()===EMPTY_CID?null:s:new Promise((u,f)=>{let l=0;const h=setInterval(async()=>{if(s=await r.dataRoot.lookup(e).catch(()=>null),!s&&l<n){l++;return}else l>=n&&f("Failed to load data root");clearInterval(h),u((s==null?void 0:s.toString())===EMPTY_CID?null:s)},o)})}const _globalReference=globalThis||window||self,webcrypto=_globalReference.crypto;var naclFastExports={},naclFast={get exports(){return naclFastExports},set exports(r){naclFastExports=r}};(function(r){(function(e){var t=function(v){var T,k=new Float64Array(16);if(v)for(T=0;T<v.length;T++)k[T]=v[T];return k},n=function(){throw new Error("no PRNG")},o=new Uint8Array(16),s=new Uint8Array(32);s[0]=9;var u=t(),f=t([1]),l=t([56129,1]),h=t([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),p=t([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),m=t([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),b=t([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),S=t([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function A(v,T,k,y){v[T]=k>>24&255,v[T+1]=k>>16&255,v[T+2]=k>>8&255,v[T+3]=k&255,v[T+4]=y>>24&255,v[T+5]=y>>16&255,v[T+6]=y>>8&255,v[T+7]=y&255}function L(v,T,k,y,B){var Q,Z=0;for(Q=0;Q<B;Q++)Z|=v[T+Q]^k[y+Q];return(1&Z-1>>>8)-1}function J(v,T,k,y){return L(v,T,k,y,16)}function ne(v,T,k,y){return L(v,T,k,y,32)}function pe(v,T,k,y){for(var B=y[0]&255|(y[1]&255)<<8|(y[2]&255)<<16|(y[3]&255)<<24,Q=k[0]&255|(k[1]&255)<<8|(k[2]&255)<<16|(k[3]&255)<<24,Z=k[4]&255|(k[5]&255)<<8|(k[6]&255)<<16|(k[7]&255)<<24,ye=k[8]&255|(k[9]&255)<<8|(k[10]&255)<<16|(k[11]&255)<<24,xe=k[12]&255|(k[13]&255)<<8|(k[14]&255)<<16|(k[15]&255)<<24,Le=y[4]&255|(y[5]&255)<<8|(y[6]&255)<<16|(y[7]&255)<<24,Ce=T[0]&255|(T[1]&255)<<8|(T[2]&255)<<16|(T[3]&255)<<24,yt=T[4]&255|(T[5]&255)<<8|(T[6]&255)<<16|(T[7]&255)<<24,Ie=T[8]&255|(T[9]&255)<<8|(T[10]&255)<<16|(T[11]&255)<<24,Ge=T[12]&255|(T[13]&255)<<8|(T[14]&255)<<16|(T[15]&255)<<24,Qe=y[8]&255|(y[9]&255)<<8|(y[10]&255)<<16|(y[11]&255)<<24,et=k[16]&255|(k[17]&255)<<8|(k[18]&255)<<16|(k[19]&255)<<24,Ye=k[20]&255|(k[21]&255)<<8|(k[22]&255)<<16|(k[23]&255)<<24,We=k[24]&255|(k[25]&255)<<8|(k[26]&255)<<16|(k[27]&255)<<24,je=k[28]&255|(k[29]&255)<<8|(k[30]&255)<<16|(k[31]&255)<<24,He=y[12]&255|(y[13]&255)<<8|(y[14]&255)<<16|(y[15]&255)<<24,De=B,Ne=Q,Se=Z,Pe=ye,Fe=xe,Ae=Le,re=Ce,ie=yt,_e=Ie,E=Ge,P=Qe,C=et,M=Ye,K=We,j=je,ee=He,I,ae=0;ae<20;ae+=2)I=De+M|0,Fe^=I<<7|I>>>32-7,I=Fe+De|0,_e^=I<<9|I>>>32-9,I=_e+Fe|0,M^=I<<13|I>>>32-13,I=M+_e|0,De^=I<<18|I>>>32-18,I=Ae+Ne|0,E^=I<<7|I>>>32-7,I=E+Ae|0,K^=I<<9|I>>>32-9,I=K+E|0,Ne^=I<<13|I>>>32-13,I=Ne+K|0,Ae^=I<<18|I>>>32-18,I=P+re|0,j^=I<<7|I>>>32-7,I=j+P|0,Se^=I<<9|I>>>32-9,I=Se+j|0,re^=I<<13|I>>>32-13,I=re+Se|0,P^=I<<18|I>>>32-18,I=ee+C|0,Pe^=I<<7|I>>>32-7,I=Pe+ee|0,ie^=I<<9|I>>>32-9,I=ie+Pe|0,C^=I<<13|I>>>32-13,I=C+ie|0,ee^=I<<18|I>>>32-18,I=De+Pe|0,Ne^=I<<7|I>>>32-7,I=Ne+De|0,Se^=I<<9|I>>>32-9,I=Se+Ne|0,Pe^=I<<13|I>>>32-13,I=Pe+Se|0,De^=I<<18|I>>>32-18,I=Ae+Fe|0,re^=I<<7|I>>>32-7,I=re+Ae|0,ie^=I<<9|I>>>32-9,I=ie+re|0,Fe^=I<<13|I>>>32-13,I=Fe+ie|0,Ae^=I<<18|I>>>32-18,I=P+E|0,C^=I<<7|I>>>32-7,I=C+P|0,_e^=I<<9|I>>>32-9,I=_e+C|0,E^=I<<13|I>>>32-13,I=E+_e|0,P^=I<<18|I>>>32-18,I=ee+j|0,M^=I<<7|I>>>32-7,I=M+ee|0,K^=I<<9|I>>>32-9,I=K+M|0,j^=I<<13|I>>>32-13,I=j+K|0,ee^=I<<18|I>>>32-18;De=De+B|0,Ne=Ne+Q|0,Se=Se+Z|0,Pe=Pe+ye|0,Fe=Fe+xe|0,Ae=Ae+Le|0,re=re+Ce|0,ie=ie+yt|0,_e=_e+Ie|0,E=E+Ge|0,P=P+Qe|0,C=C+et|0,M=M+Ye|0,K=K+We|0,j=j+je|0,ee=ee+He|0,v[0]=De>>>0&255,v[1]=De>>>8&255,v[2]=De>>>16&255,v[3]=De>>>24&255,v[4]=Ne>>>0&255,v[5]=Ne>>>8&255,v[6]=Ne>>>16&255,v[7]=Ne>>>24&255,v[8]=Se>>>0&255,v[9]=Se>>>8&255,v[10]=Se>>>16&255,v[11]=Se>>>24&255,v[12]=Pe>>>0&255,v[13]=Pe>>>8&255,v[14]=Pe>>>16&255,v[15]=Pe>>>24&255,v[16]=Fe>>>0&255,v[17]=Fe>>>8&255,v[18]=Fe>>>16&255,v[19]=Fe>>>24&255,v[20]=Ae>>>0&255,v[21]=Ae>>>8&255,v[22]=Ae>>>16&255,v[23]=Ae>>>24&255,v[24]=re>>>0&255,v[25]=re>>>8&255,v[26]=re>>>16&255,v[27]=re>>>24&255,v[28]=ie>>>0&255,v[29]=ie>>>8&255,v[30]=ie>>>16&255,v[31]=ie>>>24&255,v[32]=_e>>>0&255,v[33]=_e>>>8&255,v[34]=_e>>>16&255,v[35]=_e>>>24&255,v[36]=E>>>0&255,v[37]=E>>>8&255,v[38]=E>>>16&255,v[39]=E>>>24&255,v[40]=P>>>0&255,v[41]=P>>>8&255,v[42]=P>>>16&255,v[43]=P>>>24&255,v[44]=C>>>0&255,v[45]=C>>>8&255,v[46]=C>>>16&255,v[47]=C>>>24&255,v[48]=M>>>0&255,v[49]=M>>>8&255,v[50]=M>>>16&255,v[51]=M>>>24&255,v[52]=K>>>0&255,v[53]=K>>>8&255,v[54]=K>>>16&255,v[55]=K>>>24&255,v[56]=j>>>0&255,v[57]=j>>>8&255,v[58]=j>>>16&255,v[59]=j>>>24&255,v[60]=ee>>>0&255,v[61]=ee>>>8&255,v[62]=ee>>>16&255,v[63]=ee>>>24&255}function de(v,T,k,y){for(var B=y[0]&255|(y[1]&255)<<8|(y[2]&255)<<16|(y[3]&255)<<24,Q=k[0]&255|(k[1]&255)<<8|(k[2]&255)<<16|(k[3]&255)<<24,Z=k[4]&255|(k[5]&255)<<8|(k[6]&255)<<16|(k[7]&255)<<24,ye=k[8]&255|(k[9]&255)<<8|(k[10]&255)<<16|(k[11]&255)<<24,xe=k[12]&255|(k[13]&255)<<8|(k[14]&255)<<16|(k[15]&255)<<24,Le=y[4]&255|(y[5]&255)<<8|(y[6]&255)<<16|(y[7]&255)<<24,Ce=T[0]&255|(T[1]&255)<<8|(T[2]&255)<<16|(T[3]&255)<<24,yt=T[4]&255|(T[5]&255)<<8|(T[6]&255)<<16|(T[7]&255)<<24,Ie=T[8]&255|(T[9]&255)<<8|(T[10]&255)<<16|(T[11]&255)<<24,Ge=T[12]&255|(T[13]&255)<<8|(T[14]&255)<<16|(T[15]&255)<<24,Qe=y[8]&255|(y[9]&255)<<8|(y[10]&255)<<16|(y[11]&255)<<24,et=k[16]&255|(k[17]&255)<<8|(k[18]&255)<<16|(k[19]&255)<<24,Ye=k[20]&255|(k[21]&255)<<8|(k[22]&255)<<16|(k[23]&255)<<24,We=k[24]&255|(k[25]&255)<<8|(k[26]&255)<<16|(k[27]&255)<<24,je=k[28]&255|(k[29]&255)<<8|(k[30]&255)<<16|(k[31]&255)<<24,He=y[12]&255|(y[13]&255)<<8|(y[14]&255)<<16|(y[15]&255)<<24,De=B,Ne=Q,Se=Z,Pe=ye,Fe=xe,Ae=Le,re=Ce,ie=yt,_e=Ie,E=Ge,P=Qe,C=et,M=Ye,K=We,j=je,ee=He,I,ae=0;ae<20;ae+=2)I=De+M|0,Fe^=I<<7|I>>>32-7,I=Fe+De|0,_e^=I<<9|I>>>32-9,I=_e+Fe|0,M^=I<<13|I>>>32-13,I=M+_e|0,De^=I<<18|I>>>32-18,I=Ae+Ne|0,E^=I<<7|I>>>32-7,I=E+Ae|0,K^=I<<9|I>>>32-9,I=K+E|0,Ne^=I<<13|I>>>32-13,I=Ne+K|0,Ae^=I<<18|I>>>32-18,I=P+re|0,j^=I<<7|I>>>32-7,I=j+P|0,Se^=I<<9|I>>>32-9,I=Se+j|0,re^=I<<13|I>>>32-13,I=re+Se|0,P^=I<<18|I>>>32-18,I=ee+C|0,Pe^=I<<7|I>>>32-7,I=Pe+ee|0,ie^=I<<9|I>>>32-9,I=ie+Pe|0,C^=I<<13|I>>>32-13,I=C+ie|0,ee^=I<<18|I>>>32-18,I=De+Pe|0,Ne^=I<<7|I>>>32-7,I=Ne+De|0,Se^=I<<9|I>>>32-9,I=Se+Ne|0,Pe^=I<<13|I>>>32-13,I=Pe+Se|0,De^=I<<18|I>>>32-18,I=Ae+Fe|0,re^=I<<7|I>>>32-7,I=re+Ae|0,ie^=I<<9|I>>>32-9,I=ie+re|0,Fe^=I<<13|I>>>32-13,I=Fe+ie|0,Ae^=I<<18|I>>>32-18,I=P+E|0,C^=I<<7|I>>>32-7,I=C+P|0,_e^=I<<9|I>>>32-9,I=_e+C|0,E^=I<<13|I>>>32-13,I=E+_e|0,P^=I<<18|I>>>32-18,I=ee+j|0,M^=I<<7|I>>>32-7,I=M+ee|0,K^=I<<9|I>>>32-9,I=K+M|0,j^=I<<13|I>>>32-13,I=j+K|0,ee^=I<<18|I>>>32-18;v[0]=De>>>0&255,v[1]=De>>>8&255,v[2]=De>>>16&255,v[3]=De>>>24&255,v[4]=Ae>>>0&255,v[5]=Ae>>>8&255,v[6]=Ae>>>16&255,v[7]=Ae>>>24&255,v[8]=P>>>0&255,v[9]=P>>>8&255,v[10]=P>>>16&255,v[11]=P>>>24&255,v[12]=ee>>>0&255,v[13]=ee>>>8&255,v[14]=ee>>>16&255,v[15]=ee>>>24&255,v[16]=re>>>0&255,v[17]=re>>>8&255,v[18]=re>>>16&255,v[19]=re>>>24&255,v[20]=ie>>>0&255,v[21]=ie>>>8&255,v[22]=ie>>>16&255,v[23]=ie>>>24&255,v[24]=_e>>>0&255,v[25]=_e>>>8&255,v[26]=_e>>>16&255,v[27]=_e>>>24&255,v[28]=E>>>0&255,v[29]=E>>>8&255,v[30]=E>>>16&255,v[31]=E>>>24&255}function H(v,T,k,y){pe(v,T,k,y)}function z(v,T,k,y){de(v,T,k,y)}var ue=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function ce(v,T,k,y,B,Q,Z){var ye=new Uint8Array(16),xe=new Uint8Array(64),Le,Ce;for(Ce=0;Ce<16;Ce++)ye[Ce]=0;for(Ce=0;Ce<8;Ce++)ye[Ce]=Q[Ce];for(;B>=64;){for(H(xe,ye,Z,ue),Ce=0;Ce<64;Ce++)v[T+Ce]=k[y+Ce]^xe[Ce];for(Le=1,Ce=8;Ce<16;Ce++)Le=Le+(ye[Ce]&255)|0,ye[Ce]=Le&255,Le>>>=8;B-=64,T+=64,y+=64}if(B>0)for(H(xe,ye,Z,ue),Ce=0;Ce<B;Ce++)v[T+Ce]=k[y+Ce]^xe[Ce];return 0}function Ee(v,T,k,y,B){var Q=new Uint8Array(16),Z=new Uint8Array(64),ye,xe;for(xe=0;xe<16;xe++)Q[xe]=0;for(xe=0;xe<8;xe++)Q[xe]=y[xe];for(;k>=64;){for(H(Z,Q,B,ue),xe=0;xe<64;xe++)v[T+xe]=Z[xe];for(ye=1,xe=8;xe<16;xe++)ye=ye+(Q[xe]&255)|0,Q[xe]=ye&255,ye>>>=8;k-=64,T+=64}if(k>0)for(H(Z,Q,B,ue),xe=0;xe<k;xe++)v[T+xe]=Z[xe];return 0}function Be(v,T,k,y,B){var Q=new Uint8Array(32);z(Q,y,B,ue);for(var Z=new Uint8Array(8),ye=0;ye<8;ye++)Z[ye]=y[ye+16];return Ee(v,T,k,Z,Q)}function ot(v,T,k,y,B,Q,Z){var ye=new Uint8Array(32);z(ye,Q,Z,ue);for(var xe=new Uint8Array(8),Le=0;Le<8;Le++)xe[Le]=Q[Le+16];return ce(v,T,k,y,B,xe,ye)}var nt=function(v){this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.leftover=0,this.fin=0;var T,k,y,B,Q,Z,ye,xe;T=v[0]&255|(v[1]&255)<<8,this.r[0]=T&8191,k=v[2]&255|(v[3]&255)<<8,this.r[1]=(T>>>13|k<<3)&8191,y=v[4]&255|(v[5]&255)<<8,this.r[2]=(k>>>10|y<<6)&7939,B=v[6]&255|(v[7]&255)<<8,this.r[3]=(y>>>7|B<<9)&8191,Q=v[8]&255|(v[9]&255)<<8,this.r[4]=(B>>>4|Q<<12)&255,this.r[5]=Q>>>1&8190,Z=v[10]&255|(v[11]&255)<<8,this.r[6]=(Q>>>14|Z<<2)&8191,ye=v[12]&255|(v[13]&255)<<8,this.r[7]=(Z>>>11|ye<<5)&8065,xe=v[14]&255|(v[15]&255)<<8,this.r[8]=(ye>>>8|xe<<8)&8191,this.r[9]=xe>>>5&127,this.pad[0]=v[16]&255|(v[17]&255)<<8,this.pad[1]=v[18]&255|(v[19]&255)<<8,this.pad[2]=v[20]&255|(v[21]&255)<<8,this.pad[3]=v[22]&255|(v[23]&255)<<8,this.pad[4]=v[24]&255|(v[25]&255)<<8,this.pad[5]=v[26]&255|(v[27]&255)<<8,this.pad[6]=v[28]&255|(v[29]&255)<<8,this.pad[7]=v[30]&255|(v[31]&255)<<8};nt.prototype.blocks=function(v,T,k){for(var y=this.fin?0:2048,B,Q,Z,ye,xe,Le,Ce,yt,Ie,Ge,Qe,et,Ye,We,je,He,De,Ne,Se,Pe=this.h[0],Fe=this.h[1],Ae=this.h[2],re=this.h[3],ie=this.h[4],_e=this.h[5],E=this.h[6],P=this.h[7],C=this.h[8],M=this.h[9],K=this.r[0],j=this.r[1],ee=this.r[2],I=this.r[3],ae=this.r[4],fe=this.r[5],he=this.r[6],be=this.r[7],ke=this.r[8],Oe=this.r[9];k>=16;)B=v[T+0]&255|(v[T+1]&255)<<8,Pe+=B&8191,Q=v[T+2]&255|(v[T+3]&255)<<8,Fe+=(B>>>13|Q<<3)&8191,Z=v[T+4]&255|(v[T+5]&255)<<8,Ae+=(Q>>>10|Z<<6)&8191,ye=v[T+6]&255|(v[T+7]&255)<<8,re+=(Z>>>7|ye<<9)&8191,xe=v[T+8]&255|(v[T+9]&255)<<8,ie+=(ye>>>4|xe<<12)&8191,_e+=xe>>>1&8191,Le=v[T+10]&255|(v[T+11]&255)<<8,E+=(xe>>>14|Le<<2)&8191,Ce=v[T+12]&255|(v[T+13]&255)<<8,P+=(Le>>>11|Ce<<5)&8191,yt=v[T+14]&255|(v[T+15]&255)<<8,C+=(Ce>>>8|yt<<8)&8191,M+=yt>>>5|y,Ie=0,Ge=Ie,Ge+=Pe*K,Ge+=Fe*(5*Oe),Ge+=Ae*(5*ke),Ge+=re*(5*be),Ge+=ie*(5*he),Ie=Ge>>>13,Ge&=8191,Ge+=_e*(5*fe),Ge+=E*(5*ae),Ge+=P*(5*I),Ge+=C*(5*ee),Ge+=M*(5*j),Ie+=Ge>>>13,Ge&=8191,Qe=Ie,Qe+=Pe*j,Qe+=Fe*K,Qe+=Ae*(5*Oe),Qe+=re*(5*ke),Qe+=ie*(5*be),Ie=Qe>>>13,Qe&=8191,Qe+=_e*(5*he),Qe+=E*(5*fe),Qe+=P*(5*ae),Qe+=C*(5*I),Qe+=M*(5*ee),Ie+=Qe>>>13,Qe&=8191,et=Ie,et+=Pe*ee,et+=Fe*j,et+=Ae*K,et+=re*(5*Oe),et+=ie*(5*ke),Ie=et>>>13,et&=8191,et+=_e*(5*be),et+=E*(5*he),et+=P*(5*fe),et+=C*(5*ae),et+=M*(5*I),Ie+=et>>>13,et&=8191,Ye=Ie,Ye+=Pe*I,Ye+=Fe*ee,Ye+=Ae*j,Ye+=re*K,Ye+=ie*(5*Oe),Ie=Ye>>>13,Ye&=8191,Ye+=_e*(5*ke),Ye+=E*(5*be),Ye+=P*(5*he),Ye+=C*(5*fe),Ye+=M*(5*ae),Ie+=Ye>>>13,Ye&=8191,We=Ie,We+=Pe*ae,We+=Fe*I,We+=Ae*ee,We+=re*j,We+=ie*K,Ie=We>>>13,We&=8191,We+=_e*(5*Oe),We+=E*(5*ke),We+=P*(5*be),We+=C*(5*he),We+=M*(5*fe),Ie+=We>>>13,We&=8191,je=Ie,je+=Pe*fe,je+=Fe*ae,je+=Ae*I,je+=re*ee,je+=ie*j,Ie=je>>>13,je&=8191,je+=_e*K,je+=E*(5*Oe),je+=P*(5*ke),je+=C*(5*be),je+=M*(5*he),Ie+=je>>>13,je&=8191,He=Ie,He+=Pe*he,He+=Fe*fe,He+=Ae*ae,He+=re*I,He+=ie*ee,Ie=He>>>13,He&=8191,He+=_e*j,He+=E*K,He+=P*(5*Oe),He+=C*(5*ke),He+=M*(5*be),Ie+=He>>>13,He&=8191,De=Ie,De+=Pe*be,De+=Fe*he,De+=Ae*fe,De+=re*ae,De+=ie*I,Ie=De>>>13,De&=8191,De+=_e*ee,De+=E*j,De+=P*K,De+=C*(5*Oe),De+=M*(5*ke),Ie+=De>>>13,De&=8191,Ne=Ie,Ne+=Pe*ke,Ne+=Fe*be,Ne+=Ae*he,Ne+=re*fe,Ne+=ie*ae,Ie=Ne>>>13,Ne&=8191,Ne+=_e*I,Ne+=E*ee,Ne+=P*j,Ne+=C*K,Ne+=M*(5*Oe),Ie+=Ne>>>13,Ne&=8191,Se=Ie,Se+=Pe*Oe,Se+=Fe*ke,Se+=Ae*be,Se+=re*he,Se+=ie*fe,Ie=Se>>>13,Se&=8191,Se+=_e*ae,Se+=E*I,Se+=P*ee,Se+=C*j,Se+=M*K,Ie+=Se>>>13,Se&=8191,Ie=(Ie<<2)+Ie|0,Ie=Ie+Ge|0,Ge=Ie&8191,Ie=Ie>>>13,Qe+=Ie,Pe=Ge,Fe=Qe,Ae=et,re=Ye,ie=We,_e=je,E=He,P=De,C=Ne,M=Se,T+=16,k-=16;this.h[0]=Pe,this.h[1]=Fe,this.h[2]=Ae,this.h[3]=re,this.h[4]=ie,this.h[5]=_e,this.h[6]=E,this.h[7]=P,this.h[8]=C,this.h[9]=M},nt.prototype.finish=function(v,T){var k=new Uint16Array(10),y,B,Q,Z;if(this.leftover){for(Z=this.leftover,this.buffer[Z++]=1;Z<16;Z++)this.buffer[Z]=0;this.fin=1,this.blocks(this.buffer,0,16)}for(y=this.h[1]>>>13,this.h[1]&=8191,Z=2;Z<10;Z++)this.h[Z]+=y,y=this.h[Z]>>>13,this.h[Z]&=8191;for(this.h[0]+=y*5,y=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=y,y=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=y,k[0]=this.h[0]+5,y=k[0]>>>13,k[0]&=8191,Z=1;Z<10;Z++)k[Z]=this.h[Z]+y,y=k[Z]>>>13,k[Z]&=8191;for(k[9]-=1<<13,B=(y^1)-1,Z=0;Z<10;Z++)k[Z]&=B;for(B=~B,Z=0;Z<10;Z++)this.h[Z]=this.h[Z]&B|k[Z];for(this.h[0]=(this.h[0]|this.h[1]<<13)&65535,this.h[1]=(this.h[1]>>>3|this.h[2]<<10)&65535,this.h[2]=(this.h[2]>>>6|this.h[3]<<7)&65535,this.h[3]=(this.h[3]>>>9|this.h[4]<<4)&65535,this.h[4]=(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14)&65535,this.h[5]=(this.h[6]>>>2|this.h[7]<<11)&65535,this.h[6]=(this.h[7]>>>5|this.h[8]<<8)&65535,this.h[7]=(this.h[8]>>>8|this.h[9]<<5)&65535,Q=this.h[0]+this.pad[0],this.h[0]=Q&65535,Z=1;Z<8;Z++)Q=(this.h[Z]+this.pad[Z]|0)+(Q>>>16)|0,this.h[Z]=Q&65535;v[T+0]=this.h[0]>>>0&255,v[T+1]=this.h[0]>>>8&255,v[T+2]=this.h[1]>>>0&255,v[T+3]=this.h[1]>>>8&255,v[T+4]=this.h[2]>>>0&255,v[T+5]=this.h[2]>>>8&255,v[T+6]=this.h[3]>>>0&255,v[T+7]=this.h[3]>>>8&255,v[T+8]=this.h[4]>>>0&255,v[T+9]=this.h[4]>>>8&255,v[T+10]=this.h[5]>>>0&255,v[T+11]=this.h[5]>>>8&255,v[T+12]=this.h[6]>>>0&255,v[T+13]=this.h[6]>>>8&255,v[T+14]=this.h[7]>>>0&255,v[T+15]=this.h[7]>>>8&255},nt.prototype.update=function(v,T,k){var y,B;if(this.leftover){for(B=16-this.leftover,B>k&&(B=k),y=0;y<B;y++)this.buffer[this.leftover+y]=v[T+y];if(k-=B,T+=B,this.leftover+=B,this.leftover<16)return;this.blocks(this.buffer,0,16),this.leftover=0}if(k>=16&&(B=k-k%16,this.blocks(v,T,B),T+=B,k-=B),k){for(y=0;y<k;y++)this.buffer[this.leftover+y]=v[T+y];this.leftover+=k}};function st(v,T,k,y,B,Q){var Z=new nt(Q);return Z.update(k,y,B),Z.finish(v,T),0}function _t(v,T,k,y,B,Q){var Z=new Uint8Array(16);return st(Z,0,k,y,B,Q),J(v,T,Z,0)}function ht(v,T,k,y,B){var Q;if(k<32)return-1;for(ot(v,0,T,0,k,y,B),st(v,16,v,32,k-32,v),Q=0;Q<16;Q++)v[Q]=0;return 0}function Lt(v,T,k,y,B){var Q,Z=new Uint8Array(32);if(k<32||(Be(Z,0,32,y,B),_t(T,16,T,32,k-32,Z)!==0))return-1;for(ot(v,0,T,0,k,y,B),Q=0;Q<32;Q++)v[Q]=0;return 0}function At(v,T){var k;for(k=0;k<16;k++)v[k]=T[k]|0}function Mt(v){var T,k,y=1;for(T=0;T<16;T++)k=v[T]+y+65535,y=Math.floor(k/65536),v[T]=k-y*65536;v[0]+=y-1+37*(y-1)}function Nt(v,T,k){for(var y,B=~(k-1),Q=0;Q<16;Q++)y=B&(v[Q]^T[Q]),v[Q]^=y,T[Q]^=y}function pr(v,T){var k,y,B,Q=t(),Z=t();for(k=0;k<16;k++)Z[k]=T[k];for(Mt(Z),Mt(Z),Mt(Z),y=0;y<2;y++){for(Q[0]=Z[0]-65517,k=1;k<15;k++)Q[k]=Z[k]-65535-(Q[k-1]>>16&1),Q[k-1]&=65535;Q[15]=Z[15]-32767-(Q[14]>>16&1),B=Q[15]>>16&1,Q[14]&=65535,Nt(Z,Q,1-B)}for(k=0;k<16;k++)v[2*k]=Z[k]&255,v[2*k+1]=Z[k]>>8}function _r(v,T){var k=new Uint8Array(32),y=new Uint8Array(32);return pr(k,v),pr(y,T),ne(k,0,y,0)}function Me(v){var T=new Uint8Array(32);return pr(T,v),T[0]&1}function xt(v,T){var k;for(k=0;k<16;k++)v[k]=T[2*k]+(T[2*k+1]<<8);v[15]&=32767}function Vt(v,T,k){for(var y=0;y<16;y++)v[y]=T[y]+k[y]}function pt(v,T,k){for(var y=0;y<16;y++)v[y]=T[y]-k[y]}function Ze(v,T,k){var y,B,Q=0,Z=0,ye=0,xe=0,Le=0,Ce=0,yt=0,Ie=0,Ge=0,Qe=0,et=0,Ye=0,We=0,je=0,He=0,De=0,Ne=0,Se=0,Pe=0,Fe=0,Ae=0,re=0,ie=0,_e=0,E=0,P=0,C=0,M=0,K=0,j=0,ee=0,I=k[0],ae=k[1],fe=k[2],he=k[3],be=k[4],ke=k[5],Oe=k[6],Ke=k[7],ze=k[8],Ve=k[9],dt=k[10],vt=k[11],Pt=k[12],Gt=k[13],Ut=k[14],Qt=k[15];y=T[0],Q+=y*I,Z+=y*ae,ye+=y*fe,xe+=y*he,Le+=y*be,Ce+=y*ke,yt+=y*Oe,Ie+=y*Ke,Ge+=y*ze,Qe+=y*Ve,et+=y*dt,Ye+=y*vt,We+=y*Pt,je+=y*Gt,He+=y*Ut,De+=y*Qt,y=T[1],Z+=y*I,ye+=y*ae,xe+=y*fe,Le+=y*he,Ce+=y*be,yt+=y*ke,Ie+=y*Oe,Ge+=y*Ke,Qe+=y*ze,et+=y*Ve,Ye+=y*dt,We+=y*vt,je+=y*Pt,He+=y*Gt,De+=y*Ut,Ne+=y*Qt,y=T[2],ye+=y*I,xe+=y*ae,Le+=y*fe,Ce+=y*he,yt+=y*be,Ie+=y*ke,Ge+=y*Oe,Qe+=y*Ke,et+=y*ze,Ye+=y*Ve,We+=y*dt,je+=y*vt,He+=y*Pt,De+=y*Gt,Ne+=y*Ut,Se+=y*Qt,y=T[3],xe+=y*I,Le+=y*ae,Ce+=y*fe,yt+=y*he,Ie+=y*be,Ge+=y*ke,Qe+=y*Oe,et+=y*Ke,Ye+=y*ze,We+=y*Ve,je+=y*dt,He+=y*vt,De+=y*Pt,Ne+=y*Gt,Se+=y*Ut,Pe+=y*Qt,y=T[4],Le+=y*I,Ce+=y*ae,yt+=y*fe,Ie+=y*he,Ge+=y*be,Qe+=y*ke,et+=y*Oe,Ye+=y*Ke,We+=y*ze,je+=y*Ve,He+=y*dt,De+=y*vt,Ne+=y*Pt,Se+=y*Gt,Pe+=y*Ut,Fe+=y*Qt,y=T[5],Ce+=y*I,yt+=y*ae,Ie+=y*fe,Ge+=y*he,Qe+=y*be,et+=y*ke,Ye+=y*Oe,We+=y*Ke,je+=y*ze,He+=y*Ve,De+=y*dt,Ne+=y*vt,Se+=y*Pt,Pe+=y*Gt,Fe+=y*Ut,Ae+=y*Qt,y=T[6],yt+=y*I,Ie+=y*ae,Ge+=y*fe,Qe+=y*he,et+=y*be,Ye+=y*ke,We+=y*Oe,je+=y*Ke,He+=y*ze,De+=y*Ve,Ne+=y*dt,Se+=y*vt,Pe+=y*Pt,Fe+=y*Gt,Ae+=y*Ut,re+=y*Qt,y=T[7],Ie+=y*I,Ge+=y*ae,Qe+=y*fe,et+=y*he,Ye+=y*be,We+=y*ke,je+=y*Oe,He+=y*Ke,De+=y*ze,Ne+=y*Ve,Se+=y*dt,Pe+=y*vt,Fe+=y*Pt,Ae+=y*Gt,re+=y*Ut,ie+=y*Qt,y=T[8],Ge+=y*I,Qe+=y*ae,et+=y*fe,Ye+=y*he,We+=y*be,je+=y*ke,He+=y*Oe,De+=y*Ke,Ne+=y*ze,Se+=y*Ve,Pe+=y*dt,Fe+=y*vt,Ae+=y*Pt,re+=y*Gt,ie+=y*Ut,_e+=y*Qt,y=T[9],Qe+=y*I,et+=y*ae,Ye+=y*fe,We+=y*he,je+=y*be,He+=y*ke,De+=y*Oe,Ne+=y*Ke,Se+=y*ze,Pe+=y*Ve,Fe+=y*dt,Ae+=y*vt,re+=y*Pt,ie+=y*Gt,_e+=y*Ut,E+=y*Qt,y=T[10],et+=y*I,Ye+=y*ae,We+=y*fe,je+=y*he,He+=y*be,De+=y*ke,Ne+=y*Oe,Se+=y*Ke,Pe+=y*ze,Fe+=y*Ve,Ae+=y*dt,re+=y*vt,ie+=y*Pt,_e+=y*Gt,E+=y*Ut,P+=y*Qt,y=T[11],Ye+=y*I,We+=y*ae,je+=y*fe,He+=y*he,De+=y*be,Ne+=y*ke,Se+=y*Oe,Pe+=y*Ke,Fe+=y*ze,Ae+=y*Ve,re+=y*dt,ie+=y*vt,_e+=y*Pt,E+=y*Gt,P+=y*Ut,C+=y*Qt,y=T[12],We+=y*I,je+=y*ae,He+=y*fe,De+=y*he,Ne+=y*be,Se+=y*ke,Pe+=y*Oe,Fe+=y*Ke,Ae+=y*ze,re+=y*Ve,ie+=y*dt,_e+=y*vt,E+=y*Pt,P+=y*Gt,C+=y*Ut,M+=y*Qt,y=T[13],je+=y*I,He+=y*ae,De+=y*fe,Ne+=y*he,Se+=y*be,Pe+=y*ke,Fe+=y*Oe,Ae+=y*Ke,re+=y*ze,ie+=y*Ve,_e+=y*dt,E+=y*vt,P+=y*Pt,C+=y*Gt,M+=y*Ut,K+=y*Qt,y=T[14],He+=y*I,De+=y*ae,Ne+=y*fe,Se+=y*he,Pe+=y*be,Fe+=y*ke,Ae+=y*Oe,re+=y*Ke,ie+=y*ze,_e+=y*Ve,E+=y*dt,P+=y*vt,C+=y*Pt,M+=y*Gt,K+=y*Ut,j+=y*Qt,y=T[15],De+=y*I,Ne+=y*ae,Se+=y*fe,Pe+=y*he,Fe+=y*be,Ae+=y*ke,re+=y*Oe,ie+=y*Ke,_e+=y*ze,E+=y*Ve,P+=y*dt,C+=y*vt,M+=y*Pt,K+=y*Gt,j+=y*Ut,ee+=y*Qt,Q+=38*Ne,Z+=38*Se,ye+=38*Pe,xe+=38*Fe,Le+=38*Ae,Ce+=38*re,yt+=38*ie,Ie+=38*_e,Ge+=38*E,Qe+=38*P,et+=38*C,Ye+=38*M,We+=38*K,je+=38*j,He+=38*ee,B=1,y=Q+B+65535,B=Math.floor(y/65536),Q=y-B*65536,y=Z+B+65535,B=Math.floor(y/65536),Z=y-B*65536,y=ye+B+65535,B=Math.floor(y/65536),ye=y-B*65536,y=xe+B+65535,B=Math.floor(y/65536),xe=y-B*65536,y=Le+B+65535,B=Math.floor(y/65536),Le=y-B*65536,y=Ce+B+65535,B=Math.floor(y/65536),Ce=y-B*65536,y=yt+B+65535,B=Math.floor(y/65536),yt=y-B*65536,y=Ie+B+65535,B=Math.floor(y/65536),Ie=y-B*65536,y=Ge+B+65535,B=Math.floor(y/65536),Ge=y-B*65536,y=Qe+B+65535,B=Math.floor(y/65536),Qe=y-B*65536,y=et+B+65535,B=Math.floor(y/65536),et=y-B*65536,y=Ye+B+65535,B=Math.floor(y/65536),Ye=y-B*65536,y=We+B+65535,B=Math.floor(y/65536),We=y-B*65536,y=je+B+65535,B=Math.floor(y/65536),je=y-B*65536,y=He+B+65535,B=Math.floor(y/65536),He=y-B*65536,y=De+B+65535,B=Math.floor(y/65536),De=y-B*65536,Q+=B-1+37*(B-1),B=1,y=Q+B+65535,B=Math.floor(y/65536),Q=y-B*65536,y=Z+B+65535,B=Math.floor(y/65536),Z=y-B*65536,y=ye+B+65535,B=Math.floor(y/65536),ye=y-B*65536,y=xe+B+65535,B=Math.floor(y/65536),xe=y-B*65536,y=Le+B+65535,B=Math.floor(y/65536),Le=y-B*65536,y=Ce+B+65535,B=Math.floor(y/65536),Ce=y-B*65536,y=yt+B+65535,B=Math.floor(y/65536),yt=y-B*65536,y=Ie+B+65535,B=Math.floor(y/65536),Ie=y-B*65536,y=Ge+B+65535,B=Math.floor(y/65536),Ge=y-B*65536,y=Qe+B+65535,B=Math.floor(y/65536),Qe=y-B*65536,y=et+B+65535,B=Math.floor(y/65536),et=y-B*65536,y=Ye+B+65535,B=Math.floor(y/65536),Ye=y-B*65536,y=We+B+65535,B=Math.floor(y/65536),We=y-B*65536,y=je+B+65535,B=Math.floor(y/65536),je=y-B*65536,y=He+B+65535,B=Math.floor(y/65536),He=y-B*65536,y=De+B+65535,B=Math.floor(y/65536),De=y-B*65536,Q+=B-1+37*(B-1),v[0]=Q,v[1]=Z,v[2]=ye,v[3]=xe,v[4]=Le,v[5]=Ce,v[6]=yt,v[7]=Ie,v[8]=Ge,v[9]=Qe,v[10]=et,v[11]=Ye,v[12]=We,v[13]=je,v[14]=He,v[15]=De}function Ft(v,T){Ze(v,T,T)}function jr(v,T){var k=t(),y;for(y=0;y<16;y++)k[y]=T[y];for(y=253;y>=0;y--)Ft(k,k),y!==2&&y!==4&&Ze(k,k,T);for(y=0;y<16;y++)v[y]=k[y]}function Yt(v,T){var k=t(),y;for(y=0;y<16;y++)k[y]=T[y];for(y=250;y>=0;y--)Ft(k,k),y!==1&&Ze(k,k,T);for(y=0;y<16;y++)v[y]=k[y]}function kt(v,T,k){var y=new Uint8Array(32),B=new Float64Array(80),Q,Z,ye=t(),xe=t(),Le=t(),Ce=t(),yt=t(),Ie=t();for(Z=0;Z<31;Z++)y[Z]=T[Z];for(y[31]=T[31]&127|64,y[0]&=248,xt(B,k),Z=0;Z<16;Z++)xe[Z]=B[Z],Ce[Z]=ye[Z]=Le[Z]=0;for(ye[0]=Ce[0]=1,Z=254;Z>=0;--Z)Q=y[Z>>>3]>>>(Z&7)&1,Nt(ye,xe,Q),Nt(Le,Ce,Q),Vt(yt,ye,Le),pt(ye,ye,Le),Vt(Le,xe,Ce),pt(xe,xe,Ce),Ft(Ce,yt),Ft(Ie,ye),Ze(ye,Le,ye),Ze(Le,xe,yt),Vt(yt,ye,Le),pt(ye,ye,Le),Ft(xe,ye),pt(Le,Ce,Ie),Ze(ye,Le,l),Vt(ye,ye,Ce),Ze(Le,Le,ye),Ze(ye,Ce,Ie),Ze(Ce,xe,B),Ft(xe,yt),Nt(ye,xe,Q),Nt(Le,Ce,Q);for(Z=0;Z<16;Z++)B[Z+16]=ye[Z],B[Z+32]=Le[Z],B[Z+48]=xe[Z],B[Z+64]=Ce[Z];var Ge=B.subarray(32),Qe=B.subarray(16);return jr(Ge,Ge),Ze(Qe,Qe,Ge),pr(v,Qe),0}function wr(v,T){return kt(v,T,s)}function nr(v,T){return n(T,32),wr(v,T)}function ar(v,T,k){var y=new Uint8Array(32);return kt(y,k,T),z(v,o,y,ue)}var fr=ht,Rt=Lt;function qt(v,T,k,y,B,Q){var Z=new Uint8Array(32);return ar(Z,B,Q),fr(v,T,k,y,Z)}function Jr(v,T,k,y,B,Q){var Z=new Uint8Array(32);return ar(Z,B,Q),Rt(v,T,k,y,Z)}var zt=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function br(v,T,k,y){for(var B=new Int32Array(16),Q=new Int32Array(16),Z,ye,xe,Le,Ce,yt,Ie,Ge,Qe,et,Ye,We,je,He,De,Ne,Se,Pe,Fe,Ae,re,ie,_e,E,P,C,M=v[0],K=v[1],j=v[2],ee=v[3],I=v[4],ae=v[5],fe=v[6],he=v[7],be=T[0],ke=T[1],Oe=T[2],Ke=T[3],ze=T[4],Ve=T[5],dt=T[6],vt=T[7],Pt=0;y>=128;){for(Fe=0;Fe<16;Fe++)Ae=8*Fe+Pt,B[Fe]=k[Ae+0]<<24|k[Ae+1]<<16|k[Ae+2]<<8|k[Ae+3],Q[Fe]=k[Ae+4]<<24|k[Ae+5]<<16|k[Ae+6]<<8|k[Ae+7];for(Fe=0;Fe<80;Fe++)if(Z=M,ye=K,xe=j,Le=ee,Ce=I,yt=ae,Ie=fe,Ge=he,Qe=be,et=ke,Ye=Oe,We=Ke,je=ze,He=Ve,De=dt,Ne=vt,re=he,ie=vt,_e=ie&65535,E=ie>>>16,P=re&65535,C=re>>>16,re=(I>>>14|ze<<32-14)^(I>>>18|ze<<32-18)^(ze>>>41-32|I<<32-(41-32)),ie=(ze>>>14|I<<32-14)^(ze>>>18|I<<32-18)^(I>>>41-32|ze<<32-(41-32)),_e+=ie&65535,E+=ie>>>16,P+=re&65535,C+=re>>>16,re=I&ae^~I&fe,ie=ze&Ve^~ze&dt,_e+=ie&65535,E+=ie>>>16,P+=re&65535,C+=re>>>16,re=zt[Fe*2],ie=zt[Fe*2+1],_e+=ie&65535,E+=ie>>>16,P+=re&65535,C+=re>>>16,re=B[Fe%16],ie=Q[Fe%16],_e+=ie&65535,E+=ie>>>16,P+=re&65535,C+=re>>>16,E+=_e>>>16,P+=E>>>16,C+=P>>>16,Se=P&65535|C<<16,Pe=_e&65535|E<<16,re=Se,ie=Pe,_e=ie&65535,E=ie>>>16,P=re&65535,C=re>>>16,re=(M>>>28|be<<32-28)^(be>>>34-32|M<<32-(34-32))^(be>>>39-32|M<<32-(39-32)),ie=(be>>>28|M<<32-28)^(M>>>34-32|be<<32-(34-32))^(M>>>39-32|be<<32-(39-32)),_e+=ie&65535,E+=ie>>>16,P+=re&65535,C+=re>>>16,re=M&K^M&j^K&j,ie=be&ke^be&Oe^ke&Oe,_e+=ie&65535,E+=ie>>>16,P+=re&65535,C+=re>>>16,E+=_e>>>16,P+=E>>>16,C+=P>>>16,Ge=P&65535|C<<16,Ne=_e&65535|E<<16,re=Le,ie=We,_e=ie&65535,E=ie>>>16,P=re&65535,C=re>>>16,re=Se,ie=Pe,_e+=ie&65535,E+=ie>>>16,P+=re&65535,C+=re>>>16,E+=_e>>>16,P+=E>>>16,C+=P>>>16,Le=P&65535|C<<16,We=_e&65535|E<<16,K=Z,j=ye,ee=xe,I=Le,ae=Ce,fe=yt,he=Ie,M=Ge,ke=Qe,Oe=et,Ke=Ye,ze=We,Ve=je,dt=He,vt=De,be=Ne,Fe%16===15)for(Ae=0;Ae<16;Ae++)re=B[Ae],ie=Q[Ae],_e=ie&65535,E=ie>>>16,P=re&65535,C=re>>>16,re=B[(Ae+9)%16],ie=Q[(Ae+9)%16],_e+=ie&65535,E+=ie>>>16,P+=re&65535,C+=re>>>16,Se=B[(Ae+1)%16],Pe=Q[(Ae+1)%16],re=(Se>>>1|Pe<<32-1)^(Se>>>8|Pe<<32-8)^Se>>>7,ie=(Pe>>>1|Se<<32-1)^(Pe>>>8|Se<<32-8)^(Pe>>>7|Se<<32-7),_e+=ie&65535,E+=ie>>>16,P+=re&65535,C+=re>>>16,Se=B[(Ae+14)%16],Pe=Q[(Ae+14)%16],re=(Se>>>19|Pe<<32-19)^(Pe>>>61-32|Se<<32-(61-32))^Se>>>6,ie=(Pe>>>19|Se<<32-19)^(Se>>>61-32|Pe<<32-(61-32))^(Pe>>>6|Se<<32-6),_e+=ie&65535,E+=ie>>>16,P+=re&65535,C+=re>>>16,E+=_e>>>16,P+=E>>>16,C+=P>>>16,B[Ae]=P&65535|C<<16,Q[Ae]=_e&65535|E<<16;re=M,ie=be,_e=ie&65535,E=ie>>>16,P=re&65535,C=re>>>16,re=v[0],ie=T[0],_e+=ie&65535,E+=ie>>>16,P+=re&65535,C+=re>>>16,E+=_e>>>16,P+=E>>>16,C+=P>>>16,v[0]=M=P&65535|C<<16,T[0]=be=_e&65535|E<<16,re=K,ie=ke,_e=ie&65535,E=ie>>>16,P=re&65535,C=re>>>16,re=v[1],ie=T[1],_e+=ie&65535,E+=ie>>>16,P+=re&65535,C+=re>>>16,E+=_e>>>16,P+=E>>>16,C+=P>>>16,v[1]=K=P&65535|C<<16,T[1]=ke=_e&65535|E<<16,re=j,ie=Oe,_e=ie&65535,E=ie>>>16,P=re&65535,C=re>>>16,re=v[2],ie=T[2],_e+=ie&65535,E+=ie>>>16,P+=re&65535,C+=re>>>16,E+=_e>>>16,P+=E>>>16,C+=P>>>16,v[2]=j=P&65535|C<<16,T[2]=Oe=_e&65535|E<<16,re=ee,ie=Ke,_e=ie&65535,E=ie>>>16,P=re&65535,C=re>>>16,re=v[3],ie=T[3],_e+=ie&65535,E+=ie>>>16,P+=re&65535,C+=re>>>16,E+=_e>>>16,P+=E>>>16,C+=P>>>16,v[3]=ee=P&65535|C<<16,T[3]=Ke=_e&65535|E<<16,re=I,ie=ze,_e=ie&65535,E=ie>>>16,P=re&65535,C=re>>>16,re=v[4],ie=T[4],_e+=ie&65535,E+=ie>>>16,P+=re&65535,C+=re>>>16,E+=_e>>>16,P+=E>>>16,C+=P>>>16,v[4]=I=P&65535|C<<16,T[4]=ze=_e&65535|E<<16,re=ae,ie=Ve,_e=ie&65535,E=ie>>>16,P=re&65535,C=re>>>16,re=v[5],ie=T[5],_e+=ie&65535,E+=ie>>>16,P+=re&65535,C+=re>>>16,E+=_e>>>16,P+=E>>>16,C+=P>>>16,v[5]=ae=P&65535|C<<16,T[5]=Ve=_e&65535|E<<16,re=fe,ie=dt,_e=ie&65535,E=ie>>>16,P=re&65535,C=re>>>16,re=v[6],ie=T[6],_e+=ie&65535,E+=ie>>>16,P+=re&65535,C+=re>>>16,E+=_e>>>16,P+=E>>>16,C+=P>>>16,v[6]=fe=P&65535|C<<16,T[6]=dt=_e&65535|E<<16,re=he,ie=vt,_e=ie&65535,E=ie>>>16,P=re&65535,C=re>>>16,re=v[7],ie=T[7],_e+=ie&65535,E+=ie>>>16,P+=re&65535,C+=re>>>16,E+=_e>>>16,P+=E>>>16,C+=P>>>16,v[7]=he=P&65535|C<<16,T[7]=vt=_e&65535|E<<16,Pt+=128,y-=128}return y}function Jt(v,T,k){var y=new Int32Array(8),B=new Int32Array(8),Q=new Uint8Array(256),Z,ye=k;for(y[0]=1779033703,y[1]=3144134277,y[2]=1013904242,y[3]=2773480762,y[4]=1359893119,y[5]=2600822924,y[6]=528734635,y[7]=1541459225,B[0]=4089235720,B[1]=2227873595,B[2]=4271175723,B[3]=1595750129,B[4]=2917565137,B[5]=725511199,B[6]=4215389547,B[7]=327033209,br(y,B,T,k),k%=128,Z=0;Z<k;Z++)Q[Z]=T[ye-k+Z];for(Q[k]=128,k=256-128*(k<112?1:0),Q[k-9]=0,A(Q,k-8,ye/536870912|0,ye<<3),br(y,B,Q,k),Z=0;Z<8;Z++)A(v,8*Z,y[Z],B[Z]);return 0}function Xt(v,T){var k=t(),y=t(),B=t(),Q=t(),Z=t(),ye=t(),xe=t(),Le=t(),Ce=t();pt(k,v[1],v[0]),pt(Ce,T[1],T[0]),Ze(k,k,Ce),Vt(y,v[0],v[1]),Vt(Ce,T[0],T[1]),Ze(y,y,Ce),Ze(B,v[3],T[3]),Ze(B,B,p),Ze(Q,v[2],T[2]),Vt(Q,Q,Q),pt(Z,y,k),pt(ye,Q,B),Vt(xe,Q,B),Vt(Le,y,k),Ze(v[0],Z,ye),Ze(v[1],Le,xe),Ze(v[2],xe,ye),Ze(v[3],Z,Le)}function Dt(v,T,k){var y;for(y=0;y<4;y++)Nt(v[y],T[y],k)}function It(v,T){var k=t(),y=t(),B=t();jr(B,T[2]),Ze(k,T[0],B),Ze(y,T[1],B),pr(v,y),v[31]^=Me(k)<<7}function Zt(v,T,k){var y,B;for(At(v[0],u),At(v[1],f),At(v[2],f),At(v[3],u),B=255;B>=0;--B)y=k[B/8|0]>>(B&7)&1,Dt(v,T,y),Xt(T,v),Xt(v,v),Dt(v,T,y)}function X(v,T){var k=[t(),t(),t(),t()];At(k[0],m),At(k[1],b),At(k[2],f),Ze(k[3],m,b),Zt(v,k,T)}function se(v,T,k){var y=new Uint8Array(64),B=[t(),t(),t(),t()],Q;for(k||n(T,32),Jt(y,T,32),y[0]&=248,y[31]&=127,y[31]|=64,X(B,y),It(v,B),Q=0;Q<32;Q++)T[Q+32]=v[Q];return 0}var we=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function x(v,T){var k,y,B,Q;for(y=63;y>=32;--y){for(k=0,B=y-32,Q=y-12;B<Q;++B)T[B]+=k-16*T[y]*we[B-(y-32)],k=Math.floor((T[B]+128)/256),T[B]-=k*256;T[B]+=k,T[y]=0}for(k=0,B=0;B<32;B++)T[B]+=k-(T[31]>>4)*we[B],k=T[B]>>8,T[B]&=255;for(B=0;B<32;B++)T[B]-=k*we[B];for(y=0;y<32;y++)T[y+1]+=T[y]>>8,v[y]=T[y]&255}function g(v){var T=new Float64Array(64),k;for(k=0;k<64;k++)T[k]=v[k];for(k=0;k<64;k++)v[k]=0;x(v,T)}function w(v,T,k,y){var B=new Uint8Array(64),Q=new Uint8Array(64),Z=new Uint8Array(64),ye,xe,Le=new Float64Array(64),Ce=[t(),t(),t(),t()];Jt(B,y,32),B[0]&=248,B[31]&=127,B[31]|=64;var yt=k+64;for(ye=0;ye<k;ye++)v[64+ye]=T[ye];for(ye=0;ye<32;ye++)v[32+ye]=B[32+ye];for(Jt(Z,v.subarray(32),k+32),g(Z),X(Ce,Z),It(v,Ce),ye=32;ye<64;ye++)v[ye]=y[ye];for(Jt(Q,v,k+64),g(Q),ye=0;ye<64;ye++)Le[ye]=0;for(ye=0;ye<32;ye++)Le[ye]=Z[ye];for(ye=0;ye<32;ye++)for(xe=0;xe<32;xe++)Le[ye+xe]+=Q[ye]*B[xe];return x(v.subarray(32),Le),yt}function O(v,T){var k=t(),y=t(),B=t(),Q=t(),Z=t(),ye=t(),xe=t();return At(v[2],f),xt(v[1],T),Ft(B,v[1]),Ze(Q,B,h),pt(B,B,v[2]),Vt(Q,v[2],Q),Ft(Z,Q),Ft(ye,Z),Ze(xe,ye,Z),Ze(k,xe,B),Ze(k,k,Q),Yt(k,k),Ze(k,k,B),Ze(k,k,Q),Ze(k,k,Q),Ze(v[0],k,Q),Ft(y,v[0]),Ze(y,y,Q),_r(y,B)&&Ze(v[0],v[0],S),Ft(y,v[0]),Ze(y,y,Q),_r(y,B)?-1:(Me(v[0])===T[31]>>7&&pt(v[0],u,v[0]),Ze(v[3],v[0],v[1]),0)}function U(v,T,k,y){var B,Q=new Uint8Array(32),Z=new Uint8Array(64),ye=[t(),t(),t(),t()],xe=[t(),t(),t(),t()];if(k<64||O(xe,y))return-1;for(B=0;B<k;B++)v[B]=T[B];for(B=0;B<32;B++)v[B+32]=y[B];if(Jt(Z,v,k),g(Z),Zt(ye,xe,Z),X(xe,T.subarray(32)),Xt(ye,xe),It(Q,ye),k-=64,ne(T,0,Q,0)){for(B=0;B<k;B++)v[B]=0;return-1}for(B=0;B<k;B++)v[B]=T[B+64];return k}var W=32,te=24,$e=32,tt=16,ct=32,wt=32,lt=32,Xr=32,vr=32,wn=te,Dn=$e,In=tt,Ar=64,Kr=32,Vr=64,cn=32,bn=64;e.lowlevel={crypto_core_hsalsa20:z,crypto_stream_xor:ot,crypto_stream:Be,crypto_stream_salsa20_xor:ce,crypto_stream_salsa20:Ee,crypto_onetimeauth:st,crypto_onetimeauth_verify:_t,crypto_verify_16:J,crypto_verify_32:ne,crypto_secretbox:ht,crypto_secretbox_open:Lt,crypto_scalarmult:kt,crypto_scalarmult_base:wr,crypto_box_beforenm:ar,crypto_box_afternm:fr,crypto_box:qt,crypto_box_open:Jr,crypto_box_keypair:nr,crypto_hash:Jt,crypto_sign:w,crypto_sign_keypair:se,crypto_sign_open:U,crypto_secretbox_KEYBYTES:W,crypto_secretbox_NONCEBYTES:te,crypto_secretbox_ZEROBYTES:$e,crypto_secretbox_BOXZEROBYTES:tt,crypto_scalarmult_BYTES:ct,crypto_scalarmult_SCALARBYTES:wt,crypto_box_PUBLICKEYBYTES:lt,crypto_box_SECRETKEYBYTES:Xr,crypto_box_BEFORENMBYTES:vr,crypto_box_NONCEBYTES:wn,crypto_box_ZEROBYTES:Dn,crypto_box_BOXZEROBYTES:In,crypto_sign_BYTES:Ar,crypto_sign_PUBLICKEYBYTES:Kr,crypto_sign_SECRETKEYBYTES:Vr,crypto_sign_SEEDBYTES:cn,crypto_hash_BYTES:bn,gf:t,D:h,L:we,pack25519:pr,unpack25519:xt,M:Ze,A:Vt,S:Ft,Z:pt,pow2523:Yt,add:Xt,set25519:At,modL:x,scalarmult:Zt,scalarbase:X};function Pn(v,T){if(v.length!==W)throw new Error("bad key size");if(T.length!==te)throw new Error("bad nonce size")}function Vn(v,T){if(v.length!==lt)throw new Error("bad public key size");if(T.length!==Xr)throw new Error("bad secret key size")}function er(){for(var v=0;v<arguments.length;v++)if(!(arguments[v]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}function On(v){for(var T=0;T<v.length;T++)v[T]=0}e.randomBytes=function(v){var T=new Uint8Array(v);return n(T,v),T},e.secretbox=function(v,T,k){er(v,T,k),Pn(k,T);for(var y=new Uint8Array($e+v.length),B=new Uint8Array(y.length),Q=0;Q<v.length;Q++)y[Q+$e]=v[Q];return ht(B,y,y.length,T,k),B.subarray(tt)},e.secretbox.open=function(v,T,k){er(v,T,k),Pn(k,T);for(var y=new Uint8Array(tt+v.length),B=new Uint8Array(y.length),Q=0;Q<v.length;Q++)y[Q+tt]=v[Q];return y.length<32||Lt(B,y,y.length,T,k)!==0?null:B.subarray($e)},e.secretbox.keyLength=W,e.secretbox.nonceLength=te,e.secretbox.overheadLength=tt,e.scalarMult=function(v,T){if(er(v,T),v.length!==wt)throw new Error("bad n size");if(T.length!==ct)throw new Error("bad p size");var k=new Uint8Array(ct);return kt(k,v,T),k},e.scalarMult.base=function(v){if(er(v),v.length!==wt)throw new Error("bad n size");var T=new Uint8Array(ct);return wr(T,v),T},e.scalarMult.scalarLength=wt,e.scalarMult.groupElementLength=ct,e.box=function(v,T,k,y){var B=e.box.before(k,y);return e.secretbox(v,T,B)},e.box.before=function(v,T){er(v,T),Vn(v,T);var k=new Uint8Array(vr);return ar(k,v,T),k},e.box.after=e.secretbox,e.box.open=function(v,T,k,y){var B=e.box.before(k,y);return e.secretbox.open(v,T,B)},e.box.open.after=e.secretbox.open,e.box.keyPair=function(){var v=new Uint8Array(lt),T=new Uint8Array(Xr);return nr(v,T),{publicKey:v,secretKey:T}},e.box.keyPair.fromSecretKey=function(v){if(er(v),v.length!==Xr)throw new Error("bad secret key size");var T=new Uint8Array(lt);return wr(T,v),{publicKey:T,secretKey:new Uint8Array(v)}},e.box.publicKeyLength=lt,e.box.secretKeyLength=Xr,e.box.sharedKeyLength=vr,e.box.nonceLength=wn,e.box.overheadLength=e.secretbox.overheadLength,e.sign=function(v,T){if(er(v,T),T.length!==Vr)throw new Error("bad secret key size");var k=new Uint8Array(Ar+v.length);return w(k,v,v.length,T),k},e.sign.open=function(v,T){if(er(v,T),T.length!==Kr)throw new Error("bad public key size");var k=new Uint8Array(v.length),y=U(k,v,v.length,T);if(y<0)return null;for(var B=new Uint8Array(y),Q=0;Q<B.length;Q++)B[Q]=k[Q];return B},e.sign.detached=function(v,T){for(var k=e.sign(v,T),y=new Uint8Array(Ar),B=0;B<y.length;B++)y[B]=k[B];return y},e.sign.detached.verify=function(v,T,k){if(er(v,T,k),T.length!==Ar)throw new Error("bad signature size");if(k.length!==Kr)throw new Error("bad public key size");var y=new Uint8Array(Ar+v.length),B=new Uint8Array(Ar+v.length),Q;for(Q=0;Q<Ar;Q++)y[Q]=T[Q];for(Q=0;Q<v.length;Q++)y[Q+Ar]=v[Q];return U(B,y,y.length,k)>=0},e.sign.keyPair=function(){var v=new Uint8Array(Kr),T=new Uint8Array(Vr);return se(v,T),{publicKey:v,secretKey:T}},e.sign.keyPair.fromSecretKey=function(v){if(er(v),v.length!==Vr)throw new Error("bad secret key size");for(var T=new Uint8Array(Kr),k=0;k<T.length;k++)T[k]=v[32+k];return{publicKey:T,secretKey:new Uint8Array(v)}},e.sign.keyPair.fromSeed=function(v){if(er(v),v.length!==cn)throw new Error("bad seed size");for(var T=new Uint8Array(Kr),k=new Uint8Array(Vr),y=0;y<32;y++)k[y]=v[y];return se(T,k,!0),{publicKey:T,secretKey:k}},e.sign.publicKeyLength=Kr,e.sign.secretKeyLength=Vr,e.sign.seedLength=cn,e.sign.signatureLength=Ar,e.hash=function(v){er(v);var T=new Uint8Array(bn);return Jt(T,v,v.length),T},e.hash.hashLength=bn,e.verify=function(v,T){return er(v,T),v.length===0||T.length===0||v.length!==T.length?!1:L(v,0,T,0,v.length)===0},e.setPRNG=function(v){n=v},function(){var v=typeof self<"u"?self.crypto||self.msCrypto:null;if(v&&v.getRandomValues){var T=65536;e.setPRNG(function(k,y){var B,Q=new Uint8Array(y);for(B=0;B<y;B+=T)v.getRandomValues(Q.subarray(B,B+Math.min(y-B,T)));for(B=0;B<y;B++)k[B]=Q[B];On(Q)})}else typeof commonjsRequire<"u"&&(v=require$$0,v&&v.randomBytes&&e.setPRNG(function(k,y){var B,Q=v.randomBytes(y);for(B=0;B<y;B++)k[B]=Q[B];On(Q)}))}()})(r.exports?r.exports:self.nacl=self.nacl||{})})(naclFast);const tweetnacl=naclFastExports,KeyDoesNotExist=new Error("Key does not exist. Make sure you properly instantiated the keystore."),NotKeyPair=new Error("Retrieved a symmetric key when an asymmetric keypair was expected. Please use a different key name."),NotKey=new Error("Retrieved an asymmetric keypair when an symmetric key was expected. Please use a different key name."),ECCNotEnabled=new Error("ECC is not enabled for this browser. Please use RSA instead."),UnsupportedCrypto=new Error("Cryptosystem not supported. Please use ECC or RSA"),InvalidKeyUse=new Error("Invalid key use. Please use 'exchange' or 'write"),InvalidMaxValue=new Error("Max must be less than 256 and greater than 0");function checkIsKeyPair(r){if(!r||r===null)throw KeyDoesNotExist;if(r.privateKey===void 0)throw NotKeyPair;return r}function checkIsKey(r){if(!r||r===null)throw KeyDoesNotExist;if(r.privateKey!==void 0||r.algorithm===void 0)throw NotKey;return r}function checkValidCryptoSystem(r){checkValid(r,[CryptoSystem.ECC,CryptoSystem.RSA],UnsupportedCrypto)}function checkValidKeyUse(r){checkValid(r,[KeyUse.Exchange,KeyUse.Write],InvalidKeyUse)}function checkValid(r,e,t){if(!e.some(o=>o===r))throw t}const errors$1={KeyDoesNotExist,NotKeyPair,NotKey,ECCNotEnabled,UnsupportedCrypto,InvalidKeyUse,checkIsKeyPair,checkIsKey,checkValidCryptoSystem,checkValidKeyUse,InvalidMaxValue};function arrBufToStr(r,e){const t=e===8?new Uint8Array(r):new Uint16Array(r);return Array.from(t).map(n=>String.fromCharCode(n)).join("")}function arrBufToBase64(r){return toString$7(new Uint8Array(r),"base64pad")}function strToArrBuf(r,e){const t=e===8?new Uint8Array(r.length):new Uint16Array(r.length);for(let n=0,o=r.length;n<o;n++)t[n]=r.charCodeAt(n);return t.buffer}function base64ToArrBuf(r){return fromString$7(r,"base64pad").buffer}function publicExponent(){return new Uint8Array([1,0,1])}function randomBuf(r,{max:e}={max:255}){if(e<1||e>255)throw errors$1.InvalidMaxValue;const t=new Uint8Array(r);if(e==255)return webcrypto.getRandomValues(t),t.buffer;let n=0;const o=e+1,s=Math.floor(256/o)*o,u=new Uint8Array(1);for(;n<t.length;)webcrypto.getRandomValues(u),u[0]<s&&(t[n]=u[0]%o,n++);return t.buffer}function joinBufs(r,e){const t=new Uint8Array(r),n=new Uint8Array(e),o=new Uint8Array(t.length+n.length);return o.set(t),o.set(n,t.length),o.buffer}const normalizeUtf8ToBuf=r=>normalizeToBuf(r,e=>strToArrBuf(e,CharSize.B8)),normalizeUtf16ToBuf=r=>normalizeToBuf(r,e=>strToArrBuf(e,CharSize.B16)),normalizeBase64ToBuf=r=>normalizeToBuf(r,base64ToArrBuf),normalizeUnicodeToBuf=(r,e)=>{switch(e){case 8:return normalizeUtf8ToBuf(r);default:return normalizeUtf16ToBuf(r)}},normalizeToBuf=(r,e)=>{if(typeof r=="string")return e(r);if(typeof r=="object"&&r.byteLength!==void 0)return new Uint8Array(r).buffer;throw new Error("Improper value. Must be a string, ArrayBuffer, Uint8Array")};async function structuralClone(r){return new Promise(e=>{const{port1:t,port2:n}=new MessageChannel;n.onmessage=o=>e(o.data),t.postMessage(r)})}const utils={arrBufToStr,arrBufToBase64,strToArrBuf,base64ToArrBuf,publicExponent,randomBuf,joinBufs,normalizeUtf8ToBuf,normalizeUtf16ToBuf,normalizeBase64ToBuf,normalizeToBuf,structuralClone},ECC_EXCHANGE_ALG="ECDH",ECC_WRITE_ALG="ECDSA",RSA_EXCHANGE_ALG="RSA-OAEP",RSA_WRITE_ALG="RSASSA-PKCS1-v1_5",SALT_LENGTH=128,DEFAULT_CRYPTOSYSTEM="ecc",DEFAULT_ECC_CURVE=EccCurve.P_256,DEFAULT_RSA_SIZE=RsaSize.B2048,DEFAULT_SYMM_ALG=SymmAlg.AES_CTR,DEFAULT_SYMM_LEN=SymmKeyLength.B256,DEFAULT_CTR_LEN=64,DEFAULT_HASH_ALG=HashAlg.SHA_256,DEFAULT_CHAR_SIZE=CharSize.B16,DEFAULT_STORE_NAME="keystore",DEFAULT_EXCHANGE_KEY_NAME="exchange-key",DEFAULT_WRITE_KEY_NAME="write-key";async function makeKey(r){return webcrypto.subtle.generateKey({name:(r==null?void 0:r.alg)||DEFAULT_SYMM_ALG,length:(r==null?void 0:r.length)||DEFAULT_SYMM_LEN},!0,["encrypt","decrypt"])}async function importKey(r,e){const t=utils.base64ToArrBuf(r);return webcrypto.subtle.importKey("raw",t,{name:(e==null?void 0:e.alg)||DEFAULT_SYMM_ALG,length:(e==null?void 0:e.length)||DEFAULT_SYMM_LEN},!0,["encrypt","decrypt"])}const keys$1={makeKey,importKey};async function encryptBytes(r,e,t){const n=utils.normalizeUtf16ToBuf(r),o=typeof e=="string"?await keys$1.importKey(e,t):e,s=(t==null?void 0:t.alg)||DEFAULT_SYMM_ALG,u=(t==null?void 0:t.iv)||utils.randomBuf(16),f=await webcrypto.subtle.encrypt({name:s,iv:s===SymmAlg.AES_CTR?void 0:u,counter:s===SymmAlg.AES_CTR?new Uint8Array(u):void 0,length:s===SymmAlg.AES_CTR?DEFAULT_CTR_LEN:void 0},o,n);return utils.joinBufs(u,f)}async function decryptBytes(r,e,t){const n=utils.normalizeBase64ToBuf(r),o=typeof e=="string"?await keys$1.importKey(e,t):e,s=(t==null?void 0:t.alg)||DEFAULT_SYMM_ALG,u=n.slice(0,16),f=n.slice(16);return await webcrypto.subtle.decrypt({name:s,iv:s===SymmAlg.AES_CTR?void 0:u,counter:s===SymmAlg.AES_CTR?new Uint8Array(u):void 0,length:s===SymmAlg.AES_CTR?DEFAULT_CTR_LEN:void 0},o,f)}async function encrypt$1(r,e,t){const n=await encryptBytes(r,e,t);return utils.arrBufToBase64(n)}async function decrypt$1(r,e,t){const n=await decryptBytes(r,e,t);return utils.arrBufToStr(n,16)}async function exportKey(r){const e=await webcrypto.subtle.exportKey("raw",r);return utils.arrBufToBase64(e)}const operations$1={encryptBytes,decryptBytes,encrypt:encrypt$1,decrypt:decrypt$1,exportKey},aes$1={...keys$1,...operations$1};async function makeKeypair$1(r,e,t){checkValidKeyUse(t);const n=t===KeyUse.Exchange?RSA_EXCHANGE_ALG:RSA_WRITE_ALG,o=t===KeyUse.Exchange?["encrypt","decrypt"]:["sign","verify"];return webcrypto.subtle.generateKey({name:n,modulusLength:r,publicExponent:utils.publicExponent(),hash:{name:e}},!1,o)}function stripKeyHeader(r){return r.replace(`-----BEGIN PUBLIC KEY-----
`,"").replace(`
-----END PUBLIC KEY-----`,"")}async function importPublicKey$1(r,e,t){checkValidKeyUse(t);const n=t===KeyUse.Exchange?RSA_EXCHANGE_ALG:RSA_WRITE_ALG,o=t===KeyUse.Exchange?["encrypt"]:["verify"],s=utils.base64ToArrBuf(stripKeyHeader(r));return webcrypto.subtle.importKey("spki",s,{name:n,hash:{name:e}},!0,o)}const keys={makeKeypair:makeKeypair$1,importPublicKey:importPublicKey$1};async function sign(r,e,t=DEFAULT_CHAR_SIZE){return webcrypto.subtle.sign({name:RSA_WRITE_ALG,saltLength:SALT_LENGTH},e,normalizeUnicodeToBuf(r,t))}async function verify(r,e,t,n=DEFAULT_CHAR_SIZE,o=DEFAULT_HASH_ALG){return webcrypto.subtle.verify({name:RSA_WRITE_ALG,saltLength:SALT_LENGTH},typeof t=="string"?await keys.importPublicKey(t,o,KeyUse.Write):t,normalizeBase64ToBuf(e),normalizeUnicodeToBuf(r,n))}async function encrypt(r,e,t=DEFAULT_CHAR_SIZE,n=DEFAULT_HASH_ALG){return webcrypto.subtle.encrypt({name:RSA_EXCHANGE_ALG},typeof e=="string"?await keys.importPublicKey(e,n,KeyUse.Exchange):e,normalizeUnicodeToBuf(r,t))}async function decrypt(r,e){const t=normalizeBase64ToBuf(r);return webcrypto.subtle.decrypt({name:RSA_EXCHANGE_ALG},e,t)}async function getPublicKey(r){const e=await webcrypto.subtle.exportKey("spki",r.publicKey);return utils.arrBufToBase64(e)}const operations={sign,verify,encrypt,decrypt,getPublicKey};function createStore(r){return localforage.createInstance({name:r})}async function createIfDoesNotExist(r,e,t=localforage){if(await exists(r,t))return;const n=await e();await put(r,n,t)}async function put(r,e,t=localforage){return t.setItem(r,e)}async function getKeypair(r,e=localforage){return get$2(r,checkIsKeyPair,e)}async function getKey(r,e=localforage){return get$2(r,checkIsKey,e)}async function get$2(r,e,t=localforage){const n=await t.getItem(r);return n===null?null:e(n)}async function exists(r,e=localforage){return await e.getItem(r)!==null}async function rm(r,e=localforage){return e.removeItem(r)}async function dropStore(r){return r.dropInstance()}async function clear$3(r){return r?dropStore(r):localforage.clear()}const IDB={createStore,createIfDoesNotExist,put,getKeypair,getKey,exists,rm,dropStore,clear:clear$3};async function makeKeypair(r,e){checkValidKeyUse(e);const t=e===KeyUse.Exchange?ECC_EXCHANGE_ALG:ECC_WRITE_ALG,n=e===KeyUse.Exchange?["deriveKey","deriveBits"]:["sign","verify"];return webcrypto.subtle.generateKey({name:t,namedCurve:r},!1,n)}async function importPublicKey(r,e,t){checkValidKeyUse(t);const n=t===KeyUse.Exchange?ECC_EXCHANGE_ALG:ECC_WRITE_ALG,o=t===KeyUse.Exchange?[]:["verify"],s=utils.base64ToArrBuf(r);return webcrypto.subtle.importKey("raw",s,{name:n,namedCurve:e},!0,o)}const ecc={makeKeypair,importPublicKey},defaultConfig={type:DEFAULT_CRYPTOSYSTEM,curve:DEFAULT_ECC_CURVE,rsaSize:DEFAULT_RSA_SIZE,symmAlg:DEFAULT_SYMM_ALG,symmLen:DEFAULT_SYMM_LEN,hashAlg:DEFAULT_HASH_ALG,charSize:DEFAULT_CHAR_SIZE,storeName:DEFAULT_STORE_NAME,exchangeKeyName:DEFAULT_EXCHANGE_KEY_NAME,writeKeyName:DEFAULT_WRITE_KEY_NAME};function normalize(r,e=!0){let t;return r?t={...defaultConfig,...r}:t=defaultConfig,r!=null&&r.type||(t.type=e?CryptoSystem.ECC:CryptoSystem.RSA),t}async function eccEnabled(){const r=await ecc.makeKeypair(DEFAULT_ECC_CURVE,KeyUse.Exchange);try{await utils.structuralClone(r)}catch{return!1}return!0}function merge$2(r,e={}){return{...r,...e}}function symmKeyOpts(r){return{alg:r.symmAlg,length:r.symmLen}}const config$1={defaultConfig,normalize,eccEnabled,merge:merge$2,symmKeyOpts};class KeyStoreBase{constructor(e,t){this.cfg=e,this.store=t}async writeKey(){const e=await IDB.getKeypair(this.cfg.writeKeyName,this.store);return checkIsKeyPair(e)}async exchangeKey(){const e=await IDB.getKeypair(this.cfg.exchangeKeyName,this.store);return checkIsKeyPair(e)}async getSymmKey(e,t){const n=config$1.merge(this.cfg,t),o=await IDB.getKey(e,this.store);if(o!==null)return o;const s=await aes$1.makeKey(config$1.symmKeyOpts(n));return await IDB.put(e,s,this.store),s}async keyExists(e){return await IDB.getKey(e,this.store)!==null}async deleteKey(e){return IDB.rm(e,this.store)}async destroy(){return IDB.dropStore(this.store)}async importSymmKey(e,t,n){const o=config$1.merge(this.cfg,n),s=await aes$1.importKey(e,config$1.symmKeyOpts(o));await IDB.put(t,s,this.store)}async exportSymmKey(e,t){const n=await this.getSymmKey(e,t);return aes$1.exportKey(n)}async encryptWithSymmKey(e,t,n){const o=config$1.merge(this.cfg,n),s=await this.getSymmKey(t,n),u=await aes$1.encryptBytes(utils.strToArrBuf(e,o.charSize),s,config$1.symmKeyOpts(o));return utils.arrBufToBase64(u)}async decryptWithSymmKey(e,t,n){const o=config$1.merge(this.cfg,n),s=await this.getSymmKey(t,n),u=await aes$1.decryptBytes(utils.base64ToArrBuf(e),s,config$1.symmKeyOpts(o));return utils.arrBufToStr(u,o.charSize)}}class RSAKeyStore extends KeyStoreBase{static async init(e){const t=config$1.normalize({...e||{},type:CryptoSystem.RSA}),{rsaSize:n,hashAlg:o,storeName:s,exchangeKeyName:u,writeKeyName:f}=t,l=IDB.createStore(s);return await IDB.createIfDoesNotExist(u,()=>keys.makeKeypair(n,o,KeyUse.Exchange),l),await IDB.createIfDoesNotExist(f,()=>keys.makeKeypair(n,o,KeyUse.Write),l),new RSAKeyStore(t,l)}async sign(e,t){const n=config$1.merge(this.cfg,t),o=await this.writeKey();return utils.arrBufToBase64(await operations.sign(e,o.privateKey,n.charSize))}async verify(e,t,n,o){const s=config$1.merge(this.cfg,o);return operations.verify(e,t,n,s.charSize,s.hashAlg)}async encrypt(e,t,n){const o=config$1.merge(this.cfg,n);return utils.arrBufToBase64(await operations.encrypt(e,t,o.charSize,o.hashAlg))}async decrypt(e,t,n){const o=await this.exchangeKey(),s=config$1.merge(this.cfg,n);return utils.arrBufToStr(await operations.decrypt(e,o.privateKey),s.charSize)}async publicExchangeKey(){const e=await this.exchangeKey();return operations.getPublicKey(e)}async publicWriteKey(){const e=await this.writeKey();return operations.getPublicKey(e)}}const rsaOperations={...keys,...operations,...RSAKeyStore},aes={decrypt:aesDecrypt,encrypt:aesEncrypt,exportKey:aesExportKey,genKey:aesGenKey};function importAesKey(r,e){return webcrypto.subtle.importKey("raw",r,{name:e,length:SymmKeyLength.B256},!0,["encrypt","decrypt"])}async function aesDecrypt(r,e,t,n){const o=isCryptoKey(e)?e:await importAesKey(e,t),s=n?await webcrypto.subtle.decrypt({name:t,iv:n},o,r):await decryptBytes(r,o,{alg:t});return new Uint8Array(s)}async function aesEncrypt(r,e,t,n){const o=isCryptoKey(e)?e:await importAesKey(e,t),s=n?await webcrypto.subtle.encrypt({name:t,iv:n},o,r):await encryptBytes(r,o,{alg:t});return new Uint8Array(s)}async function aesExportKey(r){const e=await webcrypto.subtle.exportKey("raw",r);return new Uint8Array(e)}function aesGenKey(r){return makeKey({length:SymmKeyLength.B256,alg:r})}const did$1={keyTypes:{"bls12-381":{magicBytes:new Uint8Array([234,1]),verify:()=>{throw new Error("Not implemented")}},ed25519:{magicBytes:new Uint8Array([237,1]),verify:ed25519Verify},rsa:{magicBytes:new Uint8Array([0,245,2]),verify:rsaVerify}}};async function ed25519Verify({message:r,publicKey:e,signature:t}){return tweetnacl.sign.detached.verify(r,t,e)}async function rsaVerify({message:r,publicKey:e,signature:t}){return rsaOperations.verify(r,t,await webcrypto.subtle.importKey("spki",e,{name:RSA_WRITE_ALG,hash:RSA_HASHING_ALGORITHM},!1,["verify"]),8)}const hash$1={sha256:sha256$1};async function sha256$1(r){return new Uint8Array(await webcrypto.subtle.digest("sha-256",r))}function ksClearStore(r){return r.destroy()}async function ksDecrypt(r,e){const t=await r.exchangeKey();return rsaDecrypt(e,t.privateKey)}async function ksExportSymmKey(r,e){if(await r.keyExists(e)===!1)throw new Error(`Expected a key under the name '${e}', but couldn't find anything`);const t=await r.getSymmKey(e),n=await webcrypto.subtle.exportKey("raw",t);return new Uint8Array(n)}function ksGetAlgorithm(r){return Promise.resolve("rsa")}function ksGetUcanAlgorithm(r){return Promise.resolve("RS256")}function ksImportSymmKey(r,e,t){return r.importSymmKey(toString$7(e,"base64pad"),t)}function ksKeyExists(r,e){return r.keyExists(e)}async function ksPublicExchangeKey(r){const e=await r.exchangeKey(),t=await webcrypto.subtle.exportKey("spki",e.publicKey);return new Uint8Array(t)}async function ksPublicWriteKey(r){const e=await r.writeKey(),t=await webcrypto.subtle.exportKey("spki",e.publicKey);return new Uint8Array(t)}async function ksSign(r,e){const t=await r.writeKey(),n=await rsaOperations.sign(e,t.privateKey,r.cfg.charSize);return new Uint8Array(n)}const misc={randomNumbers};function randomNumbers(r){return webcrypto.getRandomValues(new Uint8Array(r.amount))}const rsa={decrypt:rsaDecrypt,encrypt:rsaEncrypt,exportPublicKey:rsaExportPublicKey,genKey:rsaGenKey},RSA_ALGORITHM="RSA-OAEP",RSA_HASHING_ALGORITHM="SHA-256";function importRsaKey(r,e){return webcrypto.subtle.importKey("spki",r,{name:RSA_ALGORITHM,hash:RSA_HASHING_ALGORITHM},!1,e)}async function rsaDecrypt(r,e){const t=await webcrypto.subtle.decrypt({name:RSA_ALGORITHM},isCryptoKey(e)?e:await importRsaKey(e,["decrypt"]),r);return new Uint8Array(t)}async function rsaEncrypt(r,e){const t=isCryptoKey(e)?e:await importRsaKey(e,["encrypt"]),n=await webcrypto.subtle.encrypt({name:RSA_ALGORITHM},t,r);return new Uint8Array(n)}async function rsaExportPublicKey(r){const e=await webcrypto.subtle.exportKey("spki",r);return new Uint8Array(e)}function rsaGenKey(){return webcrypto.subtle.generateKey({name:RSA_ALGORITHM,modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:RSA_HASHING_ALGORITHM}},!0,["encrypt","decrypt"])}async function implementation$f({storeName:r,exchangeKeyName:e,writeKeyName:t}){const n=await RSAKeyStore.init({charSize:8,hashAlg:HashAlg.SHA_256,storeName:r,exchangeKeyName:e,writeKeyName:t});return{aes,did:did$1,hash:hash$1,misc,rsa,keystore:{clearStore:(...o)=>ksClearStore(n,...o),decrypt:(...o)=>ksDecrypt(n,...o),exportSymmKey:(...o)=>ksExportSymmKey(n,...o),getAlgorithm:(...o)=>ksGetAlgorithm(n,...o),getUcanAlgorithm:(...o)=>ksGetUcanAlgorithm(n,...o),importSymmKey:(...o)=>ksImportSymmKey(n,...o),keyExists:(...o)=>ksKeyExists(n,...o),publicExchangeKey:(...o)=>ksPublicExchangeKey(n,...o),publicWriteKey:(...o)=>ksPublicWriteKey(n,...o),sign:(...o)=>ksSign(n,...o)}}}const KEYS={ACCOUNT_UCAN:"account-ucan",CID_LOG:"cid-log",SESSION:"session",UCANS:"permissioned-ucans"};function getItem(r,e){return assertBrowser("storage.getItem"),r.getItem(e)}function setItem(r,e,t){return assertBrowser("storage.setItem"),r.setItem(e,t)}function removeItem(r,e){return assertBrowser("storage.removeItem"),r.removeItem(e)}async function clear$2(r){return assertBrowser("storage.clear"),r.clear()}function implementation$e({name:r}){const e=localforage.createInstance({name:r});return{KEYS,getItem:(...t)=>getItem(e,...t),setItem:(...t)=>setItem(e,...t),removeItem:(...t)=>removeItem(e,...t),clear:(...t)=>clear$2(e,...t)}}async function lookupTxtRecord(r){return Promise.any([googleLookup(r),cloudflareLookup(r)])}async function googleLookup(r){return dnsOverHttps(`https://dns.google/resolve?name=${r}&type=txt`)}function cloudflareLookup(r){return dnsOverHttps(`https://cloudflare-dns.com/dns-query?name=${r}&type=txt`)}function dnsOverHttps(r){return fetch(r,{headers:{accept:"application/dns-json"}}).then(e=>e.json()).then(e=>{if(e.Answer){const t=e.Answer.map(n=>(n.data||"").replace(/^"+|"+$/g,""));return t[0][3]===";"?t.sort((n,o)=>n.slice(0,4).localeCompare(o.slice(0,4))).map(n=>n.slice(4)).join(""):t.join("")}else return null})}async function lookupDnsLink(r){const e=await lookupTxtRecord(r.startsWith("_dnslink.")?r:`_dnslink.${r}`);return e&&!e.includes("/ipns/")?e.replace(/^dnslink=/,"").replace(/^\/ipfs\//,""):null}const PRODUCTION={apiPath:"/v2/api",lobby:"https://auth.fission.codes",server:"https://runfission.com",userDomain:"fission.name"};function apiUrl(r,e){return`${r.server}${r.apiPath}${e!=null&&e.length?"/"+e.replace(/^\/+/,""):""}`}const didCache={did:null,host:null,lastFetched:0};async function did(r){let e;try{e=new URL(r.server).host}catch{throw new Error("Unable to parse API Endpoint")}const t=Date.now();if((didCache.host!==e||didCache.lastFetched+1e3*60*60*3<=t)&&(didCache.did=await lookupTxtRecord("_did."+e),didCache.host=e,didCache.lastFetched=t),!didCache.did)throw new Error("Couldn't get the Fission API DID");return didCache.did}const RSA="RSA";class Parser{constructor(){ss(this,"index",0);ss(this,"input","")}new(e){return this.index=0,this.input=e,this}readAtomically(e){const t=this.index,n=e();return n===void 0&&(this.index=t),n}parseWith(e){const t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{const t=this.readChar();if(t===e)return t})}readSeparator(e,t,n){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,t,n,o){return this.readAtomically(()=>{let s=0,u=0;const f=this.peekChar();if(f===void 0)return;const l=f==="0",h=2**(8*o)-1;for(;;){const p=this.readAtomically(()=>{const m=this.readChar();if(m===void 0)return;const b=Number.parseInt(m,e);if(!Number.isNaN(b))return b});if(p===void 0)break;if(s*=e,s+=p,s>h||(u+=1,t!==void 0&&u>t))return}if(u!==0)return!n&&l&&u>1?void 0:s})}readIPv4Addr(){return this.readAtomically(()=>{const e=new Uint8Array(4);for(let t=0;t<e.length;t++){const n=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[t]=n}return e})}readIPv6Addr(){const e=t=>{for(let n=0;n<t.length/2;n++){const o=n*2;if(n<t.length-3){const u=this.readSeparator(":",n,()=>this.readIPv4Addr());if(u!==void 0)return t[o]=u[0],t[o+1]=u[1],t[o+2]=u[2],t[o+3]=u[3],[o+4,!0]}const s=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(s===void 0)return[o,!1];t[o]=s>>8,t[o+1]=s&255}return[t.length,!1]};return this.readAtomically(()=>{const t=new Uint8Array(16),[n,o]=e(t);if(n===16)return t;if(o||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;const s=new Uint8Array(14),u=16-(n+2),[f]=e(s.subarray(0,u));return t.set(s.subarray(0,f),16-f),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}}const MAX_IPV6_LENGTH=45,MAX_IPV4_LENGTH=15,parser=new Parser;function parseIPv4(r){if(!(r.length>MAX_IPV4_LENGTH))return parser.new(r).parseWith(()=>parser.readIPv4Addr())}function parseIPv6(r){if(!(r.length>MAX_IPV6_LENGTH))return parser.new(r).parseWith(()=>parser.readIPv6Addr())}function parseIP(r){if(!(r.length>MAX_IPV6_LENGTH))return parser.new(r).parseWith(()=>parser.readIPAddr())}function isIPv4(r){return Boolean(parseIPv4(r))}function isIPv6(r){return Boolean(parseIPv6(r))}function isIP(r){return Boolean(parseIP(r))}const identity$3=from$2({prefix:"\0",name:"identity",encode:r=>toString$4(r),decode:r=>fromString$4(r)}),identityBase$1=Object.freeze(Object.defineProperty({__proto__:null,identity:identity$3},Symbol.toStringTag,{value:"Module"})),base2$2=rfc4648({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base2$3=Object.freeze(Object.defineProperty({__proto__:null,base2:base2$2},Symbol.toStringTag,{value:"Module"})),base8$2=rfc4648({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base8$3=Object.freeze(Object.defineProperty({__proto__:null,base8:base8$2},Symbol.toStringTag,{value:"Module"})),base10$2=baseX({prefix:"9",name:"base10",alphabet:"0123456789"}),base10$3=Object.freeze(Object.defineProperty({__proto__:null,base10:base10$2},Symbol.toStringTag,{value:"Module"})),base16$2=rfc4648({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper$1=rfc4648({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base16$3=Object.freeze(Object.defineProperty({__proto__:null,base16:base16$2,base16upper:base16upper$1},Symbol.toStringTag,{value:"Module"})),base36$2=baseX({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper$1=baseX({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base36$3=Object.freeze(Object.defineProperty({__proto__:null,base36:base36$2,base36upper:base36upper$1},Symbol.toStringTag,{value:"Module"})),base64$4=rfc4648({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad$1=rfc4648({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url$1=rfc4648({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad$1=rfc4648({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base64$5=Object.freeze(Object.defineProperty({__proto__:null,base64:base64$4,base64pad:base64pad$1,base64url:base64url$1,base64urlpad:base64urlpad$1},Symbol.toStringTag,{value:"Module"})),alphabet$1=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),alphabetBytesToChars$1=alphabet$1.reduce((r,e,t)=>(r[t]=e,r),[]),alphabetCharsToBytes$1=alphabet$1.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function encode$3(r){return r.reduce((e,t)=>(e+=alphabetBytesToChars$1[t],e),"")}function decode$2(r){const e=[];for(const t of r){const n=alphabetCharsToBytes$1[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const base256emoji$2=from$2({prefix:"🚀",name:"base256emoji",encode:encode$3,decode:decode$2}),base256emoji$3=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:base256emoji$2},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const bases$1={...identityBase$1,...base2$3,...base8$3,...base10$3,...base16$3,...base32$1,...base36$3,...base58,...base64$5,...base256emoji$3};function asUint8Array(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function allocUnsafe(r=0){var e;return((e=globalThis.Buffer)==null?void 0:e.allocUnsafe)!=null?asUint8Array(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function createCodec(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}const string=createCodec("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),ascii=createCodec("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=allocUnsafe(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),BASES={utf8:string,"utf-8":string,hex:bases$1.base16,latin1:ascii,ascii,binary:ascii,...bases$1};function toString$2(r,e="utf8"){const t=BASES[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}const isV4=isIPv4,isV6=isIPv6,toBytes=function(r){let e=0;if(r=r.toString().trim(),isV4(r)){const t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(isV6(r)){const t=r.split(":",8);let n;for(n=0;n<t.length;n++){const s=isV4(t[n]);let u;s&&(u=toBytes(t[n]),t[n]=toString$2(u.slice(0,2),"base16")),u!=null&&++n<8&&t.splice(n,0,toString$2(u.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);const s=[n,1];for(n=9-t.length;n>0;n--)s.push("0");t.splice.apply(t,s)}const o=new Uint8Array(e+16);for(n=0;n<t.length;n++){const s=parseInt(t[n],16);o[e++]=s>>8&255,o[e++]=s&255}return o}throw new Error("invalid ip address")},toString$1=function(r,e=0,t){e=~~e,t=t??r.length-e;const n=new DataView(r.buffer);if(t===4){const o=[];for(let s=0;s<t;s++)o.push(r[e+s]);return o.join(".")}if(t===16){const o=[];for(let s=0;s<t;s+=2)o.push(n.getUint16(e+s).toString(16));return o.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},V=-1,names={},codes={},table=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,V,"ip6zone"],[43,8,"ipcidr"],[53,V,"dns",!0],[54,V,"dns4",!0],[55,V,"dns6",!0],[56,V,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,V,"unix",!1,!0],[421,V,"ipfs"],[421,V,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,V,"garlic64"],[448,0,"tls"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,V,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,V,"memory"]];table.forEach(r=>{const e=createProtocol(...r);codes[e.code]=e,names[e.name]=e});function createProtocol(r,e,t,n,o){return{code:r,size:e,name:t,resolvable:Boolean(n),path:Boolean(o)}}function getProtocol(r){if(typeof r=="number"){if(codes[r]!=null)return codes[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(names[r]!=null)return names[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}var encode_1=encode$2,MSB$1=128,REST$1=127,MSBALL=~REST$1,INT=Math.pow(2,31);function encode$2(r,e,t){if(Number.MAX_SAFE_INTEGER&&r>Number.MAX_SAFE_INTEGER)throw encode$2.bytes=0,new RangeError("Could not encode varint");e=e||[],t=t||0;for(var n=t;r>=INT;)e[t++]=r&255|MSB$1,r/=128;for(;r&MSBALL;)e[t++]=r&255|MSB$1,r>>>=7;return e[t]=r|0,encode$2.bytes=t-n+1,e}var decode$1=read,MSB=128,REST=127;function read(r,n){var t=0,n=n||0,o=0,s=n,u,f=r.length;do{if(s>=f||o>49)throw read.bytes=0,new RangeError("Could not decode varint");u=r[s++],t+=o<28?(u&REST)<<o:(u&REST)*Math.pow(2,o),o+=7}while(u>=MSB);return read.bytes=s-n,t}var N1=Math.pow(2,7),N2=Math.pow(2,14),N3=Math.pow(2,21),N4=Math.pow(2,28),N5=Math.pow(2,35),N6=Math.pow(2,42),N7=Math.pow(2,49),N8=Math.pow(2,56),N9=Math.pow(2,63),length$1=function(r){return r<N1?1:r<N2?2:r<N3?3:r<N4?4:r<N5?5:r<N6?6:r<N7?7:r<N8?8:r<N9?9:10},varint={encode:encode_1,decode:decode$1,encodingLength:length$1};function fromString$1(r,e="utf8"){const t=BASES[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?asUint8Array(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}function concat(r,e){e==null&&(e=r.reduce((o,s)=>o+s.length,0));const t=allocUnsafe(e);let n=0;for(const o of r)t.set(o,n),n+=o.length;return asUint8Array(t)}function convertToString(r,e){switch(getProtocol(r).code){case 4:case 41:return bytes2ip(e);case 42:return bytes2str(e);case 6:case 273:case 33:case 132:return bytes2port(e).toString();case 53:case 54:case 55:case 56:case 400:case 777:return bytes2str(e);case 421:return bytes2mh(e);case 444:return bytes2onion(e);case 445:return bytes2onion(e);case 466:return bytes2mb(e);default:return toString$2(e,"base16")}}function convertToBytes(r,e){switch(getProtocol(r).code){case 4:return ip2bytes(e);case 41:return ip2bytes(e);case 42:return str2bytes(e);case 6:case 273:case 33:case 132:return port2bytes(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 777:return str2bytes(e);case 421:return mh2bytes(e);case 444:return onion2bytes(e);case 445:return onion32bytes(e);case 466:return mb2bytes(e);default:return fromString$1(e,"base16")}}const decoders=Object.values(bases$1).map(r=>r.decoder),anybaseDecoder=function(){let r=decoders[0].or(decoders[1]);return decoders.slice(2).forEach(e=>r=r.or(e)),r}();function ip2bytes(r){if(!isIP(r))throw new Error("invalid ip address");return toBytes(r)}function bytes2ip(r){const e=toString$1(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!isIP(e))throw new Error("invalid ip address");return e}function port2bytes(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function bytes2port(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function str2bytes(r){const e=fromString$1(r),t=Uint8Array.from(varint.encode(e.length));return concat([t,e],t.length+e.length)}function bytes2str(r){const e=varint.decode(r);if(r=r.slice(varint.decode.bytes),r.length!==e)throw new Error("inconsistent lengths");return toString$2(r)}function mh2bytes(r){let e;r[0]==="Q"||r[0]==="1"?e=decode$7(base58btc.decode(`z${r}`)).bytes:e=CID.parse(r).multihash.bytes;const t=Uint8Array.from(varint.encode(e.length));return concat([t,e],t.length+e.length)}function mb2bytes(r){const e=anybaseDecoder.decode(r),t=Uint8Array.from(varint.encode(e.length));return concat([t,e],t.length+e.length)}function bytes2mb(r){const e=varint.decode(r),t=r.slice(varint.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return"u"+toString$2(t,"base64url")}function bytes2mh(r){const e=varint.decode(r),t=r.slice(varint.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return toString$2(t,"base58btc")}function onion2bytes(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=base32.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const o=port2bytes(n);return concat([t,o],t.length+o.length)}function onion32bytes(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=base32.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const o=port2bytes(n);return concat([t,o],t.length+o.length)}function bytes2onion(r){const e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=toString$2(e,"base32"),o=bytes2port(t);return`${n}:${o}`}function stringToStringTuples(r){const e=[],t=r.split("/").slice(1);if(t.length===1&&t[0]==="")return[];for(let n=0;n<t.length;n++){const o=t[n],s=getProtocol(o);if(s.size===0){e.push([o]);continue}if(n++,n>=t.length)throw ParseError("invalid address: "+r);if(s.path===!0){e.push([o,cleanPath(t.slice(n).join("/"))]);break}e.push([o,t[n]])}return e}function stringTuplesToString(r){const e=[];return r.map(t=>{const n=protoFromTuple(t);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),cleanPath(e.join("/"))}function stringTuplesToTuples(r){return r.map(e=>{Array.isArray(e)||(e=[e]);const t=protoFromTuple(e);return e.length>1?[t.code,convertToBytes(t.code,e[1])]:[t.code]})}function tuplesToStringTuples(r){return r.map(e=>{const t=protoFromTuple(e);return e[1]!=null?[t.code,convertToString(t.code,e[1])]:[t.code]})}function tuplesToBytes(r){return fromBytes(concat(r.map(e=>{const t=protoFromTuple(e);let n=Uint8Array.from(varint.encode(t.code));return e.length>1&&e[1]!=null&&(n=concat([n,e[1]])),n})))}function sizeForAddr(r,e){return r.size>0?r.size/8:r.size===0?0:varint.decode(e)+(varint.decode.bytes??0)}function bytesToTuples(r){const e=[];let t=0;for(;t<r.length;){const n=varint.decode(r,t),o=varint.decode.bytes??0,s=getProtocol(n),u=sizeForAddr(s,r.slice(t+o));if(u===0){e.push([n]),t+=o;continue}const f=r.slice(t+o,t+o+u);if(t+=u+o,t>r.length)throw ParseError("Invalid address Uint8Array: "+toString$2(r,"base16"));e.push([n,f])}return e}function bytesToString(r){const e=bytesToTuples(r),t=tuplesToStringTuples(e);return stringTuplesToString(t)}function stringToBytes(r){r=cleanPath(r);const e=stringToStringTuples(r),t=stringTuplesToTuples(e);return tuplesToBytes(t)}function fromString(r){return stringToBytes(r)}function fromBytes(r){const e=validateBytes(r);if(e!=null)throw e;return Uint8Array.from(r)}function validateBytes(r){try{bytesToTuples(r)}catch(e){return e}}function cleanPath(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function ParseError(r){return new Error("Error parsing address: "+r)}function protoFromTuple(r){return getProtocol(r[0])}function assign(r,e){for(const t in e)Object.defineProperty(r,t,{value:e[t],enumerable:!0,configurable:!0});return r}function createError(r,e,t){if(!r||typeof r=="string")throw new TypeError("Please pass an Error to err-code");t||(t={}),typeof e=="object"&&(t=e,e=""),e&&(t.code=e);try{return assign(r,t)}catch{t.message=r.message,t.stack=r.stack;const o=function(){};return o.prototype=Object.create(Object.getPrototypeOf(r)),assign(new o,t)}}var errCode=createError;function equals(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}var __classPrivateFieldGet$2=globalThis&&globalThis.__classPrivateFieldGet||function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},__classPrivateFieldSet$1=globalThis&&globalThis.__classPrivateFieldSet||function(r,e,t,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!o:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(r,t):o?o.value=t:e.set(r,t),t},_DefaultMultiaddr_string,_DefaultMultiaddr_tuples,_DefaultMultiaddr_stringTuples,_a;const inspect=Symbol.for("nodejs.util.inspect.custom"),DNS_CODES=[getProtocol("dns").code,getProtocol("dns4").code,getProtocol("dns6").code,getProtocol("dnsaddr").code],resolvers=new Map,symbol=Symbol.for("@multiformats/js-multiaddr/multiaddr");function isMultiaddr(r){return Boolean(r==null?void 0:r[symbol])}class DefaultMultiaddr{constructor(e){if(_DefaultMultiaddr_string.set(this,void 0),_DefaultMultiaddr_tuples.set(this,void 0),_DefaultMultiaddr_stringTuples.set(this,void 0),this[_a]=!0,e==null&&(e=""),e instanceof Uint8Array)this.bytes=fromBytes(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=fromString(e)}else if(isMultiaddr(e))this.bytes=fromBytes(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return __classPrivateFieldGet$2(this,_DefaultMultiaddr_string,"f")==null&&__classPrivateFieldSet$1(this,_DefaultMultiaddr_string,bytesToString(this.bytes),"f"),__classPrivateFieldGet$2(this,_DefaultMultiaddr_string,"f")}toJSON(){return this.toString()}toOptions(){let e,t,n,o,s="";const u=getProtocol("tcp"),f=getProtocol("udp"),l=getProtocol("ip4"),h=getProtocol("ip6"),p=getProtocol("dns6"),m=getProtocol("ip6zone");for(const[S,A]of this.stringTuples())S===m.code&&(s=`%${A??""}`),DNS_CODES.includes(S)&&(t=u.name,o=443,n=`${A??""}${s}`,e=S===p.code?6:4),(S===u.code||S===f.code)&&(t=getProtocol(S).name,o=parseInt(A??"")),(S===l.code||S===h.code)&&(t=getProtocol(S).name,n=`${A??""}${s}`,e=S===h.code?6:4);if(e==null||t==null||n==null||o==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:o}}protos(){return this.protoCodes().map(e=>Object.assign({},getProtocol(e)))}protoCodes(){const e=[],t=this.bytes;let n=0;for(;n<t.length;){const o=varint.decode(t,n),s=varint.decode.bytes??0,u=getProtocol(o),f=sizeForAddr(u,t.slice(n+s));n+=f+s,e.push(o)}return e}protoNames(){return this.protos().map(e=>e.name)}tuples(){return __classPrivateFieldGet$2(this,_DefaultMultiaddr_tuples,"f")==null&&__classPrivateFieldSet$1(this,_DefaultMultiaddr_tuples,bytesToTuples(this.bytes),"f"),__classPrivateFieldGet$2(this,_DefaultMultiaddr_tuples,"f")}stringTuples(){return __classPrivateFieldGet$2(this,_DefaultMultiaddr_stringTuples,"f")==null&&__classPrivateFieldSet$1(this,_DefaultMultiaddr_stringTuples,tuplesToStringTuples(this.tuples()),"f"),__classPrivateFieldGet$2(this,_DefaultMultiaddr_stringTuples,"f")}encapsulate(e){return e=new DefaultMultiaddr(e),new DefaultMultiaddr(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),n=this.toString(),o=n.lastIndexOf(t);if(o<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new DefaultMultiaddr(n.slice(0,o))}decapsulateCode(e){const t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new DefaultMultiaddr(tuplesToBytes(t.slice(0,n)));return this}getPeerId(){try{const t=this.stringTuples().filter(n=>n[0]===names.ipfs.code).pop();if((t==null?void 0:t[1])!=null){const n=t[1];return n[0]==="Q"||n[0]==="1"?toString$2(base58btc.decode(`z${n}`),"base58btc"):toString$2(CID.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){let e=null;try{e=this.stringTuples().filter(t=>getProtocol(t[0]).path===!0)[0][1],e==null&&(e=null)}catch{e=null}return e}equals(e){return equals(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(s=>s.resolvable);if(t==null)return[this];const n=resolvers.get(t.name);if(n==null)throw errCode(new Error(`no available resolver for ${t.name}`),"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(s=>new DefaultMultiaddr(s))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(_DefaultMultiaddr_string=new WeakMap,_DefaultMultiaddr_tuples=new WeakMap,_DefaultMultiaddr_stringTuples=new WeakMap,_a=symbol,inspect)](){return`Multiaddr(${bytesToString(this.bytes)})`}}function multiaddr(r){return new DefaultMultiaddr(r)}const identity$2=from$3({prefix:"\0",name:"identity",encode:r=>toString$6(r),decode:r=>fromString$6(r)}),identityBase=Object.freeze(Object.defineProperty({__proto__:null,identity:identity$2},Symbol.toStringTag,{value:"Module"})),base2=rfc4648$1({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base2$1=Object.freeze(Object.defineProperty({__proto__:null,base2},Symbol.toStringTag,{value:"Module"})),base8=rfc4648$1({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base8$1=Object.freeze(Object.defineProperty({__proto__:null,base8},Symbol.toStringTag,{value:"Module"})),base10=baseX$1({prefix:"9",name:"base10",alphabet:"0123456789"}),base10$1=Object.freeze(Object.defineProperty({__proto__:null,base10},Symbol.toStringTag,{value:"Module"})),base16=rfc4648$1({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper=rfc4648$1({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base16$1=Object.freeze(Object.defineProperty({__proto__:null,base16,base16upper},Symbol.toStringTag,{value:"Module"})),base36=baseX$1({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper=baseX$1({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base36$1=Object.freeze(Object.defineProperty({__proto__:null,base36,base36upper},Symbol.toStringTag,{value:"Module"})),base64$2=rfc4648$1({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad=rfc4648$1({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url=rfc4648$1({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad=rfc4648$1({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base64$3=Object.freeze(Object.defineProperty({__proto__:null,base64:base64$2,base64pad,base64url,base64urlpad},Symbol.toStringTag,{value:"Module"})),alphabet=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),alphabetBytesToChars=alphabet.reduce((r,e,t)=>(r[t]=e,r),[]),alphabetCharsToBytes=alphabet.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function encode$1(r){return r.reduce((e,t)=>(e+=alphabetBytesToChars[t],e),"")}function decode(r){const e=[];for(const t of r){const n=alphabetCharsToBytes[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const base256emoji=from$3({prefix:"🚀",name:"base256emoji",encode:encode$1,decode}),base256emoji$1=Object.freeze(Object.defineProperty({__proto__:null,base256emoji},Symbol.toStringTag,{value:"Module"})),sha=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),sha256=from$1({name:"sha2-256",code:18,encode:sha("SHA-256")});from$1({name:"sha2-512",code:19,encode:sha("SHA-512")});const code=0,name="identity",encode=coerce$1,digest=r=>create$7(code,encode(r)),identity$1={code,name,encode,digest};new TextEncoder;new TextDecoder;const bases={...identityBase,...base2$1,...base8$1,...base10$1,...base16$1,...base32$3,...base36$1,...base58$1,...base64$3,...base256emoji$1};Object.values(bases).map(r=>r.decoder).reduce((r,e)=>r.or(e),bases.identity.decoder);var objectSafeGet=get$1;function get$1(r,e,t){if(!r)return t;var n,o;if(Array.isArray(e)&&(n=e.slice(0)),typeof e=="string"&&(n=e.split(".")),typeof e=="symbol"&&(n=[e]),!Array.isArray(n))throw new Error("props arg must be an array, a string or a symbol");for(;n.length;)if(o=n.shift(),!r||(r=r[o],r===void 0))return t;return r}var browserExports={},browser={get exports(){return browserExports},set exports(r){browserExports=r}},ms,hasRequiredMs;function requireMs(){if(hasRequiredMs)return ms;hasRequiredMs=1;var r=1e3,e=r*60,t=e*60,n=t*24,o=n*7,s=n*365.25;ms=function(p,m){m=m||{};var b=typeof p;if(b==="string"&&p.length>0)return u(p);if(b==="number"&&isFinite(p))return m.long?l(p):f(p);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(p))};function u(p){if(p=String(p),!(p.length>100)){var m=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(p);if(m){var b=parseFloat(m[1]),S=(m[2]||"ms").toLowerCase();switch(S){case"years":case"year":case"yrs":case"yr":case"y":return b*s;case"weeks":case"week":case"w":return b*o;case"days":case"day":case"d":return b*n;case"hours":case"hour":case"hrs":case"hr":case"h":return b*t;case"minutes":case"minute":case"mins":case"min":case"m":return b*e;case"seconds":case"second":case"secs":case"sec":case"s":return b*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return b;default:return}}}}function f(p){var m=Math.abs(p);return m>=n?Math.round(p/n)+"d":m>=t?Math.round(p/t)+"h":m>=e?Math.round(p/e)+"m":m>=r?Math.round(p/r)+"s":p+"ms"}function l(p){var m=Math.abs(p);return m>=n?h(p,m,n,"day"):m>=t?h(p,m,t,"hour"):m>=e?h(p,m,e,"minute"):m>=r?h(p,m,r,"second"):p+" ms"}function h(p,m,b,S){var A=m>=b*1.5;return Math.round(p/b)+" "+S+(A?"s":"")}return ms}function setup(r){t.debug=t,t.default=t,t.coerce=l,t.disable=s,t.enable=o,t.enabled=u,t.humanize=requireMs(),t.destroy=h,Object.keys(r).forEach(p=>{t[p]=r[p]}),t.names=[],t.skips=[],t.formatters={};function e(p){let m=0;for(let b=0;b<p.length;b++)m=(m<<5)-m+p.charCodeAt(b),m|=0;return t.colors[Math.abs(m)%t.colors.length]}t.selectColor=e;function t(p){let m,b=null,S,A;function L(...J){if(!L.enabled)return;const ne=L,pe=Number(new Date),de=pe-(m||pe);ne.diff=de,ne.prev=m,ne.curr=pe,m=pe,J[0]=t.coerce(J[0]),typeof J[0]!="string"&&J.unshift("%O");let H=0;J[0]=J[0].replace(/%([a-zA-Z%])/g,(ue,ce)=>{if(ue==="%%")return"%";H++;const Ee=t.formatters[ce];if(typeof Ee=="function"){const Be=J[H];ue=Ee.call(ne,Be),J.splice(H,1),H--}return ue}),t.formatArgs.call(ne,J),(ne.log||t.log).apply(ne,J)}return L.namespace=p,L.useColors=t.useColors(),L.color=t.selectColor(p),L.extend=n,L.destroy=t.destroy,Object.defineProperty(L,"enabled",{enumerable:!0,configurable:!1,get:()=>b!==null?b:(S!==t.namespaces&&(S=t.namespaces,A=t.enabled(p)),A),set:J=>{b=J}}),typeof t.init=="function"&&t.init(L),L}function n(p,m){const b=t(this.namespace+(typeof m>"u"?":":m)+p);return b.log=this.log,b}function o(p){t.save(p),t.namespaces=p,t.names=[],t.skips=[];let m;const b=(typeof p=="string"?p:"").split(/[\s,]+/),S=b.length;for(m=0;m<S;m++)b[m]&&(p=b[m].replace(/\*/g,".*?"),p[0]==="-"?t.skips.push(new RegExp("^"+p.slice(1)+"$")):t.names.push(new RegExp("^"+p+"$")))}function s(){const p=[...t.names.map(f),...t.skips.map(f).map(m=>"-"+m)].join(",");return t.enable(""),p}function u(p){if(p[p.length-1]==="*")return!0;let m,b;for(m=0,b=t.skips.length;m<b;m++)if(t.skips[m].test(p))return!1;for(m=0,b=t.names.length;m<b;m++)if(t.names[m].test(p))return!0;return!1}function f(p){return p.toString().substring(2,p.toString().length-2).replace(/\.\*\?$/,"*")}function l(p){return p instanceof Error?p.stack||p.message:p}function h(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var common$1=setup;(function(r,e){e.formatArgs=n,e.save=o,e.load=s,e.useColors=t,e.storage=u(),e.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;const h="color: "+this.color;l.splice(1,0,h,"color: inherit");let p=0,m=0;l[0].replace(/%[a-zA-Z%]/g,b=>{b!=="%%"&&(p++,b==="%c"&&(m=p))}),l.splice(m,0,h)}e.log=console.debug||console.log||(()=>{});function o(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch{}}function s(){let l;try{l=e.storage.getItem("debug")}catch{}return!l&&typeof process<"u"&&"env"in process&&(l={}.DEBUG),l}function u(){try{return localStorage}catch{}}r.exports=common$1(e);const{formatters:f}=r.exports;f.j=function(l){try{return JSON.stringify(l)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}}})(browser,browserExports);let nanoid=(r=21)=>crypto.getRandomValues(new Uint8Array(r)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");const pathSepS="/",pathSepB=new TextEncoder().encode(pathSepS),pathSep=pathSepB[0];class Key{constructor(e,t){if(typeof e=="string")this._buf=fromString$1(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==pathSep)throw new Error("Invalid key")}toString(e="utf8"){return toString$2(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new Key(e.join(pathSepS))}static random(){return new Key(nanoid().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new Key(e):typeof e.uint8Array=="function"?new Key(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=pathSepB),this._buf[0]!==pathSep){const e=new Uint8Array(this._buf.byteLength+1);e.fill(pathSep,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===pathSep;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),n=e.list();for(let o=0;o<t.length;o++){if(n.length<o+1)return!1;const s=t[o],u=n[o];if(s<u)return!0;if(s>u)return!1}return t.length<n.length}reverse(){return Key.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(pathSepS).slice(1)}type(){return namespaceType(this.baseNamespace())}name(){return namespaceValue(this.baseNamespace())}instance(e){return new Key(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(pathSepS)||(e+=pathSepS),e+=this.type(),new Key(e)}parent(){const e=this.list();return e.length===1?new Key(pathSepS):new Key(e.slice(0,-1).join(pathSepS))}child(e){return this.toString()===pathSepS?e:e.toString()===pathSepS?this:new Key(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return Key.withNamespaces([...this.namespaces(),...flatten(e.map(t=>t.namespaces()))])}}function namespaceType(r){const e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function namespaceValue(r){const e=r.split(":");return e[e.length-1]}function flatten(r){return[].concat(...r)}async function length(r){let e=0;for await(const t of r)e++;return e}const log$7=browserExports("ipfs:repo:migrator:migration-8");function unwrap$1(r){return r.child?unwrap$1(r.child):r}function keyToMultihash$1(r){try{const e=base32$2.decode(`b${r.toString().toLowerCase().slice(1)}`),t=CID$1.decode(e).multihash.bytes,n=base32$2.encode(t).slice(1).toUpperCase();return new Key(`/${n}`,!1)}catch{return r}}function keyToCid$1(r){try{const e=base32$2.decode(`b${r.toString().toLowerCase().slice(1)}`),t=decode$d(e),n=base32$2.encode(CID$1.createV1(code$2,t).bytes).slice(1);return new Key(`/${n.toUpperCase()}`,!1)}catch{return r}}async function process$3(r,e,t){const n=r.blocks;await n.open();const o=unwrap$1(n),s=await length(o.queryKeys({filters:[u=>t(u).toString()!==u.toString()]}));try{let u=0;for await(const f of o.query({})){const l=t(f.key);l.toString()!==f.key.toString()&&(u+=1,log$7(`Migrating Block from ${f.key} to ${l}`,await o.has(f.key)),await o.delete(f.key),await o.put(l,f.value),e(u/s*100,`Migrated Block from ${f.key} to ${l}`))}}finally{await n.close()}}const migration$4={version:8,description:"Transforms key names into base32 encoding and converts Block store to use bare multihashes encoded as base32",migrate:(r,e=()=>{})=>process$3(r,e,keyToMultihash$1),revert:(r,e=()=>{})=>process$3(r,e,keyToCid$1)};var minimalExports={},minimal$1={get exports(){return minimalExports},set exports(r){minimalExports=r}},indexMinimal={},minimal={},aspromise,hasRequiredAspromise;function requireAspromise(){if(hasRequiredAspromise)return aspromise;hasRequiredAspromise=1,aspromise=r;function r(e,t){for(var n=new Array(arguments.length-1),o=0,s=2,u=!0;s<arguments.length;)n[o++]=arguments[s++];return new Promise(function(l,h){n[o]=function(m){if(u)if(u=!1,m)h(m);else{for(var b=new Array(arguments.length-1),S=0;S<b.length;)b[S++]=arguments[S];l.apply(null,b)}};try{e.apply(t||null,n)}catch(p){u&&(u=!1,h(p))}})}return aspromise}var base64$1={},hasRequiredBase64;function requireBase64(){return hasRequiredBase64||(hasRequiredBase64=1,function(r){var e=r;e.length=function(f){var l=f.length;if(!l)return 0;for(var h=0;--l%4>1&&f.charAt(l)==="=";)++h;return Math.ceil(f.length*3)/4-h};for(var t=new Array(64),n=new Array(123),o=0;o<64;)n[t[o]=o<26?o+65:o<52?o+71:o<62?o-4:o-59|43]=o++;e.encode=function(f,l,h){for(var p=null,m=[],b=0,S=0,A;l<h;){var L=f[l++];switch(S){case 0:m[b++]=t[L>>2],A=(L&3)<<4,S=1;break;case 1:m[b++]=t[A|L>>4],A=(L&15)<<2,S=2;break;case 2:m[b++]=t[A|L>>6],m[b++]=t[L&63],S=0;break}b>8191&&((p||(p=[])).push(String.fromCharCode.apply(String,m)),b=0)}return S&&(m[b++]=t[A],m[b++]=61,S===1&&(m[b++]=61)),p?(b&&p.push(String.fromCharCode.apply(String,m.slice(0,b))),p.join("")):String.fromCharCode.apply(String,m.slice(0,b))};var s="invalid encoding";e.decode=function(f,l,h){for(var p=h,m=0,b,S=0;S<f.length;){var A=f.charCodeAt(S++);if(A===61&&m>1)break;if((A=n[A])===void 0)throw Error(s);switch(m){case 0:b=A,m=1;break;case 1:l[h++]=b<<2|(A&48)>>4,b=A,m=2;break;case 2:l[h++]=(b&15)<<4|(A&60)>>2,b=A,m=3;break;case 3:l[h++]=(b&3)<<6|A,m=0;break}}if(m===1)throw Error(s);return h-p},e.test=function(f){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(f)}}(base64$1)),base64$1}var eventemitter,hasRequiredEventemitter;function requireEventemitter(){if(hasRequiredEventemitter)return eventemitter;hasRequiredEventemitter=1,eventemitter=r;function r(){this._listeners={}}return r.prototype.on=function(t,n,o){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:n,ctx:o||this}),this},r.prototype.off=function(t,n){if(t===void 0)this._listeners={};else if(n===void 0)this._listeners[t]=[];else for(var o=this._listeners[t],s=0;s<o.length;)o[s].fn===n?o.splice(s,1):++s;return this},r.prototype.emit=function(t){var n=this._listeners[t];if(n){for(var o=[],s=1;s<arguments.length;)o.push(arguments[s++]);for(s=0;s<n.length;)n[s].fn.apply(n[s++].ctx,o)}return this},eventemitter}var float,hasRequiredFloat;function requireFloat(){if(hasRequiredFloat)return float;hasRequiredFloat=1,float=r(r);function r(s){return typeof Float32Array<"u"?function(){var u=new Float32Array([-0]),f=new Uint8Array(u.buffer),l=f[3]===128;function h(S,A,L){u[0]=S,A[L]=f[0],A[L+1]=f[1],A[L+2]=f[2],A[L+3]=f[3]}function p(S,A,L){u[0]=S,A[L]=f[3],A[L+1]=f[2],A[L+2]=f[1],A[L+3]=f[0]}s.writeFloatLE=l?h:p,s.writeFloatBE=l?p:h;function m(S,A){return f[0]=S[A],f[1]=S[A+1],f[2]=S[A+2],f[3]=S[A+3],u[0]}function b(S,A){return f[3]=S[A],f[2]=S[A+1],f[1]=S[A+2],f[0]=S[A+3],u[0]}s.readFloatLE=l?m:b,s.readFloatBE=l?b:m}():function(){function u(l,h,p,m){var b=h<0?1:0;if(b&&(h=-h),h===0)l(1/h>0?0:2147483648,p,m);else if(isNaN(h))l(2143289344,p,m);else if(h>34028234663852886e22)l((b<<31|2139095040)>>>0,p,m);else if(h<11754943508222875e-54)l((b<<31|Math.round(h/1401298464324817e-60))>>>0,p,m);else{var S=Math.floor(Math.log(h)/Math.LN2),A=Math.round(h*Math.pow(2,-S)*8388608)&8388607;l((b<<31|S+127<<23|A)>>>0,p,m)}}s.writeFloatLE=u.bind(null,e),s.writeFloatBE=u.bind(null,t);function f(l,h,p){var m=l(h,p),b=(m>>31)*2+1,S=m>>>23&255,A=m&8388607;return S===255?A?NaN:b*(1/0):S===0?b*1401298464324817e-60*A:b*Math.pow(2,S-150)*(A+8388608)}s.readFloatLE=f.bind(null,n),s.readFloatBE=f.bind(null,o)}(),typeof Float64Array<"u"?function(){var u=new Float64Array([-0]),f=new Uint8Array(u.buffer),l=f[7]===128;function h(S,A,L){u[0]=S,A[L]=f[0],A[L+1]=f[1],A[L+2]=f[2],A[L+3]=f[3],A[L+4]=f[4],A[L+5]=f[5],A[L+6]=f[6],A[L+7]=f[7]}function p(S,A,L){u[0]=S,A[L]=f[7],A[L+1]=f[6],A[L+2]=f[5],A[L+3]=f[4],A[L+4]=f[3],A[L+5]=f[2],A[L+6]=f[1],A[L+7]=f[0]}s.writeDoubleLE=l?h:p,s.writeDoubleBE=l?p:h;function m(S,A){return f[0]=S[A],f[1]=S[A+1],f[2]=S[A+2],f[3]=S[A+3],f[4]=S[A+4],f[5]=S[A+5],f[6]=S[A+6],f[7]=S[A+7],u[0]}function b(S,A){return f[7]=S[A],f[6]=S[A+1],f[5]=S[A+2],f[4]=S[A+3],f[3]=S[A+4],f[2]=S[A+5],f[1]=S[A+6],f[0]=S[A+7],u[0]}s.readDoubleLE=l?m:b,s.readDoubleBE=l?b:m}():function(){function u(l,h,p,m,b,S){var A=m<0?1:0;if(A&&(m=-m),m===0)l(0,b,S+h),l(1/m>0?0:2147483648,b,S+p);else if(isNaN(m))l(0,b,S+h),l(2146959360,b,S+p);else if(m>17976931348623157e292)l(0,b,S+h),l((A<<31|2146435072)>>>0,b,S+p);else{var L;if(m<22250738585072014e-324)L=m/5e-324,l(L>>>0,b,S+h),l((A<<31|L/4294967296)>>>0,b,S+p);else{var J=Math.floor(Math.log(m)/Math.LN2);J===1024&&(J=1023),L=m*Math.pow(2,-J),l(L*4503599627370496>>>0,b,S+h),l((A<<31|J+1023<<20|L*1048576&1048575)>>>0,b,S+p)}}}s.writeDoubleLE=u.bind(null,e,0,4),s.writeDoubleBE=u.bind(null,t,4,0);function f(l,h,p,m,b){var S=l(m,b+h),A=l(m,b+p),L=(A>>31)*2+1,J=A>>>20&2047,ne=4294967296*(A&1048575)+S;return J===2047?ne?NaN:L*(1/0):J===0?L*5e-324*ne:L*Math.pow(2,J-1075)*(ne+4503599627370496)}s.readDoubleLE=f.bind(null,n,0,4),s.readDoubleBE=f.bind(null,o,4,0)}(),s}function e(s,u,f){u[f]=s&255,u[f+1]=s>>>8&255,u[f+2]=s>>>16&255,u[f+3]=s>>>24}function t(s,u,f){u[f]=s>>>24,u[f+1]=s>>>16&255,u[f+2]=s>>>8&255,u[f+3]=s&255}function n(s,u){return(s[u]|s[u+1]<<8|s[u+2]<<16|s[u+3]<<24)>>>0}function o(s,u){return(s[u]<<24|s[u+1]<<16|s[u+2]<<8|s[u+3])>>>0}return float}var inquire_1,hasRequiredInquire;function requireInquire(){if(hasRequiredInquire)return inquire_1;hasRequiredInquire=1,inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(r){}return null}return inquire_1}var utf8$2={},hasRequiredUtf8;function requireUtf8(){return hasRequiredUtf8||(hasRequiredUtf8=1,function(r){var e=r;e.length=function(n){for(var o=0,s=0,u=0;u<n.length;++u)s=n.charCodeAt(u),s<128?o+=1:s<2048?o+=2:(s&64512)===55296&&(n.charCodeAt(u+1)&64512)===56320?(++u,o+=4):o+=3;return o},e.read=function(n,o,s){var u=s-o;if(u<1)return"";for(var f=null,l=[],h=0,p;o<s;)p=n[o++],p<128?l[h++]=p:p>191&&p<224?l[h++]=(p&31)<<6|n[o++]&63:p>239&&p<365?(p=((p&7)<<18|(n[o++]&63)<<12|(n[o++]&63)<<6|n[o++]&63)-65536,l[h++]=55296+(p>>10),l[h++]=56320+(p&1023)):l[h++]=(p&15)<<12|(n[o++]&63)<<6|n[o++]&63,h>8191&&((f||(f=[])).push(String.fromCharCode.apply(String,l)),h=0);return f?(h&&f.push(String.fromCharCode.apply(String,l.slice(0,h))),f.join("")):String.fromCharCode.apply(String,l.slice(0,h))},e.write=function(n,o,s){for(var u=s,f,l,h=0;h<n.length;++h)f=n.charCodeAt(h),f<128?o[s++]=f:f<2048?(o[s++]=f>>6|192,o[s++]=f&63|128):(f&64512)===55296&&((l=n.charCodeAt(h+1))&64512)===56320?(f=65536+((f&1023)<<10)+(l&1023),++h,o[s++]=f>>18|240,o[s++]=f>>12&63|128,o[s++]=f>>6&63|128,o[s++]=f&63|128):(o[s++]=f>>12|224,o[s++]=f>>6&63|128,o[s++]=f&63|128);return s-u}}(utf8$2)),utf8$2}var pool_1,hasRequiredPool;function requirePool(){if(hasRequiredPool)return pool_1;hasRequiredPool=1,pool_1=r;function r(e,t,n){var o=n||8192,s=o>>>1,u=null,f=o;return function(h){if(h<1||h>s)return e(h);f+h>o&&(u=e(o),f=0);var p=t.call(u,f,f+=h);return f&7&&(f=(f|7)+1),p}}return pool_1}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=e;var r=requireMinimal();function e(s,u){this.lo=s>>>0,this.hi=u>>>0}var t=e.zero=new e(0,0);t.toNumber=function(){return 0},t.zzEncode=t.zzDecode=function(){return this},t.length=function(){return 1};var n=e.zeroHash="\0\0\0\0\0\0\0\0";e.fromNumber=function(u){if(u===0)return t;var f=u<0;f&&(u=-u);var l=u>>>0,h=(u-l)/4294967296>>>0;return f&&(h=~h>>>0,l=~l>>>0,++l>4294967295&&(l=0,++h>4294967295&&(h=0))),new e(l,h)},e.from=function(u){if(typeof u=="number")return e.fromNumber(u);if(r.isString(u))if(r.Long)u=r.Long.fromString(u);else return e.fromNumber(parseInt(u,10));return u.low||u.high?new e(u.low>>>0,u.high>>>0):t},e.prototype.toNumber=function(u){if(!u&&this.hi>>>31){var f=~this.lo+1>>>0,l=~this.hi>>>0;return f||(l=l+1>>>0),-(f+l*4294967296)}return this.lo+this.hi*4294967296},e.prototype.toLong=function(u){return r.Long?new r.Long(this.lo|0,this.hi|0,Boolean(u)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(u)}};var o=String.prototype.charCodeAt;return e.fromHash=function(u){return u===n?t:new e((o.call(u,0)|o.call(u,1)<<8|o.call(u,2)<<16|o.call(u,3)<<24)>>>0,(o.call(u,4)|o.call(u,5)<<8|o.call(u,6)<<16|o.call(u,7)<<24)>>>0)},e.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},e.prototype.zzEncode=function(){var u=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^u)>>>0,this.lo=(this.lo<<1^u)>>>0,this},e.prototype.zzDecode=function(){var u=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^u)>>>0,this.hi=(this.hi>>>1^u)>>>0,this},e.prototype.length=function(){var u=this.lo,f=(this.lo>>>28|this.hi<<4)>>>0,l=this.hi>>>24;return l===0?f===0?u<16384?u<128?1:2:u<2097152?3:4:f<16384?f<128?5:6:f<2097152?7:8:l<128?9:10},longbits}var hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(r){var e=r;e.asPromise=requireAspromise(),e.base64=requireBase64(),e.EventEmitter=requireEventemitter(),e.float=requireFloat(),e.inquire=requireInquire(),e.utf8=requireUtf8(),e.pool=requirePool(),e.LongBits=requireLongbits(),e.isNode=Boolean(typeof commonjsGlobal<"u"&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),e.global=e.isNode&&commonjsGlobal||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal,e.emptyArray=Object.freeze?Object.freeze([]):[],e.emptyObject=Object.freeze?Object.freeze({}):{},e.isInteger=Number.isInteger||function(s){return typeof s=="number"&&isFinite(s)&&Math.floor(s)===s},e.isString=function(s){return typeof s=="string"||s instanceof String},e.isObject=function(s){return s&&typeof s=="object"},e.isset=e.isSet=function(s,u){var f=s[u];return f!=null&&s.hasOwnProperty(u)?typeof f!="object"||(Array.isArray(f)?f.length:Object.keys(f).length)>0:!1},e.Buffer=function(){try{var o=e.inquire("buffer").Buffer;return o.prototype.utf8Write?o:null}catch{return null}}(),e._Buffer_from=null,e._Buffer_allocUnsafe=null,e.newBuffer=function(s){return typeof s=="number"?e.Buffer?e._Buffer_allocUnsafe(s):new e.Array(s):e.Buffer?e._Buffer_from(s):typeof Uint8Array>"u"?s:new Uint8Array(s)},e.Array=typeof Uint8Array<"u"?Uint8Array:Array,e.Long=e.global.dcodeIO&&e.global.dcodeIO.Long||e.global.Long||e.inquire("long"),e.key2Re=/^true|false|0|1$/,e.key32Re=/^-?(?:0|[1-9][0-9]*)$/,e.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,e.longToHash=function(s){return s?e.LongBits.from(s).toHash():e.LongBits.zeroHash},e.longFromHash=function(s,u){var f=e.LongBits.fromHash(s);return e.Long?e.Long.fromBits(f.lo,f.hi,u):f.toNumber(Boolean(u))};function t(o,s,u){for(var f=Object.keys(s),l=0;l<f.length;++l)(o[f[l]]===void 0||!u)&&(o[f[l]]=s[f[l]]);return o}e.merge=t,e.lcFirst=function(s){return s.charAt(0).toLowerCase()+s.substring(1)};function n(o){function s(u,f){if(!(this instanceof s))return new s(u,f);Object.defineProperty(this,"message",{get:function(){return u}}),Error.captureStackTrace?Error.captureStackTrace(this,s):Object.defineProperty(this,"stack",{value:new Error().stack||""}),f&&t(this,f)}return s.prototype=Object.create(Error.prototype,{constructor:{value:s,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return o},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),s}e.newError=n,e.ProtocolError=n("ProtocolError"),e.oneOfGetter=function(s){for(var u={},f=0;f<s.length;++f)u[s[f]]=1;return function(){for(var l=Object.keys(this),h=l.length-1;h>-1;--h)if(u[l[h]]===1&&this[l[h]]!==void 0&&this[l[h]]!==null)return l[h]}},e.oneOfSetter=function(s){return function(u){for(var f=0;f<s.length;++f)s[f]!==u&&delete this[s[f]]}},e.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},e._configure=function(){var o=e.Buffer;if(!o){e._Buffer_from=e._Buffer_allocUnsafe=null;return}e._Buffer_from=o.from!==Uint8Array.from&&o.from||function(u,f){return new o(u,f)},e._Buffer_allocUnsafe=o.allocUnsafe||function(u){return new o(u)}}}(minimal)),minimal}var writer=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(r,e,t){this.fn=r,this.len=e,this.next=void 0,this.val=t}function noop$2(){}function State(r){this.head=r.head,this.tail=r.tail,this.len=r.len,this.next=r.states}function Writer$1(){this.len=0,this.head=new Op(noop$2,0,0),this.tail=this.head,this.states=null}var create$3=function r(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};Writer$1.create=create$3();Writer$1.alloc=function r(e){return new util$4.Array(e)};util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray));Writer$1.prototype._push=function r(e,t,n){return this.tail=this.tail.next=new Op(e,t,n),this.len+=t,this};function writeByte(r,e,t){e[t]=r&255}function writeVarint32(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}function VarintOp(r,e){this.len=r,this.next=void 0,this.val=e}VarintOp.prototype=Object.create(Op.prototype);VarintOp.prototype.fn=writeVarint32;Writer$1.prototype.uint32=function r(e){return this.len+=(this.tail=this.tail.next=new VarintOp((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};Writer$1.prototype.int32=function r(e){return e<0?this._push(writeVarint64,10,LongBits$1.fromNumber(e)):this.uint32(e)};Writer$1.prototype.sint32=function r(e){return this.uint32((e<<1^e>>31)>>>0)};function writeVarint64(r,e,t){for(;r.hi;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}Writer$1.prototype.uint64=function r(e){var t=LongBits$1.from(e);return this._push(writeVarint64,t.length(),t)};Writer$1.prototype.int64=Writer$1.prototype.uint64;Writer$1.prototype.sint64=function r(e){var t=LongBits$1.from(e).zzEncode();return this._push(writeVarint64,t.length(),t)};Writer$1.prototype.bool=function r(e){return this._push(writeByte,1,e?1:0)};function writeFixed32(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}Writer$1.prototype.fixed32=function r(e){return this._push(writeFixed32,4,e>>>0)};Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32;Writer$1.prototype.fixed64=function r(e){var t=LongBits$1.from(e);return this._push(writeFixed32,4,t.lo)._push(writeFixed32,4,t.hi)};Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64;Writer$1.prototype.float=function r(e){return this._push(util$4.float.writeFloatLE,4,e)};Writer$1.prototype.double=function r(e){return this._push(util$4.float.writeDoubleLE,8,e)};var writeBytes=util$4.Array.prototype.set?function r(e,t,n){t.set(e,n)}:function r(e,t,n){for(var o=0;o<e.length;++o)t[n+o]=e[o]};Writer$1.prototype.bytes=function r(e){var t=e.length>>>0;if(!t)return this._push(writeByte,1,0);if(util$4.isString(e)){var n=Writer$1.alloc(t=base64.length(e));base64.decode(e,n,0),e=n}return this.uint32(t)._push(writeBytes,t,e)};Writer$1.prototype.string=function r(e){var t=utf8$1.length(e);return t?this.uint32(t)._push(utf8$1.write,t,e):this._push(writeByte,1,0)};Writer$1.prototype.fork=function r(){return this.states=new State(this),this.head=this.tail=new Op(noop$2,0,0),this.len=0,this};Writer$1.prototype.reset=function r(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop$2,0,0),this.len=0),this};Writer$1.prototype.ldelim=function r(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this};Writer$1.prototype.finish=function r(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t};Writer$1._configure=function(r){BufferWriter$1=r,Writer$1.create=create$3(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&util$3.Buffer.prototype.set.name==="set"?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var o=0;o<e.length;)t[n++]=e[o++]}};BufferWriter.prototype.bytes=function r(e){util$3.isString(e)&&(e=util$3._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(BufferWriter.writeBytesBuffer,t,e),this};function writeStringBuffer(r,e,t){r.length<40?util$3.utf8.write(r,e,t):e.utf8Write?e.utf8Write(r,t):e.write(r,t)}BufferWriter.prototype.string=function r(e){var t=util$3.Buffer.byteLength(e);return this.uint32(t),t&&this._push(writeStringBuffer,t,e),this};BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(r,e){return RangeError("index out of range: "+r.pos+" + "+(e||1)+" > "+r.len)}function Reader$1(r){this.buf=r,this.pos=0,this.len=r.length}var create_array=typeof Uint8Array<"u"?function r(e){if(e instanceof Uint8Array||Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")}:function r(e){if(Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")},create$2=function r(){return util$2.Buffer?function(t){return(Reader$1.create=function(o){return util$2.Buffer.isBuffer(o)?new BufferReader$1(o):create_array(o)})(t)}:create_array};Reader$1.create=create$2();Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice;Reader$1.prototype.uint32=function r(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return e}}();Reader$1.prototype.int32=function r(){return this.uint32()|0};Reader$1.prototype.sint32=function r(){var e=this.uint32();return e>>>1^-(e&1)|0};function readLongVarint(){var r=new LongBits(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r;if(r.lo=(r.lo|(this.buf[this.pos]&127)<<28)>>>0,r.hi=(r.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return r;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw indexOutOfRange(this);if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r}return r.lo=(r.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,r}if(this.len-this.pos>4){for(;e<5;++e)if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}else for(;e<5;++e){if(this.pos>=this.len)throw indexOutOfRange(this);if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}throw Error("invalid varint encoding")}Reader$1.prototype.bool=function r(){return this.uint32()!==0};function readFixed32_end(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}Reader$1.prototype.fixed32=function r(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)};Reader$1.prototype.sfixed32=function r(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)|0};function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.prototype.float=function r(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};Reader$1.prototype.double=function r(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};Reader$1.prototype.bytes=function r(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw indexOutOfRange(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)};Reader$1.prototype.string=function r(){var e=this.bytes();return utf8.read(e,0,e.length)};Reader$1.prototype.skip=function r(e){if(typeof e=="number"){if(this.pos+e>this.len)throw indexOutOfRange(this,e);this.pos+=e}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this};Reader$1.prototype.skipType=function(r){switch(r){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(r=this.uint32()&7)!==4;)this.skipType(r);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+r+" at offset "+this.pos)}return this};Reader$1._configure=function(r){BufferReader$1=r,Reader$1.create=create$2(),BufferReader$1._configure();var e=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[e](!1)},uint64:function(){return readLongVarint.call(this)[e](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[e](!1)},fixed64:function(){return readFixed64.call(this)[e](!0)},sfixed64:function(){return readFixed64.call(this)[e](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(r){Reader.call(this,r)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)};BufferReader.prototype.string=function r(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};BufferReader._configure();var rpc={},service=Service,util=requireMinimal();(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service;function Service(r,e,t){if(typeof r!="function")throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=r,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(t)}Service.prototype.rpcCall=function r(e,t,n,o,s){if(!o)throw TypeError("request must be specified");var u=this;if(!s)return util.asPromise(r,u,e,t,n,o);if(!u.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return u.rpcImpl(e,t[u.requestDelimited?"encodeDelimited":"encode"](o).finish(),function(l,h){if(l)return u.emit("error",l,e),s(l);if(h===null){u.end(!0);return}if(!(h instanceof n))try{h=n[u.responseDelimited?"decodeDelimited":"decode"](h)}catch(p){return u.emit("error",p,e),s(p)}return u.emit("data",h,e),s(null,h)})}catch(f){u.emit("error",f,e),setTimeout(function(){s(f)},0);return}};Service.prototype.end=function r(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};(function(r){var e=r;e.Service=service})(rpc);var roots={};(function(r){var e=r;e.build="minimal",e.Writer=writer,e.BufferWriter=writer_buffer,e.Reader=reader,e.BufferReader=reader_buffer,e.util=requireMinimal(),e.rpc=rpc,e.roots=roots,e.configure=t;function t(){e.util._configure(),e.Writer._configure(e.BufferWriter),e.Reader._configure(e.BufferReader)}t()})(indexMinimal);(function(r){r.exports=indexMinimal})(minimal$1);const $protobuf=getDefaultExportFromCjs(minimalExports),$Reader$5=$protobuf.Reader,$Writer$5=$protobuf.Writer;$protobuf.util;const $root$5=$protobuf.roots.default||($protobuf.roots.default={}),ipfs=$root$5.ipfs=(()=>{const r={};return r.pin=function(){const e={};return e.Set=function(){function t(n){if(n)for(var o=Object.keys(n),s=0;s<o.length;++s)n[o[s]]!=null&&(this[o[s]]=n[o[s]])}return t.prototype.version=0,t.prototype.fanout=0,t.prototype.seed=0,t.encode=function(o,s){return s||(s=$Writer$5.create()),o.version!=null&&Object.hasOwnProperty.call(o,"version")&&s.uint32(8).uint32(o.version),o.fanout!=null&&Object.hasOwnProperty.call(o,"fanout")&&s.uint32(16).uint32(o.fanout),o.seed!=null&&Object.hasOwnProperty.call(o,"seed")&&s.uint32(29).fixed32(o.seed),s},t.decode=function(o,s){o instanceof $Reader$5||(o=$Reader$5.create(o));for(var u=s===void 0?o.len:o.pos+s,f=new $root$5.ipfs.pin.Set;o.pos<u;){var l=o.uint32();switch(l>>>3){case 1:f.version=o.uint32();break;case 2:f.fanout=o.uint32();break;case 3:f.seed=o.fixed32();break;default:o.skipType(l&7);break}}return f},t.fromObject=function(o){if(o instanceof $root$5.ipfs.pin.Set)return o;var s=new $root$5.ipfs.pin.Set;return o.version!=null&&(s.version=o.version>>>0),o.fanout!=null&&(s.fanout=o.fanout>>>0),o.seed!=null&&(s.seed=o.seed>>>0),s},t.toObject=function(o,s){s||(s={});var u={};return s.defaults&&(u.version=0,u.fanout=0,u.seed=0),o.version!=null&&o.hasOwnProperty("version")&&(u.version=o.version),o.fanout!=null&&o.hasOwnProperty("fanout")&&(u.fanout=o.fanout),o.seed!=null&&o.hasOwnProperty("seed")&&(u.seed=o.seed),u},t.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},t}(),e}(),r})();var fnv1aExports={},fnv1a$1={get exports(){return fnv1aExports},set exports(r){fnv1aExports=r}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),t.BASE=2166136261;function t(n,o=t.BASE){const s=n.length;for(let u=0;u<s;u++)o^=n.charCodeAt(u),o+=(o<<1)+(o<<4)+(o<<7)+(o<<8)+(o<<24);return o>>>0}e.default=t,r.exports=t})(fnv1a$1,fnv1aExports);const fnv1a=getDefaultExportFromCjs(fnv1aExports),PIN_DS_KEY=new Key("/local/pins"),DEFAULT_FANOUT=256,MAX_ITEMS=8192,EMPTY_KEY=CID$1.parse("QmdfTbBqBPQ7VNxZEYEj14VmRuZBkqFbiwReogJgS1zR1n"),PinTypes$1={direct:"direct",recursive:"recursive"};function cidToKey$2(r){return new Key(`/${base32$2.encode(r.multihash.bytes).toUpperCase().substring(1)}`)}function compare(r,e){for(let t=0;t<r.byteLength;t++){if(r[t]<e[t])return-1;if(r[t]>e[t])return 1}return r.byteLength>e.byteLength?1:r.byteLength<e.byteLength?-1:0}const PinSet=ipfs.pin.Set;function readHeader(r){const e=r.Data;if(!e)throw new Error("No data present");const t=varint.decode(e),n=varint.decode.bytes;if(n<=0)throw new Error("Invalid Set header length");if(n+t>e.length)throw new Error("Impossibly large set header length");const o=e.slice(n,t+n),s=PinSet.toObject(PinSet.decode(o),{defaults:!1,arrays:!0,longs:Number,objects:!1});if(s.version!==1)throw new Error(`Unsupported Set version: ${s.version}`);if(s.fanout>r.Links.length)throw new Error("Impossibly large fanout");return{header:s,data:e.slice(t+n)}}function hash(r,e){const t=new Uint8Array(4);new DataView(t.buffer).setUint32(0,r,!0);const o=fromString$1(e.toString()),s=concat([t,o],t.byteLength+o.byteLength);return fnv1a(toString$2(s))}async function*walkItems(r,e){const t=readHeader(e);let n=0;for(const o of e.Links){if(n<t.header.fanout){const s=o.Hash;if(!EMPTY_KEY.equals(s)){const u=await r.get(s),f=decode$4(u);yield*walkItems(r,f)}}else yield o.Hash;n++}}async function*loadSet(r,e,t){const n=e.Links.find(u=>u.Name===t);if(!n)throw new Error("No link found with name "+t);const o=await r.get(n.Hash),s=decode$4(o);yield*walkItems(r,s)}function storeItems(r,e){return t(e,0);async function t(n,o){const s=PinSet.encode({version:1,fanout:DEFAULT_FANOUT,seed:o}).finish(),u=varint.encode(s.length),f=concat([u,s]),l=[];for(let p=0;p<DEFAULT_FANOUT;p++)l.push({Name:"",Tsize:1,Hash:EMPTY_KEY});if(n.length<=MAX_ITEMS){const p=n.map(S=>({link:{Name:"",Tsize:1,Hash:S.key},data:S.data||new Uint8Array})).sort((S,A)=>compare(S.link.Hash.bytes,A.link.Hash.bytes)),m=l.concat(p.map(S=>S.link));return{Data:concat([f,...p.map(S=>S.data)]),Links:m}}else{const p=n.reduce((b,S)=>{const A=hash(o,S.key)%DEFAULT_FANOUT;return b[A]=A in b?b[A].concat([S]):[S],b},[]);let m=0;for(const b of p){const S=await t(b,o+1);await h(S,m),m++}return{Data:f,Links:l}}async function h(p,m){const b=encode$6(p),S=await sha256.digest(b),A=CID$1.createV0(S);await r.put(A,b);const L=p.Links.reduce((J,ne)=>J+(ne.Tsize||0),0)+b.length;l[m]={Name:"",Tsize:L,Hash:A}}}}async function storeSet(r,e,t){const n=await storeItems(r,t.map(l=>({key:l}))),o=encode$6(n),s=await sha256.digest(o),u=CID$1.createV0(s);await r.put(u,o);const f=n.Links.reduce((l,h)=>l+h.Tsize,0)+o.length;return{Name:e,Tsize:f,Hash:u}}async function pinsToDatastore(r,e,t,n){if(!await e.has(PIN_DS_KEY))return;const o=await e.get(PIN_DS_KEY),s=CID$1.decode(o),u=await r.get(s),f=decode$4(u);let l=0;const h=await length(loadSet(r,f,PinTypes$1.recursive))+await length(loadSet(r,f,PinTypes$1.direct));for await(const p of loadSet(r,f,PinTypes$1.recursive)){l++;const m={depth:1/0};p.version!==0&&(m.version=p.version),p.code!==code$3&&(m.codec=p.code),await t.put(cidToKey$2(p),encode$a(m)),n(l/h*100,`Migrated recursive pin ${p}`)}for await(const p of loadSet(r,f,PinTypes$1.direct)){l++;const m={depth:0};p.version!==0&&(m.version=p.version),p.code!==code$3&&(m.codec=p.code),await t.put(cidToKey$2(p),encode$a(m)),n(l/h*100,`Migrated direct pin ${p}`)}await r.delete(s),await e.delete(PIN_DS_KEY)}async function pinsToDAG(r,e,t,n){const o=[],s=[];let u=0;const f=await length(t.queryKeys({}));for await(const{key:b,value:S}of t.query({})){u++;const A=decode$a(S),L=CID$1.create(A.version||0,A.codec||code$3,decode$d(base32$2.decode("b"+b.toString().toLowerCase().split("/").pop())));A.depth===0?(n(u/f*100,`Reverted direct pin ${L}`),s.push(L)):(n(u/f*100,`Reverted recursive pin ${L}`),o.push(L))}n(100,"Updating pin root");const l={Links:[await storeSet(r,PinTypes$1.direct,s),await storeSet(r,PinTypes$1.recursive,o)]},h=encode$6(l),p=await sha256.digest(h),m=CID$1.createV0(p);await r.put(m,h),await e.put(PIN_DS_KEY,m.bytes)}async function process$2(r,e,t){const n=r.blocks,o=r.datastore,s=r.pins;await n.open(),await o.open(),await s.open();try{await t(n,o,s,e)}finally{await s.close(),await o.close(),await n.close()}}const migration$3={version:9,description:"Migrates pins to datastore",migrate:(r,e=()=>{})=>process$2(r,e,pinsToDatastore),revert:(r,e=()=>{})=>process$2(r,e,pinsToDAG)};function dbOpenFailedError(r){return r=r||new Error("Cannot open database"),errCode(r,"ERR_DB_OPEN_FAILED")}function dbDeleteFailedError(r){return r=r||new Error("Delete failed"),errCode(r,"ERR_DB_DELETE_FAILED")}function dbWriteFailedError(r){return r=r||new Error("Write failed"),errCode(r,"ERR_DB_WRITE_FAILED")}function notFoundError(r){return r=r||new Error("Not Found"),errCode(r,"ERR_NOT_FOUND")}const CONFIG_KEY=new Key("/config"),VERSION_KEY=new Key("/version");function findLevelJs$1(r){let e=r;for(;e.db||e.child;)if(e=e.db||e.child,e.type==="level-js"||e.constructor.name==="Level")return e}async function hasWithFallback$1(r,e,t){const n=await e(r);if(n)return n;const o=findLevelJs$1(t);return o?new Promise((s,u)=>{const f=o.store("readonly").get(r.toString());f.transaction.onabort=()=>{u(f.transaction.error)},f.transaction.oncomplete=()=>{s(Boolean(f.result))}}):!1}async function getWithFallback$1(r,e,t,n){if(await t(r))return e(r);const o=findLevelJs$1(n);if(!o)throw notFoundError();return new Promise((s,u)=>{const f=o.store("readonly").get(r.toString());f.transaction.onabort=()=>{u(f.transaction.error)},f.transaction.oncomplete=()=>{if(f.result)return s(f.result);u(notFoundError())}})}function wrapStore(r){const e=r.get.bind(r),t=r.has.bind(r);return r.get=n=>getWithFallback$1(n,e,t,r),r.has=n=>hasWithFallback$1(n,t,r),r}function wrapBackends(r){return{...r,root:wrapStore(r.root),datastore:wrapStore(r.datastore),pins:wrapStore(r.pins),keys:wrapStore(r.keys)}}async function keysToBinary(r,e,t=()=>{}){const n=findLevelJs$1(e);if(!n){t(`${r} did not need an upgrade`);return}t(`Upgrading ${r}`),await withEach(n,(s,u)=>[{type:"del",key:s},{type:"put",key:fromString$1(s),value:u}])}async function keysToStrings(r,e,t=()=>{}){const n=findLevelJs$1(e);if(!n){t(`${r} did not need a downgrade`);return}t(`Downgrading ${r}`),await withEach(n,(s,u)=>[{type:"del",key:s},{type:"put",key:toString$2(s),value:u}])}function unwrap(r){return r.child?unwrap(r.child):r}async function process$1(r,e,t){const n=Object.entries(r).map(([u,f])=>({key:u,backend:unwrap(f)})).filter(({key:u,backend:f})=>f.constructor.name==="LevelDatastore").map(({key:u,backend:f})=>({name:u,store:f}));e(0,`Migrating ${n.length} dbs`);let o=0;const s=u=>{e(Math.round(o/n.length*100),u)};for(const{name:u,store:f}of n){await f.open();try{await t(u,f,s)}finally{o++,await f.close()}}e(100,`Migrated ${n.length} dbs`)}const migration$2={version:10,description:"Migrates datastore-level keys to binary",migrate:(r,e=()=>{})=>process$1(r,e,keysToBinary),revert:(r,e=()=>{})=>process$1(r,e,keysToStrings)};function withEach(r,e){function t(n,o){const s=r.store("readwrite"),u=s.transaction;let f=0,l;u.onabort=()=>o(l||u.error||new Error("aborted by user")),u.oncomplete=()=>o();function h(){const p=n[f++],m=p.key;let b;try{b=p.type==="del"?s.delete(m):s.put(p.value,m)}catch(S){l=S,u.abort();return}f<n.length&&(b.onsuccess=h)}h()}return new Promise((n,o)=>{const s=r.iterator(),u=l=>l;s._deserializeKey=s._deserializeValue=u,f();function f(){const l=(h,p,m)=>{if(h||p===void 0){const b=S=>{if(S){o(S);return}n()};s.end(b);return}t(e(p,m),f)};s.next(l)}})}const MFS_ROOT_KEY$1=new Key("/local/filesroot");async function storeMfsRootInDatastore(r,e=()=>{}){if(e(100,"Migrating MFS root to repo datastore"),await r.root.open(),await r.datastore.open(),await r.root.has(MFS_ROOT_KEY$1)){const t=await r.root.get(MFS_ROOT_KEY$1);await r.datastore.put(MFS_ROOT_KEY$1,t),await r.root.delete(MFS_ROOT_KEY$1)}await r.datastore.close(),await r.root.close(),e(100,"Stored MFS root in repo datastore")}async function storeMfsRootInRoot(r,e=()=>{}){if(e(100,"Migrating MFS root to repo root datastore"),await r.root.open(),await r.datastore.open(),await r.datastore.has(MFS_ROOT_KEY$1)){const t=await r.datastore.get(MFS_ROOT_KEY$1);await r.root.put(MFS_ROOT_KEY$1,t),await r.datastore.delete(MFS_ROOT_KEY$1)}await r.datastore.close(),await r.root.close(),e(100,"Stored MFS root in repo root datastore")}const migration$1={version:11,description:"Store mfs root in the datastore",migrate:storeMfsRootInDatastore,revert:storeMfsRootInRoot},$Reader$4=$protobuf.Reader,$Writer$4=$protobuf.Writer,$util$4=$protobuf.util,$root$4=$protobuf.roots.default||($protobuf.roots.default={}),Protocols=$root$4.Protocols=(()=>{function r(e){if(this.protocols=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.protocols=$util$4.emptyArray,r.encode=function(t,n){if(n||(n=$Writer$4.create()),t.protocols!=null&&t.protocols.length)for(var o=0;o<t.protocols.length;++o)n.uint32(10).string(t.protocols[o]);return n},r.decode=function(t,n){t instanceof $Reader$4||(t=$Reader$4.create(t));for(var o=n===void 0?t.len:t.pos+n,s=new $root$4.Protocols;t.pos<o;){var u=t.uint32();switch(u>>>3){case 1:s.protocols&&s.protocols.length||(s.protocols=[]),s.protocols.push(t.string());break;default:t.skipType(u&7);break}}return s},r.fromObject=function(t){if(t instanceof $root$4.Protocols)return t;var n=new $root$4.Protocols;if(t.protocols){if(!Array.isArray(t.protocols))throw TypeError(".Protocols.protocols: array expected");n.protocols=[];for(var o=0;o<t.protocols.length;++o)n.protocols[o]=String(t.protocols[o])}return n},r.toObject=function(t,n){n||(n={});var o={};if((n.arrays||n.defaults)&&(o.protocols=[]),t.protocols&&t.protocols.length){o.protocols=[];for(var s=0;s<t.protocols.length;++s)o.protocols[s]=t.protocols[s]}return o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r})(),$Reader$3=$protobuf.Reader,$Writer$3=$protobuf.Writer,$util$3=$protobuf.util,$root$3=$protobuf.roots.default||($protobuf.roots.default={}),Addresses=$root$3.Addresses=(()=>{function r(e){if(this.addrs=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.addrs=$util$3.emptyArray,r.prototype.certifiedRecord=null,r.encode=function(t,n){if(n||(n=$Writer$3.create()),t.addrs!=null&&t.addrs.length)for(var o=0;o<t.addrs.length;++o)$root$3.Addresses.Address.encode(t.addrs[o],n.uint32(10).fork()).ldelim();return t.certifiedRecord!=null&&Object.hasOwnProperty.call(t,"certifiedRecord")&&$root$3.Addresses.CertifiedRecord.encode(t.certifiedRecord,n.uint32(18).fork()).ldelim(),n},r.decode=function(t,n){t instanceof $Reader$3||(t=$Reader$3.create(t));for(var o=n===void 0?t.len:t.pos+n,s=new $root$3.Addresses;t.pos<o;){var u=t.uint32();switch(u>>>3){case 1:s.addrs&&s.addrs.length||(s.addrs=[]),s.addrs.push($root$3.Addresses.Address.decode(t,t.uint32()));break;case 2:s.certifiedRecord=$root$3.Addresses.CertifiedRecord.decode(t,t.uint32());break;default:t.skipType(u&7);break}}return s},r.fromObject=function(t){if(t instanceof $root$3.Addresses)return t;var n=new $root$3.Addresses;if(t.addrs){if(!Array.isArray(t.addrs))throw TypeError(".Addresses.addrs: array expected");n.addrs=[];for(var o=0;o<t.addrs.length;++o){if(typeof t.addrs[o]!="object")throw TypeError(".Addresses.addrs: object expected");n.addrs[o]=$root$3.Addresses.Address.fromObject(t.addrs[o])}}if(t.certifiedRecord!=null){if(typeof t.certifiedRecord!="object")throw TypeError(".Addresses.certifiedRecord: object expected");n.certifiedRecord=$root$3.Addresses.CertifiedRecord.fromObject(t.certifiedRecord)}return n},r.toObject=function(t,n){n||(n={});var o={};if((n.arrays||n.defaults)&&(o.addrs=[]),n.defaults&&(o.certifiedRecord=null),t.addrs&&t.addrs.length){o.addrs=[];for(var s=0;s<t.addrs.length;++s)o.addrs[s]=$root$3.Addresses.Address.toObject(t.addrs[s],n)}return t.certifiedRecord!=null&&t.hasOwnProperty("certifiedRecord")&&(o.certifiedRecord=$root$3.Addresses.CertifiedRecord.toObject(t.certifiedRecord,n)),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r.Address=function(){function e(n){if(n)for(var o=Object.keys(n),s=0;s<o.length;++s)n[o[s]]!=null&&(this[o[s]]=n[o[s]])}e.prototype.multiaddr=$util$3.newBuffer([]),e.prototype.isCertified=null;let t;return Object.defineProperty(e.prototype,"_isCertified",{get:$util$3.oneOfGetter(t=["isCertified"]),set:$util$3.oneOfSetter(t)}),e.encode=function(o,s){return s||(s=$Writer$3.create()),o.multiaddr!=null&&Object.hasOwnProperty.call(o,"multiaddr")&&s.uint32(10).bytes(o.multiaddr),o.isCertified!=null&&Object.hasOwnProperty.call(o,"isCertified")&&s.uint32(16).bool(o.isCertified),s},e.decode=function(o,s){o instanceof $Reader$3||(o=$Reader$3.create(o));for(var u=s===void 0?o.len:o.pos+s,f=new $root$3.Addresses.Address;o.pos<u;){var l=o.uint32();switch(l>>>3){case 1:f.multiaddr=o.bytes();break;case 2:f.isCertified=o.bool();break;default:o.skipType(l&7);break}}return f},e.fromObject=function(o){if(o instanceof $root$3.Addresses.Address)return o;var s=new $root$3.Addresses.Address;return o.multiaddr!=null&&(typeof o.multiaddr=="string"?$util$3.base64.decode(o.multiaddr,s.multiaddr=$util$3.newBuffer($util$3.base64.length(o.multiaddr)),0):o.multiaddr.length&&(s.multiaddr=o.multiaddr)),o.isCertified!=null&&(s.isCertified=Boolean(o.isCertified)),s},e.toObject=function(o,s){s||(s={});var u={};return s.defaults&&(s.bytes===String?u.multiaddr="":(u.multiaddr=[],s.bytes!==Array&&(u.multiaddr=$util$3.newBuffer(u.multiaddr)))),o.multiaddr!=null&&o.hasOwnProperty("multiaddr")&&(u.multiaddr=s.bytes===String?$util$3.base64.encode(o.multiaddr,0,o.multiaddr.length):s.bytes===Array?Array.prototype.slice.call(o.multiaddr):o.multiaddr),o.isCertified!=null&&o.hasOwnProperty("isCertified")&&(u.isCertified=o.isCertified,s.oneofs&&(u._isCertified="isCertified")),u},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),r.CertifiedRecord=function(){function e(t){if(t)for(var n=Object.keys(t),o=0;o<n.length;++o)t[n[o]]!=null&&(this[n[o]]=t[n[o]])}return e.prototype.seq=$util$3.Long?$util$3.Long.fromBits(0,0,!0):0,e.prototype.raw=$util$3.newBuffer([]),e.encode=function(n,o){return o||(o=$Writer$3.create()),n.seq!=null&&Object.hasOwnProperty.call(n,"seq")&&o.uint32(8).uint64(n.seq),n.raw!=null&&Object.hasOwnProperty.call(n,"raw")&&o.uint32(18).bytes(n.raw),o},e.decode=function(n,o){n instanceof $Reader$3||(n=$Reader$3.create(n));for(var s=o===void 0?n.len:n.pos+o,u=new $root$3.Addresses.CertifiedRecord;n.pos<s;){var f=n.uint32();switch(f>>>3){case 1:u.seq=n.uint64();break;case 2:u.raw=n.bytes();break;default:n.skipType(f&7);break}}return u},e.fromObject=function(n){if(n instanceof $root$3.Addresses.CertifiedRecord)return n;var o=new $root$3.Addresses.CertifiedRecord;return n.seq!=null&&($util$3.Long?(o.seq=$util$3.Long.fromValue(n.seq)).unsigned=!0:typeof n.seq=="string"?o.seq=parseInt(n.seq,10):typeof n.seq=="number"?o.seq=n.seq:typeof n.seq=="object"&&(o.seq=new $util$3.LongBits(n.seq.low>>>0,n.seq.high>>>0).toNumber(!0))),n.raw!=null&&(typeof n.raw=="string"?$util$3.base64.decode(n.raw,o.raw=$util$3.newBuffer($util$3.base64.length(n.raw)),0):n.raw.length&&(o.raw=n.raw)),o},e.toObject=function(n,o){o||(o={});var s={};if(o.defaults){if($util$3.Long){var u=new $util$3.Long(0,0,!0);s.seq=o.longs===String?u.toString():o.longs===Number?u.toNumber():u}else s.seq=o.longs===String?"0":0;o.bytes===String?s.raw="":(s.raw=[],o.bytes!==Array&&(s.raw=$util$3.newBuffer(s.raw)))}return n.seq!=null&&n.hasOwnProperty("seq")&&(typeof n.seq=="number"?s.seq=o.longs===String?String(n.seq):n.seq:s.seq=o.longs===String?$util$3.Long.prototype.toString.call(n.seq):o.longs===Number?new $util$3.LongBits(n.seq.low>>>0,n.seq.high>>>0).toNumber(!0):n.seq),n.raw!=null&&n.hasOwnProperty("raw")&&(s.raw=o.bytes===String?$util$3.base64.encode(n.raw,0,n.raw.length):o.bytes===Array?Array.prototype.slice.call(n.raw):n.raw),s},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),r})(),$Reader$2=$protobuf.Reader,$Writer$2=$protobuf.Writer,$util$2=$protobuf.util,$root$2=$protobuf.roots.default||($protobuf.roots.default={}),Peer=$root$2.Peer=(()=>{function r(t){if(this.addresses=[],this.protocols=[],this.metadata=[],t)for(var n=Object.keys(t),o=0;o<n.length;++o)t[n[o]]!=null&&(this[n[o]]=t[n[o]])}r.prototype.addresses=$util$2.emptyArray,r.prototype.protocols=$util$2.emptyArray,r.prototype.metadata=$util$2.emptyArray,r.prototype.pubKey=null,r.prototype.peerRecordEnvelope=null;let e;return Object.defineProperty(r.prototype,"_pubKey",{get:$util$2.oneOfGetter(e=["pubKey"]),set:$util$2.oneOfSetter(e)}),Object.defineProperty(r.prototype,"_peerRecordEnvelope",{get:$util$2.oneOfGetter(e=["peerRecordEnvelope"]),set:$util$2.oneOfSetter(e)}),r.encode=function(n,o){if(o||(o=$Writer$2.create()),n.addresses!=null&&n.addresses.length)for(var s=0;s<n.addresses.length;++s)$root$2.Address.encode(n.addresses[s],o.uint32(10).fork()).ldelim();if(n.protocols!=null&&n.protocols.length)for(var s=0;s<n.protocols.length;++s)o.uint32(18).string(n.protocols[s]);if(n.metadata!=null&&n.metadata.length)for(var s=0;s<n.metadata.length;++s)$root$2.Metadata.encode(n.metadata[s],o.uint32(26).fork()).ldelim();return n.pubKey!=null&&Object.hasOwnProperty.call(n,"pubKey")&&o.uint32(34).bytes(n.pubKey),n.peerRecordEnvelope!=null&&Object.hasOwnProperty.call(n,"peerRecordEnvelope")&&o.uint32(42).bytes(n.peerRecordEnvelope),o},r.decode=function(n,o){n instanceof $Reader$2||(n=$Reader$2.create(n));for(var s=o===void 0?n.len:n.pos+o,u=new $root$2.Peer;n.pos<s;){var f=n.uint32();switch(f>>>3){case 1:u.addresses&&u.addresses.length||(u.addresses=[]),u.addresses.push($root$2.Address.decode(n,n.uint32()));break;case 2:u.protocols&&u.protocols.length||(u.protocols=[]),u.protocols.push(n.string());break;case 3:u.metadata&&u.metadata.length||(u.metadata=[]),u.metadata.push($root$2.Metadata.decode(n,n.uint32()));break;case 4:u.pubKey=n.bytes();break;case 5:u.peerRecordEnvelope=n.bytes();break;default:n.skipType(f&7);break}}return u},r.fromObject=function(n){if(n instanceof $root$2.Peer)return n;var o=new $root$2.Peer;if(n.addresses){if(!Array.isArray(n.addresses))throw TypeError(".Peer.addresses: array expected");o.addresses=[];for(var s=0;s<n.addresses.length;++s){if(typeof n.addresses[s]!="object")throw TypeError(".Peer.addresses: object expected");o.addresses[s]=$root$2.Address.fromObject(n.addresses[s])}}if(n.protocols){if(!Array.isArray(n.protocols))throw TypeError(".Peer.protocols: array expected");o.protocols=[];for(var s=0;s<n.protocols.length;++s)o.protocols[s]=String(n.protocols[s])}if(n.metadata){if(!Array.isArray(n.metadata))throw TypeError(".Peer.metadata: array expected");o.metadata=[];for(var s=0;s<n.metadata.length;++s){if(typeof n.metadata[s]!="object")throw TypeError(".Peer.metadata: object expected");o.metadata[s]=$root$2.Metadata.fromObject(n.metadata[s])}}return n.pubKey!=null&&(typeof n.pubKey=="string"?$util$2.base64.decode(n.pubKey,o.pubKey=$util$2.newBuffer($util$2.base64.length(n.pubKey)),0):n.pubKey.length&&(o.pubKey=n.pubKey)),n.peerRecordEnvelope!=null&&(typeof n.peerRecordEnvelope=="string"?$util$2.base64.decode(n.peerRecordEnvelope,o.peerRecordEnvelope=$util$2.newBuffer($util$2.base64.length(n.peerRecordEnvelope)),0):n.peerRecordEnvelope.length&&(o.peerRecordEnvelope=n.peerRecordEnvelope)),o},r.toObject=function(n,o){o||(o={});var s={};if((o.arrays||o.defaults)&&(s.addresses=[],s.protocols=[],s.metadata=[]),n.addresses&&n.addresses.length){s.addresses=[];for(var u=0;u<n.addresses.length;++u)s.addresses[u]=$root$2.Address.toObject(n.addresses[u],o)}if(n.protocols&&n.protocols.length){s.protocols=[];for(var u=0;u<n.protocols.length;++u)s.protocols[u]=n.protocols[u]}if(n.metadata&&n.metadata.length){s.metadata=[];for(var u=0;u<n.metadata.length;++u)s.metadata[u]=$root$2.Metadata.toObject(n.metadata[u],o)}return n.pubKey!=null&&n.hasOwnProperty("pubKey")&&(s.pubKey=o.bytes===String?$util$2.base64.encode(n.pubKey,0,n.pubKey.length):o.bytes===Array?Array.prototype.slice.call(n.pubKey):n.pubKey,o.oneofs&&(s._pubKey="pubKey")),n.peerRecordEnvelope!=null&&n.hasOwnProperty("peerRecordEnvelope")&&(s.peerRecordEnvelope=o.bytes===String?$util$2.base64.encode(n.peerRecordEnvelope,0,n.peerRecordEnvelope.length):o.bytes===Array?Array.prototype.slice.call(n.peerRecordEnvelope):n.peerRecordEnvelope,o.oneofs&&(s._peerRecordEnvelope="peerRecordEnvelope")),s},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r})();$root$2.Address=(()=>{function r(t){if(t)for(var n=Object.keys(t),o=0;o<n.length;++o)t[n[o]]!=null&&(this[n[o]]=t[n[o]])}r.prototype.multiaddr=$util$2.newBuffer([]),r.prototype.isCertified=null;let e;return Object.defineProperty(r.prototype,"_isCertified",{get:$util$2.oneOfGetter(e=["isCertified"]),set:$util$2.oneOfSetter(e)}),r.encode=function(n,o){return o||(o=$Writer$2.create()),n.multiaddr!=null&&Object.hasOwnProperty.call(n,"multiaddr")&&o.uint32(10).bytes(n.multiaddr),n.isCertified!=null&&Object.hasOwnProperty.call(n,"isCertified")&&o.uint32(16).bool(n.isCertified),o},r.decode=function(n,o){n instanceof $Reader$2||(n=$Reader$2.create(n));for(var s=o===void 0?n.len:n.pos+o,u=new $root$2.Address;n.pos<s;){var f=n.uint32();switch(f>>>3){case 1:u.multiaddr=n.bytes();break;case 2:u.isCertified=n.bool();break;default:n.skipType(f&7);break}}return u},r.fromObject=function(n){if(n instanceof $root$2.Address)return n;var o=new $root$2.Address;return n.multiaddr!=null&&(typeof n.multiaddr=="string"?$util$2.base64.decode(n.multiaddr,o.multiaddr=$util$2.newBuffer($util$2.base64.length(n.multiaddr)),0):n.multiaddr.length&&(o.multiaddr=n.multiaddr)),n.isCertified!=null&&(o.isCertified=Boolean(n.isCertified)),o},r.toObject=function(n,o){o||(o={});var s={};return o.defaults&&(o.bytes===String?s.multiaddr="":(s.multiaddr=[],o.bytes!==Array&&(s.multiaddr=$util$2.newBuffer(s.multiaddr)))),n.multiaddr!=null&&n.hasOwnProperty("multiaddr")&&(s.multiaddr=o.bytes===String?$util$2.base64.encode(n.multiaddr,0,n.multiaddr.length):o.bytes===Array?Array.prototype.slice.call(n.multiaddr):n.multiaddr),n.isCertified!=null&&n.hasOwnProperty("isCertified")&&(s.isCertified=n.isCertified,o.oneofs&&(s._isCertified="isCertified")),s},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r})();$root$2.Metadata=(()=>{function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.key="",r.prototype.value=$util$2.newBuffer([]),r.encode=function(t,n){return n||(n=$Writer$2.create()),t.key!=null&&Object.hasOwnProperty.call(t,"key")&&n.uint32(10).string(t.key),t.value!=null&&Object.hasOwnProperty.call(t,"value")&&n.uint32(18).bytes(t.value),n},r.decode=function(t,n){t instanceof $Reader$2||(t=$Reader$2.create(t));for(var o=n===void 0?t.len:t.pos+n,s=new $root$2.Metadata;t.pos<o;){var u=t.uint32();switch(u>>>3){case 1:s.key=t.string();break;case 2:s.value=t.bytes();break;default:t.skipType(u&7);break}}return s},r.fromObject=function(t){if(t instanceof $root$2.Metadata)return t;var n=new $root$2.Metadata;return t.key!=null&&(n.key=String(t.key)),t.value!=null&&(typeof t.value=="string"?$util$2.base64.decode(t.value,n.value=$util$2.newBuffer($util$2.base64.length(t.value)),0):t.value.length&&(n.value=t.value)),n},r.toObject=function(t,n){n||(n={});var o={};return n.defaults&&(o.key="",n.bytes===String?o.value="":(o.value=[],n.bytes!==Array&&(o.value=$util$2.newBuffer(o.value)))),t.key!=null&&t.hasOwnProperty("key")&&(o.key=t.key),t.value!=null&&t.hasOwnProperty("value")&&(o.value=n.bytes===String?$util$2.base64.encode(t.value,0,t.value.length):n.bytes===Array?Array.prototype.slice.call(t.value):t.value),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r})();const $Reader$1=$protobuf.Reader,$Writer$1=$protobuf.Writer,$util$1=$protobuf.util,$root$1=$protobuf.roots.default||($protobuf.roots.default={}),Envelope=$root$1.Envelope=(()=>{function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.publicKey=$util$1.newBuffer([]),r.prototype.payloadType=$util$1.newBuffer([]),r.prototype.payload=$util$1.newBuffer([]),r.prototype.signature=$util$1.newBuffer([]),r.encode=function(t,n){return n||(n=$Writer$1.create()),t.publicKey!=null&&Object.hasOwnProperty.call(t,"publicKey")&&n.uint32(10).bytes(t.publicKey),t.payloadType!=null&&Object.hasOwnProperty.call(t,"payloadType")&&n.uint32(18).bytes(t.payloadType),t.payload!=null&&Object.hasOwnProperty.call(t,"payload")&&n.uint32(26).bytes(t.payload),t.signature!=null&&Object.hasOwnProperty.call(t,"signature")&&n.uint32(42).bytes(t.signature),n},r.decode=function(t,n){t instanceof $Reader$1||(t=$Reader$1.create(t));for(var o=n===void 0?t.len:t.pos+n,s=new $root$1.Envelope;t.pos<o;){var u=t.uint32();switch(u>>>3){case 1:s.publicKey=t.bytes();break;case 2:s.payloadType=t.bytes();break;case 3:s.payload=t.bytes();break;case 5:s.signature=t.bytes();break;default:t.skipType(u&7);break}}return s},r.fromObject=function(t){if(t instanceof $root$1.Envelope)return t;var n=new $root$1.Envelope;return t.publicKey!=null&&(typeof t.publicKey=="string"?$util$1.base64.decode(t.publicKey,n.publicKey=$util$1.newBuffer($util$1.base64.length(t.publicKey)),0):t.publicKey.length&&(n.publicKey=t.publicKey)),t.payloadType!=null&&(typeof t.payloadType=="string"?$util$1.base64.decode(t.payloadType,n.payloadType=$util$1.newBuffer($util$1.base64.length(t.payloadType)),0):t.payloadType.length&&(n.payloadType=t.payloadType)),t.payload!=null&&(typeof t.payload=="string"?$util$1.base64.decode(t.payload,n.payload=$util$1.newBuffer($util$1.base64.length(t.payload)),0):t.payload.length&&(n.payload=t.payload)),t.signature!=null&&(typeof t.signature=="string"?$util$1.base64.decode(t.signature,n.signature=$util$1.newBuffer($util$1.base64.length(t.signature)),0):t.signature.length&&(n.signature=t.signature)),n},r.toObject=function(t,n){n||(n={});var o={};return n.defaults&&(n.bytes===String?o.publicKey="":(o.publicKey=[],n.bytes!==Array&&(o.publicKey=$util$1.newBuffer(o.publicKey))),n.bytes===String?o.payloadType="":(o.payloadType=[],n.bytes!==Array&&(o.payloadType=$util$1.newBuffer(o.payloadType))),n.bytes===String?o.payload="":(o.payload=[],n.bytes!==Array&&(o.payload=$util$1.newBuffer(o.payload))),n.bytes===String?o.signature="":(o.signature=[],n.bytes!==Array&&(o.signature=$util$1.newBuffer(o.signature)))),t.publicKey!=null&&t.hasOwnProperty("publicKey")&&(o.publicKey=n.bytes===String?$util$1.base64.encode(t.publicKey,0,t.publicKey.length):n.bytes===Array?Array.prototype.slice.call(t.publicKey):t.publicKey),t.payloadType!=null&&t.hasOwnProperty("payloadType")&&(o.payloadType=n.bytes===String?$util$1.base64.encode(t.payloadType,0,t.payloadType.length):n.bytes===Array?Array.prototype.slice.call(t.payloadType):t.payloadType),t.payload!=null&&t.hasOwnProperty("payload")&&(o.payload=n.bytes===String?$util$1.base64.encode(t.payload,0,t.payload.length):n.bytes===Array?Array.prototype.slice.call(t.payload):t.payload),t.signature!=null&&t.hasOwnProperty("signature")&&(o.signature=n.bytes===String?$util$1.base64.encode(t.signature,0,t.signature.length):n.bytes===Array?Array.prototype.slice.call(t.signature):t.signature),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r})(),$Reader=$protobuf.Reader,$Writer=$protobuf.Writer,$util=$protobuf.util,$root=$protobuf.roots.default||($protobuf.roots.default={}),PeerRecord=$root.PeerRecord=(()=>{function r(e){if(this.addresses=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.peerId=$util.newBuffer([]),r.prototype.seq=$util.Long?$util.Long.fromBits(0,0,!0):0,r.prototype.addresses=$util.emptyArray,r.encode=function(t,n){if(n||(n=$Writer.create()),t.peerId!=null&&Object.hasOwnProperty.call(t,"peerId")&&n.uint32(10).bytes(t.peerId),t.seq!=null&&Object.hasOwnProperty.call(t,"seq")&&n.uint32(16).uint64(t.seq),t.addresses!=null&&t.addresses.length)for(var o=0;o<t.addresses.length;++o)$root.PeerRecord.AddressInfo.encode(t.addresses[o],n.uint32(26).fork()).ldelim();return n},r.decode=function(t,n){t instanceof $Reader||(t=$Reader.create(t));for(var o=n===void 0?t.len:t.pos+n,s=new $root.PeerRecord;t.pos<o;){var u=t.uint32();switch(u>>>3){case 1:s.peerId=t.bytes();break;case 2:s.seq=t.uint64();break;case 3:s.addresses&&s.addresses.length||(s.addresses=[]),s.addresses.push($root.PeerRecord.AddressInfo.decode(t,t.uint32()));break;default:t.skipType(u&7);break}}return s},r.fromObject=function(t){if(t instanceof $root.PeerRecord)return t;var n=new $root.PeerRecord;if(t.peerId!=null&&(typeof t.peerId=="string"?$util.base64.decode(t.peerId,n.peerId=$util.newBuffer($util.base64.length(t.peerId)),0):t.peerId.length&&(n.peerId=t.peerId)),t.seq!=null&&($util.Long?(n.seq=$util.Long.fromValue(t.seq)).unsigned=!0:typeof t.seq=="string"?n.seq=parseInt(t.seq,10):typeof t.seq=="number"?n.seq=t.seq:typeof t.seq=="object"&&(n.seq=new $util.LongBits(t.seq.low>>>0,t.seq.high>>>0).toNumber(!0))),t.addresses){if(!Array.isArray(t.addresses))throw TypeError(".PeerRecord.addresses: array expected");n.addresses=[];for(var o=0;o<t.addresses.length;++o){if(typeof t.addresses[o]!="object")throw TypeError(".PeerRecord.addresses: object expected");n.addresses[o]=$root.PeerRecord.AddressInfo.fromObject(t.addresses[o])}}return n},r.toObject=function(t,n){n||(n={});var o={};if((n.arrays||n.defaults)&&(o.addresses=[]),n.defaults)if(n.bytes===String?o.peerId="":(o.peerId=[],n.bytes!==Array&&(o.peerId=$util.newBuffer(o.peerId))),$util.Long){var s=new $util.Long(0,0,!0);o.seq=n.longs===String?s.toString():n.longs===Number?s.toNumber():s}else o.seq=n.longs===String?"0":0;if(t.peerId!=null&&t.hasOwnProperty("peerId")&&(o.peerId=n.bytes===String?$util.base64.encode(t.peerId,0,t.peerId.length):n.bytes===Array?Array.prototype.slice.call(t.peerId):t.peerId),t.seq!=null&&t.hasOwnProperty("seq")&&(typeof t.seq=="number"?o.seq=n.longs===String?String(t.seq):t.seq:o.seq=n.longs===String?$util.Long.prototype.toString.call(t.seq):n.longs===Number?new $util.LongBits(t.seq.low>>>0,t.seq.high>>>0).toNumber(!0):t.seq),t.addresses&&t.addresses.length){o.addresses=[];for(var u=0;u<t.addresses.length;++u)o.addresses[u]=$root.PeerRecord.AddressInfo.toObject(t.addresses[u],n)}return o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r.AddressInfo=function(){function e(t){if(t)for(var n=Object.keys(t),o=0;o<n.length;++o)t[n[o]]!=null&&(this[n[o]]=t[n[o]])}return e.prototype.multiaddr=$util.newBuffer([]),e.encode=function(n,o){return o||(o=$Writer.create()),n.multiaddr!=null&&Object.hasOwnProperty.call(n,"multiaddr")&&o.uint32(10).bytes(n.multiaddr),o},e.decode=function(n,o){n instanceof $Reader||(n=$Reader.create(n));for(var s=o===void 0?n.len:n.pos+o,u=new $root.PeerRecord.AddressInfo;n.pos<s;){var f=n.uint32();switch(f>>>3){case 1:u.multiaddr=n.bytes();break;default:n.skipType(f&7);break}}return u},e.fromObject=function(n){if(n instanceof $root.PeerRecord.AddressInfo)return n;var o=new $root.PeerRecord.AddressInfo;return n.multiaddr!=null&&(typeof n.multiaddr=="string"?$util.base64.decode(n.multiaddr,o.multiaddr=$util.newBuffer($util.base64.length(n.multiaddr)),0):n.multiaddr.length&&(o.multiaddr=n.multiaddr)),o},e.toObject=function(n,o){o||(o={});var s={};return o.defaults&&(o.bytes===String?s.multiaddr="":(s.multiaddr=[],o.bytes!==Array&&(s.multiaddr=$util.newBuffer(s.multiaddr)))),n.multiaddr!=null&&n.hasOwnProperty("multiaddr")&&(s.multiaddr=o.bytes===String?$util.base64.encode(n.multiaddr,0,n.multiaddr.length):o.bytes===Array?Array.prototype.slice.call(n.multiaddr):n.multiaddr),s},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),r})();$protobuf.util.Long=void 0;$protobuf.configure();async function storePeerUnderSingleDatastoreKey(r,e=()=>{}){e(0,"Storing each peerstore key under a single datastore key"),await r.datastore.open();const t={},n=[];for await(const{key:o,value:s}of r.datastore.query({prefix:"/peers"})){n.push(o);const u=o.toString(),[,f,l,h,p]=u.split("/");if(f==="peers"&&["protos","addrs","metadata","keys"].includes(l)&&h)if(t[h]=t[h]||{addresses:[],protocols:[],metadata:[]},l==="protos"){const m=Protocols.decode(s);t[h].protocols=m.protocols.sort()}else if(l==="addrs"){const m=Addresses.decode(s);t[h].addresses=m.addrs.sort((b,S)=>multiaddr(b.multiaddr).toString().localeCompare(multiaddr(S.multiaddr).toString())),m.certifiedRecord&&m.certifiedRecord.raw&&(t[h].peerRecordEnvelope=m.certifiedRecord.raw)}else l==="metadata"?t[h].metadata.push({key:p,value:s}):l==="keys"&&(t[h].pubKey=s)}e(33,"Read peer data from store");for(const o of n)await r.datastore.delete(o);e(66,"Removed existing peer data from store");for(const o of Object.keys(t)){const s=t[o];s.metadata=s.metadata.sort((f,l)=>f.key.localeCompare(l.key));const u=Peer.encode(s).finish();await r.datastore.put(new Key(`/peers/${o}`),u)}await r.datastore.close(),e(100,"Stored each peerstore key under a single datastore key")}async function storePeerUnderMultipleDatastoreKeys(r,e=()=>{}){e(0,"Storing each peerstore key under a multiple datastore keys"),await r.datastore.open();const t={},n=[];for await(const{key:o,value:s}of r.datastore.query({prefix:"/peers"})){n.push(o);const u=o.toString(),[,,f]=u.split("/");t[f]=Peer.decode(s)}e(33,"Read peer data from store");for(const o of n)await r.datastore.delete(o);e(66,"Removed existing peer data from store");for(const[o,s]of Object.entries(t)){if(s.protocols&&s.protocols.length>0&&await r.datastore.put(new Key(`/peers/protos/${o}`),Protocols.encode({protocols:s.protocols}).finish()),s.addresses&&s.addresses.length>0){const u=s.peerRecordEnvelope;let f;if(u){const l=Envelope.decode(u),h=PeerRecord.decode(l.payload);f={raw:u,seq:h.seq}}await r.datastore.put(new Key(`/peers/addrs/${o}`),Addresses.encode({addrs:s.addresses,certifiedRecord:f}).finish())}if(s.metadata&&s.metadata.length>0)for(const{key:u,value:f}of s.metadata)await r.datastore.put(new Key(`/peers/metadata/${o}/${u}`),f);s.pubKey&&await r.datastore.put(new Key(`/peers/keys/${o}`),s.pubKey)}await r.datastore.close(),e(100,"Stored each peerstore key under multiple datastore keys")}const migration={version:12,description:"Store each peerstore peer under a single datastore key",migrate:storePeerUnderSingleDatastoreKey,revert:storePeerUnderMultipleDatastoreKeys},emptyMigration={description:"Empty migration.",migrate:()=>{},revert:()=>{},empty:!0},defaultMigrations=[Object.assign({version:1},emptyMigration),Object.assign({version:2},emptyMigration),Object.assign({version:3},emptyMigration),Object.assign({version:4},emptyMigration),Object.assign({version:5},emptyMigration),Object.assign({version:6},emptyMigration),Object.assign({version:7},emptyMigration),migration$4,migration$3,migration$2,migration$1,migration];class NonReversibleMigrationError extends Error{constructor(e){super(e),this.name="NonReversibleMigrationError",this.code=NonReversibleMigrationError.code,this.message=e}}NonReversibleMigrationError.code="ERR_NON_REVERSIBLE_MIGRATION";class NotInitializedRepoError extends Error{constructor(e){super(e),this.name="NotInitializedRepoError",this.code=NotInitializedRepoError.code,this.message=e}}NotInitializedRepoError.code="ERR_NOT_INITIALIZED_REPO";class RequiredParameterError extends Error{constructor(e){super(e),this.name="RequiredParameterError",this.code=RequiredParameterError.code,this.message=e}}RequiredParameterError.code="ERR_REQUIRED_PARAMETER";class InvalidValueError extends Error{constructor(e){super(e),this.name="InvalidValueError",this.code=InvalidValueError.code,this.message=e}}InvalidValueError.code="ERR_INVALID_VALUE";class MissingRepoOptionsError extends Error{constructor(e){super(e),this.name="MissingRepoOptionsError",this.code=MissingRepoOptionsError.code,this.message=e}}MissingRepoOptionsError.code="ERR_MISSING_REPO_OPTIONS";const Errors=Object.freeze(Object.defineProperty({__proto__:null,InvalidValueError,MissingRepoOptionsError,NonReversibleMigrationError,NotInitializedRepoError,RequiredParameterError},Symbol.toStringTag,{value:"Module"})),log$6=browserExports("ipfs:repo:migrator:repo:init");async function isRepoInitialized(r){if(!r)throw new MissingRepoOptionsError("Please pass repo options when trying to open a repo");const e=r.root;try{await e.open();const t=await e.has(VERSION_KEY),n=await e.has(CONFIG_KEY);return!t||!n?(log$6(`Version entry present: ${t}`),log$6(`Config entry present: ${n}`),!1):!0}catch(t){return log$6("While checking if repo is initialized error was thrown: "+t.message),!1}finally{if(e!==void 0)try{await e.close()}catch{}}}async function getVersion(r){if(!await isRepoInitialized(r))throw new NotInitializedRepoError("Repo is not initialized!");const e=r.root;await e.open();try{return parseInt(toString$2(await e.get(VERSION_KEY)))}finally{await e.close()}}async function setVersion(r,e){if(!e)throw new MissingRepoOptionsError("Please pass repo options when trying to open a repo");const t=e.root;await t.open(),await t.put(VERSION_KEY,fromString$1(String(r))),await t.close()}const log$5=browserExports("ipfs:repo:migrator");function getLatestMigrationVersion(r){return r=r||defaultMigrations,!Array.isArray(r)||r.length===0?0:r[r.length-1].version}async function migrate(r,e,t,n,o={}){const s=o.ignoreLock??!1,u=o.onProgress,f=o.isDryRun??!1,l=o.migrations??defaultMigrations;if(!r)throw new errors.RequiredParameterError("Path argument is required!");if(!t)throw new errors.RequiredParameterError("repoOptions argument is required!");if(!n)throw new errors.RequiredParameterError("toVersion argument is required!");if(!Number.isInteger(n)||n<=0)throw new errors.InvalidValueError("Version has to be positive integer!");e=wrapBackends(e);const h=await getVersion(e);if(h===n){log$5("Nothing to migrate.");return}if(h>n)throw new errors.InvalidValueError(`Current repo's version (${h}) is higher then toVersion (${n}), you probably wanted to revert it?`);verifyAvailableMigrations(l,h,n);let p;!f&&!s&&(p=await t.repoLock.lock(r));try{for(const m of l){if(n!==void 0&&m.version>n)break;if(!(m.version<=h)){log$5(`Migrating version ${m.version}`);try{if(!f){let b=()=>{};u&&(b=(S,A)=>u(m.version,S.toFixed(2),A)),await m.migrate(e,b)}}catch(b){const S=m.version-1;throw log$5(`An exception was raised during execution of migration. Setting the repo's version to last successfully migrated version: ${S}`),await setVersion(S,e),new Error(`During migration to version ${m.version} exception was raised: ${b.stack||b.message||b}`)}log$5(`Migrating to version ${m.version} finished`)}}f||await setVersion(n||getLatestMigrationVersion(l),e),log$5("Repo successfully migrated",n!==void 0?`to version ${n}!`:"to latest version!")}finally{!f&&!s&&p&&await p.close()}}async function revert(r,e,t,n,o={}){const s=o.ignoreLock??!1,u=o.onProgress,f=o.isDryRun??!1,l=o.migrations??defaultMigrations;if(!r)throw new errors.RequiredParameterError("Path argument is required!");if(!t)throw new errors.RequiredParameterError("repoOptions argument is required!");if(!n)throw new errors.RequiredParameterError("When reverting migrations, you have to specify to which version to revert!");if(!Number.isInteger(n)||n<=0)throw new errors.InvalidValueError("Version has to be positive integer!");e=wrapBackends(e);const h=await getVersion(e);if(h===n){log$5("Nothing to revert.");return}if(h<n)throw new errors.InvalidValueError(`Current repo's version (${h}) is lower then toVersion (${n}), you probably wanted to migrate it?`);verifyAvailableMigrations(l,n,h,!0);let p;!f&&!s&&(p=await t.repoLock.lock(r)),log$5(`Reverting from version ${h} to ${n}`);try{const m=l.slice().reverse();for(const b of m){if(b.version<=n)break;if(!(b.version>h)){log$5(`Reverting migration version ${b.version}`);try{if(!f){let S=()=>{};u&&(S=(A,L)=>u(b.version,A.toFixed(2),L)),await b.revert(e,S)}}catch(S){const A=b.version;throw log$5(`An exception was raised during execution of migration. Setting the repo's version to last successfully reverted version: ${A}`),await setVersion(A,e),S.message=`During reversion to version ${b.version} exception was raised: ${S.message}`,S}log$5(`Reverting to version ${b.version} finished`)}}f||await setVersion(n,e),log$5(`All migrations successfully reverted to version ${n}!`)}finally{!f&&!s&&p&&await p.close()}}function verifyAvailableMigrations(r,e,t,n=!1){let o=0;for(const s of r){if(s.version>t)break;if(s.version>e){if(n&&!s.revert)throw new errors.NonReversibleMigrationError(`It is not possible to revert to version ${e} because migration version ${s.version} is not reversible. Cancelling reversion.`);o++}}if(o!==t-e)throw new errors.InvalidValueError(`The ipfs-repo-migrations package does not have all migration to migrate from version ${e} to ${t}`)}const errors=Errors;var bytesExports={},bytes$1={get exports(){return bytesExports},set exports(r){bytesExports=r}};/*!
 * bytes
 * Copyright(c) 2012-2014 TJ Holowaychuk
 * Copyright(c) 2015 Jed Watson
 * MIT Licensed
 */bytes$1.exports=bytes;bytesExports.format=format;bytesExports.parse=parse;var formatThousandsRegExp=/\B(?=(\d{3})+(?!\d))/g,formatDecimalsRegExp=/(?:\.0*|(\.[^0]+)0+)$/,map$1={b:1,kb:1<<10,mb:1<<20,gb:1<<30,tb:Math.pow(1024,4),pb:Math.pow(1024,5)},parseRegExp=/^((-|\+)?(\d+(?:\.\d+)?)) *(kb|mb|gb|tb|pb)$/i;function bytes(r,e){return typeof r=="string"?parse(r):typeof r=="number"?format(r,e):null}function format(r,e){if(!Number.isFinite(r))return null;var t=Math.abs(r),n=e&&e.thousandsSeparator||"",o=e&&e.unitSeparator||"",s=e&&e.decimalPlaces!==void 0?e.decimalPlaces:2,u=Boolean(e&&e.fixedDecimals),f=e&&e.unit||"";(!f||!map$1[f.toLowerCase()])&&(t>=map$1.pb?f="PB":t>=map$1.tb?f="TB":t>=map$1.gb?f="GB":t>=map$1.mb?f="MB":t>=map$1.kb?f="KB":f="B");var l=r/map$1[f.toLowerCase()],h=l.toFixed(s);return u||(h=h.replace(formatDecimalsRegExp,"$1")),n&&(h=h.split(".").map(function(p,m){return m===0?p.replace(formatThousandsRegExp,n):p}).join(".")),h+o+f}function parse(r){if(typeof r=="number"&&!isNaN(r))return r;if(typeof r!="string")return null;var e=parseRegExp.exec(r),t,n="b";return e?(t=parseFloat(e[1]),n=e[4].toLowerCase()):(t=parseInt(r,10),n="b"),isNaN(t)?null:Math.floor(map$1[n]*t)}var isPlainObj=r=>{if(Object.prototype.toString.call(r)!=="[object Object]")return!1;const e=Object.getPrototypeOf(r);return e===null||e===Object.prototype};const isOptionObject=isPlainObj,{hasOwnProperty:hasOwnProperty$1}=Object.prototype,{propertyIsEnumerable}=Object,defineProperty=(r,e,t)=>Object.defineProperty(r,e,{value:t,writable:!0,enumerable:!0,configurable:!0}),globalThis$1=commonjsGlobal,defaultMergeOptions={concatArrays:!1,ignoreUndefined:!1},getEnumerableOwnPropertyKeys=r=>{const e=[];for(const t in r)hasOwnProperty$1.call(r,t)&&e.push(t);if(Object.getOwnPropertySymbols){const t=Object.getOwnPropertySymbols(r);for(const n of t)propertyIsEnumerable.call(r,n)&&e.push(n)}return e};function clone(r){return Array.isArray(r)?cloneArray(r):isOptionObject(r)?cloneOptionObject(r):r}function cloneArray(r){const e=r.slice(0,0);return getEnumerableOwnPropertyKeys(r).forEach(t=>{defineProperty(e,t,clone(r[t]))}),e}function cloneOptionObject(r){const e=Object.getPrototypeOf(r)===null?Object.create(null):{};return getEnumerableOwnPropertyKeys(r).forEach(t=>{defineProperty(e,t,clone(r[t]))}),e}const mergeKeys=(r,e,t,n)=>(t.forEach(o=>{typeof e[o]>"u"&&n.ignoreUndefined||(o in r&&r[o]!==Object.getPrototypeOf(r)?defineProperty(r,o,merge$1(r[o],e[o],n)):defineProperty(r,o,clone(e[o])))}),r),concatArrays=(r,e,t)=>{let n=r.slice(0,0),o=0;return[r,e].forEach(s=>{const u=[];for(let f=0;f<s.length;f++)hasOwnProperty$1.call(s,f)&&(u.push(String(f)),s===r?defineProperty(n,o++,s[f]):defineProperty(n,o++,clone(s[f])));n=mergeKeys(n,s,getEnumerableOwnPropertyKeys(s).filter(f=>!u.includes(f)),t)}),n};function merge$1(r,e,t){return t.concatArrays&&Array.isArray(r)&&Array.isArray(e)?concatArrays(r,e,t):!isOptionObject(e)||!isOptionObject(r)?clone(e):mergeKeys(r,e,getEnumerableOwnPropertyKeys(e),t)}var mergeOptions=function(...r){const e=merge$1(clone(defaultMergeOptions),this!==globalThis$1&&this||{},defaultMergeOptions);let t={_:{}};for(const n of r)if(n!==void 0){if(!isOptionObject(n))throw new TypeError("`"+n+"` is not an Option Object");t=merge$1(t,{_:n},e)}return t._};const repoVersion=12;class LockExistsError extends Error{constructor(e){super(e),this.name="LockExistsError",this.code=LockExistsError.code}}LockExistsError.code="ERR_LOCK_EXISTS";class NotFoundError extends Error{constructor(e){super(e),this.name="NotFoundError",this.code=NotFoundError.code}}NotFoundError.code="ERR_NOT_FOUND";class InvalidRepoVersionError extends Error{constructor(e){super(e),this.name="InvalidRepoVersionError",this.code=InvalidRepoVersionError.code}}InvalidRepoVersionError.code="ERR_INVALID_REPO_VERSION";const ERR_REPO_NOT_INITIALIZED="ERR_REPO_NOT_INITIALIZED",ERR_REPO_ALREADY_OPEN="ERR_REPO_ALREADY_OPEN",ERR_REPO_ALREADY_CLOSED="ERR_REPO_ALREADY_CLOSED";async function hasWithFallback(r,e,t){const n=await e(r);if(n)return n;const o=findLevelJs(t);return o?new Promise((s,u)=>{const f=o.store("readonly").get(r.toString());f.transaction.onabort=()=>{u(f.transaction.error)},f.transaction.oncomplete=()=>{s(Boolean(f.result))}}):!1}async function getWithFallback(r,e,t,n){if(await t(r))return e(r);const o=findLevelJs(n);if(!o)throw new NotFoundError;return new Promise((s,u)=>{const f=o.store("readonly").get(r.toString());f.transaction.onabort=()=>{u(f.transaction.error)},f.transaction.oncomplete=()=>{if(f.result)return s(f.result);u(new NotFoundError)}})}function findLevelJs(r){let e=r;for(;e.db||e.child;)if(e=e.db||e.child,e.type==="level-js"||e.constructor.name==="Level")return e}const log$4=browserExports("ipfs:repo:version"),versionKey=new Key("version");function version(r){return{async exists(){return hasWithFallback(versionKey,r.has.bind(r),r)},async get(){const e=await getWithFallback(versionKey,r.get.bind(r),r.has.bind(r),r);return parseInt(toString$2(e),10)},set(e){return r.put(versionKey,fromString$1(String(e)))},async check(e){const t=await this.get();return log$4("comparing version: %s and %s",t,e),t===e||(t===6&&e===7||e===6&&t===7)}}}var eventemitter3Exports={},eventemitter3={get exports(){return eventemitter3Exports},set exports(r){eventemitter3Exports=r}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function o(l,h,p){this.fn=l,this.context=h,this.once=p||!1}function s(l,h,p,m,b){if(typeof p!="function")throw new TypeError("The listener must be a function");var S=new o(p,m||l,b),A=t?t+h:h;return l._events[A]?l._events[A].fn?l._events[A]=[l._events[A],S]:l._events[A].push(S):(l._events[A]=S,l._eventsCount++),l}function u(l,h){--l._eventsCount===0?l._events=new n:delete l._events[h]}function f(){this._events=new n,this._eventsCount=0}f.prototype.eventNames=function(){var h=[],p,m;if(this._eventsCount===0)return h;for(m in p=this._events)e.call(p,m)&&h.push(t?m.slice(1):m);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(p)):h},f.prototype.listeners=function(h){var p=t?t+h:h,m=this._events[p];if(!m)return[];if(m.fn)return[m.fn];for(var b=0,S=m.length,A=new Array(S);b<S;b++)A[b]=m[b].fn;return A},f.prototype.listenerCount=function(h){var p=t?t+h:h,m=this._events[p];return m?m.fn?1:m.length:0},f.prototype.emit=function(h,p,m,b,S,A){var L=t?t+h:h;if(!this._events[L])return!1;var J=this._events[L],ne=arguments.length,pe,de;if(J.fn){switch(J.once&&this.removeListener(h,J.fn,void 0,!0),ne){case 1:return J.fn.call(J.context),!0;case 2:return J.fn.call(J.context,p),!0;case 3:return J.fn.call(J.context,p,m),!0;case 4:return J.fn.call(J.context,p,m,b),!0;case 5:return J.fn.call(J.context,p,m,b,S),!0;case 6:return J.fn.call(J.context,p,m,b,S,A),!0}for(de=1,pe=new Array(ne-1);de<ne;de++)pe[de-1]=arguments[de];J.fn.apply(J.context,pe)}else{var H=J.length,z;for(de=0;de<H;de++)switch(J[de].once&&this.removeListener(h,J[de].fn,void 0,!0),ne){case 1:J[de].fn.call(J[de].context);break;case 2:J[de].fn.call(J[de].context,p);break;case 3:J[de].fn.call(J[de].context,p,m);break;case 4:J[de].fn.call(J[de].context,p,m,b);break;default:if(!pe)for(z=1,pe=new Array(ne-1);z<ne;z++)pe[z-1]=arguments[z];J[de].fn.apply(J[de].context,pe)}}return!0},f.prototype.on=function(h,p,m){return s(this,h,p,m,!1)},f.prototype.once=function(h,p,m){return s(this,h,p,m,!0)},f.prototype.removeListener=function(h,p,m,b){var S=t?t+h:h;if(!this._events[S])return this;if(!p)return u(this,S),this;var A=this._events[S];if(A.fn)A.fn===p&&(!b||A.once)&&(!m||A.context===m)&&u(this,S);else{for(var L=0,J=[],ne=A.length;L<ne;L++)(A[L].fn!==p||b&&!A[L].once||m&&A[L].context!==m)&&J.push(A[L]);J.length?this._events[S]=J.length===1?J[0]:J:u(this,S)}return this},f.prototype.removeAllListeners=function(h){var p;return h?(p=t?t+h:h,this._events[p]&&u(this,p)):(this._events=new n,this._eventsCount=0),this},f.prototype.off=f.prototype.removeListener,f.prototype.addListener=f.prototype.on,f.prefixed=t,f.EventEmitter=f,r.exports=f})(eventemitter3);let TimeoutError$1=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},AbortError$2=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}};const getDOMException$1=r=>globalThis.DOMException===void 0?new AbortError$2(r):new DOMException(r),getAbortedReason$1=r=>{const e=r.reason===void 0?getDOMException$1("This operation was aborted."):r.reason;return e instanceof Error?e:getDOMException$1(e)};function pTimeout$1(r,e,t,n){let o;const s=new Promise((u,f)=>{if(typeof e!="number"||Math.sign(e)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${e}\``);if(e===Number.POSITIVE_INFINITY){u(r);return}if(n={customTimers:{setTimeout,clearTimeout},...n},n.signal){const{signal:l}=n;l.aborted&&f(getAbortedReason$1(l)),l.addEventListener("abort",()=>{f(getAbortedReason$1(l))})}o=n.customTimers.setTimeout.call(void 0,()=>{if(typeof t=="function"){try{u(t())}catch(p){f(p)}return}const l=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,h=t instanceof Error?t:new TimeoutError$1(l);typeof r.cancel=="function"&&r.cancel(),f(h)},e),(async()=>{try{u(await r)}catch(l){f(l)}finally{n.customTimers.clearTimeout.call(void 0,o)}})()});return s.clear=()=>{clearTimeout(o),o=void 0},s}function lowerBound(r,e,t){let n=0,o=r.length;for(;o>0;){const s=Math.trunc(o/2);let u=n+s;t(r[u],e)<=0?(n=++u,o-=s+1):o=s}return n}var __classPrivateFieldGet$1=globalThis&&globalThis.__classPrivateFieldGet||function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},_PriorityQueue_queue;class PriorityQueue{constructor(){_PriorityQueue_queue.set(this,[])}enqueue(e,t){t={priority:0,...t};const n={priority:t.priority,run:e};if(this.size&&__classPrivateFieldGet$1(this,_PriorityQueue_queue,"f")[this.size-1].priority>=t.priority){__classPrivateFieldGet$1(this,_PriorityQueue_queue,"f").push(n);return}const o=lowerBound(__classPrivateFieldGet$1(this,_PriorityQueue_queue,"f"),n,(s,u)=>u.priority-s.priority);__classPrivateFieldGet$1(this,_PriorityQueue_queue,"f").splice(o,0,n)}dequeue(){const e=__classPrivateFieldGet$1(this,_PriorityQueue_queue,"f").shift();return e==null?void 0:e.run}filter(e){return __classPrivateFieldGet$1(this,_PriorityQueue_queue,"f").filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return __classPrivateFieldGet$1(this,_PriorityQueue_queue,"f").length}}_PriorityQueue_queue=new WeakMap;var __classPrivateFieldSet=globalThis&&globalThis.__classPrivateFieldSet||function(r,e,t,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!o:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(r,t):o?o.value=t:e.set(r,t),t},__classPrivateFieldGet=globalThis&&globalThis.__classPrivateFieldGet||function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},_PQueue_instances,_PQueue_carryoverConcurrencyCount,_PQueue_isIntervalIgnored,_PQueue_intervalCount,_PQueue_intervalCap,_PQueue_interval,_PQueue_intervalEnd,_PQueue_intervalId,_PQueue_timeoutId,_PQueue_queue,_PQueue_queueClass,_PQueue_pending,_PQueue_concurrency,_PQueue_isPaused,_PQueue_throwOnTimeout,_PQueue_doesIntervalAllowAnother_get,_PQueue_doesConcurrentAllowAnother_get,_PQueue_next,_PQueue_onResumeInterval,_PQueue_isIntervalPaused_get,_PQueue_tryToStartAnother,_PQueue_initializeIntervalIfNeeded,_PQueue_onInterval,_PQueue_processQueue,_PQueue_throwOnAbort,_PQueue_onEvent;let AbortError$1=class extends Error{};class PQueue extends eventemitter3Exports{constructor(e){var t,n,o,s;if(super(),_PQueue_instances.add(this),_PQueue_carryoverConcurrencyCount.set(this,void 0),_PQueue_isIntervalIgnored.set(this,void 0),_PQueue_intervalCount.set(this,0),_PQueue_intervalCap.set(this,void 0),_PQueue_interval.set(this,void 0),_PQueue_intervalEnd.set(this,0),_PQueue_intervalId.set(this,void 0),_PQueue_timeoutId.set(this,void 0),_PQueue_queue.set(this,void 0),_PQueue_queueClass.set(this,void 0),_PQueue_pending.set(this,0),_PQueue_concurrency.set(this,void 0),_PQueue_isPaused.set(this,void 0),_PQueue_throwOnTimeout.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:PriorityQueue,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(s=(o=e.interval)===null||o===void 0?void 0:o.toString())!==null&&s!==void 0?s:""}\` (${typeof e.interval})`);__classPrivateFieldSet(this,_PQueue_carryoverConcurrencyCount,e.carryoverConcurrencyCount,"f"),__classPrivateFieldSet(this,_PQueue_isIntervalIgnored,e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,"f"),__classPrivateFieldSet(this,_PQueue_intervalCap,e.intervalCap,"f"),__classPrivateFieldSet(this,_PQueue_interval,e.interval,"f"),__classPrivateFieldSet(this,_PQueue_queue,new e.queueClass,"f"),__classPrivateFieldSet(this,_PQueue_queueClass,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,__classPrivateFieldSet(this,_PQueue_throwOnTimeout,e.throwOnTimeout===!0,"f"),__classPrivateFieldSet(this,_PQueue_isPaused,e.autoStart===!1,"f")}get concurrency(){return __classPrivateFieldGet(this,_PQueue_concurrency,"f")}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);__classPrivateFieldSet(this,_PQueue_concurrency,e,"f"),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_processQueue).call(this)}async add(e,t={}){return t={timeout:this.timeout,throwOnTimeout:__classPrivateFieldGet(this,_PQueue_throwOnTimeout,"f"),...t},new Promise((n,o)=>{__classPrivateFieldGet(this,_PQueue_queue,"f").enqueue(async()=>{var s,u,f;__classPrivateFieldSet(this,_PQueue_pending,(u=__classPrivateFieldGet(this,_PQueue_pending,"f"),u++,u),"f"),__classPrivateFieldSet(this,_PQueue_intervalCount,(f=__classPrivateFieldGet(this,_PQueue_intervalCount,"f"),f++,f),"f");try{if(!((s=t.signal)===null||s===void 0)&&s.aborted)throw new AbortError$1("The task was aborted.");let l=e({signal:t.signal});t.timeout&&(l=pTimeout$1(Promise.resolve(l),t.timeout)),t.signal&&(l=Promise.race([l,__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_throwOnAbort).call(this,t.signal)]));const h=await l;n(h),this.emit("completed",h)}catch(l){if(l instanceof TimeoutError$1&&!t.throwOnTimeout){n();return}o(l),this.emit("error",l)}finally{__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_next).call(this)}},t),this.emit("add"),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_tryToStartAnother).call(this)})}async addAll(e,t){return Promise.all(e.map(async n=>this.add(n,t)))}start(){return __classPrivateFieldGet(this,_PQueue_isPaused,"f")?(__classPrivateFieldSet(this,_PQueue_isPaused,!1,"f"),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_processQueue).call(this),this):this}pause(){__classPrivateFieldSet(this,_PQueue_isPaused,!0,"f")}clear(){__classPrivateFieldSet(this,_PQueue_queue,new(__classPrivateFieldGet(this,_PQueue_queueClass,"f")),"f")}async onEmpty(){__classPrivateFieldGet(this,_PQueue_queue,"f").size!==0&&await __classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onEvent).call(this,"empty")}async onSizeLessThan(e){__classPrivateFieldGet(this,_PQueue_queue,"f").size<e||await __classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onEvent).call(this,"next",()=>__classPrivateFieldGet(this,_PQueue_queue,"f").size<e)}async onIdle(){__classPrivateFieldGet(this,_PQueue_pending,"f")===0&&__classPrivateFieldGet(this,_PQueue_queue,"f").size===0||await __classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onEvent).call(this,"idle")}get size(){return __classPrivateFieldGet(this,_PQueue_queue,"f").size}sizeBy(e){return __classPrivateFieldGet(this,_PQueue_queue,"f").filter(e).length}get pending(){return __classPrivateFieldGet(this,_PQueue_pending,"f")}get isPaused(){return __classPrivateFieldGet(this,_PQueue_isPaused,"f")}}_PQueue_carryoverConcurrencyCount=new WeakMap,_PQueue_isIntervalIgnored=new WeakMap,_PQueue_intervalCount=new WeakMap,_PQueue_intervalCap=new WeakMap,_PQueue_interval=new WeakMap,_PQueue_intervalEnd=new WeakMap,_PQueue_intervalId=new WeakMap,_PQueue_timeoutId=new WeakMap,_PQueue_queue=new WeakMap,_PQueue_queueClass=new WeakMap,_PQueue_pending=new WeakMap,_PQueue_concurrency=new WeakMap,_PQueue_isPaused=new WeakMap,_PQueue_throwOnTimeout=new WeakMap,_PQueue_instances=new WeakSet,_PQueue_doesIntervalAllowAnother_get=function r(){return __classPrivateFieldGet(this,_PQueue_isIntervalIgnored,"f")||__classPrivateFieldGet(this,_PQueue_intervalCount,"f")<__classPrivateFieldGet(this,_PQueue_intervalCap,"f")},_PQueue_doesConcurrentAllowAnother_get=function r(){return __classPrivateFieldGet(this,_PQueue_pending,"f")<__classPrivateFieldGet(this,_PQueue_concurrency,"f")},_PQueue_next=function r(){var e;__classPrivateFieldSet(this,_PQueue_pending,(e=__classPrivateFieldGet(this,_PQueue_pending,"f"),e--,e),"f"),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_tryToStartAnother).call(this),this.emit("next")},_PQueue_onResumeInterval=function r(){__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onInterval).call(this),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_initializeIntervalIfNeeded).call(this),__classPrivateFieldSet(this,_PQueue_timeoutId,void 0,"f")},_PQueue_isIntervalPaused_get=function r(){const e=Date.now();if(__classPrivateFieldGet(this,_PQueue_intervalId,"f")===void 0){const t=__classPrivateFieldGet(this,_PQueue_intervalEnd,"f")-e;if(t<0)__classPrivateFieldSet(this,_PQueue_intervalCount,__classPrivateFieldGet(this,_PQueue_carryoverConcurrencyCount,"f")?__classPrivateFieldGet(this,_PQueue_pending,"f"):0,"f");else return __classPrivateFieldGet(this,_PQueue_timeoutId,"f")===void 0&&__classPrivateFieldSet(this,_PQueue_timeoutId,setTimeout(()=>{__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onResumeInterval).call(this)},t),"f"),!0}return!1},_PQueue_tryToStartAnother=function r(){if(__classPrivateFieldGet(this,_PQueue_queue,"f").size===0)return __classPrivateFieldGet(this,_PQueue_intervalId,"f")&&clearInterval(__classPrivateFieldGet(this,_PQueue_intervalId,"f")),__classPrivateFieldSet(this,_PQueue_intervalId,void 0,"f"),this.emit("empty"),__classPrivateFieldGet(this,_PQueue_pending,"f")===0&&this.emit("idle"),!1;if(!__classPrivateFieldGet(this,_PQueue_isPaused,"f")){const e=!__classPrivateFieldGet(this,_PQueue_instances,"a",_PQueue_isIntervalPaused_get);if(__classPrivateFieldGet(this,_PQueue_instances,"a",_PQueue_doesIntervalAllowAnother_get)&&__classPrivateFieldGet(this,_PQueue_instances,"a",_PQueue_doesConcurrentAllowAnother_get)){const t=__classPrivateFieldGet(this,_PQueue_queue,"f").dequeue();return t?(this.emit("active"),t(),e&&__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_initializeIntervalIfNeeded).call(this),!0):!1}}return!1},_PQueue_initializeIntervalIfNeeded=function r(){__classPrivateFieldGet(this,_PQueue_isIntervalIgnored,"f")||__classPrivateFieldGet(this,_PQueue_intervalId,"f")!==void 0||(__classPrivateFieldSet(this,_PQueue_intervalId,setInterval(()=>{__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onInterval).call(this)},__classPrivateFieldGet(this,_PQueue_interval,"f")),"f"),__classPrivateFieldSet(this,_PQueue_intervalEnd,Date.now()+__classPrivateFieldGet(this,_PQueue_interval,"f"),"f"))},_PQueue_onInterval=function r(){__classPrivateFieldGet(this,_PQueue_intervalCount,"f")===0&&__classPrivateFieldGet(this,_PQueue_pending,"f")===0&&__classPrivateFieldGet(this,_PQueue_intervalId,"f")&&(clearInterval(__classPrivateFieldGet(this,_PQueue_intervalId,"f")),__classPrivateFieldSet(this,_PQueue_intervalId,void 0,"f")),__classPrivateFieldSet(this,_PQueue_intervalCount,__classPrivateFieldGet(this,_PQueue_carryoverConcurrencyCount,"f")?__classPrivateFieldGet(this,_PQueue_pending,"f"):0,"f"),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_processQueue).call(this)},_PQueue_processQueue=function r(){for(;__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_tryToStartAnother).call(this););},_PQueue_throwOnAbort=async function r(e){return new Promise((t,n)=>{e.addEventListener("abort",()=>{n(new AbortError$1("The task was aborted."))},{once:!0})})},_PQueue_onEvent=async function r(e,t){return new Promise(n=>{const o=()=>{t&&!t()||(this.off(e,o),n())};this.on(e,o)})};var objectSafeSet=set;function set(r,e,t){var n,o;if(Array.isArray(e)&&(n=e.slice(0)),typeof e=="string"&&(n=e.split(".")),typeof e=="symbol"&&(n=[e]),!Array.isArray(n))throw new Error("props arg must be an array, a string or a symbol");if(o=n.pop(),!o)return!1;prototypeCheck(o);for(var s;s=n.shift();)if(prototypeCheck(s),typeof r[s]>"u"&&(r[s]={}),r=r[s],!r||typeof r!="object")return!1;return r[o]=t,!0}function prototypeCheck(r){if(r=="__proto__"||r=="constructor"||r=="prototype")throw new Error("setting of prototype values not supported")}const Queue=PQueue.default?PQueue.default:PQueue,configKey=new Key("config");function config(r){const e=new Queue({concurrency:1}),t={async getAll(s={}){const u=await getWithFallback(configKey,r.get.bind(r),r.has.bind(r),r);return JSON.parse(toString$2(u))},async get(s,u={}){if(s==null)throw new NotFoundError(`Key ${s} does not exist in config`);const f=await this.getAll(u),l=objectSafeGet(f,s);if(l===void 0)throw new NotFoundError(`Key ${s} does not exist in config`);return l},set(s,u,f={}){if(typeof s!="string"&&!(s instanceof String))throw errCode(new Error("Invalid key type: "+typeof s),"ERR_INVALID_KEY");if(u===void 0||u instanceof Uint8Array)throw errCode(new Error("Invalid value type: "+typeof u),"ERR_INVALID_VALUE");return e.add(()=>n({key:s,value:u},f.signal))},replace(s,u={}){if(!s||s instanceof Uint8Array)throw errCode(new Error("Invalid value type: "+typeof s),"ERR_INVALID_VALUE");return e.add(()=>n({key:void 0,value:s},u.signal))},async exists(){return hasWithFallback(configKey,r.has.bind(r),r)}};return t;async function n(s,u){if(u&&u.aborted)return;const f=s.key,l=s.value;if(f){const h=await t.getAll();return typeof h=="object"&&h!==null&&objectSafeSet(h,f,l),o(h)}return o(l)}function o(s){const u=fromString$1(JSON.stringify(s,null,2));return r.put(configKey,u)}}function isPlainObject(r){if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)}function sortKeys(r,e={}){if(!isPlainObject(r)&&!Array.isArray(r))throw new TypeError("Expected a plain object or array");const{deep:t,compare:n}=e,o=[],s=[],u=l=>{const h=o.indexOf(l);if(h!==-1)return s[h];const p=[];return o.push(l),s.push(p),p.push(...l.map(m=>Array.isArray(m)?u(m):isPlainObject(m)?f(m):m)),p},f=l=>{const h=o.indexOf(l);if(h!==-1)return s[h];const p={},m=Object.keys(l).sort(n);o.push(l),s.push(p);for(const b of m){const S=l[b];let A;t&&Array.isArray(S)?A=u(S):A=t&&isPlainObject(S)?f(S):S,Object.defineProperty(p,b,{...Object.getOwnPropertyDescriptor(l,b),value:A})}return p};return Array.isArray(r)?t?u(r):r.slice():f(r)}const specKey=new Key("datastore_spec");function spec(r){return{exists(){return r.has(specKey)},async get(){const e=await r.get(specKey);return JSON.parse(toString$2(e))},async set(e){return r.put(specKey,fromString$1(JSON.stringify(sortKeys(e,{deep:!0}))))}}}const apiFile=new Key("api");function apiAddr(r){return{async get(){const e=await r.get(apiFile);return e&&e.toString()},set(e){return r.put(apiFile,fromString$1(e.toString()))},delete(){return r.delete(apiFile)}}}async function*filter$1(r,e){for await(const t of r)await e(t)&&(yield t)}class FixedFIFO{constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}}class FIFO{constructor(e={}){this.hwm=e.splitLimit??16,this.head=new FixedFIFO(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return(e==null?void 0:e.byteLength)!=null?e.byteLength:1}push(e){if((e==null?void 0:e.value)!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new FixedFIFO(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return(e==null?void 0:e.value)!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}function pushable(r={}){return _pushable(t=>{const n=t.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function _pushable(r,e){e=e??{};let t=e.onEnd,n=new FIFO,o,s,u;const f=async()=>n.isEmpty()?u?{done:!0}:await new Promise((L,J)=>{s=ne=>{s=null,n.push(ne);try{L(r(n))}catch(pe){J(pe)}return o}}):r(n),l=L=>s!=null?s(L):(n.push(L),o),h=L=>(n=new FIFO,s!=null?s({error:L}):(n.push({error:L}),o)),p=L=>{if(u)return o;if((e==null?void 0:e.objectMode)!==!0&&(L==null?void 0:L.byteLength)==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:L})},m=L=>u?o:(u=!0,L!=null?h(L):l({done:!0})),b=()=>(n=new FIFO,m(),{done:!0}),S=L=>(m(L),{done:!0});if(o={[Symbol.asyncIterator](){return this},next:f,return:b,throw:S,push:p,end:m,get readableLength(){return n.size}},t==null)return o;const A=o;return o={[Symbol.asyncIterator](){return this},next(){return A.next()},throw(L){return A.throw(L),t!=null&&(t(L),t=void 0),{done:!0}},return(){return A.return(),t!=null&&(t(),t=void 0),{done:!0}},push:p,end(L){return A.end(L),t!=null&&(t(L),t=void 0),o},get readableLength(){return A.readableLength}},o}async function drain$1(r){for await(const e of r);}function createIdStore(r){return{open(){return r.open()},close(){return r.close()},query(e,t){return r.query(e,t)},queryKeys(e,t){return r.queryKeys(e,t)},async get(e,t){const n=extractContents(e);return n.isIdentity?Promise.resolve(n.digest):r.get(e,t)},async*getMany(e,t){for await(const n of e)yield this.get(n,t)},async put(e,t,n){const{isIdentity:o}=extractContents(e);o||await r.put(e,t,n)},async*putMany(e,t){const n=pushable({objectMode:!0});(globalThis.process&&globalThis.process.nextTick?globalThis.process.nextTick:globalThis.setImmediate||globalThis.setTimeout)(async()=>{try{await drain$1(r.putMany(async function*(){for await(const{key:s,value:u}of e)extractContents(s).isIdentity||(yield{key:s,value:u}),n.push({key:s,value:u})}())),n.end()}catch(s){n.end(s)}}),yield*n},has(e,t){const{isIdentity:n}=extractContents(e);return n?Promise.resolve(!0):r.has(e,t)},delete(e,t){const{isIdentity:n}=extractContents(e);return n?Promise.resolve():r.delete(e,t)},deleteMany(e,t){return r.deleteMany(filter$1(e,n=>!extractContents(n).isIdentity),t)},batch(){const e=r.batch();return{put(t,n){const{isIdentity:o}=extractContents(t);o||e.put(t,n)},delete(t){const{isIdentity:n}=extractContents(t);n||e.delete(t)},commit:t=>e.commit(t)}}}}function extractContents(r){const e=CID$1.asCID(r);if(e==null)throw errCode(new Error("Not a valid cid"),"ERR_INVALID_CID");return e.multihash.code!==identity$1.code?{isIdentity:!1}:{isIdentity:!0,digest:e.multihash.digest}}const log$3=browserExports("ipfs:repo:lock:memory"),lockFile="repo.lock",LOCKS={};async function lock(r){const e=r+"/"+lockFile;if(log$3("locking %s",e),LOCKS[e]===!0)throw new LockExistsError(`Lock already being held for file: ${e}`);return LOCKS[e]=!0,{async close(){LOCKS[e]&&delete LOCKS[e]}}}async function locked(r){const e=r+"/"+lockFile;return log$3(`checking lock: ${e}`),Boolean(LOCKS[e])}const MemoryLock={lock,locked},defaultOptions$2={autoMigrate:!0,onMigrationProgress:()=>{},repoOwner:!0,repoLock:MemoryLock},defaultDatastore={Spec:{type:"mount",mounts:[{mountpoint:"/blocks",type:"measure",prefix:"flatfs.datastore",child:{type:"flatfs",path:"blocks",sync:!0,shardFunc:"/repo/flatfs/shard/v1/next-to-last/2"}},{mountpoint:"/",type:"measure",prefix:"leveldb.datastore",child:{type:"levelds",path:"datastore",compression:"none"}}]}};async function first(r){for await(const e of r)return e}function readonly({enumerable:r=!0,configurable:e=!1}={}){return{enumerable:r,configurable:e,writable:!1}}function*linksWithin(r,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(const[t,n]of e.entries()){const o=[...r,t],s=CID$1.asCID(n);s?yield[o.join("/"),s]:typeof n=="object"&&(yield*links(n,o))}else{const t=CID$1.asCID(e);t?yield[r.join("/"),t]:yield*links(e,r)}}function*links(r,e){if(!(r==null||r instanceof Uint8Array))for(const[t,n]of Object.entries(r)){const o=[...e,t];yield*linksWithin(o,n)}}function*treeWithin(r,e){if(Array.isArray(e))for(const[t,n]of e.entries()){const o=[...r,t];yield o.join("/"),typeof n=="object"&&!CID$1.asCID(n)&&(yield*tree(n,o))}else yield*tree(e,r)}function*tree(r,e){if(!(r==null||typeof r!="object"))for(const[t,n]of Object.entries(r)){const o=[...e,t];yield o.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&!CID$1.asCID(n)&&(yield*treeWithin(o,n))}}function get(r,e){let t=r;for(const[n,o]of e.entries()){if(t=t[o],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(u=>`[${JSON.stringify(u)}]`).join("")}`);const s=CID$1.asCID(t);if(s)return{value:s,remaining:e.slice(n+1).join("/")}}return{value:t}}class Block{constructor({cid:e,bytes:t,value:n}){if(!e||!t||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:readonly(),bytes:readonly(),value:readonly(),asBlock:readonly()})}links(){return links(this.value,[])}tree(){return tree(this.value,[])}get(e="/"){return get(this.value,e.split("/").filter(Boolean))}}function createUnsafe({bytes:r,cid:e,value:t,codec:n}){const o=t!==void 0?t:n&&n.decode(r);if(o===void 0)throw new Error('Missing required argument, must either provide "value" or "codec"');return new Block({cid:e,bytes:r,value:o})}function cidToKey$1(r){const e=CID$1.asCID(r);if(e==null)throw errCode(new Error("Not a valid cid"),"ERR_INVALID_CID");const t=base32$2.encode(e.multihash.bytes);return new Key("/"+t.slice(1).toUpperCase(),!1)}function keyToMultihash(r){return decode$d(base32$2.decode(`b${r.toString().toLowerCase().substring(1)}`))}const log$2=browserExports("ipfs:repo:utils:walk-dag");async function*walkDag(r,e,t,n){try{const o=await e.get(r,n),s=await t(r.code),u=createUnsafe({bytes:o,cid:r,codec:s});for(const[,f]of u.links())yield f,yield*walkDag(f,e,t,n)}catch(o){throw log$2("Could not walk DAG for CID",r.toString(),o),o}}const PinTypes={direct:"direct",recursive:"recursive",indirect:"indirect",all:"all"};class QuickLRU extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[t,n]of e)this.onEviction(t,n.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const n=t.get(e);return this._getItemValue(e,n)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield e)}for(const e of this.cache){const[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:n=this.maxAge}={}){const o=typeof n=="number"&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;this.cache.has(e)?this.cache.set(e,{value:t,expiry:o}):this._set(e,{value:t,expiry:o})}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],n=t.length-e;n<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(n>0&&this._emitEvictions(t.slice(0,n)),this.oldCache=new Map(t.slice(n)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}for(const e of this.oldCache){const[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const n=e[t],[o,s]=n;this._deleteIfExpired(o,s)===!1&&(yield[o,s.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const n=e[t],[o,s]=n;this.cache.has(o)||this._deleteIfExpired(o,s)===!1&&(yield[o,s.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[n,o]of this.entriesAscending())e.call(t,o,n,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}const CID_CACHE_MAX_SIZE=2048;function invalidPinTypeErr(r){const e=`Invalid type '${r}', must be one of {direct, indirect, recursive, all}`;return errCode(new Error(e),"ERR_INVALID_PIN_TYPE")}class PinManager{constructor({pinstore:e,blockstore:t,loadCodec:n}){this.pinstore=e,this.blockstore=t,this.loadCodec=n,this.log=browserExports("ipfs:repo:pin"),this.directPins=new Set,this.recursivePins=new Set}async pinDirectly(e,t={}){await this.blockstore.get(e,t);const n={depth:0};return e.version!==0&&(n.version=e.version),e.code!==code$3&&(n.codec=e.code),t.metadata&&(n.metadata=t.metadata),this.pinstore.put(cidToKey$1(e),encode$a(n))}unpin(e,t){return this.pinstore.delete(cidToKey$1(e),t)}async pinRecursively(e,t={}){await this.fetchCompleteDag(e,t);const n={depth:1/0};e.version!==0&&(n.version=e.version),e.code!==code$3&&(n.codec=e.code),t.metadata&&(n.metadata=t.metadata),await this.pinstore.put(cidToKey$1(e),encode$a(n))}async*directKeys(e){for await(const t of this.pinstore.query({filters:[n=>decode$a(n.value).depth===0]})){const n=decode$a(t.value),o=n.version||0,s=n.codec!=null?n.codec:code$3,u=keyToMultihash(t.key);yield{cid:CID$1.create(o,s,u),metadata:n.metadata}}}async*recursiveKeys(e){for await(const t of this.pinstore.query({filters:[n=>decode$a(n.value).depth===1/0]})){const n=decode$a(t.value),o=n.version||0,s=n.codec!=null?n.codec:code$3,u=keyToMultihash(t.key);yield{cid:CID$1.create(o,s,u),metadata:n.metadata}}}async*indirectKeys(e){for await(const{cid:t}of this.recursiveKeys())for await(const n of walkDag(t,this.blockstore,this.loadCodec,e)){const o=[PinTypes.recursive];(await this.isPinnedWithType(n,o)).pinned||(yield n)}}async isPinnedWithType(e,t,n){Array.isArray(t)||(t=[t]);const o=t.includes(PinTypes.all),s=t.includes(PinTypes.direct),u=t.includes(PinTypes.recursive),f=t.includes(PinTypes.indirect);if(u||s||o){const p=await first(this.pinstore.query({prefix:cidToKey$1(e).toString(),filters:[m=>{if(o)return!0;const b=decode$a(m.value);return t.includes(b.depth===0?PinTypes.direct:PinTypes.recursive)}],limit:1}));if(p){const m=decode$a(p.value);return{cid:e,pinned:!0,reason:m.depth===0?PinTypes.direct:PinTypes.recursive,metadata:m.metadata}}}const l=this;async function*h(p,m){for await(const{cid:b}of m)for await(const S of walkDag(b,l.blockstore,l.loadCodec))if(S.equals(p)){yield b;return}}if(o||f){const p=await first(h(e,this.recursiveKeys()));if(p)return{cid:e,pinned:!0,reason:PinTypes.indirect,parent:p}}return{cid:e,pinned:!1}}async fetchCompleteDag(e,t={}){const n=new QuickLRU({maxSize:t.cidCacheMaxSize??CID_CACHE_MAX_SIZE}),o=async(s,u)=>{if(n.has(s.toString()))return;n.set(s.toString(),!0);const f=await this.blockstore.get(s,u),l=await this.loadCodec(s.code),h=createUnsafe({bytes:f,cid:s,codec:l});await Promise.all([...h.links()].map(([,p])=>o(p,u)))};await o(e,t)}static checkPinType(e){if(typeof e!="string"||!Object.keys(PinTypes).includes(e))throw invalidPinTypeErr(e);return!0}}async function*map(r,e){for await(const t of r)yield e(t)}function createPinnedBlockstore(r,e){return{open(){return e.open()},close(){return e.close()},query(t,n){return e.query(t,n)},queryKeys(t,n){return e.queryKeys(t,n)},async get(t,n){return e.get(t,n)},async*getMany(t,n){yield*e.getMany(t,n)},async put(t,n,o){await e.put(t,n,o)},async*putMany(t,n){yield*e.putMany(t,n)},has(t,n){return e.has(t,n)},async delete(t,n){return await ensureNotPinned(t,r),e.delete(t,n)},deleteMany(t,n){return e.deleteMany(map(t,async o=>(await ensureNotPinned(o,r),o)),n)},batch(){return e.batch()}}}async function ensureNotPinned(r,e){const{pinned:t,reason:n}=await e.isPinnedWithType(r,PinTypes.all);if(t)throw errCode(new Error(`pinned: ${n}`),"ERR_BLOCK_PINNED")}class TimeoutError extends Error{constructor(e){super(e),this.name="TimeoutError"}}class AbortError extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}const getDOMException=r=>globalThis.DOMException===void 0?new AbortError(r):new DOMException(r),getAbortedReason=r=>{const e=r.reason===void 0?getDOMException("This operation was aborted."):r.reason;return e instanceof Error?e:getDOMException(e)};function pTimeout(r,e){const{milliseconds:t,fallback:n,message:o,customTimers:s={setTimeout,clearTimeout}}=e;let u;const f=new Promise((l,h)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(t===Number.POSITIVE_INFINITY){l(r);return}if(e.signal){const{signal:p}=e;p.aborted&&h(getAbortedReason(p)),p.addEventListener("abort",()=>{h(getAbortedReason(p))})}u=s.setTimeout.call(void 0,()=>{if(n){try{l(n())}catch(p){h(p)}return}if(typeof r.cancel=="function"&&r.cancel(),o===!1)l();else if(o instanceof Error)h(o);else{const p=o??`Promise timed out after ${t} milliseconds`;h(new TimeoutError(p))}},t),(async()=>{try{l(await r)}catch(p){h(p)}finally{s.clearTimeout.call(void 0,u)}})()});return f.clear=()=>{s.clearTimeout.call(void 0,u),u=void 0},f}const WORKER_REQUEST_READ_LOCK="lock:worker:request-read",WORKER_RELEASE_READ_LOCK="lock:worker:release-read",MASTER_GRANT_READ_LOCK="lock:master:grant-read",WORKER_REQUEST_WRITE_LOCK="lock:worker:request-write",WORKER_RELEASE_WRITE_LOCK="lock:worker:release-write",MASTER_GRANT_WRITE_LOCK="lock:master:grant-write",events$1={},observable=r=>{r.addEventListener("message",e=>{observable.dispatchEvent("message",r,e)}),r.port!=null&&r.port.addEventListener("message",e=>{observable.dispatchEvent("message",r,e)})};observable.addEventListener=(r,e)=>{events$1[r]==null&&(events$1[r]=[]),events$1[r].push(e)};observable.removeEventListener=(r,e)=>{events$1[r]!=null&&(events$1[r]=events$1[r].filter(t=>t===e))};observable.dispatchEvent=function(r,e,t){events$1[r]!=null&&events$1[r].forEach(n=>n(e,t))};const handleWorkerLockRequest=(r,e,t,n,o)=>(s,u)=>{if(u.data.type!==t)return;const f={type:u.data.type,name:u.data.name,identifier:u.data.identifier};r.dispatchEvent(new MessageEvent(e,{data:{name:f.name,handler:async()=>(s.postMessage({type:o,name:f.name,identifier:f.identifier}),await new Promise(l=>{const h=p=>{if(p==null||p.data==null)return;const m={type:p.data.type,name:p.data.name,identifier:p.data.identifier};m.type===n&&m.identifier===f.identifier&&(s.removeEventListener("message",h),l())};s.addEventListener("message",h)}))}}))},makeWorkerLockRequest=(r,e,t,n)=>async()=>{const o=nanoid();return globalThis.postMessage({type:e,identifier:o,name:r}),await new Promise(s=>{const u=f=>{if(f==null||f.data==null)return;const l={type:f.data.type,identifier:f.data.identifier};l.type===t&&l.identifier===o&&(globalThis.removeEventListener("message",u),s(()=>{globalThis.postMessage({type:n,identifier:o,name:r})}))};globalThis.addEventListener("message",u)})},defaultOptions$1={singleProcess:!1},impl=r=>{if(r=Object.assign({},defaultOptions$1,r),Boolean(globalThis.document)||r.singleProcess){const t=new EventTarget;return observable.addEventListener("message",handleWorkerLockRequest(t,"requestReadLock",WORKER_REQUEST_READ_LOCK,WORKER_RELEASE_READ_LOCK,MASTER_GRANT_READ_LOCK)),observable.addEventListener("message",handleWorkerLockRequest(t,"requestWriteLock",WORKER_REQUEST_WRITE_LOCK,WORKER_RELEASE_WRITE_LOCK,MASTER_GRANT_WRITE_LOCK)),t}return{isWorker:!0,readLock:t=>makeWorkerLockRequest(t,WORKER_REQUEST_READ_LOCK,MASTER_GRANT_READ_LOCK,WORKER_RELEASE_READ_LOCK),writeLock:t=>makeWorkerLockRequest(t,WORKER_REQUEST_WRITE_LOCK,MASTER_GRANT_WRITE_LOCK,WORKER_RELEASE_WRITE_LOCK)}},mutexes={};let implementation$d;async function createReleaseable(r,e){let t;const n=new Promise(o=>{t=o});return r.add(async()=>await pTimeout((async()=>await new Promise(o=>{t(()=>{o()})}))(),{milliseconds:e.timeout})),await n}const createMutex=(r,e)=>{if(implementation$d.isWorker===!0)return{readLock:implementation$d.readLock(r,e),writeLock:implementation$d.writeLock(r,e)};const t=new PQueue({concurrency:1});let n;return{async readLock(){if(n!=null)return await createReleaseable(n,e);n=new PQueue({concurrency:e.concurrency,autoStart:!1});const o=n,s=createReleaseable(n,e);return t.add(async()=>(o.start(),await o.onIdle().then(()=>{n===o&&(n=null)}))),await s},async writeLock(){return n=null,await createReleaseable(t,e)}}},defaultOptions={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function createMortice(r){const e=Object.assign({},defaultOptions,r);return implementation$d==null&&(implementation$d=impl(e),implementation$d.isWorker!==!0&&(implementation$d.addEventListener("requestReadLock",t=>{mutexes[t.data.name]!=null&&mutexes[t.data.name].readLock().then(async n=>await t.data.handler().finally(()=>n()))}),implementation$d.addEventListener("requestWriteLock",async t=>{mutexes[t.data.name]!=null&&mutexes[t.data.name].writeLock().then(async n=>await t.data.handler().finally(()=>n()))}))),mutexes[e.name]==null&&(mutexes[e.name]=createMutex(e.name,e)),mutexes[e.name]}async function*batch(r,e=1){let t=[];e<1&&(e=1);for await(const n of r)for(t.push(n);t.length>=e;)yield t.slice(0,e),t=t.slice(e);for(;t.length>0;)yield t.slice(0,e),t=t.slice(e)}async function*parallelBatch(r,e=1){for await(const t of batch(r,e)){const n=t.map(async o=>await o().then(s=>({ok:!0,value:s}),s=>({ok:!1,err:s})));for(let o=0;o<n.length;o++){const s=await n[o];if(s.ok)yield s.value;else throw s.err}}}async function*merge(...r){const e=pushable({objectMode:!0});Promise.resolve().then(async()=>{try{await Promise.all(r.map(async t=>{for await(const n of t)e.push(n)})),e.end()}catch(t){e.end(t)}}),yield*e}const rawPipe=(...r)=>{let e;for(;r.length>0;)e=r.shift()(e);return e},isIterable=r=>r!=null&&(typeof r[Symbol.asyncIterator]=="function"||typeof r[Symbol.iterator]=="function"||typeof r.next=="function"),isDuplex=r=>r!=null&&typeof r.sink=="function"&&isIterable(r.source),duplexPipelineFn=r=>e=>{const t=r.sink(e);if(t.then!=null){const n=pushable({objectMode:!0});return t.then(()=>{n.end()},s=>{n.end(s)}),merge(n,async function*(){yield*r.source,n.end()}())}return r.source};function pipe(r,...e){if(isDuplex(r)){const n=r;r=()=>n.source}else if(isIterable(r)){const n=r;r=()=>n}const t=[r,...e];if(t.length>1&&isDuplex(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let n=1;n<t.length-1;n++)isDuplex(t[n])&&(t[n]=duplexPipelineFn(t[n]));return rawPipe(...t)}const log$1=browserExports("ipfs:repo:gc"),ERR_NOT_FOUND=notFoundError().code,BLOCK_RM_CONCURRENCY=256,MFS_ROOT_KEY=new Key("/local/filesroot");function gc({gcLock:r,pins:e,blockstore:t,root:n,loadCodec:o}){async function*s(){const u=Date.now();log$1("Creating set of marked blocks");const f=await r.writeLock();try{const l=await createMarkedSet({pins:e,blockstore:t,root:n,loadCodec:o}),h=t.queryKeys({});yield*deleteUnmarkedBlocks({blockstore:t},l,h),log$1(`Complete (${Date.now()-u}ms)`)}finally{f()}}return s}async function createMarkedSet({pins:r,blockstore:e,loadCodec:t,root:n}){const o=async function*(){let f;try{f=await n.get(MFS_ROOT_KEY)}catch(h){if(h.code===ERR_NOT_FOUND){log$1("No blocks in MFS");return}throw h}const l=CID$1.decode(f);yield l,yield*walkDag(l,e,t)}(),s=merge(map(r.recursiveKeys(),({cid:f})=>f),r.indirectKeys(),map(r.directKeys(),({cid:f})=>f),o),u=new Set;for await(const f of merge(s,o))u.add(base32$2.encode(f.multihash.bytes));return u}async function*deleteUnmarkedBlocks({blockstore:r},e,t){let n=0,o=0;yield*pipe(parallelBatch(map(t,async u=>async function(){n++;try{const l=base32$2.encode(u.multihash.bytes);if(e.has(l))return null;try{await r.delete(u),o++}catch(h){return{err:new Error(`Could not delete block with CID ${u}: ${h.message}`)}}return{cid:u}}catch(l){const h=`Could delete block with CID ${u}`;return log$1(h,l),{err:new Error(h+`: ${l.message}`)}}}),BLOCK_RM_CONCURRENCY),u=>filter$1(u,Boolean)),log$1(`Marked set has ${e.size} unique blocks. Blockstore has ${n} blocks. Deleted ${o} blocks.`)}const log=browserExports("ipfs:repo"),noLimit=Number.MAX_SAFE_INTEGER,AUTO_MIGRATE_CONFIG_KEY="repoAutoMigrate";let Repo$1=class{constructor(e,t,n,o){if(typeof e!="string")throw new Error("missing repo path");if(typeof t!="function")throw new Error("missing codec loader");this.options=mergeOptions(defaultOptions$2,o),this.closed=!0,this.path=e,this.root=n.root,this.datastore=n.datastore,this.keys=n.keys;const s=n.blocks,u=n.pins;this.pins=new PinManager({pinstore:u,blockstore:s,loadCodec:t});const f=createPinnedBlockstore(this.pins,s);this.blocks=createIdStore(f),this.version=version(this.root),this.config=config(this.root),this.spec=spec(this.root),this.apiAddr=apiAddr(this.root),this.gcLock=createMortice({name:e,singleProcess:this.options.repoOwner!==!1}),this.gc=gc({gcLock:this.gcLock,pins:this.pins,blockstore:this.blocks,root:this.root,loadCodec:t})}async init(e){log("initializing at: %s",this.path),await this._openRoot(),await this.config.replace(buildConfig(e)),await this.spec.set(buildDatastoreSpec(e)),await this.version.set(repoVersion)}async isInitialized(){if(!this.closed)return!0;try{return await this._openRoot(),await this._checkInitialized(),await this.root.close(),!0}catch{return!1}}async open(){if(!this.closed)throw errCode(new Error("repo is already open"),ERR_REPO_ALREADY_OPEN);log("opening at: %s",this.path);try{if(await this._openRoot(),await this._checkInitialized(),this._lockfile=await this._openLock(),log("acquired repo.lock"),!await this.version.check(repoVersion))if(await this._isAutoMigrationEnabled())await this._migrate(repoVersion,{root:this.root,datastore:this.datastore,pins:this.pins.pinstore,blocks:this.pins.blockstore,keys:this.keys});else throw new InvalidRepoVersionError("Incompatible repo versions. Automatic migrations disabled. Please migrate the repo manually.");log("creating datastore"),await this.datastore.open(),log("creating blocks"),await this.blocks.open(),log("creating keystore"),await this.keys.open(),log("creating pins"),await this.pins.pinstore.open(),this.closed=!1,log("all opened")}catch(e){if(this._lockfile)try{await this._closeLock(),this._lockfile=null}catch(t){log("error removing lock",t)}throw e}}async _openRoot(){try{await this.root.open()}catch(e){if(e.message!=="Already open")throw e}}async _openLock(){const e=await this.options.repoLock.lock(this.path);if(typeof e.close!="function")throw errCode(new Error("Locks must have a close method"),"ERR_NO_CLOSE_FUNCTION");return e}_closeLock(){return this._lockfile&&this._lockfile.close()}async _checkInitialized(){log("init check");let e;try{[e]=await Promise.all([this.config.exists(),this.spec.exists(),this.version.exists()])}catch(t){throw t.code==="ERR_NOT_FOUND"?errCode(new Error("repo is not initialized yet"),ERR_REPO_NOT_INITIALIZED,{path:this.path}):t}if(!e)throw errCode(new Error("repo is not initialized yet"),ERR_REPO_NOT_INITIALIZED,{path:this.path})}async close(){if(this.closed)throw errCode(new Error("repo is already closed"),ERR_REPO_ALREADY_CLOSED);log("closing at: %s",this.path);try{await this.apiAddr.delete()}catch(e){if(e.code!==ERR_REPO_NOT_INITIALIZED&&!e.message.startsWith("ENOENT"))throw e}await Promise.all([this.root,this.blocks,this.keys,this.datastore,this.pins.pinstore].map(e=>e&&e.close())),log("unlocking"),this.closed=!0,await this._closeLock()}exists(){return this.version.exists()}async stat(){if(this.datastore&&this.keys){const[e,t,n,o,s]=await Promise.all([this._storageMaxStat(),this._blockStat(),this.version.get(),getSize(this.datastore),getSize(this.keys)]),u=t.size+o+s;return{repoPath:this.path,storageMax:e,version:n,numObjects:t.count,repoSize:u}}throw errCode(new Error("repo is not initialized yet"),ERR_REPO_NOT_INITIALIZED,{path:this.path})}async _isAutoMigrationEnabled(){if(this.options.autoMigrate!==void 0)return this.options.autoMigrate;let e;try{e=await this.config.get(AUTO_MIGRATE_CONFIG_KEY)}catch(t){if(t.code===NotFoundError.code)e=!0;else throw t}return e}async _migrate(e,t){return await this.version.get()>e?(log(`reverting to version ${e}`),revert(this.path,t,this.options,e,{ignoreLock:!0,onProgress:this.options.onMigrationProgress})):(log(`migrating to version ${e}`),migrate(this.path,t,this.options,e,{ignoreLock:!0,onProgress:this.options.onMigrationProgress}))}async _storageMaxStat(){try{const e=await this.config.get("Datastore.StorageMax");return BigInt(bytesExports(e))}catch{return BigInt(noLimit)}}async _blockStat(){let e=BigInt(0),t=BigInt(0);if(this.blocks)for await(const{key:n,value:o}of this.blocks.query({}))e+=BigInt(1),t+=BigInt(o.byteLength),t+=BigInt(n.bytes.byteLength);return{count:e,size:t}}};async function getSize(r){let e=BigInt(0);for await(const t of r.query({}))e+=BigInt(t.value.byteLength),e+=BigInt(t.key.uint8Array().byteLength);return e}function createRepo(r,e,t,n){return new Repo$1(r,e,t,n)}function buildConfig(r){return r.Datastore=Object.assign({},defaultDatastore,objectSafeGet(r,"datastore")),r}function buildDatastoreSpec(r){const e={...defaultDatastore.Spec,...objectSafeGet(r,"Datastore.Spec")};return{type:e.type,mounts:e.mounts.map(t=>({mountpoint:t.mountpoint,type:t.child.type,path:t.child.path,shardFunc:t.child.shardFunc}))}}const drain=async r=>{for await(const e of r);};var itDrain=drain;const filter=async function*(r,e){for await(const t of r)await e(t)&&(yield t)};var itFilter=filter;const take$1=async function*(r,e){let t=0;if(!(e<1)){for await(const n of r)if(yield n,t++,t===e)return}};var itTake=take$1;const all$1=async r=>{const e=[];for await(const t of r)e.push(t);return e};var itAll=all$1;const sortAll$1=(r,e)=>async function*(){yield*(await itAll(r)).sort(e)}();class BaseBlockstore{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:n,value:o}of e)await this.put(n,o,t),yield{key:n,value:o}}async*getMany(e,t={}){for await(const n of e)yield this.get(n,t)}async*deleteMany(e,t={}){for await(const n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,o){e.push({key:n,value:o})},delete(n){t.push(n)},commit:async n=>{await itDrain(this.putMany(e,n)),e=[],await itDrain(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(e.prefix!=null&&(n=itFilter(n,o=>o.key.toString().startsWith(e.prefix||""))),Array.isArray(e.filters)&&(n=e.filters.reduce((o,s)=>itFilter(o,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((o,s)=>sortAll$1(o,s),n)),e.offset!=null){let o=0;n=itFilter(n,()=>o++>=(e.offset||0))}return e.limit!=null&&(n=itTake(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null&&(n=itFilter(n,o=>o.toString().startsWith(e.prefix||""))),Array.isArray(e.filters)&&(n=e.filters.reduce((o,s)=>itFilter(o,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((o,s)=>sortAll$1(o,s),n)),e.offset!=null){let o=0;n=itFilter(n,()=>o++>=e.offset)}return e.limit!=null&&(n=itTake(n,e.limit)),n}}function cidToKey(r){const e=CID$1.asCID(r);if(!e)throw errCode(new Error("Not a valid cid"),"ERR_INVALID_CID");return new Key("/"+base32$2.encode(e.multihash.bytes).slice(1).toUpperCase(),!1)}function keyToCid(r){return CID$1.createV1(code$2,decode$d(base32$2.decode("b"+r.toString().slice(1).toLowerCase())))}function convertPrefix(r){const e=r.substring(0,1);if(e==="/")return convertPrefix(r.substring(1));let t;e.toLowerCase()==="b"?t=s=>base32$2.decode(s.toLowerCase()).subarray(2):e.toLowerCase()==="c"?t=s=>base32pad$1.decode(s.toLowerCase()).subarray(2):e==="z"?t=s=>base58btc$1.decode(s).subarray(2):e==="Q"?t=s=>base58btc$1.decode("z"+s):t=s=>base32$2.decode("b"+s.toLowerCase()).subarray(2);let n;for(let s=1;s<r.length;s++)try{n=t(r.substring(0,s))}catch(u){if(u.message!=="Unexpected end of data")throw u}let o="/C";return n&&(o=`/${base32$2.encode(n).slice(1,-1).toUpperCase()||"C"}`),o}function convertQuery(r){return{...r,prefix:r.prefix?convertPrefix(r.prefix):void 0,filters:r.filters?r.filters.map(e=>t=>e({key:keyToCid(t.key),value:t.value})):void 0,orders:r.orders?r.orders.map(e=>(t,n)=>e({key:keyToCid(t.key),value:t.value},{key:keyToCid(n.key),value:n.value})):void 0}}function convertKeyQuery(r){return{...r,prefix:r.prefix?convertPrefix(r.prefix):void 0,filters:r.filters?r.filters.map(e=>t=>e(keyToCid(t))):void 0,orders:r.orders?r.orders.map(e=>(t,n)=>e(keyToCid(t),keyToCid(n))):void 0}}class BlockstoreDatastoreAdapter extends BaseBlockstore{constructor(e){super(),this.child=e}open(){return this.child.open()}close(){return this.child.close()}async*query(e,t){for await(const{key:n,value:o}of this.child.query(convertQuery(e),t))yield{key:keyToCid(n),value:o}}async*queryKeys(e,t){for await(const n of this.child.queryKeys(convertKeyQuery(e),t))yield keyToCid(n)}async get(e,t){return this.child.get(cidToKey(e),t)}async*getMany(e,t){for await(const n of e)yield this.get(n,t)}async put(e,t,n){await this.child.put(cidToKey(e),t,n)}async*putMany(e,t){const n=pushable({objectMode:!0});(globalThis.process&&globalThis.process.nextTick?globalThis.process.nextTick:globalThis.setImmediate||globalThis.setTimeout)(async()=>{try{const s=this.child;await drain$1(this.child.putMany(async function*(){for await(const u of e){const f=cidToKey(u.key);await s.has(f,t)||(yield{key:f,value:u.value}),n.push(u)}}())),n.end()}catch(s){n.end(s)}}),yield*n}has(e,t){return this.child.has(cidToKey(e),t)}delete(e,t){return this.child.delete(cidToKey(e),t)}deleteMany(e,t){const n=pushable({objectMode:!0});return drain$1(this.child.deleteMany(async function*(){for await(const o of e)yield cidToKey(o),n.push(o);n.end()}(),t)).catch(o=>{n.end(o)}),n}}async function all(r){const e=[];for await(const t of r)e.push(t);return e}const sortAll=(r,e)=>async function*(){yield*(await all(r)).sort(e)}();async function*take(r,e){let t=0;if(!(e<1)){for await(const n of r)if(yield n,t++,t===e)return}}class BaseDatastore{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:n,value:o}of e)await this.put(n,o,t),yield{key:n,value:o}}async*getMany(e,t={}){for await(const n of e)yield this.get(n,t)}async*deleteMany(e,t={}){for await(const n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,o){e.push({key:n,value:o})},delete(n){t.push(n)},commit:async n=>{await drain$1(this.putMany(e,n)),e=[],await drain$1(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(e.prefix!=null&&(n=filter$1(n,o=>o.key.toString().startsWith(e.prefix))),Array.isArray(e.filters)&&(n=e.filters.reduce((o,s)=>filter$1(o,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((o,s)=>sortAll(o,s),n)),e.offset!=null){let o=0;n=filter$1(n,()=>o++>=e.offset)}return e.limit!=null&&(n=take(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null&&(n=filter$1(n,o=>o.toString().startsWith(e.prefix))),Array.isArray(e.filters)&&(n=e.filters.reduce((o,s)=>filter$1(o,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((o,s)=>sortAll(o,s),n)),e.offset!=null){let o=0;n=filter$1(n,()=>o++>=e.offset)}return e.limit!=null&&(n=take(n,e.limit)),n}}class MemoryDatastore extends BaseDatastore{constructor(){super(),this.data={}}open(){return Promise.resolve()}close(){return Promise.resolve()}async put(e,t){this.data[e.toString()]=t}async get(e){if(!await this.has(e))throw notFoundError();return this.data[e.toString()]}async has(e){return this.data[e.toString()]!==void 0}async delete(e){delete this.data[e.toString()]}async*_all(){yield*Object.entries(this.data).map(([e,t])=>({key:new Key(e),value:t}))}async*_allKeys(){yield*Object.entries(this.data).map(([e])=>new Key(e))}}const SHARDING_FN="SHARDING",README_FN="_README";new Key(SHARDING_FN);new Key(README_FN);browserExports.formatters.b=r=>r==null?"undefined":base58btc.baseEncode(r);browserExports.formatters.t=r=>r==null?"undefined":base32.baseEncode(r);browserExports.formatters.m=r=>r==null?"undefined":base64$4.baseEncode(r);browserExports.formatters.p=r=>r==null?"undefined":r.toString();browserExports.formatters.c=r=>r==null?"undefined":r.toString();browserExports.formatters.k=r=>r==null?"undefined":r.toString();function logger(r){return Object.assign(browserExports(r),{error:browserExports(`${r}:error`),trace:browserExports(`${r}:trace`)})}logger("datastore:core:tiered");async function*sort(r,e){yield*(await all(r)).sort(e)}var browserLevel={},abstractLevel$1={},abstractLevel={},levelSupports={};levelSupports.supports=function r(...e){const t=e.reduce((n,o)=>Object.assign(n,o),{});return Object.assign(t,{snapshots:t.snapshots||!1,permanence:t.permanence||!1,seek:t.seek||!1,clear:t.clear||!1,getMany:t.getMany||!1,keyIterator:t.keyIterator||!1,valueIterator:t.valueIterator||!1,iteratorNextv:t.iteratorNextv||!1,iteratorAll:t.iteratorAll||!1,status:t.status||!1,createIfMissing:t.createIfMissing||!1,errorIfExists:t.errorIfExists||!1,deferredOpen:t.deferredOpen||!1,promises:t.promises||!1,streams:t.streams||!1,encodings:Object.assign({},t.encodings),events:Object.assign({},t.events),additionalMethods:Object.assign({},t.additionalMethods)})};var levelTranscoder={},moduleError=class extends Error{constructor(e,t){super(e||""),typeof t=="object"&&t!==null&&(t.code&&(this.code=String(t.code)),t.expected&&(this.expected=!0),t.transient&&(this.transient=!0),t.cause&&(this.cause=t.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}},encodings$1={};let lazy=null;var textEndec$1=function(){return lazy===null&&(lazy={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),lazy},formats$2={},encoding={};const ModuleError$8=moduleError,formats$1=new Set(["buffer","view","utf8"]);let Encoding$2=class{constructor(e){if(this.encode=e.encode||this.encode,this.decode=e.decode||this.decode,this.name=e.name||this.name,this.format=e.format||this.format,typeof this.encode!="function")throw new TypeError("The 'encode' property must be a function");if(typeof this.decode!="function")throw new TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),typeof this.name!="string"||this.name==="")throw new TypeError("The 'name' property must be a string");if(typeof this.format!="string"||!formats$1.has(this.format))throw new TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");e.createViewTranscoder&&(this.createViewTranscoder=e.createViewTranscoder),e.createBufferTranscoder&&(this.createBufferTranscoder=e.createBufferTranscoder),e.createUTF8Transcoder&&(this.createUTF8Transcoder=e.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new ModuleError$8(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new ModuleError$8(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new ModuleError$8(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}};encoding.Encoding=Encoding$2;const{Buffer:Buffer$2}=buffer||{},{Encoding:Encoding$1}=encoding,textEndec=textEndec$1;let BufferFormat$2=class extends Encoding$1{constructor(e){super({...e,format:"buffer"})}createViewTranscoder(){return new ViewFormat$2({encode:this.encode,decode:e=>this.decode(Buffer$2.from(e.buffer,e.byteOffset,e.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}},ViewFormat$2=class extends Encoding$1{constructor(e){super({...e,format:"view"})}createBufferTranscoder(){return new BufferFormat$2({encode:e=>{const t=this.encode(e);return Buffer$2.from(t.buffer,t.byteOffset,t.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}},UTF8Format$2=class extends Encoding$1{constructor(e){super({...e,format:"utf8"})}createBufferTranscoder(){return new BufferFormat$2({encode:e=>Buffer$2.from(this.encode(e),"utf8"),decode:e=>this.decode(e.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){const{textEncoder:e,textDecoder:t}=textEndec();return new ViewFormat$2({encode:n=>e.encode(this.encode(n)),decode:n=>this.decode(t.decode(n)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}};formats$2.BufferFormat=BufferFormat$2;formats$2.ViewFormat=ViewFormat$2;formats$2.UTF8Format=UTF8Format$2;const{Buffer:Buffer$1}=buffer||{Buffer:{isBuffer:()=>!1}},{textEncoder:textEncoder$1,textDecoder}=textEndec$1(),{BufferFormat:BufferFormat$1,ViewFormat:ViewFormat$1,UTF8Format:UTF8Format$1}=formats$2,identity=r=>r;encodings$1.utf8=new UTF8Format$1({encode:function(r){return Buffer$1.isBuffer(r)?r.toString("utf8"):ArrayBuffer.isView(r)?textDecoder.decode(r):String(r)},decode:identity,name:"utf8",createViewTranscoder(){return new ViewFormat$1({encode:function(r){return ArrayBuffer.isView(r)?r:textEncoder$1.encode(r)},decode:function(r){return textDecoder.decode(r)},name:`${this.name}+view`})},createBufferTranscoder(){return new BufferFormat$1({encode:function(r){return Buffer$1.isBuffer(r)?r:ArrayBuffer.isView(r)?Buffer$1.from(r.buffer,r.byteOffset,r.byteLength):Buffer$1.from(String(r),"utf8")},decode:function(r){return r.toString("utf8")},name:`${this.name}+buffer`})}});encodings$1.json=new UTF8Format$1({encode:JSON.stringify,decode:JSON.parse,name:"json"});encodings$1.buffer=new BufferFormat$1({encode:function(r){return Buffer$1.isBuffer(r)?r:ArrayBuffer.isView(r)?Buffer$1.from(r.buffer,r.byteOffset,r.byteLength):Buffer$1.from(String(r),"utf8")},decode:identity,name:"buffer",createViewTranscoder(){return new ViewFormat$1({encode:function(r){return ArrayBuffer.isView(r)?r:Buffer$1.from(String(r),"utf8")},decode:function(r){return Buffer$1.from(r.buffer,r.byteOffset,r.byteLength)},name:`${this.name}+view`})}});encodings$1.view=new ViewFormat$1({encode:function(r){return ArrayBuffer.isView(r)?r:textEncoder$1.encode(r)},decode:identity,name:"view",createBufferTranscoder(){return new BufferFormat$1({encode:function(r){return Buffer$1.isBuffer(r)?r:ArrayBuffer.isView(r)?Buffer$1.from(r.buffer,r.byteOffset,r.byteLength):Buffer$1.from(String(r),"utf8")},decode:identity,name:`${this.name}+buffer`})}});encodings$1.hex=new BufferFormat$1({encode:function(r){return Buffer$1.isBuffer(r)?r:Buffer$1.from(String(r),"hex")},decode:function(r){return r.toString("hex")},name:"hex"});encodings$1.base64=new BufferFormat$1({encode:function(r){return Buffer$1.isBuffer(r)?r:Buffer$1.from(String(r),"base64")},decode:function(r){return r.toString("base64")},name:"base64"});const ModuleError$7=moduleError,encodings=encodings$1,{Encoding}=encoding,{BufferFormat,ViewFormat,UTF8Format}=formats$2,kFormats=Symbol("formats"),kEncodings=Symbol("encodings"),validFormats=new Set(["buffer","view","utf8"]);let Transcoder$1=class{constructor(e){if(Array.isArray(e)){if(!e.every(t=>validFormats.has(t)))throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}else throw new TypeError("The first argument 'formats' must be an array");this[kEncodings]=new Map,this[kFormats]=new Set(e);for(const t in encodings)try{this.encoding(t)}catch(n){if(n.code!=="LEVEL_ENCODING_NOT_SUPPORTED")throw n}}encodings(){return Array.from(new Set(this[kEncodings].values()))}encoding(e){let t=this[kEncodings].get(e);if(t===void 0){if(typeof e=="string"&&e!==""){if(t=lookup$1[e],!t)throw new ModuleError$7(`Encoding '${e}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else{if(typeof e!="object"||e===null)throw new TypeError("First argument 'encoding' must be a string or object");t=from(e)}const{name:n,format:o}=t;if(!this[kFormats].has(o))if(this[kFormats].has("view"))t=t.createViewTranscoder();else if(this[kFormats].has("buffer"))t=t.createBufferTranscoder();else if(this[kFormats].has("utf8"))t=t.createUTF8Transcoder();else throw new ModuleError$7(`Encoding '${n}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"});for(const s of[e,n,t.name,t.commonName])this[kEncodings].set(s,t)}return t}};levelTranscoder.Transcoder=Transcoder$1;function from(r){if(r instanceof Encoding)return r;const e="type"in r&&typeof r.type=="string"?r.type:void 0,t=r.name||e||`anonymous-${anonymousCount++}`;switch(detectFormat(r)){case"view":return new ViewFormat({...r,name:t});case"utf8":return new UTF8Format({...r,name:t});case"buffer":return new BufferFormat({...r,name:t});default:throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}function detectFormat(r){return"format"in r&&r.format!==void 0?r.format:"buffer"in r&&typeof r.buffer=="boolean"?r.buffer?"buffer":"utf8":"code"in r&&Number.isInteger(r.code)?"view":"buffer"}const aliases={binary:encodings.buffer,"utf-8":encodings.utf8},lookup$1={...encodings,...aliases};let anonymousCount=0;var eventsExports={},events={get exports(){return eventsExports},set exports(r){eventsExports=r}},R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function r(e,t,n){return Function.prototype.apply.call(e,t,n)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:ReflectOwnKeys=function(e){return Object.getOwnPropertyNames(e)};function ProcessEmitWarning(r){console&&console.warn&&console.warn(r)}var NumberIsNaN=Number.isNaN||function r(e){return e!==e};function EventEmitter$1(){EventEmitter$1.init.call(this)}events.exports=EventEmitter$1;eventsExports.once=once;EventEmitter$1.EventEmitter=EventEmitter$1;EventEmitter$1.prototype._events=void 0;EventEmitter$1.prototype._eventsCount=0;EventEmitter$1.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(EventEmitter$1,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(r){if(typeof r!="number"||r<0||NumberIsNaN(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");defaultMaxListeners=r}});EventEmitter$1.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter$1.prototype.setMaxListeners=function r(e){if(typeof e!="number"||e<0||NumberIsNaN(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function _getMaxListeners(r){return r._maxListeners===void 0?EventEmitter$1.defaultMaxListeners:r._maxListeners}EventEmitter$1.prototype.getMaxListeners=function r(){return _getMaxListeners(this)};EventEmitter$1.prototype.emit=function r(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var o=e==="error",s=this._events;if(s!==void 0)o=o&&s.error===void 0;else if(!o)return!1;if(o){var u;if(t.length>0&&(u=t[0]),u instanceof Error)throw u;var f=new Error("Unhandled error."+(u?" ("+u.message+")":""));throw f.context=u,f}var l=s[e];if(l===void 0)return!1;if(typeof l=="function")ReflectApply(l,this,t);else for(var h=l.length,p=arrayClone(l,h),n=0;n<h;++n)ReflectApply(p[n],this,t);return!0};function _addListener(r,e,t,n){var o,s,u;if(checkListener(t),s=r._events,s===void 0?(s=r._events=Object.create(null),r._eventsCount=0):(s.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),s=r._events),u=s[e]),u===void 0)u=s[e]=t,++r._eventsCount;else if(typeof u=="function"?u=s[e]=n?[t,u]:[u,t]:n?u.unshift(t):u.push(t),o=_getMaxListeners(r),o>0&&u.length>o&&!u.warned){u.warned=!0;var f=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");f.name="MaxListenersExceededWarning",f.emitter=r,f.type=e,f.count=u.length,ProcessEmitWarning(f)}return r}EventEmitter$1.prototype.addListener=function r(e,t){return _addListener(this,e,t,!1)};EventEmitter$1.prototype.on=EventEmitter$1.prototype.addListener;EventEmitter$1.prototype.prependListener=function r(e,t){return _addListener(this,e,t,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},o=onceWrapper.bind(n);return o.listener=t,n.wrapFn=o,o}EventEmitter$1.prototype.once=function r(e,t){return checkListener(t),this.on(e,_onceWrap(this,e,t)),this};EventEmitter$1.prototype.prependOnceListener=function r(e,t){return checkListener(t),this.prependListener(e,_onceWrap(this,e,t)),this};EventEmitter$1.prototype.removeListener=function r(e,t){var n,o,s,u,f;if(checkListener(t),o=this._events,o===void 0)return this;if(n=o[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete o[e],o.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(s=-1,u=n.length-1;u>=0;u--)if(n[u]===t||n[u].listener===t){f=n[u].listener,s=u;break}if(s<0)return this;s===0?n.shift():spliceOne(n,s),n.length===1&&(o[e]=n[0]),o.removeListener!==void 0&&this.emit("removeListener",e,f||t)}return this};EventEmitter$1.prototype.off=EventEmitter$1.prototype.removeListener;EventEmitter$1.prototype.removeAllListeners=function r(e){var t,n,o;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var s=Object.keys(n),u;for(o=0;o<s.length;++o)u=s[o],u!=="removeListener"&&this.removeAllListeners(u);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(o=t.length-1;o>=0;o--)this.removeListener(e,t[o]);return this};function _listeners(r,e,t){var n=r._events;if(n===void 0)return[];var o=n[e];return o===void 0?[]:typeof o=="function"?t?[o.listener||o]:[o]:t?unwrapListeners(o):arrayClone(o,o.length)}EventEmitter$1.prototype.listeners=function r(e){return _listeners(this,e,!0)};EventEmitter$1.prototype.rawListeners=function r(e){return _listeners(this,e,!1)};EventEmitter$1.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):listenerCount.call(r,e)};EventEmitter$1.prototype.listenerCount=listenerCount;function listenerCount(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}EventEmitter$1.prototype.eventNames=function r(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function spliceOne(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function unwrapListeners(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function once(r,e){return new Promise(function(t,n){function o(u){r.removeListener(e,s),n(u)}function s(){typeof r.removeListener=="function"&&r.removeListener("error",o),t([].slice.call(arguments))}eventTargetAgnosticAddListener(r,e,s,{once:!0}),e!=="error"&&addErrorHandlerIfEventEmitter(r,o,{once:!0})})}function addErrorHandlerIfEventEmitter(r,e,t){typeof r.on=="function"&&eventTargetAgnosticAddListener(r,"error",e,t)}function eventTargetAgnosticAddListener(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function o(s){n.once&&r.removeEventListener(e,o),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var catering={},nextTickBrowser$1=typeof queueMicrotask=="function"?queueMicrotask:r=>Promise.resolve().then(r),nextTick=nextTickBrowser$1;catering.fromCallback=function(r,e){if(r===void 0){var t=new Promise(function(n,o){r=function(s,u){s?o(s):n(u)}});r[e!==void 0?e:"promise"]=t}else if(typeof r!="function")throw new TypeError("Callback must be a function");return r};catering.fromPromise=function(r,e){if(e===void 0)return r;r.then(function(t){nextTick(()=>e(null,t))}).catch(function(t){nextTick(()=>e(t))})};var abstractIterator={},common={};common.getCallback=function(r,e){return typeof r=="function"?r:e};common.getOptions=function(r,e){return typeof r=="object"&&r!==null?r:e!==void 0?e:{}};const{fromCallback:fromCallback$3}=catering,ModuleError$6=moduleError,{getOptions:getOptions$2,getCallback:getCallback$2}=common,kPromise$3=Symbol("promise"),kCallback$1=Symbol("callback"),kWorking=Symbol("working"),kHandleOne$1=Symbol("handleOne"),kHandleMany$1=Symbol("handleMany"),kAutoClose=Symbol("autoClose"),kFinishWork=Symbol("finishWork"),kReturnMany=Symbol("returnMany"),kClosing=Symbol("closing"),kHandleClose=Symbol("handleClose"),kClosed=Symbol("closed"),kCloseCallbacks$1=Symbol("closeCallbacks"),kKeyEncoding$1=Symbol("keyEncoding"),kValueEncoding$1=Symbol("valueEncoding"),kAbortOnClose=Symbol("abortOnClose"),kLegacy=Symbol("legacy"),kKeys=Symbol("keys"),kValues=Symbol("values"),kLimit=Symbol("limit"),kCount=Symbol("count"),emptyOptions$1=Object.freeze({}),noop$1=()=>{};let warnedEnd=!1;class CommonIterator{constructor(e,t,n){if(typeof e!="object"||e===null){const o=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${o}`)}if(typeof t!="object"||t===null)throw new TypeError("The second argument must be an options object");this[kClosed]=!1,this[kCloseCallbacks$1]=[],this[kWorking]=!1,this[kClosing]=!1,this[kAutoClose]=!1,this[kCallback$1]=null,this[kHandleOne$1]=this[kHandleOne$1].bind(this),this[kHandleMany$1]=this[kHandleMany$1].bind(this),this[kHandleClose]=this[kHandleClose].bind(this),this[kKeyEncoding$1]=t[kKeyEncoding$1],this[kValueEncoding$1]=t[kValueEncoding$1],this[kLegacy]=n,this[kLimit]=Number.isInteger(t.limit)&&t.limit>=0?t.limit:1/0,this[kCount]=0,this[kAbortOnClose]=!!t.abortOnClose,this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get count(){return this[kCount]}get limit(){return this[kLimit]}next(e){let t;if(e===void 0)t=new Promise((n,o)=>{e=(s,u,f)=>{s?o(s):this[kLegacy]?u===void 0&&f===void 0?n():n([u,f]):n(u)}});else if(typeof e!="function")throw new TypeError("Callback must be a function");return this[kClosing]?this.nextTick(e,new ModuleError$6("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[kWorking]?this.nextTick(e,new ModuleError$6("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[kWorking]=!0,this[kCallback$1]=e,this[kCount]>=this[kLimit]?this.nextTick(this[kHandleOne$1],null):this._next(this[kHandleOne$1])),t}_next(e){this.nextTick(e)}nextv(e,t,n){return n=getCallback$2(t,n),n=fromCallback$3(n,kPromise$3),t=getOptions$2(t,emptyOptions$1),Number.isInteger(e)?(this[kClosing]?this.nextTick(n,new ModuleError$6("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[kWorking]?this.nextTick(n,new ModuleError$6("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(e<1&&(e=1),this[kLimit]<1/0&&(e=Math.min(e,this[kLimit]-this[kCount])),this[kWorking]=!0,this[kCallback$1]=n,e<=0?this.nextTick(this[kHandleMany$1],null,[]):this._nextv(e,t,this[kHandleMany$1])),n[kPromise$3]):(this.nextTick(n,new TypeError("The first argument 'size' must be an integer")),n[kPromise$3])}_nextv(e,t,n){const o=[],s=(u,f,l)=>{if(u)return n(u);if(this[kLegacy]?f===void 0&&l===void 0:f===void 0)return n(null,o);o.push(this[kLegacy]?[f,l]:f),o.length===e?n(null,o):this._next(s)};this._next(s)}all(e,t){return t=getCallback$2(e,t),t=fromCallback$3(t,kPromise$3),e=getOptions$2(e,emptyOptions$1),this[kClosing]?this.nextTick(t,new ModuleError$6("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[kWorking]?this.nextTick(t,new ModuleError$6("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[kWorking]=!0,this[kCallback$1]=t,this[kAutoClose]=!0,this[kCount]>=this[kLimit]?this.nextTick(this[kHandleMany$1],null,[]):this._all(e,this[kHandleMany$1])),t[kPromise$3]}_all(e,t){let n=this[kCount];const o=[],s=()=>{const f=this[kLimit]<1/0?Math.min(1e3,this[kLimit]-n):1e3;f<=0?this.nextTick(t,null,o):this._nextv(f,emptyOptions$1,u)},u=(f,l)=>{f?t(f):l.length===0?t(null,o):(o.push.apply(o,l),n+=l.length,s())};s()}[kFinishWork](){const e=this[kCallback$1];return this[kAbortOnClose]&&e===null?noop$1:(this[kWorking]=!1,this[kCallback$1]=null,this[kClosing]&&this._close(this[kHandleClose]),e)}[kReturnMany](e,t,n){this[kAutoClose]?this.close(e.bind(null,t,n)):e(t,n)}seek(e,t){if(t=getOptions$2(t,emptyOptions$1),!this[kClosing]){if(this[kWorking])throw new ModuleError$6("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{const n=this.db.keyEncoding(t.keyEncoding||this[kKeyEncoding$1]),o=n.format;t.keyEncoding!==o&&(t={...t,keyEncoding:o});const s=this.db.prefixKey(n.encode(e),o);this._seek(s,t)}}}_seek(e,t){throw new ModuleError$6("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(e){return e=fromCallback$3(e,kPromise$3),this[kClosed]?this.nextTick(e):this[kClosing]?this[kCloseCallbacks$1].push(e):(this[kClosing]=!0,this[kCloseCallbacks$1].push(e),this[kWorking]?this[kAbortOnClose]&&this[kFinishWork]()(new ModuleError$6("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this._close(this[kHandleClose])),e[kPromise$3]}_close(e){this.nextTick(e)}[kHandleClose](){this[kClosed]=!0,this.db.detachResource(this);const e=this[kCloseCallbacks$1];this[kCloseCallbacks$1]=[];for(const t of e)t()}async*[Symbol.asyncIterator](){try{let e;for(;(e=await this.next())!==void 0;)yield e}finally{this[kClosed]||await this.close()}}}let AbstractIterator$3=class extends CommonIterator{constructor(e,t){super(e,t,!0),this[kKeys]=t.keys!==!1,this[kValues]=t.values!==!1}[kHandleOne$1](e,t,n){const o=this[kFinishWork]();if(e)return o(e);try{t=this[kKeys]&&t!==void 0?this[kKeyEncoding$1].decode(t):void 0,n=this[kValues]&&n!==void 0?this[kValueEncoding$1].decode(n):void 0}catch(s){return o(new IteratorDecodeError("entry",s))}t===void 0&&n===void 0||this[kCount]++,o(null,t,n)}[kHandleMany$1](e,t){const n=this[kFinishWork]();if(e)return this[kReturnMany](n,e);try{for(const o of t){const s=o[0],u=o[1];o[0]=this[kKeys]&&s!==void 0?this[kKeyEncoding$1].decode(s):void 0,o[1]=this[kValues]&&u!==void 0?this[kValueEncoding$1].decode(u):void 0}}catch(o){return this[kReturnMany](n,new IteratorDecodeError("entries",o))}this[kCount]+=t.length,this[kReturnMany](n,null,t)}end(e){return!warnedEnd&&typeof console<"u"&&(warnedEnd=!0,console.warn(new ModuleError$6("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(e)}},AbstractKeyIterator$2=class extends CommonIterator{constructor(e,t){super(e,t,!1)}[kHandleOne$1](e,t){const n=this[kFinishWork]();if(e)return n(e);try{t=t!==void 0?this[kKeyEncoding$1].decode(t):void 0}catch(o){return n(new IteratorDecodeError("key",o))}t!==void 0&&this[kCount]++,n(null,t)}[kHandleMany$1](e,t){const n=this[kFinishWork]();if(e)return this[kReturnMany](n,e);try{for(let o=0;o<t.length;o++){const s=t[o];t[o]=s!==void 0?this[kKeyEncoding$1].decode(s):void 0}}catch(o){return this[kReturnMany](n,new IteratorDecodeError("keys",o))}this[kCount]+=t.length,this[kReturnMany](n,null,t)}},AbstractValueIterator$2=class extends CommonIterator{constructor(e,t){super(e,t,!1)}[kHandleOne$1](e,t){const n=this[kFinishWork]();if(e)return n(e);try{t=t!==void 0?this[kValueEncoding$1].decode(t):void 0}catch(o){return n(new IteratorDecodeError("value",o))}t!==void 0&&this[kCount]++,n(null,t)}[kHandleMany$1](e,t){const n=this[kFinishWork]();if(e)return this[kReturnMany](n,e);try{for(let o=0;o<t.length;o++){const s=t[o];t[o]=s!==void 0?this[kValueEncoding$1].decode(s):void 0}}catch(o){return this[kReturnMany](n,new IteratorDecodeError("values",o))}this[kCount]+=t.length,this[kReturnMany](n,null,t)}};class IteratorDecodeError extends ModuleError$6{constructor(e,t){super(`Iterator could not decode ${e}`,{code:"LEVEL_DECODE_ERROR",cause:t})}}for(const r of["_ended property","_nexting property","_end method"])Object.defineProperty(AbstractIterator$3.prototype,r.split(" ")[0],{get(){throw new ModuleError$6(`The ${r} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new ModuleError$6(`The ${r} has been removed`,{code:"LEVEL_LEGACY"})}});AbstractIterator$3.keyEncoding=kKeyEncoding$1;AbstractIterator$3.valueEncoding=kValueEncoding$1;abstractIterator.AbstractIterator=AbstractIterator$3;abstractIterator.AbstractKeyIterator=AbstractKeyIterator$2;abstractIterator.AbstractValueIterator=AbstractValueIterator$2;var defaultKvIterator={};const{AbstractKeyIterator:AbstractKeyIterator$1,AbstractValueIterator:AbstractValueIterator$1}=abstractIterator,kIterator=Symbol("iterator"),kCallback=Symbol("callback"),kHandleOne=Symbol("handleOne"),kHandleMany=Symbol("handleMany");let DefaultKeyIterator$1=class extends AbstractKeyIterator$1{constructor(e,t){super(e,t),this[kIterator]=e.iterator({...t,keys:!0,values:!1}),this[kHandleOne]=this[kHandleOne].bind(this),this[kHandleMany]=this[kHandleMany].bind(this)}},DefaultValueIterator$1=class extends AbstractValueIterator$1{constructor(e,t){super(e,t),this[kIterator]=e.iterator({...t,keys:!1,values:!0}),this[kHandleOne]=this[kHandleOne].bind(this),this[kHandleMany]=this[kHandleMany].bind(this)}};for(const r of[DefaultKeyIterator$1,DefaultValueIterator$1]){const e=r===DefaultKeyIterator$1,t=e?n=>n[0]:n=>n[1];r.prototype._next=function(n){this[kCallback]=n,this[kIterator].next(this[kHandleOne])},r.prototype[kHandleOne]=function(n,o,s){const u=this[kCallback];n?u(n):u(null,e?o:s)},r.prototype._nextv=function(n,o,s){this[kCallback]=s,this[kIterator].nextv(n,o,this[kHandleMany])},r.prototype._all=function(n,o){this[kCallback]=o,this[kIterator].all(n,this[kHandleMany])},r.prototype[kHandleMany]=function(n,o){const s=this[kCallback];n?s(n):s(null,o.map(t))},r.prototype._seek=function(n,o){this[kIterator].seek(n,o)},r.prototype._close=function(n){this[kIterator].close(n)}}defaultKvIterator.DefaultKeyIterator=DefaultKeyIterator$1;defaultKvIterator.DefaultValueIterator=DefaultValueIterator$1;var deferredIterator={};const{AbstractIterator:AbstractIterator$2,AbstractKeyIterator,AbstractValueIterator}=abstractIterator,ModuleError$5=moduleError,kNut=Symbol("nut"),kUndefer$1=Symbol("undefer"),kFactory=Symbol("factory");let DeferredIterator$1=class extends AbstractIterator$2{constructor(e,t){super(e,t),this[kNut]=null,this[kFactory]=()=>e.iterator(t),this.db.defer(()=>this[kUndefer$1]())}},DeferredKeyIterator$1=class extends AbstractKeyIterator{constructor(e,t){super(e,t),this[kNut]=null,this[kFactory]=()=>e.keys(t),this.db.defer(()=>this[kUndefer$1]())}},DeferredValueIterator$1=class extends AbstractValueIterator{constructor(e,t){super(e,t),this[kNut]=null,this[kFactory]=()=>e.values(t),this.db.defer(()=>this[kUndefer$1]())}};for(const r of[DeferredIterator$1,DeferredKeyIterator$1,DeferredValueIterator$1])r.prototype[kUndefer$1]=function(){this.db.status==="open"&&(this[kNut]=this[kFactory]())},r.prototype._next=function(e){this[kNut]!==null?this[kNut].next(e):this.db.status==="opening"?this.db.defer(()=>this._next(e)):this.nextTick(e,new ModuleError$5("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._nextv=function(e,t,n){this[kNut]!==null?this[kNut].nextv(e,t,n):this.db.status==="opening"?this.db.defer(()=>this._nextv(e,t,n)):this.nextTick(n,new ModuleError$5("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._all=function(e,t){this[kNut]!==null?this[kNut].all(t):this.db.status==="opening"?this.db.defer(()=>this._all(e,t)):this.nextTick(t,new ModuleError$5("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._seek=function(e,t){this[kNut]!==null?this[kNut]._seek(e,t):this.db.status==="opening"&&this.db.defer(()=>this._seek(e,t))},r.prototype._close=function(e){this[kNut]!==null?this[kNut].close(e):this.db.status==="opening"?this.db.defer(()=>this._close(e)):this.nextTick(e)};deferredIterator.DeferredIterator=DeferredIterator$1;deferredIterator.DeferredKeyIterator=DeferredKeyIterator$1;deferredIterator.DeferredValueIterator=DeferredValueIterator$1;var defaultChainedBatch={},abstractChainedBatch={};const{fromCallback:fromCallback$2}=catering,ModuleError$4=moduleError,{getCallback:getCallback$1,getOptions:getOptions$1}=common,kPromise$2=Symbol("promise"),kStatus$1=Symbol("status"),kOperations$1=Symbol("operations"),kFinishClose=Symbol("finishClose"),kCloseCallbacks=Symbol("closeCallbacks");let AbstractChainedBatch$1=class{constructor(e){if(typeof e!="object"||e===null){const t=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${t}`)}this[kOperations$1]=[],this[kCloseCallbacks]=[],this[kStatus$1]="open",this[kFinishClose]=this[kFinishClose].bind(this),this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get length(){return this[kOperations$1].length}put(e,t,n){if(this[kStatus$1]!=="open")throw new ModuleError$4("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const o=this.db._checkKey(e)||this.db._checkValue(t);if(o)throw o;const s=n&&n.sublevel!=null?n.sublevel:this.db,u=n,f=s.keyEncoding(n&&n.keyEncoding),l=s.valueEncoding(n&&n.valueEncoding),h=f.format;n={...n,keyEncoding:h,valueEncoding:l.format},s!==this.db&&(n.sublevel=null);const p=s.prefixKey(f.encode(e),h),m=l.encode(t);return this._put(p,m,n),this[kOperations$1].push({...u,type:"put",key:e,value:t}),this}_put(e,t,n){}del(e,t){if(this[kStatus$1]!=="open")throw new ModuleError$4("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const n=this.db._checkKey(e);if(n)throw n;const o=t&&t.sublevel!=null?t.sublevel:this.db,s=t,u=o.keyEncoding(t&&t.keyEncoding),f=u.format;return t={...t,keyEncoding:f},o!==this.db&&(t.sublevel=null),this._del(o.prefixKey(u.encode(e),f),t),this[kOperations$1].push({...s,type:"del",key:e}),this}_del(e,t){}clear(){if(this[kStatus$1]!=="open")throw new ModuleError$4("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[kOperations$1]=[],this}_clear(){}write(e,t){return t=getCallback$1(e,t),t=fromCallback$2(t,kPromise$2),e=getOptions$1(e),this[kStatus$1]!=="open"?this.nextTick(t,new ModuleError$4("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):this.length===0?this.close(t):(this[kStatus$1]="writing",this._write(e,n=>{this[kStatus$1]="closing",this[kCloseCallbacks].push(()=>t(n)),n||this.db.emit("batch",this[kOperations$1]),this._close(this[kFinishClose])})),t[kPromise$2]}_write(e,t){}close(e){return e=fromCallback$2(e,kPromise$2),this[kStatus$1]==="closing"?this[kCloseCallbacks].push(e):this[kStatus$1]==="closed"?this.nextTick(e):(this[kCloseCallbacks].push(e),this[kStatus$1]!=="writing"&&(this[kStatus$1]="closing",this._close(this[kFinishClose]))),e[kPromise$2]}_close(e){this.nextTick(e)}[kFinishClose](){this[kStatus$1]="closed",this.db.detachResource(this);const e=this[kCloseCallbacks];this[kCloseCallbacks]=[];for(const t of e)t()}};abstractChainedBatch.AbstractChainedBatch=AbstractChainedBatch$1;const{AbstractChainedBatch}=abstractChainedBatch,ModuleError$3=moduleError,kEncoded=Symbol("encoded");let DefaultChainedBatch$1=class extends AbstractChainedBatch{constructor(e){super(e),this[kEncoded]=[]}_put(e,t,n){this[kEncoded].push({...n,type:"put",key:e,value:t})}_del(e,t){this[kEncoded].push({...t,type:"del",key:e})}_clear(){this[kEncoded]=[]}_write(e,t){this.db.status==="opening"?this.db.defer(()=>this._write(e,t)):this.db.status==="open"?this[kEncoded].length===0?this.nextTick(t):this.db._batch(this[kEncoded],e,t):this.nextTick(t,new ModuleError$3("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}};defaultChainedBatch.DefaultChainedBatch=DefaultChainedBatch$1;const ModuleError$2=moduleError,hasOwnProperty=Object.prototype.hasOwnProperty,rangeOptions$1=new Set(["lt","lte","gt","gte"]);var rangeOptions_1=function(r,e){const t={};for(const n in r)if(hasOwnProperty.call(r,n)&&!(n==="keyEncoding"||n==="valueEncoding")){if(n==="start"||n==="end")throw new ModuleError$2(`The legacy range option '${n}' has been removed`,{code:"LEVEL_LEGACY"});if(n==="encoding")throw new ModuleError$2("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});rangeOptions$1.has(n)?t[n]=e.encode(r[n]):t[n]=r[n]}return t.reverse=!!t.reverse,t.limit=Number.isInteger(t.limit)&&t.limit>=0?t.limit:-1,t};/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let promise;var queueMicrotask_1=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:commonjsGlobal):r=>(promise||(promise=Promise.resolve())).then(r).catch(e=>setTimeout(()=>{throw e},0)),nextTickBrowser,hasRequiredNextTickBrowser;function requireNextTickBrowser(){if(hasRequiredNextTickBrowser)return nextTickBrowser;hasRequiredNextTickBrowser=1;const r=queueMicrotask_1;return nextTickBrowser=function(e,...t){t.length===0?r(e):r(()=>e(...t))},nextTickBrowser}var abstractSublevelIterator={},hasRequiredAbstractSublevelIterator;function requireAbstractSublevelIterator(){if(hasRequiredAbstractSublevelIterator)return abstractSublevelIterator;hasRequiredAbstractSublevelIterator=1;const{AbstractIterator:r,AbstractKeyIterator:e,AbstractValueIterator:t}=abstractIterator,n=Symbol("unfix"),o=Symbol("iterator"),s=Symbol("handleOne"),u=Symbol("handleMany"),f=Symbol("callback");class l extends r{constructor(b,S,A,L){super(b,S),this[o]=A,this[n]=L,this[s]=this[s].bind(this),this[u]=this[u].bind(this),this[f]=null}[s](b,S,A){const L=this[f];if(b)return L(b);S!==void 0&&(S=this[n](S)),L(b,S,A)}[u](b,S){const A=this[f];if(b)return A(b);for(const L of S){const J=L[0];J!==void 0&&(L[0]=this[n](J))}A(b,S)}}class h extends e{constructor(b,S,A,L){super(b,S),this[o]=A,this[n]=L,this[s]=this[s].bind(this),this[u]=this[u].bind(this),this[f]=null}[s](b,S){const A=this[f];if(b)return A(b);S!==void 0&&(S=this[n](S)),A(b,S)}[u](b,S){const A=this[f];if(b)return A(b);for(let L=0;L<S.length;L++){const J=S[L];J!==void 0&&(S[L]=this[n](J))}A(b,S)}}class p extends t{constructor(b,S,A){super(b,S),this[o]=A}}for(const m of[l,h])m.prototype._next=function(b){this[f]=b,this[o].next(this[s])},m.prototype._nextv=function(b,S,A){this[f]=A,this[o].nextv(b,S,this[u])},m.prototype._all=function(b,S){this[f]=S,this[o].all(b,this[u])};for(const m of[p])m.prototype._next=function(b){this[o].next(b)},m.prototype._nextv=function(b,S,A){this[o].nextv(b,S,A)},m.prototype._all=function(b,S){this[o].all(b,S)};for(const m of[l,h,p])m.prototype._seek=function(b,S){this[o].seek(b,S)},m.prototype._close=function(b){this[o].close(b)};return abstractSublevelIterator.AbstractSublevelIterator=l,abstractSublevelIterator.AbstractSublevelKeyIterator=h,abstractSublevelIterator.AbstractSublevelValueIterator=p,abstractSublevelIterator}var abstractSublevel,hasRequiredAbstractSublevel;function requireAbstractSublevel(){if(hasRequiredAbstractSublevel)return abstractSublevel;hasRequiredAbstractSublevel=1;const r=moduleError,{Buffer:e}=buffer||{},{AbstractSublevelIterator:t,AbstractSublevelKeyIterator:n,AbstractSublevelValueIterator:o}=requireAbstractSublevelIterator(),s=Symbol("prefix"),u=Symbol("upperBound"),f=Symbol("prefixRange"),l=Symbol("parent"),h=Symbol("unfix"),p=new TextEncoder,m={separator:"!"};abstractSublevel=function({AbstractLevel:ne}){class pe extends ne{static defaults(H){if(typeof H=="string")throw new r("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(H&&H.open)throw new r("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return H==null?m:H.separator?H:{...H,separator:"!"}}constructor(H,z,ue){const{separator:ce,manifest:Ee,...Be}=pe.defaults(ue);z=J(z,ce);const ot=ce.charCodeAt(0)+1,nt=H[l]||H;if(!p.encode(z).every(ht=>ht>ot&&ht<127))throw new r(`Prefix must use bytes > ${ot} < ${127}`,{code:"LEVEL_INVALID_PREFIX"});super(b(nt,Ee),Be);const st=(H.prefix||"")+ce+z+ce,_t=st.slice(0,-1)+String.fromCharCode(ot);this[l]=nt,this[s]=new A(st),this[u]=new A(_t),this[h]=new L,this.nextTick=nt.nextTick}prefixKey(H,z){if(z==="utf8")return this[s].utf8+H;if(H.byteLength===0)return this[s][z];if(z==="view"){const ue=this[s].view,ce=new Uint8Array(ue.byteLength+H.byteLength);return ce.set(ue,0),ce.set(H,ue.byteLength),ce}else{const ue=this[s].buffer;return e.concat([ue,H],ue.byteLength+H.byteLength)}}[f](H,z){H.gte!==void 0?H.gte=this.prefixKey(H.gte,z):H.gt!==void 0?H.gt=this.prefixKey(H.gt,z):H.gte=this[s][z],H.lte!==void 0?H.lte=this.prefixKey(H.lte,z):H.lt!==void 0?H.lt=this.prefixKey(H.lt,z):H.lte=this[u][z]}get prefix(){return this[s].utf8}get db(){return this[l]}_open(H,z){this[l].open({passive:!0},z)}_put(H,z,ue,ce){this[l].put(H,z,ue,ce)}_get(H,z,ue){this[l].get(H,z,ue)}_getMany(H,z,ue){this[l].getMany(H,z,ue)}_del(H,z,ue){this[l].del(H,z,ue)}_batch(H,z,ue){this[l].batch(H,z,ue)}_clear(H,z){this[f](H,H.keyEncoding),this[l].clear(H,z)}_iterator(H){this[f](H,H.keyEncoding);const z=this[l].iterator(H),ue=this[h].get(this[s].utf8.length,H.keyEncoding);return new t(this,H,z,ue)}_keys(H){this[f](H,H.keyEncoding);const z=this[l].keys(H),ue=this[h].get(this[s].utf8.length,H.keyEncoding);return new n(this,H,z,ue)}_values(H){this[f](H,H.keyEncoding);const z=this[l].values(H);return new o(this,H,z)}}return{AbstractSublevel:pe}};const b=function(ne,pe){return{...ne.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...pe,encodings:{utf8:S(ne,"utf8"),buffer:S(ne,"buffer"),view:S(ne,"view")}}},S=function(ne,pe){return ne.supports.encodings[pe]?ne.keyEncoding(pe).name===pe:!1};class A{constructor(pe){this.utf8=pe,this.view=p.encode(pe),this.buffer=e?e.from(this.view.buffer,0,this.view.byteLength):{}}}class L{constructor(){this.cache=new Map}get(pe,de){let H=this.cache.get(de);return H===void 0&&(de==="view"?H=function(z,ue){return ue.subarray(z)}.bind(null,pe):H=function(z,ue){return ue.slice(z)}.bind(null,pe),this.cache.set(de,H)),H}}const J=function(ne,pe){let de=0,H=ne.length;for(;de<H&&ne[de]===pe;)de++;for(;H>de&&ne[H-1]===pe;)H--;return ne.slice(de,H)};return abstractSublevel}const{supports}=levelSupports,{Transcoder}=levelTranscoder,{EventEmitter}=eventsExports,{fromCallback:fromCallback$1}=catering,ModuleError$1=moduleError,{AbstractIterator:AbstractIterator$1}=abstractIterator,{DefaultKeyIterator,DefaultValueIterator}=defaultKvIterator,{DeferredIterator,DeferredKeyIterator,DeferredValueIterator}=deferredIterator,{DefaultChainedBatch}=defaultChainedBatch,{getCallback,getOptions}=common,rangeOptions=rangeOptions_1,kPromise$1=Symbol("promise"),kLanded=Symbol("landed"),kResources=Symbol("resources"),kCloseResources=Symbol("closeResources"),kOperations=Symbol("operations"),kUndefer=Symbol("undefer"),kDeferOpen=Symbol("deferOpen"),kOptions$1=Symbol("options"),kStatus=Symbol("status"),kDefaultOptions=Symbol("defaultOptions"),kTranscoder=Symbol("transcoder"),kKeyEncoding=Symbol("keyEncoding"),kValueEncoding=Symbol("valueEncoding"),noop=()=>{};let AbstractLevel$1=class extends EventEmitter{constructor(e,t){if(super(),typeof e!="object"||e===null)throw new TypeError("The first argument 'manifest' must be an object");t=getOptions(t);const{keyEncoding:n,valueEncoding:o,passive:s,...u}=t;this[kResources]=new Set,this[kOperations]=[],this[kDeferOpen]=!0,this[kOptions$1]=u,this[kStatus]="opening",this.supports=supports(e,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:e.snapshots!==!1,permanence:e.permanence!==!1,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:e.encodings||{},events:Object.assign({},e.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[kTranscoder]=new Transcoder(formats(this)),this[kKeyEncoding]=this[kTranscoder].encoding(n||"utf8"),this[kValueEncoding]=this[kTranscoder].encoding(o||"utf8");for(const f of this[kTranscoder].encodings())this.supports.encodings[f.commonName]||(this.supports.encodings[f.commonName]=!0);this[kDefaultOptions]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[kKeyEncoding].commonName,valueEncoding:this[kValueEncoding].commonName}),key:Object.freeze({keyEncoding:this[kKeyEncoding].commonName})},this.nextTick(()=>{this[kDeferOpen]&&this.open({passive:!1},noop)})}get status(){return this[kStatus]}keyEncoding(e){return this[kTranscoder].encoding(e??this[kKeyEncoding])}valueEncoding(e){return this[kTranscoder].encoding(e??this[kValueEncoding])}open(e,t){t=getCallback(e,t),t=fromCallback$1(t,kPromise$1),e={...this[kOptions$1],...getOptions(e)},e.createIfMissing=e.createIfMissing!==!1,e.errorIfExists=!!e.errorIfExists;const n=o=>{this[kStatus]==="closing"||this[kStatus]==="opening"?this.once(kLanded,o?()=>n(o):n):this[kStatus]!=="open"?t(new ModuleError$1("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:o})):t()};return e.passive?this[kStatus]==="opening"?this.once(kLanded,n):this.nextTick(n):this[kStatus]==="closed"||this[kDeferOpen]?(this[kDeferOpen]=!1,this[kStatus]="opening",this.emit("opening"),this._open(e,o=>{if(o){this[kStatus]="closed",this[kCloseResources](()=>{this.emit(kLanded),n(o)}),this[kUndefer]();return}this[kStatus]="open",this[kUndefer](),this.emit(kLanded),this[kStatus]==="open"&&this.emit("open"),this[kStatus]==="open"&&this.emit("ready"),n()})):this[kStatus]==="open"?this.nextTick(n):this.once(kLanded,()=>this.open(e,t)),t[kPromise$1]}_open(e,t){this.nextTick(t)}close(e){e=fromCallback$1(e,kPromise$1);const t=n=>{this[kStatus]==="opening"||this[kStatus]==="closing"?this.once(kLanded,n?t(n):t):this[kStatus]!=="closed"?e(new ModuleError$1("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:n})):e()};if(this[kStatus]==="open"){this[kStatus]="closing",this.emit("closing");const n=o=>{this[kStatus]="open",this[kUndefer](),this.emit(kLanded),t(o)};this[kCloseResources](()=>{this._close(o=>{if(o)return n(o);this[kStatus]="closed",this[kUndefer](),this.emit(kLanded),this[kStatus]==="closed"&&this.emit("closed"),t()})})}else this[kStatus]==="closed"?this.nextTick(t):this.once(kLanded,()=>this.close(e));return e[kPromise$1]}[kCloseResources](e){if(this[kResources].size===0)return this.nextTick(e);let t=this[kResources].size,n=!0;const o=()=>{--t===0&&(n?this.nextTick(e):e())};for(const s of this[kResources])s.close(o);n=!1,this[kResources].clear()}_close(e){this.nextTick(e)}get(e,t,n){if(n=getCallback(t,n),n=fromCallback$1(n,kPromise$1),t=getOptions(t,this[kDefaultOptions].entry),this[kStatus]==="opening")return this.defer(()=>this.get(e,t,n)),n[kPromise$1];if(maybeError(this,n))return n[kPromise$1];const o=this._checkKey(e);if(o)return this.nextTick(n,o),n[kPromise$1];const s=this.keyEncoding(t.keyEncoding),u=this.valueEncoding(t.valueEncoding),f=s.format,l=u.format;return(t.keyEncoding!==f||t.valueEncoding!==l)&&(t=Object.assign({},t,{keyEncoding:f,valueEncoding:l})),this._get(this.prefixKey(s.encode(e),f),t,(h,p)=>{if(h)return(h.code==="LEVEL_NOT_FOUND"||h.notFound||/NotFound/i.test(h))&&(h.code||(h.code="LEVEL_NOT_FOUND"),h.notFound||(h.notFound=!0),h.status||(h.status=404)),n(h);try{p=u.decode(p)}catch(m){return n(new ModuleError$1("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:m}))}n(null,p)}),n[kPromise$1]}_get(e,t,n){this.nextTick(n,new Error("NotFound"))}getMany(e,t,n){if(n=getCallback(t,n),n=fromCallback$1(n,kPromise$1),t=getOptions(t,this[kDefaultOptions].entry),this[kStatus]==="opening")return this.defer(()=>this.getMany(e,t,n)),n[kPromise$1];if(maybeError(this,n))return n[kPromise$1];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'keys' must be an array")),n[kPromise$1];if(e.length===0)return this.nextTick(n,null,[]),n[kPromise$1];const o=this.keyEncoding(t.keyEncoding),s=this.valueEncoding(t.valueEncoding),u=o.format,f=s.format;(t.keyEncoding!==u||t.valueEncoding!==f)&&(t=Object.assign({},t,{keyEncoding:u,valueEncoding:f}));const l=new Array(e.length);for(let h=0;h<e.length;h++){const p=e[h],m=this._checkKey(p);if(m)return this.nextTick(n,m),n[kPromise$1];l[h]=this.prefixKey(o.encode(p),u)}return this._getMany(l,t,(h,p)=>{if(h)return n(h);try{for(let m=0;m<p.length;m++)p[m]!==void 0&&(p[m]=s.decode(p[m]))}catch(m){return n(new ModuleError$1(`Could not decode one or more of ${p.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:m}))}n(null,p)}),n[kPromise$1]}_getMany(e,t,n){this.nextTick(n,null,new Array(e.length).fill(void 0))}put(e,t,n,o){if(o=getCallback(n,o),o=fromCallback$1(o,kPromise$1),n=getOptions(n,this[kDefaultOptions].entry),this[kStatus]==="opening")return this.defer(()=>this.put(e,t,n,o)),o[kPromise$1];if(maybeError(this,o))return o[kPromise$1];const s=this._checkKey(e)||this._checkValue(t);if(s)return this.nextTick(o,s),o[kPromise$1];const u=this.keyEncoding(n.keyEncoding),f=this.valueEncoding(n.valueEncoding),l=u.format,h=f.format;(n.keyEncoding!==l||n.valueEncoding!==h)&&(n=Object.assign({},n,{keyEncoding:l,valueEncoding:h}));const p=this.prefixKey(u.encode(e),l),m=f.encode(t);return this._put(p,m,n,b=>{if(b)return o(b);this.emit("put",e,t),o()}),o[kPromise$1]}_put(e,t,n,o){this.nextTick(o)}del(e,t,n){if(n=getCallback(t,n),n=fromCallback$1(n,kPromise$1),t=getOptions(t,this[kDefaultOptions].key),this[kStatus]==="opening")return this.defer(()=>this.del(e,t,n)),n[kPromise$1];if(maybeError(this,n))return n[kPromise$1];const o=this._checkKey(e);if(o)return this.nextTick(n,o),n[kPromise$1];const s=this.keyEncoding(t.keyEncoding),u=s.format;return t.keyEncoding!==u&&(t=Object.assign({},t,{keyEncoding:u})),this._del(this.prefixKey(s.encode(e),u),t,f=>{if(f)return n(f);this.emit("del",e),n()}),n[kPromise$1]}_del(e,t,n){this.nextTick(n)}batch(e,t,n){if(!arguments.length){if(this[kStatus]==="opening")return new DefaultChainedBatch(this);if(this[kStatus]!=="open")throw new ModuleError$1("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(typeof e=="function"?n=e:n=getCallback(t,n),n=fromCallback$1(n,kPromise$1),t=getOptions(t,this[kDefaultOptions].empty),this[kStatus]==="opening")return this.defer(()=>this.batch(e,t,n)),n[kPromise$1];if(maybeError(this,n))return n[kPromise$1];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'operations' must be an array")),n[kPromise$1];if(e.length===0)return this.nextTick(n),n[kPromise$1];const o=new Array(e.length),{keyEncoding:s,valueEncoding:u,...f}=t;for(let l=0;l<e.length;l++){if(typeof e[l]!="object"||e[l]===null)return this.nextTick(n,new TypeError("A batch operation must be an object")),n[kPromise$1];const h=Object.assign({},e[l]);if(h.type!=="put"&&h.type!=="del")return this.nextTick(n,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),n[kPromise$1];const p=this._checkKey(h.key);if(p)return this.nextTick(n,p),n[kPromise$1];const m=h.sublevel!=null?h.sublevel:this,b=m.keyEncoding(h.keyEncoding||s),S=b.format;if(h.key=m.prefixKey(b.encode(h.key),S),h.keyEncoding=S,h.type==="put"){const A=this._checkValue(h.value);if(A)return this.nextTick(n,A),n[kPromise$1];const L=m.valueEncoding(h.valueEncoding||u);h.value=L.encode(h.value),h.valueEncoding=L.format}m!==this&&(h.sublevel=null),o[l]=h}return this._batch(o,f,l=>{if(l)return n(l);this.emit("batch",e),n()}),n[kPromise$1]}_batch(e,t,n){this.nextTick(n)}sublevel(e,t){return this._sublevel(e,AbstractSublevel.defaults(t))}_sublevel(e,t){return new AbstractSublevel(this,e,t)}prefixKey(e,t){return e}clear(e,t){if(t=getCallback(e,t),t=fromCallback$1(t,kPromise$1),e=getOptions(e,this[kDefaultOptions].empty),this[kStatus]==="opening")return this.defer(()=>this.clear(e,t)),t[kPromise$1];if(maybeError(this,t))return t[kPromise$1];const n=e,o=this.keyEncoding(e.keyEncoding);return e=rangeOptions(e,o),e.keyEncoding=o.format,e.limit===0?this.nextTick(t):this._clear(e,s=>{if(s)return t(s);this.emit("clear",n),t()}),t[kPromise$1]}_clear(e,t){this.nextTick(t)}iterator(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=rangeOptions(e,t),e.keys=e.keys!==!1,e.values=e.values!==!1,e[AbstractIterator$1.keyEncoding]=t,e[AbstractIterator$1.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[kStatus]==="opening")return new DeferredIterator(this,e);if(this[kStatus]!=="open")throw new ModuleError$1("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(e)}_iterator(e){return new AbstractIterator$1(this,e)}keys(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=rangeOptions(e,t),e[AbstractIterator$1.keyEncoding]=t,e[AbstractIterator$1.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[kStatus]==="opening")return new DeferredKeyIterator(this,e);if(this[kStatus]!=="open")throw new ModuleError$1("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(e)}_keys(e){return new DefaultKeyIterator(this,e)}values(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=rangeOptions(e,t),e[AbstractIterator$1.keyEncoding]=t,e[AbstractIterator$1.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[kStatus]==="opening")return new DeferredValueIterator(this,e);if(this[kStatus]!=="open")throw new ModuleError$1("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(e)}_values(e){return new DefaultValueIterator(this,e)}defer(e){if(typeof e!="function")throw new TypeError("The first argument must be a function");this[kOperations].push(e)}[kUndefer](){if(this[kOperations].length===0)return;const e=this[kOperations];this[kOperations]=[];for(const t of e)t()}attachResource(e){if(typeof e!="object"||e===null||typeof e.close!="function")throw new TypeError("The first argument must be a resource object");this[kResources].add(e)}detachResource(e){this[kResources].delete(e)}_chainedBatch(){return new DefaultChainedBatch(this)}_checkKey(e){if(e==null)return new ModuleError$1("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(e){if(e==null)return new ModuleError$1("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}};AbstractLevel$1.prototype.nextTick=requireNextTickBrowser();const{AbstractSublevel}=requireAbstractSublevel()({AbstractLevel:AbstractLevel$1});abstractLevel.AbstractLevel=AbstractLevel$1;abstractLevel.AbstractSublevel=AbstractSublevel;const maybeError=function(r,e){return r[kStatus]!=="open"?(r.nextTick(e,new ModuleError$1("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0):!1},formats=function(r){return Object.keys(r.supports.encodings).filter(e=>!!r.supports.encodings[e])};abstractLevel$1.AbstractLevel=abstractLevel.AbstractLevel;abstractLevel$1.AbstractSublevel=abstractLevel.AbstractSublevel;abstractLevel$1.AbstractIterator=abstractIterator.AbstractIterator;abstractLevel$1.AbstractKeyIterator=abstractIterator.AbstractKeyIterator;abstractLevel$1.AbstractValueIterator=abstractIterator.AbstractValueIterator;abstractLevel$1.AbstractChainedBatch=abstractChainedBatch.AbstractChainedBatch;/*! run-parallel-limit. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var runParallelLimit_1=runParallelLimit;const queueMicrotask$1=queueMicrotask_1;function runParallelLimit(r,e,t){if(typeof e!="number")throw new Error("second argument must be a Number");let n,o,s,u,f,l=!0,h;Array.isArray(r)?(n=[],s=o=r.length):(u=Object.keys(r),n={},s=o=u.length);function p(b){function S(){t&&t(b,n),t=null}l?queueMicrotask$1(S):S()}function m(b,S,A){if(n[b]=A,S&&(f=!0),--s===0||S)p(S);else if(!f&&h<o){let L;u?(L=u[h],h+=1,r[L](function(J,ne){m(L,J,ne)})):(L=h,h+=1,r[L](function(J,ne){m(L,J,ne)}))}}h=e,s?u?u.some(function(b,S){return r[b](function(A,L){m(b,A,L)}),S===e-1}):r.some(function(b,S){return b(function(A,L){m(S,A,L)}),S===e-1}):p(null),l=!1}var iterator={},keyRange=function r(e){const t=e.gte!==void 0?e.gte:e.gt!==void 0?e.gt:void 0,n=e.lte!==void 0?e.lte:e.lt!==void 0?e.lt:void 0,o=e.gte===void 0,s=e.lte===void 0;return t!==void 0&&n!==void 0?IDBKeyRange.bound(t,n,o,s):t!==void 0?IDBKeyRange.lowerBound(t,o):n!==void 0?IDBKeyRange.upperBound(n,s):null};const textEncoder=new TextEncoder;var deserialize$2=function(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):textEncoder.encode(r)};const{AbstractIterator}=abstractLevel$1,createKeyRange$1=keyRange,deserialize$1=deserialize$2,kCache=Symbol("cache"),kFinished=Symbol("finished"),kOptions=Symbol("options"),kCurrentOptions=Symbol("currentOptions"),kPosition=Symbol("position"),kLocation$1=Symbol("location"),kFirst=Symbol("first"),emptyOptions={};let Iterator$1=class extends AbstractIterator{constructor(e,t,n){super(e,n),this[kCache]=[],this[kFinished]=this.limit===0,this[kOptions]=n,this[kCurrentOptions]={...n},this[kPosition]=void 0,this[kLocation$1]=t,this[kFirst]=!0}_nextv(e,t,n){if(this[kFirst]=!1,this[kFinished])return this.nextTick(n,null,[]);if(this[kCache].length>0)return e=Math.min(e,this[kCache].length),this.nextTick(n,null,this[kCache].splice(0,e));this[kPosition]!==void 0&&(this[kOptions].reverse?(this[kCurrentOptions].lt=this[kPosition],this[kCurrentOptions].lte=void 0):(this[kCurrentOptions].gt=this[kPosition],this[kCurrentOptions].gte=void 0));let o;try{o=createKeyRange$1(this[kCurrentOptions])}catch{return this[kFinished]=!0,this.nextTick(n,null,[])}const s=this.db.db.transaction([this[kLocation$1]],"readonly"),u=s.objectStore(this[kLocation$1]),f=[];if(this[kOptions].reverse){const l=!this[kOptions].values&&u.openKeyCursor?"openKeyCursor":"openCursor";u[l](o,"prev").onsuccess=h=>{const p=h.target.result;if(p){const{key:m,value:b}=p;this[kPosition]=m,f.push([this[kOptions].keys&&m!==void 0?deserialize$1(m):void 0,this[kOptions].values&&b!==void 0?deserialize$1(b):void 0]),f.length<e?p.continue():maybeCommit(s)}else this[kFinished]=!0}}else{let l,h;const p=()=>{if(l===void 0||h===void 0)return;const m=Math.max(l.length,h.length);m===0||e===1/0?this[kFinished]=!0:this[kPosition]=l[m-1],f.length=m;for(let b=0;b<m;b++){const S=l[b],A=h[b];f[b]=[this[kOptions].keys&&S!==void 0?deserialize$1(S):void 0,this[kOptions].values&&A!==void 0?deserialize$1(A):void 0]}maybeCommit(s)};this[kOptions].keys||e<1/0?u.getAllKeys(o,e<1/0?e:void 0).onsuccess=m=>{l=m.target.result,p()}:(l=[],this.nextTick(p)),this[kOptions].values?u.getAll(o,e<1/0?e:void 0).onsuccess=m=>{h=m.target.result,p()}:(h=[],this.nextTick(p))}s.onabort=()=>{n(s.error||new Error("aborted by user")),n=null},s.oncomplete=()=>{n(null,f),n=null}}_next(e){if(this[kCache].length>0){const[t,n]=this[kCache].shift();this.nextTick(e,null,t,n)}else if(this[kFinished])this.nextTick(e);else{let t=Math.min(100,this.limit-this.count);this[kFirst]&&(this[kFirst]=!1,t=1),this._nextv(t,emptyOptions,(n,o)=>{if(n)return e(n);this[kCache]=o,this._next(e)})}}_all(e,t){this[kFirst]=!1;const n=this[kCache].splice(0,this[kCache].length),o=this.limit-this.count-n.length;if(o<=0)return this.nextTick(t,null,n);this._nextv(o,emptyOptions,(s,u)=>{if(s)return t(s);n.length>0&&(u=n.concat(u)),t(null,u)})}_seek(e,t){this[kFirst]=!0,this[kCache]=[],this[kFinished]=!1,this[kPosition]=void 0,this[kCurrentOptions]={...this[kOptions]};let n;try{n=createKeyRange$1(this[kOptions])}catch{this[kFinished]=!0;return}n!==null&&!n.includes(e)?this[kFinished]=!0:this[kOptions].reverse?this[kCurrentOptions].lte=e:this[kCurrentOptions].gte=e}};iterator.Iterator=Iterator$1;function maybeCommit(r){typeof r.commit=="function"&&r.commit()}var clear$1=function r(e,t,n,o,s){if(o.limit===0)return e.nextTick(s);const u=e.db.transaction([t],"readwrite"),f=u.objectStore(t);let l=0;u.oncomplete=function(){s()},u.onabort=function(){s(u.error||new Error("aborted by user"))};const h=f.openKeyCursor?"openKeyCursor":"openCursor",p=o.reverse?"prev":"next";f[h](n,p).onsuccess=function(m){const b=m.target.result;b&&(f.delete(b.key).onsuccess=function(){(o.limit<=0||++l<o.limit)&&b.continue()})}};const{AbstractLevel}=abstractLevel$1,ModuleError=moduleError,parallel=runParallelLimit_1,{fromCallback}=catering,{Iterator}=iterator,deserialize=deserialize$2,clear=clear$1,createKeyRange=keyRange,DEFAULT_PREFIX="level-js-",kIDB=Symbol("idb"),kNamePrefix=Symbol("namePrefix"),kLocation=Symbol("location"),kVersion=Symbol("version"),kStore=Symbol("store"),kOnComplete=Symbol("onComplete"),kPromise=Symbol("promise");class BrowserLevel extends AbstractLevel{constructor(e,t,n){if(typeof t=="function"||typeof n=="function")throw new ModuleError("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});const{prefix:o,version:s,...u}=t||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},u),typeof e!="string")throw new Error("constructor requires a location string argument");this[kLocation]=e,this[kNamePrefix]=o??DEFAULT_PREFIX,this[kVersion]=parseInt(s||1,10),this[kIDB]=null}get location(){return this[kLocation]}get namePrefix(){return this[kNamePrefix]}get version(){return this[kVersion]}get db(){return this[kIDB]}get type(){return"browser-level"}_open(e,t){const n=indexedDB.open(this[kNamePrefix]+this[kLocation],this[kVersion]);n.onerror=function(){t(n.error||new Error("unknown error"))},n.onsuccess=()=>{this[kIDB]=n.result,t()},n.onupgradeneeded=o=>{const s=o.target.result;s.objectStoreNames.contains(this[kLocation])||s.createObjectStore(this[kLocation])}}[kStore](e){return this[kIDB].transaction([this[kLocation]],e).objectStore(this[kLocation])}[kOnComplete](e,t){const n=e.transaction;n.onabort=function(){t(n.error||new Error("aborted by user"))},n.oncomplete=function(){t(null,e.result)}}_get(e,t,n){const o=this[kStore]("readonly");let s;try{s=o.get(e)}catch(u){return this.nextTick(n,u)}this[kOnComplete](s,function(u,f){if(u)return n(u);if(f===void 0)return n(new ModuleError("Entry not found",{code:"LEVEL_NOT_FOUND"}));n(null,deserialize(f))})}_getMany(e,t,n){const o=this[kStore]("readonly"),s=e.map(u=>f=>{let l;try{l=o.get(u)}catch(h){return f(h)}l.onsuccess=()=>{const h=l.result;f(null,h===void 0?h:deserialize(h))},l.onerror=h=>{h.stopPropagation(),f(l.error)}});parallel(s,16,n)}_del(e,t,n){const o=this[kStore]("readwrite");let s;try{s=o.delete(e)}catch(u){return this.nextTick(n,u)}this[kOnComplete](s,n)}_put(e,t,n,o){const s=this[kStore]("readwrite");let u;try{u=s.put(t,e)}catch(f){return this.nextTick(o,f)}this[kOnComplete](u,o)}_iterator(e){return new Iterator(this,this[kLocation],e)}_batch(e,t,n){const o=this[kStore]("readwrite"),s=o.transaction;let u=0,f;s.onabort=function(){n(f||s.error||new Error("aborted by user"))},s.oncomplete=function(){n()};function l(){const h=e[u++],p=h.key;let m;try{m=h.type==="del"?o.delete(p):o.put(h.value,p)}catch(b){f=b,s.abort();return}u<e.length?m.onsuccess=l:typeof s.commit=="function"&&s.commit()}l()}_clear(e,t){let n,o;try{n=createKeyRange(e)}catch{return this.nextTick(t)}if(e.limit>=0)return clear(this,this[kLocation],n,e,t);try{const s=this[kStore]("readwrite");o=n?s.delete(n):s.clear()}catch(s){return this.nextTick(t,s)}this[kOnComplete](o,t)}_close(e){this[kIDB].close(),this.nextTick(e)}}BrowserLevel.destroy=function(r,e,t){typeof e=="function"&&(t=e,e=DEFAULT_PREFIX),t=fromCallback(t,kPromise);const n=indexedDB.deleteDatabase(e+r);return n.onsuccess=function(){t()},n.onerror=function(o){t(o)},t[kPromise]};browserLevel.BrowserLevel=BrowserLevel;var Level=browserLevel.BrowserLevel;class LevelDatastore extends BaseDatastore{constructor(e,t={}){super(),this.db=typeof e=="string"?new Level(e,{...t,keyEncoding:"utf8",valueEncoding:"view"}):e,this.opts={createIfMissing:!0,compression:!1,...t}}async open(){try{await this.db.open(this.opts)}catch(e){throw dbOpenFailedError(e)}}async put(e,t){try{await this.db.put(e.toString(),t)}catch(n){throw dbWriteFailedError(n)}}async get(e){let t;try{t=await this.db.get(e.toString())}catch(n){throw n.notFound?notFoundError(n):dbWriteFailedError(n)}return t}async has(e){try{await this.db.get(e.toString())}catch(t){if(t.notFound)return!1;throw t}return!0}async delete(e){try{await this.db.del(e.toString())}catch(t){throw dbDeleteFailedError(t)}}close(){return this.db&&this.db.close()}batch(){const e=[];return{put:(t,n)=>{e.push({type:"put",key:t.toString(),value:n})},delete:t=>{e.push({type:"del",key:t.toString()})},commit:()=>this.db.batch(e)}}query(e){let t=this._query({values:!0,prefix:e.prefix});Array.isArray(e.filters)&&(t=e.filters.reduce((s,u)=>filter$1(s,u),t)),Array.isArray(e.orders)&&(t=e.orders.reduce((s,u)=>sort(s,u),t));const{offset:n,limit:o}=e;if(n){let s=0;t=filter$1(t,()=>s++>=n)}return o&&(t=take(t,o)),t}queryKeys(e){let t=map(this._query({values:!1,prefix:e.prefix}),({key:s})=>s);Array.isArray(e.filters)&&(t=e.filters.reduce((s,u)=>filter$1(s,u),t)),Array.isArray(e.orders)&&(t=e.orders.reduce((s,u)=>sort(s,u),t));const{offset:n,limit:o}=e;if(n){let s=0;t=filter$1(t,()=>s++>=n)}return o&&(t=take(t,o)),t}_query(e){const t={keys:!0,keyEncoding:"buffer",values:e.values};if(e.prefix!=null){const o=e.prefix.toString();t.gte=o,t.lt=o+"ÿ"}const n=this.db.iterator(t);if(n[Symbol.asyncIterator])return levelIteratorToIterator(n);if(n.next!=null&&n.end!=null)return oldLevelIteratorToIterator(n);throw new Error("Level returned incompatible iterator")}}async function*levelIteratorToIterator(r){for await(const[e,t]of r)yield{key:new Key(e,!1),value:t};await r.close()}function oldLevelIteratorToIterator(r){return{[Symbol.asyncIterator](){return{next:()=>new Promise((e,t)=>{r.next((n,o,s)=>{if(n)return t(n);if(o==null)return r.end(u=>{if(u)return t(u);e({done:!0,value:void 0})});e({done:!1,value:{key:new Key(o,!1),value:s}})})}),return:()=>new Promise((e,t)=>{r.end(n=>{if(n)return t(n);e({done:!0,value:void 0})})})}}}}function create$1(r){const e=new MemoryDatastore;return createRepo(r,t=>{const n={[code$3]:dagPB,[name$2]:dagPB,[code$4]:dagCBOR,[name$3]:dagCBOR,[code$2]:raw,[name$1]:raw};return Promise.resolve(n[t])},{root:new LevelDatastore(`${r}/root`,{prefix:"",version:2}),blocks:new BlockstoreDatastoreAdapter(new LevelDatastore(`${r}/blocks`,{prefix:"",version:2})),keys:new LevelDatastore(`${r}/keys`,{prefix:"",version:2}),datastore:e,pins:new LevelDatastore(`${r}/pins`,{prefix:"",version:2})},{repoLock:{lock:async()=>({close:async()=>{}}),locked:async()=>!1},autoMigrate:!1})}const latestPeerTimeoutIds={};var gu;const isSafari=/^((?!chrome|android).)*safari/i.test(((gu=globalThis.navigator)==null?void 0:gu.userAgent)||""),KEEP_ALIVE_INTERVAL=1*60*1e3,KEEP_TRYING_INTERVAL=5*60*1e3,BACKOFF_INIT={retryNumber:0,lastBackoff:0,currentBackoff:1e3},OPTIONS={config:{Addresses:{Delegates:[]},Bootstrap:[],Discovery:{webRTCStar:{Enabled:!1}},Pubsub:{Enabled:!1}},preload:{enabled:!1,addresses:[]},libp2p:{peerDiscovery:[],connectionManager:{autoDial:!1}},init:{algorithm:isSafari?RSA:void 0,emptyRepo:!0}};async function createAndConnect(r,e,t,n,o){const s=await listPeers(r.storage,t);if(s.length===0)throw new Error("💥 Couldn't start IPFS node, peer list is empty");const u=create$1(n),f=await e.create({...OPTIONS,repo:u});return s.forEach(l=>{latestPeerTimeoutIds[l.toString()]=null,tryConnecting(f,l,o)}),globalThis.addEventListener("online",async()=>{(await listPeers(r.storage,t)).filter(l=>{const h=l.toString();return!h.includes("/localhost/")&&!h.includes("/127.0.0.1/")&&!h.includes("/0.0.0.0/")}).forEach(l=>{tryConnecting(f,l,o)})}),o&&console.log("🚀 Started IPFS node"),{ipfs:f,repo:u}}function fetchPeers(r){return fetch(r).then(e=>e.json()).then(e=>Array.isArray(e)?e:[]).then(e=>e.filter(t=>isString(t)&&t.includes("/wss/"))).catch(()=>{throw new Error("💥 Couldn't start IPFS node, failed to fetch peer list")})}async function listPeers(r,e){let t;const n=`ipfs-peers-${e}`,o=await r.getItem(n);return isString(o)&&o.trim()!==""?(t=JSON.parse(o),fetchPeers(e).then(s=>r.setItem(n,JSON.stringify(s))).catch(s=>{console.error(s)})):(t=await fetchPeers(e),await r.setItem(n,JSON.stringify(t))),t.map(multiaddr)}function keepAlive(r,e,t,n){let o=null;t.currentBackoff<KEEP_TRYING_INTERVAL?o=setTimeout(()=>reconnect(r,e,t,n),t.currentBackoff):o=setTimeout(()=>reconnect(r,e,t,n),KEEP_TRYING_INTERVAL),latestPeerTimeoutIds[e.toString()]=o,ping(r,e).then(({latency:s})=>{const u={connected:!0,lastConnectedAt:Date.now(),latency:s};report(e,u),o&&clearTimeout(o),o===latestPeerTimeoutIds[e.toString()]&&setTimeout(()=>keepAlive(r,e,BACKOFF_INIT,u),KEEP_ALIVE_INTERVAL)}).catch(()=>{})}async function reconnect(r,e,t,n){const o={...n,connected:!1,latency:null};report(e,o);try{await r.swarm.disconnect(e),await r.swarm.connect(e)}catch{}if(t.currentBackoff<KEEP_TRYING_INTERVAL){const s={retryNumber:t.retryNumber+1,lastBackoff:t.currentBackoff,currentBackoff:t.lastBackoff+t.currentBackoff};keepAlive(r,e,s,o)}else keepAlive(r,e,t,o)}function tryConnecting(r,e,t){ping(r,e).then(({latency:n})=>r.swarm.connect(e,{timeout:60*1e3}).then(()=>{t&&console.log(`🪐 Connected to ${e}`);const o={connected:!0,lastConnectedAt:Date.now(),latency:n};report(e,o),setTimeout(()=>keepAlive(r,e,BACKOFF_INIT,o),KEEP_ALIVE_INTERVAL)})).catch(()=>{t&&console.log(`🪓 Could not connect to ${e}`);const n={connected:!1,lastConnectedAt:null,latency:null};report(e,n),keepAlive(r,e,BACKOFF_INIT,n)})}async function ping(r,e){return r.libp2p.ping(e).then(t=>({latency:t}))}let peerConnections=[];function report(r,e){peerConnections=peerConnections.filter(n=>n.peer!==r).concat({peer:r,status:e}),peerConnections.every(n=>!n.status.connected),peerConnections.reduce((n,{status:o})=>n>=(o.lastConnectedAt||0)?n:o.lastConnectedAt||0,0);const t=peerConnections.filter(n=>n.status.latency!==null);t.length>0&&peerConnections.reduce((n,o)=>n+(o.status.latency||0),0)/t.length}const DEFAULT_CDN_URL="https://unpkg.com/ipfs-core@0.17.0/dist/index.min.js",nodeWithPkg=(r,e,t,n,o)=>createAndConnect(r,e,t,n,o),pkgFromCDN=async r=>{if(!r)throw new Error("This function requires a URL to a CDN");return __vitePreload(()=>import(r),[],import.meta.url).then(e=>self.IpfsCore)};async function implementation$c(r){return{getBlock:async e=>{const{ipfs:t}=await r();return t.block.get(e)},getUnixDirectory:async e=>{const{ipfs:t}=await r(),n=[];for await(const o of t.ls(e)){const{name:s="",cid:u,size:f,type:l}=o;n.push({name:s,cid:u,size:f,isFile:l!=="dir"})}return n},getUnixFile:async e=>{const{ipfs:t}=await r(),n=[];for await(const o of t.cat(e))n.push(o);return concat$2(n)},putBlock:async(e,t)=>{const{repo:n}=await r(),o=getByIdentifier(t),s=await sha256.digest(e),u=CID$1.createV1(o.code,s);return await n.blocks.put(u,e),u},putChunked:async e=>{const{ipfs:t}=await r();return{...await t.add(e,{cidVersion:1,hashAlg:"sha2-256",rawLeaves:!0,wrapWithDirectory:!1,preload:!1,pin:!1}),isFile:!0}},size:async e=>{const{ipfs:t}=await r();return(await t.files.stat(`/ipfs/${e}`)).cumulativeSize}}}async function implementation$b(r,e,t){let n=null;return implementation$c(async()=>n||(n=await nodeWithPkg(r,await pkgFromCDN(DEFAULT_CDN_URL),e,t,!1),n))}async function implementation$a(r,e){return implementation$b(r,PRODUCTION.server+"/ipfs/peers",e)}function endpoint(r){return({rootDID:e})=>`${r}/user/link/${e}`}const createWssChannel=async(r,e,t)=>{const{username:n,handleMessage:o}=t,s=await waitForRootDid(r,n);if(!s)throw new Error(`Failed to lookup DID for ${n}`);const u=`deviceLink#${s}`;console.log("Opening channel",u);const f=new WebSocket(e({rootDID:s}));await waitForOpenConnection(f),f.onmessage=o;const l=publishOnWssChannel(f),h=closeWssChannel(f);return{send:l,close:h}},waitForRootDid=async(r,e)=>{let t=await r.didRoot.lookup(e).catch(()=>(console.warn("Could not fetch root DID. Retrying."),null));return t||new Promise((n,o)=>{let u=0;const f=setInterval(async()=>{if(t=await r.didRoot.lookup(e).catch(()=>(console.warn("Could not fetch root DID. Retrying."),null)),!t&&u<10){u++;return}else!t&&u===10&&o("Failed to fetch root DID.");clearInterval(f),n(t)},1e3)})},waitForOpenConnection=async r=>new Promise((e,t)=>{r.onopen=()=>e(),r.onerror=()=>t("Websocket channel could not be opened")}),closeWssChannel=r=>function(){r&&r.close(1e3)},publishOnWssChannel=r=>function(e){const t=typeof e=="string"?new TextEncoder().encode(e).buffer:e;r==null||r.send(t)},USERNAME_BLOCKLIST=["fission","ipfs","ipns","did","id","identity",".htaccess","htaccess",".htpasswd","htpasswd",".well-known","well-known","400","401","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","421","422","423","424","426","428","429","431","500","501","502","503","504","505","506","507","508","509","510","511","_domainkey","about","about-us","abuse","access","account","accounts","ad","add","admin","administration","administrator","ads","ads.txt","advertise","advertising","aes128-ctr","aes128-gcm","aes192-ctr","aes256-ctr","aes256-gcm","affiliate","affiliates","ajax","alert","alerts","alpha","amp","analytics","api","app","app-ads.txt","apps","asc","assets","atom","auth","authentication","authorize","autoconfig","autodiscover","avatar","backup","banner","banners","bbs","beta","billing","billings","blog","blogs","board","bookmark","bookmarks","broadcasthost","business","buy","cache","calendar","campaign","captcha","careers","cart","cas","categories","category","cdn","cgi","cgi-bin","chacha20-poly1305","change","channel","channels","chart","chat","checkout","clear","client","close","cloud","cms","com","comment","comments","community","compare","compose","config","connect","contact","contest","cookies","copy","copyright","count","cp","cpanel","create","crossdomain.xml","css","curve25519-sha256","customer","customers","customize","dashboard","db","deals","debug","delete","desc","destroy","dev","developer","developers","diffie-hellman-group-exchange-sha256","diffie-hellman-group14-sha1","disconnect","discuss","dns","dns0","dns1","dns2","dns3","dns4","docs","documentation","domain","download","downloads","downvote","draft","drop","ecdh-sha2-nistp256","ecdh-sha2-nistp384","ecdh-sha2-nistp521","edit","editor","email","enterprise","error","errors","event","events","example","exception","exit","explore","export","extensions","false","family","faq","faqs","favicon.ico","features","feed","feedback","feeds","file","files","filter","follow","follower","followers","following","fonts","forgot","forgot-password","forgotpassword","form","forms","forum","forums","friend","friends","ftp","get","git","go","graphql","group","groups","guest","guidelines","guides","head","header","help","hide","hmac-sha","hmac-sha1","hmac-sha1-etm","hmac-sha2-256","hmac-sha2-256-etm","hmac-sha2-512","hmac-sha2-512-etm","home","host","hosting","hostmaster","htpasswd","http","httpd","https","humans.txt","icons","images","imap","img","import","index","info","insert","investors","invitations","invite","invites","invoice","is","isatap","issues","it","jobs","join","js","json","keybase.txt","learn","legal","license","licensing","like","limit","live","load","local","localdomain","localhost","lock","login","logout","lost-password","m","mail","mail0","mail1","mail2","mail3","mail4","mail5","mail6","mail7","mail8","mail9","mailer-daemon","mailerdaemon","map","marketing","marketplace","master","me","media","member","members","message","messages","metrics","mis","mobile","moderator","modify","more","mx","mx1","my","net","network","new","news","newsletter","newsletters","next","nil","no-reply","nobody","noc","none","noreply","notification","notifications","ns","ns0","ns1","ns2","ns3","ns4","ns5","ns6","ns7","ns8","ns9","null","oauth","oauth2","offer","offers","online","openid","order","orders","overview","owa","owner","page","pages","partners","passwd","password","pay","payment","payments","photo","photos","pixel","plans","plugins","policies","policy","pop","pop3","popular","portal","portfolio","post","postfix","postmaster","poweruser","preferences","premium","press","previous","pricing","print","privacy","privacy-policy","private","prod","product","production","profile","profiles","project","projects","public","purchase","put","quota","recover","recovery","redirect","reduce","refund","refunds","register","registration","remove","replies","reply","report","request","request-password","reset","reset-password","response","return","returns","review","reviews","robots.txt","root","rootuser","rsa-sha2-2","rsa-sha2-512","rss","rules","sales","save","script","sdk","search","secure","security","select","services","session","sessions","settings","setup","share","shift","shop","signin","signup","site","sitemap","sites","smtp","sort","source","sql","ssh","ssh-rsa","ssl","ssladmin","ssladministrator","sslwebmaster","stage","staging","stat","static","statistics","stats","status","store","style","styles","stylesheet","stylesheets","subdomain","subscribe","sudo","super","superuser","support","survey","sync","sysadmin","system","tablet","tag","tags","team","telnet","terms","terms-of-use","test","testimonials","theme","themes","today","tools","topic","topics","tour","training","translate","translations","trending","trial","true","umac-128","umac-128-etm","umac-64","umac-64-etm","undefined","unfollow","unlike","unsubscribe","update","upgrade","usenet","user","username","users","uucp","var","verify","video","view","void","vote","vpn","webmail","webmaster","website","widget","widgets","wiki","wpad","write","www","www-data","www1","www2","www3","www4","you","yourname","yourusername","zlib"];async function createAccount(r,e,t){const n=encode$b(await build({audience:await did(r),dependencies:e,issuer:await write(e.crypto)}));return{success:(await fetch(apiUrl(r,"/user"),{method:"PUT",headers:{authorization:`Bearer ${n}`,"content-type":"application/json"},body:JSON.stringify(t)})).status<300}}async function isUsernameAvailable$1(r,e){return!(await fetch(apiUrl(r,`/user/data/${e}`))).ok}function isUsernameValid$1(r){return!r.startsWith("-")&&!r.endsWith("-")&&!r.startsWith("_")&&/^[a-zA-Z0-9_-]+$/.test(r)&&!USERNAME_BLOCKLIST.includes(r.toLowerCase())}function createChannel(r,e,t){return createWssChannel(e.reference,endpoint(`${r.server}${r.apiPath}`.replace(/^https?:\/\//,"wss://")),t)}const isUsernameAvailable=async(r,e)=>isUsernameAvailable$1(r,e),isUsernameValid=async r=>isUsernameValid$1(r),register=async(r,e,t)=>{const{success:n}=await createAccount(r,e,t);return n?register$1(e,{...t,type:TYPE}):{success:!1}};function implementation$9(r,e){const t=implementation$g(e);return{type:t.type,canDelegateAccount:t.canDelegateAccount,delegateAccount:t.delegateAccount,linkDevice:t.linkDevice,session:t.session,isUsernameValid,createChannel:(...n)=>createChannel(r,e,...n),isUsernameAvailable:(...n)=>isUsernameAvailable(r,...n),register:(...n)=>register(r,e,...n)}}async function canDelegateAccount(r,e){const t=await r.reference.didRoot.lookup(e);return await retrieve({crypto:r.crypto,accountDID:t})?canDelegateAccount$1(r,e):!1}async function delegateAccount(r,e,t){const n=await r.reference.didRoot.lookup(e),o=await retrieve({crypto:r.crypto,accountDID:n}),{token:s}=await delegateAccount$2(r,e,t);return{readKey:toString$7(o,"base64pad"),ucan:s}}async function linkDevice(r,e,t){if(!isWnfsLinkingData(t))throw new LinkingError(`Consumer received invalid link device response from producer: Expected read key and ucan, but got ${JSON.stringify(t)}`);const{readKey:n,ucan:o}=t,s=decode$b(o);if(await isValid(r.crypto,s)){await r.storage.setItem(r.storage.KEYS.ACCOUNT_UCAN,o),await store({accountDID:await r.reference.didRoot.lookup(e),crypto:r.crypto,readKey:fromString$2(n)});const u=await write(r.crypto),f=await build({dependencies:r,potency:"APPEND",resource:"*",proof:o,lifetimeInSeconds:60*60*24*30*12*1e3,audience:u,issuer:u});await r.reference.repositories.ucans.add(f)}else throw new LinkingError(`Consumer received invalid link device response from producer. Given ucan is invalid: ${t.ucan}`);await provide(r.storage,{type:TYPE,username:e})}async function session(r,e,t,n){var o;if(e){if(!r.reference.repositories.ucans.find(f=>f.payload.exp<Date.now()+604800?!1:f.payload.ptc==="APPEND"&&f.payload.rsc==="*")){const f=await write(r.crypto),l=await r.storage.getItem(r.storage.KEYS.ACCOUNT_UCAN),h=await build({dependencies:r,potency:"APPEND",resource:"*",proof:l||void 0,lifetimeInSeconds:60*60*24*30*12*1e3,audience:f,issuer:f});await r.reference.repositories.ucans.add(h)}const u=((o=t.fileSystem)==null?void 0:o.loadImmediately)===!1?void 0:await loadFileSystem({config:t,dependencies:{crypto:r.crypto,depot:r.depot,manners:r.manners,reference:r.reference,storage:r.storage},eventEmitter:n.fileSystem,username:e});return new Session({crypto:r.crypto,fs:u,storage:r.storage,type:TYPE,username:e})}return null}function isWnfsLinkingData(r){return isObject$1(r)&&"readKey"in r&&typeof r.readKey=="string"&&"ucan"in r&&typeof r.ucan=="string"}function implementation$8(r){const e=implementation$g(r);return{type:e.type,session,canDelegateAccount:(...t)=>canDelegateAccount(r,...t),delegateAccount:(...t)=>delegateAccount(r,...t),linkDevice:(...t)=>linkDevice(r,...t),createChannel:e.createChannel,isUsernameValid:e.isUsernameValid,isUsernameAvailable:e.isUsernameAvailable,register:e.register}}function implementation$7(r,e){const t=implementation$9(r,e),n=implementation$8(e);return{type:n.type,canDelegateAccount:n.canDelegateAccount,delegateAccount:n.delegateAccount,linkDevice:n.linkDevice,session:n.session,createChannel:t.createChannel,isUsernameValid:t.isUsernameValid,isUsernameAvailable:t.isUsernameAvailable,register:t.register}}function implementation$6(r){return implementation$7(PRODUCTION,r)}async function collect(r,e){const t=new URL(self.location.href),n=t.searchParams.get("authorised");if(!n)return null;const o=t.searchParams.get("username")??"",s=await retry(async()=>translateClassifiedInfo(e,n==="via-postmessage"?await getClassifiedViaPostMessage(r,e.crypto):JSON.parse(toString$7(await e.depot.getUnixFile(decodeCID(n)),"utf8"))),{tries:20,timeout:6e4,timeoutMessage:"Trying to retrieve UCAN(s) and readKey(s) from the auth lobby timed out after 60 seconds."});if(!s)throw new Error("Failed to retrieve secrets from lobby url parameters");return t.searchParams.delete("authorised"),t.searchParams.delete("cancelled"),t.searchParams.delete("newUser"),t.searchParams.delete("username"),history.replaceState(null,document.title,t.toString()),{...s,username:o}}async function request(r,e,t={}){const{permissions:n}=t,o=n==null?void 0:n.app,s=n==null?void 0:n.fs,u=n==null?void 0:n.platform,f=n==null?void 0:n.raw,l=n==null?void 0:n.sharing,h=await exchange(e.crypto),p=await write(e.crypto),m=!!document.body.querySelector("iframe#webnative-ipfs")&&typeof SharedWorker=="function",b=t.returnUrl||window.location.href,S=[["didExchange",h],["didWrite",p],["redirectTo",b],["sdk",VERSION.toString()],["sharedRepo",m?"t":"f"],["sharing",l?"t":"f"]].concat(o?[["appFolder",`${o.creator}/${o.name}`]]:[],s!=null&&s.private?s.private.map(A=>["privatePath",toPosix(A,{absolute:!0})]):[],s!=null&&s.public?s.public.map(A=>["publicPath",toPosix(A,{absolute:!0})]):[],f?[["raw",urlEncode(JSON.stringify(f))]]:[],t.extraParams?Object.entries(t.extraParams):[]).concat((()=>{const A=u==null?void 0:u.apps;switch(typeof A){case"string":return[["app",A]];case"object":return A.map(L=>["app",L]);default:return[]}})());window.location.href=r.lobby+"?"+S.map(([A,L])=>encodeURIComponent(A)+"="+encodeURIComponent(L)).join("&")}async function getClassifiedViaPostMessage(r,e){const t=await exchange(e),n=await new Promise(o=>{const s=document.createElement("iframe");s.id="webnative-secret-exchange",s.style.width="0",s.style.height="0",s.style.border="none",s.style.display="none",document.body.appendChild(s),s.onload=()=>{o(s)},s.src=`${r.lobby}/exchange.html`});return new Promise((o,s)=>{function u(){globalThis.removeEventListener("message",f),document.body.removeChild(n),s()}function f(h){if(new URL(h.origin).host!==new URL(r.lobby).host||h.data==null)return u();let p;try{p=JSON.parse(h.data)}catch{u()}isLobbyClassifiedInfo(p)||u(),globalThis.removeEventListener("message",f);try{document.body.removeChild(n)}catch{}o(p)}if(globalThis.addEventListener("message",f),n.contentWindow==null)throw new Error("Can't import UCANs & readKey(s): No access to its contentWindow");const l={webnative:"exchange-secrets",didExchange:t};n.contentWindow.postMessage(l,n.src)})}function isLobbyClassifiedInfo(r){return isObject$1(r)&&isString(r.sessionKey)&&isString(r.secrets)&&isString(r.iv)}function isLobbySecrets(r){return isObject$1(r)&&isObject$1(r.fs)&&Object.values(r.fs).every(e=>hasProp(e,"key")&&hasProp(e,"bareNameFilter"))&&Array.isArray(r.ucans)&&r.ucans.every(e=>isString(e))}async function translateClassifiedInfo({crypto:r},e){const t=await r.keystore.decrypt(fromString$7(e.sessionKey,"base64pad")),o=t[1]===0?fromString$7(new TextDecoder("utf-16").decode(t),"base64pad"):t,s=await r.aes.decrypt(fromString$7(e.secrets,"base64pad"),o,SymmAlg.AES_GCM,fromString$7(e.iv,"base64pad")),u=JSON.parse(toString$7(s,"utf8"));if(!isLobbySecrets(u))throw new Error("Invalid secrets received");const f=isLobbySecrets(u)?Object.entries(u.fs).map(([h,{bareNameFilter:p,key:m}])=>({bareNameFilter:p,path:fromPosix(h),readKey:fromString$7(m,"base64pad")})):[],l=u.ucans.map(h=>decode$b(h));return{fileSystemSecrets:f,ucans:l}}async function retry(r,e){return await Promise.race([r(),new Promise((t,n)=>e.tries>0?setTimeout(()=>retry(r,{...e,tries:e.tries-1}).then(t,n),e.timeout):setTimeout(()=>n(new Error(e.timeoutMessage)),e.timeout))])}function implementation$5(r,e){return{collect:()=>collect(r,e),request:(...t)=>request(r,e,...t)}}function implementation$4(r){return implementation$5(PRODUCTION,r)}function create({storage:r}){return Repo.create({storage:r,storageName:r.KEYS.CID_LOG})}class Repo extends Repository{constructor(e){super(e)}fromJSON(e){return decodeCID(e)}toJSON(e){return e.toString()}indexOf(e){return this.memoryCache.map(t=>t.toString()).indexOf(e.toString())}newest(){return this.memoryCache[this.memoryCache.length-1]}}async function didRootLookup(r,e){const t=await r.storage.getItem(r.storage.KEYS.ACCOUNT_UCAN);return t?rootIssuer(t):await write(r.crypto)}async function implementation$3(r){return{dataRoot:{domain:()=>{throw new Error("Not implemented")},lookup:()=>{throw new Error("Not implemented")},update:()=>{throw new Error("Not implemented")}},didRoot:{lookup:(...e)=>didRootLookup(r,...e)},dns:{lookupDnsLink,lookupTxtRecord},repositories:{cidLog:await create({storage:r.storage}),ucans:await create$6({storage:r.storage})}}}async function lookup(r,e,t){const n=await lookupOnFisson(r,e,t);if(!n)return null;if(n!==null)return n;try{const o=await lookupDnsLink(t+".files."+r.userDomain);return o?decodeCID(o):null}catch(o){throw console.error(o),new Error("Could not locate user root in DNS")}}async function lookupOnFisson(r,e,t){try{const o=await(await fetch(apiUrl(r,`user/data/${t}`),{cache:"reload"})).json();return decodeCID(o)}catch(n){return e.manners.log("Could not locate user root on Fission server: ",hasProp(n,"toString")?n.toString():n),null}}async function update(r,e,t,n){const o=t.toString();return e.manners.log("🌊 Updating your DNSLink:",o),await fetchWithRetry(apiUrl(r,`user/data/${o}`),{headers:async()=>({authorization:`Bearer ${encode$b(await build({dependencies:e,audience:await did(r),issuer:await write(e.crypto),potency:"APPEND",proof:encode$b(n),resource:n.payload.rsc}))}`}),retries:100,retryDelay:5e3,retryOn:[502,503,504]},{method:"PUT"}).then(s=>(s.status<300?e.manners.log("🪴 DNSLink updated:",o):e.manners.log("🔥 Failed to update DNSLink for:",o),{success:s.status<300})).catch(s=>(e.manners.log("🔥 Failed to update DNSLink for:",o),console.error(s),{success:!1}))}async function fetchWithRetry(r,e,t,n=0){const o=await e.headers(),s=await fetch(r,{...t,headers:{...t.headers,...o}});if(e.retryOn.includes(s.status)){if(n<e.retries)return await new Promise((u,f)=>setTimeout(()=>fetchWithRetry(r,e,t,n+1).then(u,f),e.retryDelay));throw new Error("Too many retries for fetch")}return s}async function root(r,e){try{const t=await lookupTxtRecord(`_did.${e}.${r.userDomain}`);if(t!==null)return t}catch{}throw new Error("Could not locate user DID in DNS.")}async function implementation$2(r,e){const t=await implementation$3(e);return t.dataRoot.domain=n=>`${n}.files.${r.userDomain}`,t.dataRoot.lookup=(...n)=>lookup(r,e,...n),t.dataRoot.update=(...n)=>update(r,e,...n),t.didRoot.lookup=(...n)=>root(r,...n),t}function implementation$1(r){return implementation$2(PRODUCTION,r)}function implementation(r){return{log:r.configuration.debug?console.log:()=>{},warn:r.configuration.debug?console.warn:()=>{},wnfsWasmLookup:e=>fetch(`https://unpkg.com/wnfs@${e}/wasm_wnfs_bg.wasm`),fileSystem:{hooks:{afterLoadExisting:async()=>{},afterLoadNew:async e=>{await e.publish()},beforeLoadExisting:async()=>{},beforeLoadNew:async()=>{}}}}}var ProgramError;(function(r){r.InsecureContext="INSECURE_CONTEXT",r.UnsupportedBrowser="UNSUPPORTED_BROWSER"})(ProgramError||(ProgramError={}));async function program(r){if(!r)throw new Error("Expected a settings object of the type `Partial<Components> & Configuration` as the first parameter");if(globalThis.isSecureContext===!1)throw ProgramError.InsecureContext;if(await isSupported()===!1)throw ProgramError.UnsupportedBrowser;const e=await gatherComponents(r);return assemble(extractConfig(r),e)}async function assemble(r,e){var p,m;const t=r.permissions;await ensureBackwardsCompatibility(e,r);const n=createEmitter(),o=await restore(e.storage),s=(b=>({implementation:b,accountConsumer(S){return createConsumer({auth:b,crypto:e.crypto,manners:e.manners},{username:S})},accountProducer(S){return createProducer({auth:b,crypto:e.crypto,manners:e.manners},{username:S})},isUsernameAvailable:b.isUsernameAvailable,isUsernameValid:b.isUsernameValid,register:b.register,async session(){const S=await restore(e.storage);return S?this.implementation.session(e,S.username,r,{fileSystem:n}):null}}))(e.auth),u={async collect(){const b=await e.capabilities.collect();return b?(await collect$1({capabilities:b,crypto:e.crypto,reference:e.reference,storage:e.storage}),b.username):null},request(b){return e.capabilities.request({permissions:t,...b||{}})},async session(b){var ne;if(!validatePermissions(e.reference.repositories.ucans,t||{}))return console.warn("The present UCANs did not satisfy the configured permissions."),null;const A=await e.reference.didRoot.lookup(b);if(!await validateSecrets(e.crypto,A,t||{}))return console.warn("The present filesystem secrets did not satisfy the configured permissions."),null;await provide(e.storage,{type:SESSION_TYPE,username:b});const J=((ne=r.fileSystem)==null?void 0:ne.loadImmediately)===!1?void 0:await loadFileSystem({config:r,dependencies:e,eventEmitter:n,username:b});return new Session({fs:J,username:b,crypto:e.crypto,storage:e.storage,type:SESSION_TYPE})}};let f=null;if(isCapabilityBasedAuthConfiguration(r)){const b=await u.collect();b&&(f=await u.session(b)),o&&o.type===SESSION_TYPE&&(f=await u.session(o.username))}else o&&o.type!==SESSION_TYPE&&(f=await s.session());const h={...{accountDID:b=>e.reference.didRoot.lookup(b),agentDID:()=>write(e.crypto),sharingDID:()=>exchange(e.crypto),fileSystem:{...listenTo(n),addPublicExchangeKey:b=>addPublicExchangeKey(e.crypto,b),addSampleData:b=>addSampleData(b),hasPublicExchangeKey:b=>hasPublicExchangeKey(e.crypto,b),load:b=>loadFileSystem({config:r,username:b,dependencies:e,eventEmitter:n}),recover:b=>recoverFileSystem({auth:s,dependencies:e,...b})}},configuration:{...r},auth:s,components:e,capabilities:u,session:f};if(r.debug&&(((p=r.debugging)==null?void 0:p.injectIntoGlobalContext)===void 0?!0:(m=r.debugging)==null?void 0:m.injectIntoGlobalContext)){const S=globalThis;S.__webnative=S.__webnative||{},S.__webnative.programs=S.__webnative.programs||{},S.__webnative.programs[namespace(r)]=h}return h}async function gatherComponents(r){const e=extractConfig(r),t=r.crypto||await defaultCryptoComponent(e),n=r.manners||defaultMannersComponent(e),o=r.storage||defaultStorageComponent(e),s=r.reference||await defaultReferenceComponent({crypto:t,manners:n,storage:o}),u=r.depot||await defaultDepotComponent({storage:o},e),f=r.capabilities||defaultCapabilitiesComponent({crypto:t,depot:u});return{auth:r.auth||defaultAuthComponent({crypto:t,reference:s,storage:o}),capabilities:f,crypto:t,depot:u,manners:n,reference:s,storage:o}}function defaultAuthComponent({crypto:r,reference:e,storage:t}){return implementation$6({crypto:r,reference:e,storage:t})}function defaultCapabilitiesComponent({crypto:r,depot:e}){return implementation$4({crypto:r,depot:e})}function defaultCryptoComponent(r){return implementation$f({storeName:namespace(r),exchangeKeyName:"exchange-key",writeKeyName:"write-key"})}function defaultDepotComponent({storage:r},e){return implementation$a({storage:r},`${namespace(e)}/ipfs`)}function defaultMannersComponent(r){return implementation({configuration:r})}function defaultReferenceComponent({crypto:r,manners:e,storage:t}){return implementation$1({crypto:r,manners:e,storage:t})}function defaultStorageComponent(r){return implementation$e({name:namespace(r)})}async function isSupported(){return localforage.supports(localforage.INDEXEDDB)&&await(()=>new Promise(r=>{const e=indexedDB.open("testDatabase");e.onsuccess=()=>r(!0),e.onerror=()=>r(!1)}))()}async function ensureBackwardsCompatibility(r,e){const[t,n]=["migrated",VERSION],o=fromString$3(VERSION);if(!o)throw new Error("The webnative VERSION should be a semver string");if(await r.storage.getItem(t).then(h=>typeof h=="string"?fromString$3(h):null).then(h=>h&&isBiggerThanOrEqualTo(h,o))||!globalThis.indexedDB)return;const u=globalThis.indexedDB.databases?(await globalThis.indexedDB.databases()).map(h=>h.name):["keystore","localforage"],f=u.includes("keystore")?await bwOpenDatabase("keystore"):null;if(f){const h=await bwGetValue(f,"keyvaluepairs","exchange-key"),p=await bwGetValue(f,"keyvaluepairs","write-key");h&&p&&(await r.storage.setItem("exchange-key",h),await r.storage.setItem("write-key",p))}const l=u.includes("localforage")?await bwOpenDatabase("localforage"):null;if(l){const h=await bwGetValue(l,"keyvaluepairs","ucan"),p=await bwGetValue(l,"keyvaluepairs","webnative.auth_ucans"),m=await bwGetValue(l,"keyvaluepairs","readKey"),b=await bwGetValue(l,"keyvaluepairs","webnative.auth_username");if(m&&isString(m)){const S=h||(Array.isArray(p)?p[0]:void 0),A=S?rootIssuer(S):typeof b=="string"?await r.reference.didRoot.lookup(b):null;if(!A)throw new Error("Failed to retrieve account DID");await store({accountDID:A,crypto:r.crypto,readKey:fromString$7(m,"base64pad")})}h&&await r.storage.setItem(r.storage.KEYS.ACCOUNT_UCAN,h),b&&await r.storage.setItem(r.storage.KEYS.SESSION,JSON.stringify({type:isCapabilityBasedAuthConfiguration(e)?SESSION_TYPE:TYPE,username:b}))}await r.storage.setItem(t,n)}function bwGetValue(r,e,t){return new Promise((n,o)=>{if(!r.objectStoreNames.contains(e))return n(null);const f=r.transaction([e],"readonly").objectStore(e).get(t);f.onerror=()=>{n(null)},f.onsuccess=()=>{n(f.result)}})}function bwOpenDatabase(r){return new Promise((e,t)=>{const n=globalThis.indexedDB.open(r);n.onerror=()=>{e(null)},n.onsuccess=()=>{e(n.result)},n.onupgradeneeded=o=>{var s;(s=n.transaction)==null||s.abort(),globalThis.indexedDB.deleteDatabase(r)}})}function extractConfig(r){return{namespace:r.namespace,debug:r.debug,fileSystem:r.fileSystem,permissions:r.permissions,userMessages:r.userMessages}}function isCapabilityBasedAuthConfiguration(r){return!!r.permissions}export{DEFAULT_THEME_KEY as D,ProgramError as P,storeTheme as a,file as b,publicKeyToDid as c,sha256$1 as d,toString$2 as e,filesystemStore as f,accountSettingsStore as g,directory as h,combine as i,isFile as j,require$$0 as k,fromString$1 as l,getSystemDefaultTheme as m,notificationStore as n,program as p,retrieve as r,sessionStore as s,themeStore as t};
