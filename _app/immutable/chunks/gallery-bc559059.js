import{$ as o}from"./index-5bd3dcd0.js";import{h as f,f as w,i as l,b as m,j as P}from"./index-29800c50.js";import{w as x}from"./preload-helper-ba922b4b.js";import{a as d}from"./notifications-4ae7a520.js";import{f as S}from"./utils-a870ce58.js";var g=(e=>(e.PUBLIC="Public",e.PRIVATE="Private",e))(g||{});const i=x({loading:!0,publicImages:[],privateImages:[],selectedArea:"Public"}),c={[g.PUBLIC]:f("public","gallery"),[g.PRIVATE]:f("private","gallery")},A=20,I=async()=>{try{i.update(t=>({...t,loading:!0}));const{selectedArea:e}=o(i),a=e===g.PRIVATE,s=o(w),u=c[e],p=await s.ls(u);let n=await Promise.all(Object.entries(p).map(async([t])=>{const r=await s.get(l(c[e],m(`${t}`)));if(!P(r))return null;const b=a?r.header.content.toString():r.cid.toString(),h=new Blob([r.content]),y=URL.createObjectURL(h),E=r.header.metadata.unixMeta.ctime;return{cid:b,ctime:E,name:t,private:a,size:p[t].size,src:y}}));n=n.filter(t=>!!t),n.sort((t,r)=>r.ctime-t.ctime),i.update(t=>({...t,...a?{privateImages:n}:{publicImages:n},loading:!1}))}catch(e){console.error(e),i.update(a=>({...a,loading:!1}))}},v=async e=>{try{const{selectedArea:a}=o(i),s=o(w);if(e.size/(1024*1024)>A)throw new Error("Image can be no larger than 20MB");if(await s.exists(l(c[a],m(e.name))))throw new Error(`${e.name} image already exists`);await s.write(l(c[a],m(e.name)),await S(e)),await s.publish(),d(`${e.name} image has been published`,"success")}catch(a){d(a.message,"error"),console.error(a)}},R=async e=>{try{const{selectedArea:a}=o(i),s=o(w);if(await s.exists(l(c[a],m(e))))await s.rm(l(c[a],m(e))),await s.publish(),d(`${e} image has been deleted`,"success"),await I();else throw new Error(`${e} image has already been deleted`)}catch(a){d(a.message,"error"),console.error(a)}},T=async e=>{await Promise.all(Array.from(e).map(async a=>{await v(a)})),await I()};export{g as A,c as G,i as a,R as d,I as g,T as h,v as u};
